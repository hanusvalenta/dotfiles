/*******************************************************
* Copyright (C) 2018-2024 WP Interactive Media, Inc. - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
*******************************************************/
(()=>{var t={7588:()=>{!function(t,e,i){"use strict";if(t.MutationObserver&&"undefined"!=typeof HTMLElement){var n,s=0,o=(n=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector,{matchesSelector:function(t,e){return t instanceof HTMLElement&&n.call(t,e)},addMethod:function(t,e,i){var n=t[e];t[e]=function(){return i.length==arguments.length?i.apply(this,arguments):"function"==typeof n?n.apply(this,arguments):void 0}},callCallbacks:function(t,e){e&&e.options.onceOnly&&1==e.firedElems.length&&(t=[t[0]]);for(var i,n=0;i=t[n];n++)i&&i.callback&&i.callback.call(i.elem,i.elem);e&&e.options.onceOnly&&1==e.firedElems.length&&e.me.unbindEventWithSelectorAndCallback.call(e.target,e.selector,e.callback)},checkChildNodesRecursively:function(t,e,i,n){for(var s,r=0;s=t[r];r++)i(s,e,n)&&n.push({callback:e.callback,elem:s}),s.childNodes.length>0&&o.checkChildNodesRecursively(s.childNodes,e,i,n)},mergeArrays:function(t,e){var i,n={};for(i in t)t.hasOwnProperty(i)&&(n[i]=t[i]);for(i in e)e.hasOwnProperty(i)&&(n[i]=e[i]);return n},toElementsArray:function(e){return void 0===e||"number"==typeof e.length&&e!==t||(e=[e]),e}}),r=function(){var t=function(){this.i=[],this.u=null,this.l=null};return t.prototype.addEvent=function(t,e,i,n){var s={target:t,selector:e,options:i,callback:n,firedElems:[]};return this.u&&this.u(s),this.i.push(s),s},t.prototype.removeEvent=function(t){for(var e,i=this.i.length-1;e=this.i[i];i--)if(t(e)){this.l&&this.l(e);var n=this.i.splice(i,1);n&&n.length&&(n[0].callback=null)}},t.prototype.beforeAdding=function(t){this.u=t},t.prototype.beforeRemoving=function(t){this.l=t},t}(),u=function(e,n){var s=new r,u=this,a={fireOnAttributesModification:!1};return s.beforeAdding((function(i){var s,o=i.target;o!==t.document&&o!==t||(o=document.getElementsByTagName("html")[0]),s=new MutationObserver((function(t){n.call(this,t,i)}));var r=e(i.options);s.observe(o,r),i.observer=s,i.me=u})),s.beforeRemoving((function(t){t.observer.disconnect()})),this.bindEvent=function(t,e,i){e=o.mergeArrays(a,e);for(var n=o.toElementsArray(this),r=0;r<n.length;r++)s.addEvent(n[r],t,e,i)},this.unbindEvent=function(){var t=o.toElementsArray(this);s.removeEvent((function(e){for(var n=0;n<t.length;n++)if(this===i||e.target===t[n])return!0;return!1}))},this.unbindEventWithSelectorOrCallback=function(t){var e,n=o.toElementsArray(this),r=t;e="function"==typeof t?function(t){for(var e=0;e<n.length;e++)if((this===i||t.target===n[e])&&t.callback===r)return!0;return!1}:function(e){for(var s=0;s<n.length;s++)if((this===i||e.target===n[s])&&e.selector===t)return!0;return!1},s.removeEvent(e)},this.unbindEventWithSelectorAndCallback=function(t,e){var n=o.toElementsArray(this);s.removeEvent((function(s){for(var o=0;o<n.length;o++)if((this===i||s.target===n[o])&&s.selector===t&&s.callback===e)return!0;return!1}))},this},a=new function(){var t={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};function e(t,e,n){return!(!o.matchesSelector(t,e.selector)||(t.D===i&&(t.D=s++),-1!=e.firedElems.indexOf(t.D)))&&(e.firedElems.push(t.D),!0)}var n=(a=new u((function(t){var e={attributes:!1,childList:!0,subtree:!0};return t.fireOnAttributesModification&&(e.attributes=!0),e}),(function(t,i){t.forEach((function(t){var n=t.addedNodes,s=t.target,r=[];null!==n&&n.length>0?o.checkChildNodesRecursively(n,i,e,r):"attributes"===t.type&&e(s,i,r)&&r.push({callback:i.callback,elem:s}),o.callCallbacks(r,i)}))}))).bindEvent;return a.bindEvent=function(e,i,s){void 0===s?(s=i,i=t):i=o.mergeArrays(t,i);var r=o.toElementsArray(this);if(i.existing){for(var u=[],a=0;a<r.length;a++)for(var c=r[a].querySelectorAll(e),h=0;h<c.length;h++)u.push({callback:s,elem:c[h]});if(i.onceOnly&&u.length)return s.call(u[0].elem,u[0].elem);setTimeout(o.callCallbacks,1,u)}n.call(this,e,i,s)},a},c=new function(){var t={};function e(t,e){return o.matchesSelector(t,e.selector)}var i=(c=new u((function(){return{childList:!0,subtree:!0}}),(function(t,i){t.forEach((function(t){var n=t.removedNodes,s=[];null!==n&&n.length>0&&o.checkChildNodesRecursively(n,i,e,s),o.callCallbacks(s,i)}))}))).bindEvent;return c.bindEvent=function(e,n,s){void 0===s?(s=n,n=t):n=o.mergeArrays(t,n),i.call(this,e,n,s)},c};e&&d(e.fn),d(HTMLElement.prototype),d(NodeList.prototype),d(HTMLCollection.prototype),d(HTMLDocument.prototype),d(Window.prototype);var h={};return l(a,h,"unbindAllArrive"),l(c,h,"unbindAllLeave"),h}function l(t,e,i){o.addMethod(e,i,t.unbindEvent),o.addMethod(e,i,t.unbindEventWithSelectorOrCallback),o.addMethod(e,i,t.unbindEventWithSelectorAndCallback)}function d(t){t.arrive=a.bindEvent,l(a,t,"unbindArrive"),t.leave=c.bindEvent,l(c,t,"unbindLeave")}}(window,"undefined"==typeof jQuery?null:jQuery,void 0)},7833:(t,e,i)=>{e.formatArgs=function(e){if(e[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+e[0]+(this.useColors?"%c ":" ")+"+"+t.exports.humanize(this.diff),!this.useColors)return;const i="color: "+this.color;e.splice(1,0,i,"color: inherit");let n=0,s=0;e[0].replace(/%[a-zA-Z%]/g,(t=>{"%%"!==t&&(n++,"%c"===t&&(s=n))})),e.splice(s,0,i)},e.save=function(t){try{t?e.storage.setItem("debug",t):e.storage.removeItem("debug")}catch(t){}},e.load=function(){let t;try{t=e.storage.getItem("debug")}catch(t){}!t&&"undefined"!=typeof process&&"env"in process&&(t="MISSING_ENV_VAR".DEBUG);return t},e.useColors=function(){if("undefined"!=typeof window&&window.process&&("renderer"===window.process.type||window.process.__nwjs))return!0;if("undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))return!1;return"undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/)},e.storage=function(){try{return localStorage}catch(t){}}(),e.destroy=(()=>{let t=!1;return()=>{t||(t=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),e.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],e.log=console.debug||console.log||(()=>{}),t.exports=i(736)(e);const{formatters:n}=t.exports;n.j=function(t){try{return JSON.stringify(t)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}},736:(t,e,i)=>{t.exports=function(t){function e(t){let i,s,o,r=null;function u(...t){if(!u.enabled)return;const n=u,s=Number(new Date),o=s-(i||s);n.diff=o,n.prev=i,n.curr=s,i=s,t[0]=e.coerce(t[0]),"string"!=typeof t[0]&&t.unshift("%O");let r=0;t[0]=t[0].replace(/%([a-zA-Z%])/g,((i,s)=>{if("%%"===i)return"%";r++;const o=e.formatters[s];if("function"==typeof o){const e=t[r];i=o.call(n,e),t.splice(r,1),r--}return i})),e.formatArgs.call(n,t);(n.log||e.log).apply(n,t)}return u.namespace=t,u.useColors=e.useColors(),u.color=e.selectColor(t),u.extend=n,u.destroy=e.destroy,Object.defineProperty(u,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==r?r:(s!==e.namespaces&&(s=e.namespaces,o=e.enabled(t)),o),set:t=>{r=t}}),"function"==typeof e.init&&e.init(u),u}function n(t,i){const n=e(this.namespace+(void 0===i?":":i)+t);return n.log=this.log,n}function s(t){return t.toString().substring(2,t.toString().length-2).replace(/\.\*\?$/,"*")}return e.debug=e,e.default=e,e.coerce=function(t){if(t instanceof Error)return t.stack||t.message;return t},e.disable=function(){const t=[...e.names.map(s),...e.skips.map(s).map((t=>"-"+t))].join(",");return e.enable(""),t},e.enable=function(t){let i;e.save(t),e.namespaces=t,e.names=[],e.skips=[];const n=("string"==typeof t?t:"").split(/[\s,]+/),s=n.length;for(i=0;i<s;i++)n[i]&&("-"===(t=n[i].replace(/\*/g,".*?"))[0]?e.skips.push(new RegExp("^"+t.slice(1)+"$")):e.names.push(new RegExp("^"+t+"$")))},e.enabled=function(t){if("*"===t[t.length-1])return!0;let i,n;for(i=0,n=e.skips.length;i<n;i++)if(e.skips[i].test(t))return!1;for(i=0,n=e.names.length;i<n;i++)if(e.names[i].test(t))return!0;return!1},e.humanize=i(6585),e.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(t).forEach((i=>{e[i]=t[i]})),e.names=[],e.skips=[],e.formatters={},e.selectColor=function(t){let i=0;for(let e=0;e<t.length;e++)i=(i<<5)-i+t.charCodeAt(e),i|=0;return e.colors[Math.abs(i)%e.colors.length]},e.enable(e.load()),e}},5089:t=>{t.exports='<div id="chat-wrapper" tpInjected>\n    <iframe\n        style="display: none"\n        id="tpChatFrame"\n        allow="autoplay; clipboard-read; web-share; clipboard-write; payment; camera; microphone;"\n        src="{CHAT_URL}"\n    >\n    </iframe>\n</div>\n'},7076:t=>{t.exports='<style tpInjected>\n    .hidden {\n        display: none !important;\n    }\n</style>\n<div class="hidden" id="tpIconContainer" tpInjected>\n    <div class="hidden" id="tp-buttons-container">\n        <button id="tp-icon-container">\n            <img id="tp-icon-white" src="{EXTENSION_LOGO_GRADIENT}" />\n            <img id="play-chat-icon" class="hidden" src="{PLAY_CHAT}" />\n            <span class="tooltiptext extension-txt" style="width: 120px">Open Teleparty</span>\n            <div class="hidden" id="tp-message-indicator"></div>\n        </button>\n        <div class="tp-seperator"></div>\n        \x3c!-- <button class="tp-control-button" id="tp-friends-button">\n            <img id="tp-friends-image" src=\'{FRIENDS_IMAGE}\' />\n            <span class="tooltiptext extension-txt" style="width: 120px;"> Friends List</span>\n        </button> --\x3e\n        <div class="hidden" id="tp-party-active">\n            <button class="tp-control-button" id="tp-link-button">\n                <img class="tp-button-image tp-center-image" data-tp-id="overlay-copy_link" src="{LINK_IMAGE}" />\n                <img class="tp-hover-image tp-center-image" data-tp-id="overlay-copy_link" src="{LINK_ACTIVE_IMAGE}" />\n                <span class="tooltiptext extension-txt" style="width: 120px">Copy link</span>\n            </button>\n            <button class="tp-control-button" id="tp-chat-button">\n                <img\n                    id="tp-chat-reset"\n                    class="tp-center-image hidden"\n                    data-tp-id="overlay-reset_chat"\n                    src="{RESET_CHAT_IMAGE}"\n                />\n                <img id="tp-chat-hidden" class="tp-button-image tp-center-image" src="{CHAT_HIDDEN_IMAGE}" />\n                <img id="tp-chat-gray" class="hidden tp-button-image tp-center-image" src="{CHAT_GRAY_IMAGE}" />\n                <img class="tp-hover-image tp-center-image" data-tp-id="overlay-show_chat" src="{CHAT_ACTIVE_IMAGE}" />\n                <div class="hidden" id="tp-message-indicator"></div>\n                <span class="tooltiptext extension-txt" style="width: 120px">Show chat</span>\n            </button>\n            <button class="tp-control-button" id="tp-disconnect-button">\n                <img\n                    class="tp-button-image tp-center-image"\n                    data-tp-id="overlay-leave_party"\n                    src="{DISCONNECT_IMAGE}"\n                />\n                <img class="tp-hover-image tp-center-image" data-tp-id="overlay-leave_party" src="{DISCONNECT_IMAGE}" />\n                <span class="tooltiptext extension-txt" style="width: 120px">Leave Party</span>\n            </button>\n        </div>\n    </div>\n    \x3c!-- <button class="hidden tp-control-button" id="tp-chat-close-button">\n        <img id="tp-start-image" data-tp-id="overlay-hide_chat" src=\'{ARROW_RIGHT}\' />\n        <span class="tooltiptext extension-txt" style="width: 100px;">Hide chat</span>\n    </button> --\x3e\n    <div id="tp-error-box" class="hidden">\n        <p class="extension-txt-indicator" id="tp-controls-error-text">\n            Failed to connect to background script. Please Try again later\n        </p>\n    </div>\n</div>\n'},6585:t=>{var e=1e3,i=60*e,n=60*i,s=24*n,o=7*s,r=365.25*s;function u(t,e,i,n){var s=e>=1.5*i;return Math.round(t/i)+" "+n+(s?"s":"")}t.exports=function(t,a){a=a||{};var c=typeof t;if("string"===c&&t.length>0)return function(t){if((t=String(t)).length>100)return;var u=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(t);if(!u)return;var a=parseFloat(u[1]);switch((u[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return a*r;case"weeks":case"week":case"w":return a*o;case"days":case"day":case"d":return a*s;case"hours":case"hour":case"hrs":case"hr":case"h":return a*n;case"minutes":case"minute":case"mins":case"min":case"m":return a*i;case"seconds":case"second":case"secs":case"sec":case"s":return a*e;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return a;default:return}}(t);if("number"===c&&isFinite(t))return a.long?function(t){var o=Math.abs(t);if(o>=s)return u(t,o,s,"day");if(o>=n)return u(t,o,n,"hour");if(o>=i)return u(t,o,i,"minute");if(o>=e)return u(t,o,e,"second");return t+" ms"}(t):function(t){var o=Math.abs(t);if(o>=s)return Math.round(t/s)+"d";if(o>=n)return Math.round(t/n)+"h";if(o>=i)return Math.round(t/i)+"m";if(o>=e)return Math.round(t/e)+"s";return t+"ms"}(t);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(t))}}},e={};function i(n){var s=e[n];if(void 0!==s)return s.exports;var o=e[n]={exports:{}};return t[n](o,o.exports,i),o.exports}i.n=t=>{var e=t&&t.p?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var n in e)i.o(e,n)&&!i.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{"use strict";var t;!function(t){t[t.CHROME=1]="CHROME",t[t.FIREFOX=2]="FIREFOX",t[t.EDGE=4]="EDGE",t[t.SAFARI=8]="SAFARI"}(t||(t={}));t.CHROME;var e=console.log.bind(self.console),n=i(5089),s=i.n(n);const o="https://api.teleparty.com",r="https://www.teleparty.com";const u=340,a=chrome.runtime.id,c=(chrome.runtime.getManifest().version,"reactionContainerOpen"),h="https://sessions.teleparty.com",l=`${r}/sidebar`,d=["heart","angry","fire","laugh","surprise","cry"],D=["heart","angry","fire","laugh","surprise","cry"],p="recentlyUsedEmojiMap",v="redirectDataMap",g=[{annotation:"face with tears of joy",group:0,order:8,tags:["face","joy","laugh","tear"],unicode:"üòÇ",version:.6,emoticon:":')",shortcodes:["joy","lmao","tears_of_joy"]},{annotation:"smiling face with heart-eyes",group:0,order:16,tags:["eye","face","love","smile"],unicode:"üòç",version:.6,shortcodes:["heart_eyes","smiling_face_with_heart_eyes"]},{shortcodes:["loudly_crying_face","sob"],annotation:"loudly crying face",tags:["cry","face","sad","sob","tear"],unicode:"üò≠",order:93,group:0,version:.6,emoticon:":'o"},{shortcodes:["pleading","pleading_face"],annotation:"pleading face",tags:["begging","mercy","puppy eyes"],unicode:"ü•∫",order:85,group:0,version:11},{shortcodes:["rofl"],annotation:"rolling on the floor laughing",tags:["face","floor","laugh","rofl","rolling","rotfl"],unicode:"ü§£",order:7,group:0,version:3,emoticon:":'D"},{annotation:"red heart",group:0,order:149,tags:["heart"],unicode:"‚ù§Ô∏è",version:.6,emoticon:"<3",shortcodes:["heart","red_heart"]}],f=/(?:\uD83D(?:\uDD73\uFE0F?|\uDC41(?:(?:\uFE0F(?:\u200D\uD83D\uDDE8\uFE0F?)?|\u200D\uD83D\uDDE8\uFE0F?))?|[\uDDE8\uDDEF]\uFE0F?|\uDC4B(?:\uD83C[\uDFFB-\uDFFF])?|\uDD90(?:(?:\uD83C[\uDFFB-\uDFFF]|\uFE0F))?|[\uDD96\uDC4C\uDC48\uDC49\uDC46\uDD95\uDC47\uDC4D\uDC4E\uDC4A\uDC4F\uDE4C\uDC50\uDE4F\uDC85\uDCAA\uDC42\uDC43\uDC76\uDC66\uDC67](?:\uD83C[\uDFFB-\uDFFF])?|\uDC71(?:(?:\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2640\u2642]\uFE0F?))?)|\u200D(?:[\u2640\u2642]\uFE0F?)))?|\uDC68(?:(?:\uD83C(?:\uDFFB(?:\u200D(?:\uD83E(?:\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFC-\uDFFF]|[\uDDB0\uDDB1\uDDB3\uDDB2\uDDAF\uDDBC\uDDBD])|\u2695\uFE0F?|\uD83C[\uDF93\uDFEB\uDF3E\uDF73\uDFED\uDFA4\uDFA8]|\u2696\uFE0F?|\uD83D[\uDD27\uDCBC\uDD2C\uDCBB\uDE80\uDE92]|\u2708\uFE0F?))?|\uDFFC(?:\u200D(?:\uD83E(?:\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFD-\uDFFF]|[\uDDB0\uDDB1\uDDB3\uDDB2\uDDAF\uDDBC\uDDBD])|\u2695\uFE0F?|\uD83C[\uDF93\uDFEB\uDF3E\uDF73\uDFED\uDFA4\uDFA8]|\u2696\uFE0F?|\uD83D[\uDD27\uDCBC\uDD2C\uDCBB\uDE80\uDE92]|\u2708\uFE0F?))?|\uDFFD(?:\u200D(?:\uD83E(?:\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF]|[\uDDB0\uDDB1\uDDB3\uDDB2\uDDAF\uDDBC\uDDBD])|\u2695\uFE0F?|\uD83C[\uDF93\uDFEB\uDF3E\uDF73\uDFED\uDFA4\uDFA8]|\u2696\uFE0F?|\uD83D[\uDD27\uDCBC\uDD2C\uDCBB\uDE80\uDE92]|\u2708\uFE0F?))?|\uDFFE(?:\u200D(?:\uD83E(?:\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFD\uDFFF]|[\uDDB0\uDDB1\uDDB3\uDDB2\uDDAF\uDDBC\uDDBD])|\u2695\uFE0F?|\uD83C[\uDF93\uDFEB\uDF3E\uDF73\uDFED\uDFA4\uDFA8]|\u2696\uFE0F?|\uD83D[\uDD27\uDCBC\uDD2C\uDCBB\uDE80\uDE92]|\u2708\uFE0F?))?|\uDFFF(?:\u200D(?:\uD83E(?:\uDD1D\u200D\uD83D\uDC68\uD83C[\uDFFB-\uDFFE]|[\uDDB0\uDDB1\uDDB3\uDDB2\uDDAF\uDDBC\uDDBD])|\u2695\uFE0F?|\uD83C[\uDF93\uDFEB\uDF3E\uDF73\uDFED\uDFA4\uDFA8]|\u2696\uFE0F?|\uD83D[\uDD27\uDCBC\uDD2C\uDCBB\uDE80\uDE92]|\u2708\uFE0F?))?)|\u200D(?:\uD83E[\uDDB0\uDDB1\uDDB3\uDDB2\uDDAF\uDDBC\uDDBD]|\u2695\uFE0F?|\uD83C[\uDF93\uDFEB\uDF3E\uDF73\uDFED\uDFA4\uDFA8]|\u2696\uFE0F?|\uD83D(?:\uDC69\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uDC68\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?|[\uDD27\uDCBC\uDD2C\uDCBB\uDE80\uDE92])|\u2708\uFE0F?|\u2764(?:\uFE0F\u200D\uD83D(?:\uDC8B\u200D\uD83D\uDC68|\uDC68)|\u200D\uD83D(?:\uDC8B\u200D\uD83D\uDC68|\uDC68)))))?|\uDC69(?:(?:\uD83C(?:\uDFFB(?:\u200D(?:\uD83E(?:\uDD1D\u200D\uD83D(?:\uDC69\uD83C[\uDFFC-\uDFFF]|\uDC68\uD83C[\uDFFC-\uDFFF])|[\uDDB0\uDDB1\uDDB3\uDDB2\uDDAF\uDDBC\uDDBD])|\u2695\uFE0F?|\uD83C[\uDF93\uDFEB\uDF3E\uDF73\uDFED\uDFA4\uDFA8]|\u2696\uFE0F?|\uD83D[\uDD27\uDCBC\uDD2C\uDCBB\uDE80\uDE92]|\u2708\uFE0F?))?|\uDFFC(?:\u200D(?:\uD83E(?:\uDD1D\u200D\uD83D(?:\uDC69\uD83C[\uDFFB\uDFFD-\uDFFF]|\uDC68\uD83C[\uDFFB\uDFFD-\uDFFF])|[\uDDB0\uDDB1\uDDB3\uDDB2\uDDAF\uDDBC\uDDBD])|\u2695\uFE0F?|\uD83C[\uDF93\uDFEB\uDF3E\uDF73\uDFED\uDFA4\uDFA8]|\u2696\uFE0F?|\uD83D[\uDD27\uDCBC\uDD2C\uDCBB\uDE80\uDE92]|\u2708\uFE0F?))?|\uDFFD(?:\u200D(?:\uD83E(?:\uDD1D\u200D\uD83D(?:\uDC69\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF]|\uDC68\uD83C[\uDFFB\uDFFC\uDFFE\uDFFF])|[\uDDB0\uDDB1\uDDB3\uDDB2\uDDAF\uDDBC\uDDBD])|\u2695\uFE0F?|\uD83C[\uDF93\uDFEB\uDF3E\uDF73\uDFED\uDFA4\uDFA8]|\u2696\uFE0F?|\uD83D[\uDD27\uDCBC\uDD2C\uDCBB\uDE80\uDE92]|\u2708\uFE0F?))?|\uDFFE(?:\u200D(?:\uD83E(?:\uDD1D\u200D\uD83D(?:\uDC69\uD83C[\uDFFB-\uDFFD\uDFFF]|\uDC68\uD83C[\uDFFB-\uDFFD\uDFFF])|[\uDDB0\uDDB1\uDDB3\uDDB2\uDDAF\uDDBC\uDDBD])|\u2695\uFE0F?|\uD83C[\uDF93\uDFEB\uDF3E\uDF73\uDFED\uDFA4\uDFA8]|\u2696\uFE0F?|\uD83D[\uDD27\uDCBC\uDD2C\uDCBB\uDE80\uDE92]|\u2708\uFE0F?))?|\uDFFF(?:\u200D(?:\uD83E(?:\uDD1D\u200D\uD83D(?:\uDC69\uD83C[\uDFFB-\uDFFE]|\uDC68\uD83C[\uDFFB-\uDFFE])|[\uDDB0\uDDB1\uDDB3\uDDB2\uDDAF\uDDBC\uDDBD])|\u2695\uFE0F?|\uD83C[\uDF93\uDFEB\uDF3E\uDF73\uDFED\uDFA4\uDFA8]|\u2696\uFE0F?|\uD83D[\uDD27\uDCBC\uDD2C\uDCBB\uDE80\uDE92]|\u2708\uFE0F?))?)|\u200D(?:\uD83E[\uDDB0\uDDB1\uDDB3\uDDB2\uDDAF\uDDBC\uDDBD]|\u2695\uFE0F?|\uD83C[\uDF93\uDFEB\uDF3E\uDF73\uDFED\uDFA4\uDFA8]|\u2696\uFE0F?|\uD83D(?:\uDC69\u200D\uD83D(?:\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?)|\uDC66(?:\u200D\uD83D\uDC66)?|\uDC67(?:\u200D\uD83D[\uDC66\uDC67])?|[\uDD27\uDCBC\uDD2C\uDCBB\uDE80\uDE92])|\u2708\uFE0F?|\u2764(?:\uFE0F\u200D\uD83D(?:\uDC8B\u200D\uD83D[\uDC68\uDC69]|[\uDC68\uDC69])|\u200D\uD83D(?:\uDC8B\u200D\uD83D[\uDC68\uDC69]|[\uDC68\uDC69])))))?|[\uDC74\uDC75](?:\uD83C[\uDFFB-\uDFFF])?|[\uDE4D\uDE4E\uDE45\uDE46\uDC81\uDE4B\uDE47\uDC6E](?:(?:\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?)|\u200D(?:[\u2642\u2640]\uFE0F?)))?|\uDD75(?:(?:\uFE0F(?:\u200D(?:[\u2642\u2640]\uFE0F?))?|\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?)|\u200D(?:[\u2642\u2640]\uFE0F?)))?|[\uDC82\uDC77](?:(?:\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?)|\u200D(?:[\u2642\u2640]\uFE0F?)))?|\uDC78(?:\uD83C[\uDFFB-\uDFFF])?|\uDC73(?:(?:\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?)|\u200D(?:[\u2642\u2640]\uFE0F?)))?|[\uDC72\uDC70\uDC7C](?:\uD83C[\uDFFB-\uDFFF])?|[\uDC86\uDC87\uDEB6](?:(?:\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?)|\u200D(?:[\u2642\u2640]\uFE0F?)))?|[\uDC83\uDD7A](?:\uD83C[\uDFFB-\uDFFF])?|\uDD74(?:(?:\uD83C[\uDFFB-\uDFFF]|\uFE0F))?|\uDC6F(?:\u200D(?:[\u2642\u2640]\uFE0F?))?|[\uDEA3\uDEB4\uDEB5](?:(?:\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?)|\u200D(?:[\u2642\u2640]\uFE0F?)))?|[\uDEC0\uDECC\uDC6D\uDC6B\uDC6C](?:\uD83C[\uDFFB-\uDFFF])?|\uDDE3\uFE0F?|\uDC15(?:\u200D\uD83E\uDDBA)?|[\uDC3F\uDD4A\uDD77\uDD78\uDDFA\uDEE3\uDEE4\uDEE2\uDEF3\uDEE5\uDEE9\uDEF0\uDECE\uDD70\uDD79\uDDBC\uDD76\uDECD\uDDA5\uDDA8\uDDB1\uDDB2\uDCFD\uDD6F\uDDDE\uDDF3\uDD8B\uDD8A\uDD8C\uDD8D\uDDC2\uDDD2\uDDD3\uDD87\uDDC3\uDDC4\uDDD1\uDDDD\uDEE0\uDDE1\uDEE1\uDDDC\uDECF\uDECB\uDD49]\uFE0F?|[\uDE00\uDE03\uDE04\uDE01\uDE06\uDE05\uDE02\uDE42\uDE43\uDE09\uDE0A\uDE07\uDE0D\uDE18\uDE17\uDE1A\uDE19\uDE0B\uDE1B-\uDE1D\uDE10\uDE11\uDE36\uDE0F\uDE12\uDE44\uDE2C\uDE0C\uDE14\uDE2A\uDE34\uDE37\uDE35\uDE0E\uDE15\uDE1F\uDE41\uDE2E\uDE2F\uDE32\uDE33\uDE26-\uDE28\uDE30\uDE25\uDE22\uDE2D\uDE31\uDE16\uDE23\uDE1E\uDE13\uDE29\uDE2B\uDE24\uDE21\uDE20\uDE08\uDC7F\uDC80\uDCA9\uDC79-\uDC7B\uDC7D\uDC7E\uDE3A\uDE38\uDE39\uDE3B-\uDE3D\uDE40\uDE3F\uDE3E\uDE48-\uDE4A\uDC8B\uDC8C\uDC98\uDC9D\uDC96\uDC97\uDC93\uDC9E\uDC95\uDC9F\uDC94\uDC9B\uDC9A\uDC99\uDC9C\uDDA4\uDCAF\uDCA2\uDCA5\uDCAB\uDCA6\uDCA8\uDCA3\uDCAC\uDCAD\uDCA4\uDC40\uDC45\uDC44\uDC8F\uDC91\uDC6A\uDC64\uDC65\uDC63\uDC35\uDC12\uDC36\uDC29\uDC3A\uDC31\uDC08\uDC2F\uDC05\uDC06\uDC34\uDC0E\uDC2E\uDC02-\uDC04\uDC37\uDC16\uDC17\uDC3D\uDC0F\uDC11\uDC10\uDC2A\uDC2B\uDC18\uDC2D\uDC01\uDC00\uDC39\uDC30\uDC07\uDC3B\uDC28\uDC3C\uDC3E\uDC14\uDC13\uDC23-\uDC27\uDC38\uDC0A\uDC22\uDC0D\uDC32\uDC09\uDC33\uDC0B\uDC2C\uDC1F-\uDC21\uDC19\uDC1A\uDC0C\uDC1B-\uDC1E\uDC90\uDCAE\uDD2A\uDDFE\uDDFB\uDC92\uDDFC\uDDFD\uDD4C\uDED5\uDD4D\uDD4B\uDC88\uDE82-\uDE8A\uDE9D\uDE9E\uDE8B-\uDE8E\uDE90-\uDE9C\uDEF5\uDEFA\uDEB2\uDEF4\uDEF9\uDE8F\uDEA8\uDEA5\uDEA6\uDED1\uDEA7\uDEF6\uDEA4\uDEA2\uDEEB\uDEEC\uDCBA\uDE81\uDE9F-\uDEA1\uDE80\uDEF8\uDD5B\uDD67\uDD50\uDD5C\uDD51\uDD5D\uDD52\uDD5E\uDD53\uDD5F\uDD54\uDD60\uDD55\uDD61\uDD56\uDD62\uDD57\uDD63\uDD58\uDD64\uDD59\uDD65\uDD5A\uDD66\uDD25\uDCA7\uDEF7\uDD2E\uDC53-\uDC62\uDC51\uDC52\uDCFF\uDC84\uDC8D\uDC8E\uDD07-\uDD0A\uDCE2\uDCE3\uDCEF\uDD14\uDD15\uDCFB\uDCF1\uDCF2\uDCDE-\uDCE0\uDD0B\uDD0C\uDCBB\uDCBD-\uDCC0\uDCFA\uDCF7-\uDCF9\uDCFC\uDD0D\uDD0E\uDCA1\uDD26\uDCD4-\uDCDA\uDCD3\uDCD2\uDCC3\uDCDC\uDCC4\uDCF0\uDCD1\uDD16\uDCB0\uDCB4-\uDCB8\uDCB3\uDCB9\uDCB1\uDCB2\uDCE7-\uDCE9\uDCE4-\uDCE6\uDCEB\uDCEA\uDCEC-\uDCEE\uDCDD\uDCBC\uDCC1\uDCC2\uDCC5-\uDCD0\uDD12\uDD13\uDD0F-\uDD11\uDD28\uDD2B\uDD27\uDD29\uDD17\uDD2C\uDD2D\uDCE1\uDC89\uDC8A\uDEAA\uDEBD\uDEBF\uDEC1\uDED2\uDEAC\uDDFF\uDEAE\uDEB0\uDEB9-\uDEBC\uDEBE\uDEC2-\uDEC5\uDEB8\uDEAB\uDEB3\uDEAD\uDEAF\uDEB1\uDEB7\uDCF5\uDD1E\uDD03\uDD04\uDD19-\uDD1D\uDED0\uDD4E\uDD2F\uDD00-\uDD02\uDD3C\uDD3D\uDD05\uDD06\uDCF6\uDCF3\uDCF4\uDD31\uDCDB\uDD30\uDD1F-\uDD24\uDD34\uDFE0-\uDFE2\uDD35\uDFE3-\uDFE5\uDFE7-\uDFE9\uDFE6\uDFEA\uDFEB\uDD36-\uDD3B\uDCA0\uDD18\uDD33\uDD32\uDEA9])|\uD83E(?:[\uDD1A\uDD0F\uDD1E\uDD1F\uDD18\uDD19\uDD1B\uDD1C\uDD32\uDD33\uDDB5\uDDB6\uDDBB\uDDD2](?:\uD83C[\uDFFB-\uDFFF])?|\uDDD1(?:(?:\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:\uD83E(?:\uDD1D\u200D\uD83E\uDDD1\uD83C[\uDFFB-\uDFFF]|[\uDDB0\uDDB1\uDDB3\uDDB2\uDDAF\uDDBC\uDDBD])|\u2695\uFE0F?|\uD83C[\uDF93\uDFEB\uDF3E\uDF73\uDFED\uDFA4\uDFA8]|\u2696\uFE0F?|\uD83D[\uDD27\uDCBC\uDD2C\uDCBB\uDE80\uDE92]|\u2708\uFE0F?))?)|\u200D(?:\uD83E(?:\uDD1D\u200D\uD83E\uDDD1|[\uDDB0\uDDB1\uDDB3\uDDB2\uDDAF\uDDBC\uDDBD])|\u2695\uFE0F?|\uD83C[\uDF93\uDFEB\uDF3E\uDF73\uDFED\uDFA4\uDFA8]|\u2696\uFE0F?|\uD83D[\uDD27\uDCBC\uDD2C\uDCBB\uDE80\uDE92]|\u2708\uFE0F?)))?|[\uDDD4\uDDD3](?:\uD83C[\uDFFB-\uDFFF])?|[\uDDCF\uDD26\uDD37](?:(?:\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?)|\u200D(?:[\u2642\u2640]\uFE0F?)))?|[\uDD34\uDDD5\uDD35\uDD30\uDD31\uDD36](?:\uD83C[\uDFFB-\uDFFF])?|[\uDDB8\uDDB9\uDDD9-\uDDDD](?:(?:\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?)|\u200D(?:[\u2642\u2640]\uFE0F?)))?|[\uDDDE\uDDDF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?|[\uDDCD\uDDCE\uDDD6\uDDD7\uDD38](?:(?:\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?)|\u200D(?:[\u2642\u2640]\uFE0F?)))?|\uDD3C(?:\u200D(?:[\u2642\u2640]\uFE0F?))?|[\uDD3D\uDD3E\uDD39\uDDD8](?:(?:\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?)|\u200D(?:[\u2642\u2640]\uFE0F?)))?|[\uDD23\uDD70\uDD29\uDD2A\uDD11\uDD17\uDD2D\uDD2B\uDD14\uDD10\uDD28\uDD25\uDD24\uDD12\uDD15\uDD22\uDD2E\uDD27\uDD75\uDD76\uDD74\uDD2F\uDD20\uDD73\uDD13\uDDD0\uDD7A\uDD71\uDD2C\uDD21\uDD16\uDDE1\uDD0E\uDD0D\uDD1D\uDDBE\uDDBF\uDDE0\uDDB7\uDDB4\uDD3A\uDDB0\uDDB1\uDDB3\uDDB2\uDD8D\uDDA7\uDDAE\uDD8A\uDD9D\uDD81\uDD84\uDD93\uDD8C\uDD99\uDD92\uDD8F\uDD9B\uDD94\uDD87\uDDA5\uDDA6\uDDA8\uDD98\uDDA1\uDD83\uDD85\uDD86\uDDA2\uDD89\uDDA9\uDD9A\uDD9C\uDD8E\uDD95\uDD96\uDD88\uDD8B\uDD97\uDD82\uDD9F\uDDA0\uDD40\uDD6D\uDD5D\uDD65\uDD51\uDD54\uDD55\uDD52\uDD6C\uDD66\uDDC4\uDDC5\uDD5C\uDD50\uDD56\uDD68\uDD6F\uDD5E\uDDC7\uDDC0\uDD69\uDD53\uDD6A\uDD59\uDDC6\uDD5A\uDD58\uDD63\uDD57\uDDC8\uDDC2\uDD6B\uDD6E\uDD5F-\uDD61\uDD80\uDD9E\uDD90\uDD91\uDDAA\uDDC1\uDD67\uDD5B\uDD42\uDD43\uDD64\uDDC3\uDDC9\uDDCA\uDD62\uDD44\uDDED\uDDF1\uDDBD\uDDBC\uDE82\uDDF3\uDE90\uDDE8\uDDE7\uDD47-\uDD49\uDD4E\uDD4F\uDD4D\uDD4A\uDD4B\uDD45\uDD3F\uDD4C\uDE80\uDE81\uDDFF\uDDE9\uDDF8\uDDF5\uDDF6\uDD7D\uDD7C\uDDBA\uDDE3-\uDDE6\uDD7B\uDE71-\uDE73\uDD7E\uDD7F\uDE70\uDDE2\uDE95\uDD41\uDDEE\uDE94\uDDFE\uDE93\uDDAF\uDDF0\uDDF2\uDDEA-\uDDEC\uDE78-\uDE7A\uDE91\uDE92\uDDF4\uDDF7\uDDF9-\uDDFD\uDDEF])|[\u263A\u2639\u2620\u2763\u2764]\uFE0F?|\u270B(?:\uD83C[\uDFFB-\uDFFF])?|[\u270C\u261D](?:(?:\uD83C[\uDFFB-\uDFFF]|\uFE0F))?|\u270A(?:\uD83C[\uDFFB-\uDFFF])?|\u270D(?:(?:\uD83C[\uDFFB-\uDFFF]|\uFE0F))?|\uD83C(?:\uDF85(?:\uD83C[\uDFFB-\uDFFF])?|\uDFC3(?:(?:\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?)|\u200D(?:[\u2642\u2640]\uFE0F?)))?|[\uDFC7\uDFC2](?:\uD83C[\uDFFB-\uDFFF])?|\uDFCC(?:(?:\uFE0F(?:\u200D(?:[\u2642\u2640]\uFE0F?))?|\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?)|\u200D(?:[\u2642\u2640]\uFE0F?)))?|[\uDFC4\uDFCA](?:(?:\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?)|\u200D(?:[\u2642\u2640]\uFE0F?)))?|\uDFCB(?:(?:\uFE0F(?:\u200D(?:[\u2642\u2640]\uFE0F?))?|\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?)|\u200D(?:[\u2642\u2640]\uFE0F?)))?|[\uDFF5\uDF36\uDF7D\uDFD4-\uDFD6\uDFDC-\uDFDF\uDFDB\uDFD7\uDFD8\uDFDA\uDFD9\uDFCE\uDFCD\uDF21\uDF24-\uDF2C\uDF97\uDF9F\uDF96\uDF99-\uDF9B\uDF9E\uDFF7\uDD70\uDD71\uDD7E\uDD7F\uDE02\uDE37]\uFE0F?|\uDFF4(?:(?:\u200D\u2620\uFE0F?|\uDB40\uDC67\uDB40\uDC62\uDB40(?:\uDC65\uDB40\uDC6E\uDB40\uDC67\uDB40\uDC7F|\uDC73\uDB40\uDC63\uDB40\uDC74\uDB40\uDC7F|\uDC77\uDB40\uDC6C\uDB40\uDC73\uDB40\uDC7F)))?|\uDFF3(?:(?:\uFE0F(?:\u200D\uD83C\uDF08)?|\u200D\uD83C\uDF08))?|\uDDE6\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF]|\uDDE7\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF]|\uDDE8\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF]|\uDDE9\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF]|\uDDEA\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA]|\uDDEB\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7]|\uDDEC\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE]|\uDDED\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA]|\uDDEE\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9]|\uDDEF\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5]|\uDDF0\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF]|\uDDF1\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE]|\uDDF2\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF]|\uDDF3\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF]|\uDDF4\uD83C\uDDF2|\uDDF5\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE]|\uDDF6\uD83C\uDDE6|\uDDF7\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC]|\uDDF8\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF]|\uDDF9\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF]|\uDDFA\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF]|\uDDFB\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA]|\uDDFC\uD83C[\uDDEB\uDDF8]|\uDDFD\uD83C\uDDF0|\uDDFE\uD83C[\uDDEA\uDDF9]|\uDDFF\uD83C[\uDDE6\uDDF2\uDDFC]|[\uDFFB-\uDFFF\uDF38-\uDF3C\uDF37\uDF31-\uDF35\uDF3E-\uDF43\uDF47-\uDF53\uDF45\uDF46\uDF3D\uDF44\uDF30\uDF5E\uDF56\uDF57\uDF54\uDF5F\uDF55\uDF2D-\uDF2F\uDF73\uDF72\uDF7F\uDF71\uDF58-\uDF5D\uDF60\uDF62-\uDF65\uDF61\uDF66-\uDF6A\uDF82\uDF70\uDF6B-\uDF6F\uDF7C\uDF75\uDF76\uDF7E\uDF77-\uDF7B\uDF74\uDFFA\uDF0D-\uDF10\uDF0B\uDFE0-\uDFE6\uDFE8-\uDFED\uDFEF\uDFF0\uDF01\uDF03-\uDF07\uDF09\uDFA0-\uDFA2\uDFAA\uDF11-\uDF20\uDF0C\uDF00\uDF08\uDF02\uDF0A\uDF83\uDF84\uDF86-\uDF8B\uDF8D-\uDF91\uDF80\uDF81\uDFAB\uDFC6\uDFC5\uDFC0\uDFD0\uDFC8\uDFC9\uDFBE\uDFB3\uDFCF\uDFD1-\uDFD3\uDFF8\uDFA3\uDFBD\uDFBF\uDFAF\uDFB1\uDFAE\uDFB0\uDFB2\uDCCF\uDC04\uDFB4\uDFAD\uDFA8\uDF92\uDFA9\uDF93\uDFBC\uDFB5\uDFB6\uDFA4\uDFA7\uDFB7-\uDFBB\uDFA5\uDFAC\uDFEE\uDFF9\uDFE7\uDFA6\uDD8E\uDD91-\uDD9A\uDE01\uDE36\uDE2F\uDE50\uDE39\uDE1A\uDE32\uDE51\uDE38\uDE34\uDE33\uDE3A\uDE35\uDFC1\uDF8C])|\u26F7\uFE0F?|\u26F9(?:(?:\uFE0F(?:\u200D(?:[\u2642\u2640]\uFE0F?))?|\uD83C(?:[\uDFFB-\uDFFF](?:\u200D(?:[\u2642\u2640]\uFE0F?))?)|\u200D(?:[\u2642\u2640]\uFE0F?)))?|[\u2618\u26F0\u26E9\u2668\u26F4\u2708\u23F1\u23F2\u2600\u2601\u26C8\u2602\u26F1\u2744\u2603\u2604\u26F8\u2660\u2665\u2666\u2663\u265F\u26D1\u260E\u2328\u2709\u270F\u2712\u2702\u26CF\u2692\u2694\u2699\u2696\u26D3\u2697\u26B0\u26B1\u26A0\u2622\u2623\u2B06\u2197\u27A1\u2198\u2B07\u2199\u2B05\u2196\u2195\u2194\u21A9\u21AA\u2934\u2935\u269B\u2721\u2638\u262F\u271D\u2626\u262A\u262E\u25B6\u23ED\u23EF\u25C0\u23EE\u23F8-\u23FA\u23CF\u2640\u2642\u2695\u267E\u267B\u269C\u2611\u2714\u2716\u303D\u2733\u2734\u2747\u203C\u2049\u3030\u00A9\u00AE\u2122]\uFE0F?|[\u0023\u002A\u0030-\u0039](?:\uFE0F\u20E3|\u20E3)|[\u2139\u24C2\u3297\u3299\u25FC\u25FB\u25AA\u25AB]\uFE0F?|[\u2615\u26EA\u26F2\u26FA\u26FD\u2693\u26F5\u231B\u23F3\u231A\u23F0\u2B50\u26C5\u2614\u26A1\u26C4\u2728\u26BD\u26BE\u26F3\u267F\u26D4\u2648-\u2653\u26CE\u23E9-\u23EC\u2B55\u2705\u274C\u274E\u2795-\u2797\u27B0\u27BF\u2753-\u2755\u2757\u26AB\u26AA\u2B1B\u2B1C\u25FE\u25FD])/g,m=["Batman.svg","DeadPool.svg","CptAmerica.svg","Wolverine.svg","IronMan.svg","Goofy.svg","Alien.svg","Mulan.svg","Snow-White.svg","Poohbear.svg","Sailormoon.svg","Sailor Cat.svg","Pizza.svg","Cookie.svg","Chocobar.svg","hotdog.svg","Hamburger.svg","Popcorn.svg","IceCream.svg","ChickenLeg.svg"],w=["General/Alien.svg","General/Batman.svg","General/ChickenLeg.svg","General/Chocobar.svg","General/Cookie.svg","General/CptAmerica.svg","General/DeadPool.svg","General/Goofy.svg","General/Hamburger.svg","General/hotdog.svg","General/IceCream.svg","General/IronMan.svg","General/Mulan.svg","General/Pizza.svg","General/Poohbear.svg","General/Popcorn.svg","General/Sailor Cat.svg","General/Sailormoon.svg","General/Snow-White.svg","General/Wolverine.svg"],F=["General/Alien.svg","General/Batman.svg","General/ChickenLeg.svg","General/Chocobar.svg","General/Cookie.svg","General/CptAmerica.svg","General/DeadPool.svg","General/Goofy.svg","General/Hamburger.svg","General/hotdog.svg","General/IceCream.svg","General/IronMan.svg","General/Mulan.svg","General/Pizza.svg","General/Poohbear.svg","General/Popcorn.svg","General/Sailor Cat.svg","General/Sailormoon.svg","General/Snow-White.svg","General/Wolverine.svg","Christmas/angel.svg","Christmas/bell.svg","Christmas/box.svg","Christmas/cane.svg","Christmas/flake.svg","Christmas/gingerbread.svg","Christmas/gingerbread_F.svg","Christmas/gingerbread_M.svg","Christmas/gloves_blue.svg","Christmas/gloves_red.svg","Christmas/hat.svg","Christmas/ornament.svg","Christmas/raindeer.svg","Christmas/reef.svg","Christmas/santa_F.svg","Christmas/santa_M.svg","Christmas/snowglobe.svg","Christmas/snowman.svg","Christmas/sock.svg","Christmas/tree.svg","Halloween/bats.svg","Halloween/candy_corn.svg","Halloween/cat_black.svg","Halloween/cat_white.svg","Halloween/coffin.svg","Halloween/eye_ball.svg","Halloween/face_angry.svg","Halloween/face_evil.svg","Halloween/face_silly.svg","Halloween/face_smile.svg","Halloween/frankenstein.svg","Halloween/ghost_F.svg","Halloween/ghost_M.svg","Halloween/gravestone.svg","Halloween/lollipop.svg","Halloween/moon.svg","Halloween/mummy.svg","Halloween/potion.svg","Halloween/pumpkin.svg","Halloween/pumpkin_witch.svg","Halloween/skull_brain.svg","Halloween/skull_candy.svg","Halloween/skull_girl.svg","Halloween/witch_hat.svg","Thanksgiving/acorn.svg","Thanksgiving/bread.svg","Thanksgiving/candles.svg","Thanksgiving/corn.svg","Thanksgiving/drinks.svg","Thanksgiving/maple_leaf.svg","Thanksgiving/plate_chicken.svg","Thanksgiving/pumpkin.svg","Thanksgiving/pumpkin_pie.svg","Thanksgiving/slice_pie.svg","Thanksgiving/sun_flower.svg","Thanksgiving/turkey_face.svg"],y={General:["Alien.svg","Batman.svg","ChickenLeg.svg","Chocobar.svg","Cookie.svg","CptAmerica.svg","DeadPool.svg","Goofy.svg","Hamburger.svg","hotdog.svg","IceCream.svg","IronMan.svg","Mulan.svg","Pizza.svg","Poohbear.svg","Popcorn.svg","Sailor Cat.svg","Sailormoon.svg","Snow-White.svg","Wolverine.svg"],Christmas:["angel.svg","bell.svg","box.svg","cane.svg","flake.svg","gingerbread.svg","gingerbread_F.svg","gingerbread_M.svg","gloves_blue.svg","gloves_red.svg","hat.svg","ornament.svg","raindeer.svg","reef.svg","santa_F.svg","santa_M.svg","snowglobe.svg","snowman.svg","sock.svg","tree.svg"],Halloween:["bats.svg","candy_corn.svg","cat_black.svg","cat_white.svg","coffin.svg","eye_ball.svg","face_angry.svg","face_evil.svg","face_silly.svg","face_smile.svg","frankenstein.svg","ghost_F.svg","ghost_M.svg","gravestone.svg","lollipop.svg","moon.svg","mummy.svg","potion.svg","pumpkin.svg","pumpkin_witch.svg","skull_brain.svg","skull_candy.svg","skull_girl.svg","witch_hat.svg"],Thanksgiving:["acorn.svg","bread.svg","candles.svg","corn.svg","drinks.svg","maple_leaf.svg","plate_chicken.svg","pumpkin.svg","pumpkin_pie.svg","slice_pie.svg","sun_flower.svg","turkey_face.svg"]},C={General:["candy_corn.webp","cat_ears.webp","devil_horn.webp","jack_o_lantern.webp","spooky_bat.webp","spooky_cat.webp","spooky_coffin.webp","spooky_ghost_night.webp","spooky_pumpkin_eye.webp","spooky_reaper_circle.webp","spooky_reaper_walking.webp","spooky_skull.webp","spooky_witch_hat.webp","vampire_teeth.webp"]};function b(t){return t?t.replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/[\r\n]{3,}/gm,"\n\n").replace(f,`<span style="font-size: ${function(t){let e=16;const i=t.replace(f,"").replace(/[\uFE0F]/g,""),n=((t||"").match(f)||[]).length;return 0===i.length&&n<=3&&(e=32),e}(t)}px">$&</span>`):t}const E={General:function(){return!0},Christmas:function(){return 11===(new Date).getMonth()},Halloween:function(){const t=new Date;return 9===t.getMonth()&&t.getDate()>=24},Thanksgiving:function(){const t=new Date;return 10===t.getMonth()&&t.getDate()>=18&&t.getDate()<=28||9===t.getMonth()&&t.getDate()>=8&&t.getDate()<=14}},_="Please open a video on Amazon Prime Video then click on the Tp icon",x="Failed to read chrome storage. Please refresh the page and try again",k="Failed to connect to Script. Please refresh the page and try again",A="An unexpected error occurred. Please refresh the page and try again.",B="Video element not found.";var I=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};const S=new class{setItemsAsync(t){return I(this,void 0,void 0,(function*(){return new Promise(((e,i)=>{chrome.storage.local.set(t,(()=>{chrome.runtime.lastError?i(new Error("Failed to write to chrome storage. Please refresh the page and try again")):e()}))}))}))}};Object.freeze(S);const j=S;var T=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class M{constructor(t){var e,i,n,s,o,r,u;this.m={userIcon:null!==(e=t.userIcon)&&void 0!==e?e:"",userIconFrame:null!==(i=t.userIconFrame)&&void 0!==i?i:"",userNickname:null!==(n=t.userNickname)&&void 0!==n?n:"",nameColor:null!==(s=t.nameColor)&&void 0!==s?s:"",badge:null!==(o=t.badge)&&void 0!==o?o:"",reactions:null!==(r=t.reactions)&&void 0!==r?r:D},this.F=null!==(u=t.userId)&&void 0!==u?u:""}saveUserIcon(t){t=b(t),this.m.userIcon=t,j.setItemsAsync({userIcon:t}),e("new user settings after set user icon: "+JSON.stringify(this.m))}saveUserNickname(t){this.m.userNickname=t,j.setItemsAsync({userNickname:t}),e("new user settings after set user nickname: "+JSON.stringify(this.m))}saveUserSettings(t){return T(this,void 0,void 0,(function*(){const i=b(t.userIcon),n=b(t.userIconFrame||"");this.m=t,this.m.userIcon=i,yield j.setItemsAsync({userNickname:t.userNickname,userIcon:i,userIconFrame:n,nameColor:t.nameColor,badge:t.badge,reactions:t.reactions}),e("new user settings after save: "+JSON.stringify(this.m))}))}get userSettings(){return this.m}get permId(){return this.F}get userIcon(){return this.m.userIcon}get userIconFrame(){return this.m.userIconFrame||""}get userNickname(){return this.m.userNickname}}const $="Service_Background",V="Popup",P="Content_Script",L="Page_Controls";var O=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};const R=new class{addListener(t){chrome.runtime.onMessage.addListener(t)}removeListener(t){chrome.runtime.onMessage.removeListener(t)}sendMessageToTabAsync(t,i,n=2e4){return O(this,void 0,void 0,(function*(){return new Promise(((s,o)=>{const r=setTimeout((()=>{console.log("send timeout"),o("Message Timeout")}),n);try{chrome.tabs.sendMessage(i,t,(i=>{chrome.runtime.lastError&&e(chrome.runtime.lastError.message+JSON.stringify(t)),clearTimeout(r),s(i)}))}catch(t){clearTimeout(r),o(t)}}))}))}C(t,e){return O(this,void 0,void 0,(function*(){return new Promise(((i,n)=>{let s=null;e&&(s=setTimeout((()=>{n({error:"Send Message Timeout"})}),e));try{chrome.runtime.sendMessage(a,t,(e=>{chrome.runtime.lastError&&console.log(chrome.runtime.lastError.message+JSON.stringify(t)),s&&clearTimeout(s),i(e)}))}catch(t){s&&clearTimeout(s),n(t)}}))}))}};class N{constructor(t,e,i){this.sender=t,this.target=e,this.type=i}}class H extends N{constructor(t,e,i){super(t,e,i),this._=i}}var U,G,z;!function(t){t.BROADCAST="brodadcast",t.BROADCAST_NEXT_EPISODE="broadcastNextEpisode",t.SEND_MESSAGE="sendMessage",t.CONTENT_SCRIPT_READY="contentScriptReady",t.CONTENT_SCRIPT_ERROR="contentScriptError",t.TEARDOWN="teardown",t.GET_SESSION_DATA="getSessionData",t.SET_TYPING="setTyping",t.SET_BUFFERING="setBuffering",t.SET_WATCHING_ADS="setWatchingAds",t.BROADCAST_USER_SETTINGS="brodadcastUserSettings",t.SEND_REACTION="sendReaction",t.SEND_GIF="sendGIF",t.WEB_RTC="webRTC",t.VALIDATION="validation"}(U||(U={}));class W extends H{constructor(t,e,i){super(t,e,U.SET_TYPING),this.data=i}}class Q extends H{constructor(t,e,i){super(t,e,U.SEND_MESSAGE),this.data=i}}class Y extends H{constructor(t,e,i){super(t,e,U.BROADCAST_USER_SETTINGS),this.data=i}}class Z extends N{constructor(t,e,i){super(t,e,i),this.type=i}}!function(t){t.JOIN_SESSION="joinSession",t.ACCEPT_DROPIN="acceptDropin",t.SET_STATUS_TYPE="setStatusType",t.SET_DATA="setData",t.GET_DATA="getData",t.GET_STATUS_TYPE="getStatusType",t.GET_PARTY_STATUS="getPartyStatus",t.GET_VIDEO_DATA="getVideoData",t.LOAD_SESSION="loadSession",t.NO_SESSION_DATA="noSessionData",t.ON_NOTIF="onNotif",t.FORWARD_TO_SIDEBAR="forwardToSidebar",t.TEARDOWN="teardown",t.ON_VIDEO_UPDATE="onVideoUpdate",t.SOCKET_LOST_CONNECTION="socketLostConnection",t.REBOOT="socketReconnect",t.LOG_EVENT="logEvent",t.LOG_EXPERIMENT="logExperiment",t.STAY_ALIVE="stayAlive",t.LOAD_CHAT_WINDOW="loadChatWindow",t.RESET_CHAT_WINDOW="resetChatWindow",t.HIDE_CHAT_WINDOW="hideChatWindow",t.SET_USER_PRESENCE="setUserPresence",t.TOGGLE_OPEN_PARTY="toggleOpenParty",t.GET_ACTIVE_PARTY="getActiveParty",t.GET_TAB_ID="getTabId",t.SET_ACTIVE_PARTY="setActiveParty",t.FULLSCREEN_WINDOW="fullscreenWindow",t.MAX_WINDOW="maxWindow",t.GET_EXPERIMENT_FLAG="getExpFlag",t.USER_LIST="userList",t.USER_AUTHENTICATED="userAuthenticated",t.BLOCK_CSP="blockCSP",t.REDIRECT_DATA_SET="redirectDataSet",t.LOAD_NETFLIX_DATA="loadNetflixData",t.TOGGLE_BACKGROUND_TAB="toggleBackgroundTab",t.GET_ALLCHAT_HAS_FOCUS="getAllchatHasFocus",t.SET_REDIRECT_URL="setRedirectUrl",t.GET_REDIRECT_URL="getRedirectUrl",t.SET_POSTHOG_DISTINCT_ID="setPosthogDistinctId",t.POSTHOG_HAS_FEATURE="posthogHasFeature",t.GET_PERM_ID="getPermId"}(G||(G={}));class J extends Z{constructor(t,e,i){super(t,e,G.TEARDOWN),this.data=i}}!function(t){t.POSTHOG="posthog",t.METIS="metis",t.BOTH="both"}(z||(z={}));class K extends Z{constructor(t,e,i,n=z.BOTH){super(t,e,G.LOG_EVENT),this.eventPipelineTarget=z.BOTH,this.data=i,this.sender=t,this.target=e,this.eventPipelineTarget=n}}class q extends H{constructor(t,e,i){super(t,e,U.SEND_REACTION),this.data=i}}class X extends H{constructor(t,e,i){super(t,e,U.SEND_GIF),this.data=i}}var tt=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class et{constructor(){this.resetTasks(),this.k=[],this.A=0,this.B=Promise.resolve(),this.I=!0}createInstance(){return new et}pushTask(t,e){if(!this.I)return;const i={action:t,name:e};0===this.A&&this.resetTasks(),this.A=this.k.push(i),this.B=this.B.then((()=>{if(this.k.includes(i)&&this.I)return this.S(i)().then((()=>{this.k.shift(),this.A-=1}))}))}disable(){this.I=!1,this.resetTasks()}resetTasks(){this.B=Promise.resolve(),this.k=[],this.A=0}S(t){return function(){return tt(this,void 0,void 0,(function*(){try{yield t.action()}catch(t){}}))}}get tasksInFlight(){return this.A}hasTaskInQueue(t){return this.k.some((e=>e.name===t))}removeTask(t){console.log(this.k),this.k=this.k.filter(((e,i)=>e.name===t&&0==i?(console.error("Cannot filter active task"),!0):e.name!==t)),this.A=this.k.length,console.log(this.k)}}const it=new et;var nt=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};const st=new class{getItemAsync(t){var e;return nt(this,void 0,void 0,(function*(){const i=yield chrome.storage.local.get(t);return null!==(e=i[t])&&void 0!==e?e:null}))}getItemsAsync(t){return nt(this,void 0,void 0,(function*(){return new Promise(((e,i)=>{chrome.storage.local.get(t,(t=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError),i(new Error(x))):e(t)}))}))}))}getStorageUse(){return nt(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{chrome.storage.local.getBytesInUse(null,(i=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError),e(new Error(x))):t(i)}))}))}))}getAllItemsAsync(){return nt(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{chrome.storage.local.get(null,(i=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError),e(new Error(x))):t(i)}))}))}))}};Object.freeze(st);const ot=st;var rt,ut=new Uint8Array(16);function at(){if(!rt&&!(rt="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return rt(ut)}const ct=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;const ht=function(t){return"string"==typeof t&&ct.test(t)};for(var lt=[],dt=0;dt<256;++dt)lt.push((dt+256).toString(16).substr(1));const Dt=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=(lt[t[e+0]]+lt[t[e+1]]+lt[t[e+2]]+lt[t[e+3]]+"-"+lt[t[e+4]]+lt[t[e+5]]+"-"+lt[t[e+6]]+lt[t[e+7]]+"-"+lt[t[e+8]]+lt[t[e+9]]+"-"+lt[t[e+10]]+lt[t[e+11]]+lt[t[e+12]]+lt[t[e+13]]+lt[t[e+14]]+lt[t[e+15]]).toLowerCase();if(!ht(i))throw TypeError("Stringified UUID is invalid");return i};const pt=function(t,e,i){var n=(t=t||{}).random||(t.rng||at)();if(n[6]=15&n[6]|64,n[8]=63&n[8]|128,e){i=i||0;for(var s=0;s<16;++s)e[i+s]=n[s];return e}return Dt(n)};var vt;!function(t){t.SET_USER_LIST="setUserList",t.SET_CONNECTION_ID="setConnectionId",t.LOAD_INIT_DATA="loadInitData",t.SET_PAGE_TITLE="setPageTitle",t.ADD_GIF_MESSAGE="addGifMessage",t.SIDEBAR_MESSAGING_READY="sidebarMessagingReady",t.RESET_VIEW="resetView",t.HIDE_CHAT="hideChat",t.ON_UPDATE_SETTINGS="onUpdateSettings",t.PREVIEW_REACTION="previewReaction",t.UPDATE_SETTINGS="updateSettings",t.UPDATE_ACTIONS_STATE="updateActionsState",t.GO_NEXT_EPISODE="goNextEpisode",t.SET_REACTIONS_ACTIVE="setReactionsActive",t.ON_FOCUS="onSidebarFocus",t.SET_USER_ICON_URL="setUserIconUrl",t.SET_USER_ICON_FRAME_URL="setUserIconFrameUrl",t.ADD_MESSAGE="addMessage",t.CLEAR_MESSAGES="clearMessages",t.SET_PRESENCE_MESSAGE="setPresenceMessage",t.ON_PAGE_CLICK="onPageClick",t.ON_PURCHASE="onPurchase",t.DISPLAY_MODAL="displayModal",t.OPEN_TAB="openTab",t.ON_CHROME_STORAGE_UPDATE="onChromeStorageUpdate",t.ON_WEB_RTC="onWebRTC",t.SHARE_SHEET="shareSheet",t.TRACK_DATA="trackData",t.RESET_CHAT_WINDOW="resetChatWindow",t.RECEIVED_MESSAGE="receivedMessage"}(vt||(vt={}));const gt=chrome.runtime.getURL("img/x-circle.svg"),ft="with-chat";var mt=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};const wt=new class{isUserIconValid(t){if(!t)return!1;if(t.includes("/profile-images/"))return!0;if(t.includes("?newIconUrl=")){const[e,i]=t.split("?newIconUrl=");return F.includes(i)&&m.includes(e)}return F.includes(t)}isUserIdValid(t){return"string"==typeof t&&(16===t.length||36===t.length)}isUserNickNameValid(t){return"string"==typeof t&&t.length>0&&t.length<20}getDefaultUserIcon(){const t=Math.floor(Math.random()*w.length);return w[t]}getDefaultUserNickName(){return""}T(t){return mt(this,void 0,void 0,(function*(){try{yield j.setItemsAsync(t)}catch(t){}}))}getValidatedChromeStorageDataAsync(){return mt(this,void 0,void 0,(function*(){const t=yield ot.getAllItemsAsync(),e=this.validateStorageData(t);return JSON.stringify(t)!==JSON.stringify(e)&&this.T(e),e}))}validateStorageData(t){var e;const i="object"==typeof t?Object.assign({},t):{};return(null===(e=i.userIcon)||void 0===e?void 0:e.includes("?newIconUrl="))&&(i.userIcon=i.userIcon.split("?newIconUrl=")[1]),this.isUserIconValid(i.userIcon)||(i.userIcon=this.getDefaultUserIcon()),this.isUserNickNameValid(i.userNickname)||(i.userNickname=this.getDefaultUserNickName()),i}};Object.freeze(wt);const Ft=wt,yt=1e3,Ct=72e5,bt=12e4,Et={title:"Teleparty | Disconnected from party",content:"Only the owner of this party can change the episode. Click the button below to be redirected to the party, then click on the red Tp icon to rejoin.",buttonTitle:"Return to Party"},_t={title:"Teleparty | Are you still there?",content:"You will be removed from the party in 120 seconds for inactivity. Move your mouse to continue watching."},xt={title:"Teleparty | Disconnected from party",content:"It looks like someone changed the video and we weren't able to connect you. Click the button below to be redirected to the party, then click on the red Tp icon to rejoin.",buttonTitle:"Return to Party"},kt={title:"Teleparty | Disconnected from party",content:"It looks like you lost connection to the extension. Click the button below to be redirected to the party, then click on the red Tp icon to rejoin.",buttonTitle:"Return to Party"};function At(t,e){Bt();const i=e?function(t){return`\n    <div id="alert-dialog-wrapper">\n      <div id="alert-dialog-container">\n        <div id="alert-title-wrapper">\n            <div class="alert-title">\n                <p id="alert-title-txt" class="extension-title">\n                    ${t.title}\n                </p>\n                <button id="alert-x-btn">\n                    <img src="${gt}" alt="close" />\n                </button>\n            </div>\n            <div class="extension-border-bot">\n                \n            </div>\n        </div>\n        <div id="alert-description">\n            <p id="alert-content-txt" class="extension-txt">\n              ${t.content}\n            </p>\n            <button id="alert-return-btn" class="extension-btn">${t.buttonTitle}</button>\n        </div>\n      </div>\n    </div>\n    `}(t):function(t){return`\n  <div id="alert-dialog-wrapper">\n    <div id="alert-dialog-container">\n      <div id="alert-title-wrapper">\n          <div class="alert-title">\n              <p id="alert-title-txt" class="extension-title">\n                  ${t.title}\n              </p>\n              <button id="alert-x-btn">\n                  <img src="${gt}" alt="close" />\n              </button>\n          </div>\n          <div class="extension-border-bot">\n              \n          </div>\n      </div>\n      <div id="alert-description">\n          <p id="alert-content-txt" class="extension-txt">\n            ${t.content}\n          </p>\n      </div>\n    </div>\n  </div>\n  `}(t);document.body.insertAdjacentHTML("afterbegin",i),jQuery("#alert-x-btn").click((()=>{Bt()})),e&&jQuery("#alert-return-btn").click((()=>{Bt(),window.location.href=e}))}function Bt(){const t=document.querySelector("#alert-dialog-wrapper");t&&t.remove()}const It={showAlert:!1},St={showAlert:!0,alertModal:{title:"Teleparty | Disconnected from party",content:"You were removed from the party from inactivity. Click the button below rejoin the party.",buttonTitle:"Return to Party"}},jt={showAlert:!0,alertModal:{title:"Teleparty | Disconnected from party",content:"Sorry, long parties only work for consecutive episodes for now. Please share a new Teleparty to continue watching together, or click the button below to rejoin the party.",buttonTitle:"Return to Party"}},Tt={showAlert:!0,alertModal:xt};var Mt;!function(t){t.HEART="heart",t.ANGRY="angry",t.FIRE="fire",t.LAUGH="laugh",t.CRY="cry",t.SURPRISE="surprise"}(Mt||(Mt={}));const $t=t=>e=>{var i;if(t.length){const n=document.querySelector(t),s=null===(i=null==n?void 0:n.shadowRoot)||void 0===i?void 0:i.querySelector(e);return s?jQuery(s):jQuery()}return jQuery(e)};var Vt=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class Pt{constructor(t,e){this.M=this.$.bind(this),this.V=this.resetIdleTimer.bind(this),this.P=t=>{"TP_EMOJI_REQ_RELOAD"===t.data&&this.updateFrequentlyUsed(),t.data&&"emoji-click"===t.data.type&&this.L(t.data)},this.O=t=>{t.target!==this.R("#chat-input")[0]&&t.target!==this.R("#nickname-edit")[0]||t.stopImmediatePropagation()},this.N=t=>{this.H.onVideoClick();const e=t.target;let i=""!==e.id?e.id:e.className;i=e.getAttribute("data-tp-id")?e.getAttribute("data-tp-id"):i;const n={name:"user_click",component:{name:i,type:e.nodeName,origin:"other"}},s=new K(P,$,n);R.C(s),t.target!==this.R("emoji-picker")[0]&&t.target!==this.R("#chat-input")[0]&&this.R("#emoji-picker-container")&&!this.R("#emoji-picker-container").is(":hidden")&&this.H.toggleEmojiClicker(),t.target instanceof HTMLElement&&this.R("#gif-picker-container").length&&this.R("#gif-picker-container")[0]&&!this.R("#gif-picker-container")[0].contains(t.target)&&t.target!==this.R("#chat-input")[0]&&!this.R("#gif-picker-container").is(":hidden")&&"category-img"!==t.target.className&&this.H.toggleGIFs()},this.L=t=>{console.log("on Emoji Click");const e=this.R("#chat-input")[0],i=t.detail.unicode,n=new K(P,$,{name:"user_click",component:{name:"chat_input_container-emoji_picker-emoji",type:i}});R.C(n);const s=new K(P,$,{eventType:`emoji-click-${i}`,sessionId:this.H.getSessionId()});R.C(s),it.pushTask((()=>this.updateFrequentlyUsed(t.detail.emoji)));const o=window.getSelection();if(!this.R("#chat-input").is(":focus")&&e.lastChild){const t=document.createRange();t.setStartAfter(e.lastChild),null==o||o.removeAllRanges(),null==o||o.addRange(t)}this.H.focusChat(),this.U(i);e.scrollHeight-e.scrollTop<=e.clientHeight+40&&(e.scrollTop=e.scrollHeight),this.G(),this.H.onInputChange()},this.H=t,this.R=$t(e||"")}W(){e("Idle Warning called"),At(_t);const t=new K(P,$,{name:"party_warning",action:{description:"user has been warned for being idle",reason:"user was idle for "+bt+" time in milliseconds."}});R.C(t);const i=new K(P,$,{eventType:"idle-warn-2hr",sessionId:this.H.getSessionId()});R.C(i),this.Y=setTimeout(this.Z.bind(this),bt)}Z(){e("Idle kick called");const t=new K(P,$,{name:"party_kick",action:{description:"user has been kicked for being idle",reason:"user was idle for "+Ct+" time in milliseconds."}}),i=new J(P,$,St);R.C(t),R.C(i)}resetIdleTimer(){this.J&&clearTimeout(this.J),this.Y&&(Bt(),clearTimeout(this.Y)),this.J=setTimeout(this.W.bind(this),Ct)}K(){this.J=setTimeout(this.W.bind(this),Ct),window.onmousemove=t=>{t.isTrusted&&this.V()},window.onfocus=()=>this.V(),window.onmousedown=()=>this.V(),window.ontouchstart=()=>this.V(),window.onkeydown=()=>this.V()}q(){this.J&&clearTimeout(this.J),this.Y&&clearTimeout(this.Y),window.onmousemove=null,window.onmousedown=null,window.ontouchstart=null,window.onkeydown=null}startListening(){e("Listening for chat events"),this.K(),this.X(),this.initWindowListeners()}stopListening(){this.tt(),this.q(),this.et()}$(){this.H.clearUnreadCount()}it(t){if(console.log("Pasting"),t.preventDefault(),t.clipboardData){const e=t.clipboardData.getData("text/plain");document.execCommand("insertHTML",!1,e)}this.H.onInputChange()}initWindowListeners(){jQuery(window).on("focus",this.M),window.addEventListener("message",this.P),document.addEventListener("dragstart",this.nt.bind(this)),document.addEventListener("webkitfullscreenchange",this.H.onFullScreen),document.addEventListener("fullscreenchange",this.H.onFullScreen),document.addEventListener("keydown",this.O,!0),document.addEventListener("emoji-click",this.L),document.addEventListener("click",this.N)}X(){jQuery(window).on("focus",this.M),this.R("#party-tab").on("click",this.H.togglePartyTab.bind(this.H)),this.R("#friends-tab").on("click",this.H.toggleFriendsTab.bind(this.H)),this.R(".user-icon").on("click",this.H.toggleLargeUserIconButton.bind(this.H)),this.R("#user-icon").on("click",this.H.toggleIconContainer.bind(this.H)),this.R("#link-icon").on("click",this.H.linkIconListener.bind(this.H)),this.R("#reset-icon").on("click",this.H.resetIconListener.bind(this.H)),this.R(".image-button").on("click",this.H.userIconSelectorListener.bind(this.H)),this.R("#chat-input-container").on("keydown",this.H.onChatKeyDown.bind(this.H)),this.R("#nickname-edit").on("keydown",this.H.onChatKeyDown.bind(this.H)),this.R("#chat-input").on("keypress",this.H.onChatKeyPress.bind(this.H)),this.R("#chat-input").on("input",this.H.onInputChange.bind(this.H)),this.R("#gif-search").on("keyup",this.H.onGifSearch.bind(this.H)),this.R("#saveChanges").on("click",this.H.saveChangesListener.bind(this.H)),this.R("#cancelNickname").on("click",this.H.cancelNicknameListener.bind(this.H)),this.R("#chat-wrapper").on("mouseup",this.H.cancelEvent),this.R("#chat-wrapper").on("mousedown",this.H.cancelEvent),this.R("#chat-wrapper").on("pointerup",this.H.cancelEvent),this.R("#chat-wrapper").on("pointerdown",this.H.cancelEvent),this.R("#chat-wrapper").on("mousemove",this.H.cancelEvent),this.R("#chat-wrapper").on("pointermove",this.H.cancelEvent),this.R("#chat-wrapper").on("keyup",this.H.onChatKeyUp.bind(this.H)),this.R("#emoji-picker-btn").on("click",this.H.addEmojiPicker.bind(this.H)),this.R("#gif-btn").on("click",this.H.addGifPicker.bind(this.H)),this.R(".gif-img").on("click",this.H.clickGif.bind(this.H)),this.R(".gif-results").on("click","video, img",this.H.clickGif.bind(this.H)),this.R("#category-container").on("click","video",this.H.clickGif.bind(this.H)),this.R("#gif-input-back").on("click",this.H.resetGif.bind(this.H)),this.R("#reaction-btn").on("click",this.H.addReactionTab.bind(this.H)),this.R("#chat-input-container").on("click",this.st.bind(this)),this.R("#chat-input").on("input",this.G.bind(this)),this.R("#chat-input").on("drop",this.ot.bind(this)),this.R("#gif-results-wrapper").on("scroll",this.H.onScrollToBottom.bind(this.H)),this.rt(),document.addEventListener("keydown",this.O.bind(this),!0),this.H.initCustomListeners()}rt(){this.R("#tp-heart-button").on("click",(()=>{this.H.onReactionClicked(Mt.HEART)})),this.R("#tp-cry-button").on("click",(()=>{this.H.onReactionClicked(Mt.CRY)})),this.R("#tp-angry-button").on("click",(()=>{this.H.onReactionClicked(Mt.ANGRY)})),this.R("#tp-surprise-button").on("click",(()=>{this.H.onReactionClicked(Mt.SURPRISE)})),this.R("#tp-laugh-button").on("click",(()=>{this.H.onReactionClicked(Mt.LAUGH)})),this.R("#tp-fire-button").on("click",(()=>{this.H.onReactionClicked(Mt.FIRE)}))}G(){var t,e;const i=null!==(t=this.R("#bottom-chat-controls").outerHeight(!0))&&void 0!==t?t:parseInt(this.R("#bottom-chat-controls").css("height")),n=parseInt(this.R("#chat-input-container").css("padding-bottom")),s=(null!==(e=this.R("#chat-input").outerHeight(!0))&&void 0!==e?e:parseInt(this.R("#chat-input").css("height")))+i+n;this.R("#emoji-picker-container").css({bottom:s}),this.R("#gif-picker-container").css({bottom:s})}ot(t){t.preventDefault()}nt(t){t.preventDefault()}st(t){t.target===this.R("#chat-input")[0]&&this.H.focusChat()}U(t){let e,i;if(window.getSelection&&(e=window.getSelection(),e&&e.getRangeAt&&e.rangeCount)){i=e.getRangeAt(0),i.deleteContents();const n=document.createElement("span");n.className="inTextEmoji",n.innerHTML=t;const s=document.createDocumentFragment();let o,r;for(;o=n.firstChild;)r=s.appendChild(o);i.insertNode(s),r&&(i=i.cloneRange(),i.setStartAfter(r),i.collapse(!1),e.removeAllRanges(),e.addRange(i))}}ut(t){return"object"==typeof t&&null!=t&&"unicode"in t}ct(t){if(!Array.isArray(t))return!1;if(0===t.length)return!1;for(let e=0;e<t.length;e++){const i=t[e];if(!this.ut(i))return!1}return!0}updateFrequentlyUsed(t){var e;return Vt(this,void 0,void 0,(function*(){const i=yield ot.getItemsAsync([p]);let n=null!==(e=i[p])&&void 0!==e?e:g;this.ct(n)||(n=g),Array.isArray(n)&&(t&&(n=n.filter((e=>e.unicode!=t.unicode)),n.unshift(t),n=n.slice(0,24)),yield j.setItemsAsync({[p]:n}),window.postMessage({type:"TP_FREQ_USED",data:n},"*"))}))}et(){jQuery(window).off("focus",this.M),document.removeEventListener("emoji-click",this.L),document.removeEventListener("keydown",this.O,!0),document.removeEventListener("click",this.N),window.removeEventListener("message",this.P),document.removeEventListener("webkitfullscreenchange",this.H.onFullScreen),document.removeEventListener("fullscreenchange",this.H.onFullScreen)}tt(){this.R(".user-icon").off(),this.R("#user-icon").off(),this.R("#link-icon").off(),this.R(".image-button").off(),this.R("#chat-input").off(),this.R("#saveChanges").off(),this.R("#cancelNickname").off(),this.R("#chat-input-container").off(),this.R("#chat-wrapper").off()}}var Lt=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};const Ot=`tp_csrf:${new URL(o).origin}`,Rt=6e4;let Nt=null;function Ht(){var t,e,i;return Lt(this,void 0,void 0,(function*(){const n=yield fetch(`${o}/session/csrf`,{method:"GET",credentials:"include"});if(!n.ok)return;const s=yield n.json().catch((()=>({}))),r=null!==(e=null!==(t=null==s?void 0:s.csrf)&&void 0!==t?t:null==s?void 0:s.token)&&void 0!==e?e:null===(i=null==s?void 0:s.data)||void 0===i?void 0:i.csrf;return"string"==typeof r&&r?(function(t){try{if("undefined"==typeof sessionStorage)return;sessionStorage.setItem(Ot,JSON.stringify({v:t,t:Date.now()}))}catch(t){}}(r),r):void 0}))}function Ut(t=!1){return Lt(this,void 0,void 0,(function*(){const e=function(){try{if("undefined"==typeof sessionStorage)return;const t=sessionStorage.getItem(Ot);if(!t)return;const{v:e,t:i}=JSON.parse(t);if(Date.now()-i<Rt)return e}catch(t){}}();return e&&!t?e:(null!=Nt||(Nt=Ht().finally((()=>{Nt=null}))),Nt)}))}const Gt=Object.freeze("video-highlights"),zt=Object.freeze(["live-match-info","fantasy","commentary","scorecard","squad","key-moments"]),Wt=Object.freeze({tag:"type",value:"match-info"}),Qt=Object.freeze({VIDEO_ELEMENT_SELECTOR:"video.vjs-tech",VIDEO_ELEMENT_SELECTOR_2:'video[class*="StyledVideo"]',TITLE_ELEMENT_SELECTOR:'[class*="VideoPlayerTitleLabel"]',MATCH_INFO_QUERY_PARAM:Wt,AD_CLASS_NAME:'video[title="Advertisement"]',INSTREAM_AD_ID:'[id*="instream-video"]',LIVE_MATCH_PAGE_TYPES:zt,HIGHLIGHTS:Gt}),Yt=Object.freeze({SHOW:"player",LIVE_TV:"livestream"}),Zt=Object.freeze({VIDEO_ELEMENT_SELECTOR:"video#bitmovinplayer-video-player-element",LIVE_VIDEO_ELEMENT_SELECTOR:"video#bitmovinplayer-video-bitmovin-element",TITLE_ELEMENT_SELECTOR:'h3[class*="VODTitle_show-title"]',VIDEO_TYPES:Yt,AD_CLASS_NAME:'video[title="Advertisement"]'}),Jt=Object.freeze({VIDEO:"vod",LIVE:"live"}),Kt=Object.freeze({VIDEO_ELEMENT_SELECTOR:"video#bitmovinplayer-video-null",AD_CLASS_NAME:'video[title="Advertisement"]',TITLE_ELEMENT_SELECTOR:"#series_title",TITLE_ELEMENT_SELECTOR_LIVE_TV:".bmpui-label-metadata-viu-title.bmpui-label-metadata-viu-title",UI_CONTAINER:".bmpui-ui-uicontainer",VIDEO_TYPES:Jt,QUERY_PARAMS_ORIGIN_EPISODE_CODE_TAG:"originEpisodeCode"});var qt,Xt=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};function te(t){return t.hostname.includes(".amazon.")||t.hostname.includes(".primevideo.")}function ee(t){return function(){return new Promise((e=>{setTimeout((()=>{e()}),t)}))}}function ie(t,e,i=250){return function(){const n=(new Date).getTime(),s=function(){return t()?Promise.resolve():null!==e&&(new Date).getTime()-n>e?Promise.reject(new Error("delayUntil timed out: "+t)):ee(i)().then(s)};return s()}}function ne(t,e,i){t.push(e),t.length>i&&t.splice(0,t.length-i)}function se(t){return t.concat().sort()[Math.floor(t.length/2)]}function oe(t){const e=document.createElement("script");e.setAttribute("tpInjected",""),e.src=t,(document.head||document.documentElement).appendChild(e),e.remove()}function re(t){return Xt(this,void 0,void 0,(function*(){if((t.headers.get("content-type")||"").includes("application/json"))try{return yield t.json()}catch(t){}return yield t.text()}))}function ue(t,e,i,n,s,r,u=!1){return Xt(this,void 0,void 0,(function*(){const a=`${o}/${t}`.replace(/([^:]\/)\/+/g,"$1"),c=i&&!!s,h=i&&!s,l=Object.assign({Accept:"application/json"},r||{}),d=t=>"undefined"!=typeof FormData&&t instanceof FormData||"undefined"!=typeof Blob&&t instanceof Blob||"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer;if("GET"===e||null==n||d(n)||(l["Content-Type"]=l["Content-Type"]||"application/json"),c&&(l.Authorization=`Bearer ${s}`),h&&!l["x-tp-csrf"]){const t=yield Ut(u);t&&(l["x-tp-csrf"]=t)}const D={method:e,headers:l,credentials:h?"include":"omit",body:"GET"!==e&&null!=n?d(n)?n:JSON.stringify(n):void 0},p=yield fetch(a,D);if(0===p.status||p.status>=200&&p.status<400)return yield re(p);const v=yield re(p),g=new Error("string"==typeof v?v:JSON.stringify(v));throw g.status=p.status,g}))}!function(t){t.REGISTER="register",t.PARTY_START="party_start",t.PARTY_JOIN="party_join",t.PARTY_END="party_end",t.PARTY_SHARE="party_share"}(qt||(qt={}));class ae{constructor(t){this.H=t,this.ht=[],this.lt=0,this.dt=document.title,this.Dt=0,this.vt=new Map,this.gt=new Map,this.ft=new Map,this.wt=[],this.Ft=[],this.yt="",this.Ct="",e("Message Controller")}bt(t,e,i,n){return jQuery(`\n            <div class="msg-container ${!n&&"tp-msg-combined"}-message">\n                <div class="tp-icon-name">\n                    <div class="icon">\n                    ${n?`<img src="${b(t)}" data-tp-id="chat_history_container-user_icon"/>`:""}\n                    </div>\n                </div>\n                <div class="msg-txt message${i.isSystemMessage?"-system":"-txt"}">\n                    ${n?`<h3 data-tp-id="chat_history_container-nickname">${e}</h3>`:""}\n                    <p data-tp-id="chat_history_container-message">${b(i.body).trim()}</p>\n                </div>\n            </div>\n          `)}Et(t,e,i,n){const s=200/(i.gifObject.media.full.dims[0]/i.gifObject.media.full.dims[1]),o=200/(i.gifObject.media.fullMobile.dims[0]/i.gifObject.media.fullMobile.dims[1]),r=this.H.shouldUseVideoGIF();return jQuery(`\n            <div class="msg-container ${!n&&"tp-msg-combined"}-message">\n                <div class="tp-icon-name">\n                    <div class="icon" >\n                    ${n?`<img src="${b(t)}" data-tp-id="chat_history_container-user_icon"/>`:""}\n                    </div>\n                </div>\n                <div class="msg-gif message-gif">\n                    ${n?`<h3 data-tp-id="chat_history_container-nickname">${e}</h3>`:""}  \n            ${r?`<video src="${b(i.gifObject.media.full.url)}"  height="${s}" class="tp-video-gif" data-tp-id="chat_history_container-gif" autoplay muted loop playsinline disablepictureinpicture disableremoteplayback>`:`<img src="${b(i.gifObject.media.fullMobile.url)}"  height="${o}" class="tp-video-gif" data-tp-id="chat_history_container-gif" autoplay muted loop playsinline disablepictureinpicture disableremoteplayback>`}     \n                </div>\n            </div>\n          `)}_t(t,e,i){return jQuery(`\n            <div class="msg ${!i&&"tp-msg-combined"}-message">\n                <div class="tp-icon-name">\n                    ${i?`<img src="${b(t)}" data-tp-id="chat_history_container-user_icon"/>`:""}\n                </div>\n                <div class="message${e.isSystemMessage?"-system":"-txt"}">\n                    <p class="msg-nickname"></p>\n                    <p data-tp-id="chat_history_container-message">${b(e.body).trim()}</p>\n                </div>\n            </div>\n        `)}xt(t,e,i){const n=200/(e.gifObject.media.full.dims[0]/e.gifObject.media.full.dims[1]),s=200/(e.gifObject.media.fullMobile.dims[0]/e.gifObject.media.fullMobile.dims[1]),o=this.H.shouldUseVideoGIF();return jQuery(`\n            <div class="msg-container ${!i&&"tp-msg-combined"}-message">\n                <div class="tp-icon-name">\n                    <div class="tp-icon-name">\n                    ${i?`<img src="${b(t)}" data-tp-id="chat_history_container-user_icon"/>`:""}\n                    </div>\n                </div>\n                <div class="msg-gif message-gif">\n                    <p class="msg-nickname"></p>\n                    ${o?`<video src="${b(e.gifObject.media.full.url)}" data-tp-id="chat_history_container-gif" height="${n}" class = "tp-video-gif" autoplay loop playsinline disablepictureinpicture disableremoteplayback>`:`<img src="${b(e.gifObject.media.fullMobile.url)}" data-tp-id="chat_history_container-gif" height="${s}" class = "tp-video-gif" autoplay loop playsinline disablepictureinpicture disableremoteplayback>`}\n                </div>\n            </div>\n          `)}kt(t,e,i,n,s){t.appendTo(jQuery("#chat-history"));const o=t[0];o.F=e.permId,o.At=i,o.Bt=n,o.It=e,o.St=s}reloadMessages(){this.H.queueMessageForFrame(vt.CLEAR_MESSAGES,"");const t=JSON.parse(JSON.stringify(this.ht));for(let e=0;e<t.length;e++){const i=t[e];"gifObject"in i?this.addGif(i,e):this.addMessage(i,!1,e)}this.ht=t}jt(t,e){if(Math.abs(t.timestamp-e.timestamp)>6e4)return!1;if(t.permId!==e.permId)return!1;if("isSystemMessage"in e&&e.isSystemMessage&&(e.body.includes("joined")||e.body.includes("left")))return!1;if("gifObject"in t){if("isSystemMessage"in e&&e.isSystemMessage)return!1}else{if(t.isSystemMessage&&(t.body.includes("joined")||t.body.includes("left")))return!1;if("gifObject"in e){if(t.isSystemMessage)return!1}else if(t.isSystemMessage!==e.isSystemMessage)return!1}return!0}addMessage(t,e,i){if(void 0===i&&(i=this.ht.length),t.isSystemMessage&&"left"===t.body&&(console.log("trying to add left message"),!t.userIcon&&!this.vt.has(t.permId)))return;if(0===i&&t.isSystemMessage&&t.body.includes("joined"))return;e&&t.isSystemMessage&&t.body.indexOf("updated their user icon")>-1&&(t.userIcon&&this.setUserIcon(t.permId,t.userIcon),t.userNickname&&this.setUserNickname(t.permId,t.userNickname));const n=this.ht.slice(-1).pop(),s=!(void 0!==n&&i>0)||!this.jt(n,t);this.ht.push(t);const o=Object.assign({},t),r=this.getUserIconURL(o.permId,o.userIcon),u=this.getUserNickname(o.permId,o.userNickname),a=this.getUserIconFrameURL(o.permId,o.userIconFrame);this.H.queueMessageForFrame(vt.ADD_MESSAGE,{originalMessage:o,userIcon:r,userNickname:u,userIconFrame:a});const c=""===u?this._t(r,o,s):this.bt(r,u,o,s);this.kt(c,o,r,u,s),this.scrollToBottom(),this.Tt()}addGif(t,e){void 0===e&&(e=this.ht.length);const i=this.ht.slice(-1).pop(),n=!(void 0!==i&&e>0)||!this.jt(i,t);this.ht.push(t);const s=t.userIcon?this.getUserIconURL(t.permId,t.userIcon):this.getUserIconURL(t.permId),o=t.userNickname?this.getUserNickname(t.permId,t.userNickname):"",r=this.getUserIconFrameURL(t.permId,t.userIconFrame);this.H.queueMessageForFrame(vt.ADD_MESSAGE,{originalMessage:t,userIcon:s,userNickname:o,userIconFrame:r});const u=""===o?this.xt(s,t,n):this.Et(s,o,t,n);u[0].Mt=!0,this.kt(u,t,s,o,n),ee(100)().then(this.scrollToBottom.bind(this)),this.Tt()}scrollToBottom(){jQuery("#chat-history").scrollTop(jQuery("#chat-history").prop("scrollHeight"))}clearUnreadCount(){this.lt>0&&(this.lt=0,document.title=this.dt)}Tt(){this.lt+=1,this.Dt+=1,document.hasFocus()||(document.title="("+String(this.lt)+") "+this.dt)}getUserIconURL(t,e=""){if(!this.vt.has(t)){const i=ae.parseIconSrc(e),n=void 0!==i?i:this.$t();this.vt.set(t,n),this.Ft.push(n)}return this.vt.get(t)}static parseIconSrc(t){if(t.includes("/profile-images/"))return t;const e=t.includes("?newIconUrl=")?t.split("?newIconUrl=")[1]:t,i=t.includes("?newIconUrl=")?t.split("?newIconUrl=")[0]:t;return F.includes(e)?chrome.runtime.getURL("img/icons/"+t):m.includes(i)?chrome.runtime.getURL("img/icons/General/"+t):void 0}getUserIconFrameURL(t,e=""){if(!this.gt.has(t)){const i=ae.parseIconFrameSrc(e)||"";this.gt.set(t,i)}return this.gt.get(t)}static parseIconFrameSrc(t){return t}getUserNickname(t,e=""){return this.ft.has(t)||(this.ft.set(t,e),this.wt.push(e)),b(this.ft.get(t))}$t(){let t=chrome.runtime.getURL("img/icons/General/"+m[Math.floor(Math.random()*m.length)]);if(this.Ft.length<y.General.length)for(;this.Ft.includes(t);)t=chrome.runtime.getURL("img/icons/General/"+m[Math.floor(Math.random()*m.length)]);return t}Vt(t){const e=t[0],i=e.F;let n=e.At;i&&this.getUserIconURL(i)!==n&&(n=this.getUserIconURL(i),t.find("img").attr("src",n),e.At=n);const s=e.Bt;if(i&&n){const o=this.getUserNickname(i);if(o!==s){const s=e.It,r=e.St;let u;if(e.Mt&&s&&"gifObject"in s&&r&&(u=""==o?this.xt(n,s,r):this.Et(n,o,s,r)),!e.Mt&&s&&"isSystemMessage"in s&&r&&(u=""==o?this._t(n,s,r):this.bt(n,o,s,r)),u){t.replaceWith(u);const e=u[0];e.F=i,e.At=n,e.Bt=o,e.It=s,e.St=r}}}}setUserIconUrl(t){this.yt=t,this.H.queueMessageForFrame(vt.SET_USER_ICON_URL,t)}setUserIconFrameUrl(t){this.Ct=t,this.H.queueMessageForFrame(vt.SET_USER_ICON_FRAME_URL,t)}renderSidebar(){jQuery("#user-icon img").attr("src",this.yt),jQuery(".user-icon img").attr("src",this.yt);const t=jQuery(".msg");for(let e=0;e<t.length;e++)this.Vt(jQuery(t[e]));const e=jQuery(".msg-container");for(let t=0;t<e.length;t++)this.Vt(jQuery(e[t]));this.H.isChatFrameActive()&&this.reloadMessages()}Pt(t){let e=null;if(t){if(t.includes("/profile-images/"))return t;if(t.includes("?newIconUrl=")){const i=t.split("?newIconUrl="),n=i[1],s=i[0];F.includes(n)?e=chrome.runtime.getURL(`img/icons/${n}`):m.includes(s)&&(e=chrome.runtime.getURL(`img/icons/General/${s}`))}else F.includes(t)?e=chrome.runtime.getURL(`img/icons/${t}`):m.includes(t)&&(e=chrome.runtime.getURL(`img/icons/General/${t}`))}if(null===e){let t=y.General.filter((t=>!this.Ft.includes(t)));0===t.length&&(t=y.General);const i=t[Math.floor(Math.random()*t.length)];e=chrome.runtime.getURL(`/img/icons/General/${i}`)}return e}setUserIcon(t,e){const i=this.Pt(e);this.vt.set(t,i),this.Ft.push(i),this.renderSidebar()}setUserNickname(t,e){const i=b(e);this.ft.set(t,i),this.wt.push(i),this.renderSidebar()}updateUserData(t,e,i,n){const s=this.Pt(e),o=null!=n?n:"";this.vt.set(t,s),this.gt.set(t,o),this.Ft.push(s),this.ft.set(t,i),this.wt.push(i),this.renderSidebar()}addYoutubePromo(){jQuery(`\n        <div class="msg-container">\n            <div class="msg-txt message-system">\n                <div style="width:100%; height: 100px">\n                    <img data-tp-id="tp_youtube_promo" style="width: 100%;height: 100%;object-fit: contain;cursor:pointer !important;" src="${chrome.runtime.getURL("img/youtube_promo.jpg")}" \n                    onclick="window.open('https://teleparty.com/youtube')"\n                    />\n                </div>\n            </div>\n        </div>\n        `).prependTo(jQuery("#chat-history"))}addReviewMessage(){jQuery('\n          <div class="msg-container">\n          <div class="msg-txt message-system" style="width:100%">\n          <p>\n          Thanks for using Teleparty! <br> \n          If you enjoy the extension, please leave a positive review \n          <a id="reviewLink" href="https://chromewebstore.google.com/detail/netflix-party-is-now-tele/oocalimimngaihdkbihfgmpkcpnmlaoa/reviews" style="display:inline;color:red;text-decoration:underline;" target="none">here!</a>\n          </p>\n          </div>\n          </div>\n          ').appendTo(jQuery("#chat-history"));const t=new K(P,$,{name:"review-shown",action:{description:"review was shown on chrome",reason:"review was shown."}});R.C(t);const e={eventType:"review-shown-chrome",sessionId:this.H.getSessionId()},i=new K(P,$,e);R.C(i),jQuery("#reviewLink").click((()=>{chrome.storage.local.set({reviewClicked:!0});const t=new K(P,$,{name:"review-clicked",action:{description:"review was clicked on chrome",reason:"review was clicked."}});R.C(t);const e={eventType:"review-clicked-chrome",sessionId:this.H.getSessionId()},i=new K(P,$,e);R.C(i)}))}}class ce{constructor(t){this.Lt=!1,this.Ot=!1,this.Rt=!1,this.H=t}setupPresenceIndicator(){this.Lt=!1,this.Ot=!1,this.Rt=!1,this.Nt()}Ht(){return jQuery("#presence-indicator")}setTypingPresenceVisible(t){this.Lt=t,this.Nt()}setBufferingPresenceVisible(t){this.Ot=t,this.Nt()}setWatchingAdsPresenceVisible(t){this.Rt=t,this.Nt()}getWatchingAdsVisible(){return this.Rt}Ut(){return this.Rt?"People are watching ads...":this.Lt&&this.Ot?"People are typing and buffering...":this.Lt?"People are typing...":this.Ot?"People are buffering...":""}Nt(){const t=this.Ut();this.Ht().text(t),this.H.queueMessageForFrame(vt.SET_PRESENCE_MESSAGE,{text:t})}}var he=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class le{constructor(t){this.Gt=!1,this.zt=1,this.Wt=!1,this.Qt=!1,this.Yt="",this.Zt="",this.Jt="0",this.Kt="",this.qt=!0,this.Xt=!1,this.te=0,this.ee=[],this.ie=new et,this.ne=!1,this.se=void 0,this.oe=!0,this.re=this.ue(),this.ae=this.ue(),this.ce=!1,this.he=!1,this.le=[],this.de=0,this.logEvent=t=>{const e=new K(P,$,t);R.C(e)},this.checkInitReactionContainer=()=>{ot.getItemsAsync([c]).then((t=>{!0!==t[c]&&void 0!==t[c]||this.showReactionHolder()}))},this.onSidebarFocus=()=>{var t;null===(t=this.De)||void 0===t||t.hideMessageIndicator()},this.setReactionsActive=t=>{this.ie.pushTask((()=>j.setItemsAsync({[c]:t.active})),"setReactionsActive")},this.onFullScreen=()=>{var t;this.scrollToBottom(),document.fullscreenElement||document.webkitIsFullScreen?this.logEvent({name:"fullscreen_enter"}):this.logEvent({name:"fullscreen_exit"}),null===(t=this.De)||void 0===t||t.setChatButtons()},this.cancelEvent=t=>{t.stopPropagation()},this.pe=!1,this.ve=new Pt(this,t),this.ge=new ce(this),this.fe=new ae(this),this.we=void 0,this.Fe=void 0,this.ye=!1,this.R=$t(t||""),this.de=0}setPageControls(t){this.De=t}fixPageControls(){var t,e;null===(t=this.De)||void 0===t||t.enablePartyIcons(),null===(e=this.De)||void 0===e||e.setChatButtons()}setChatVisible(t,e=!0){return he(this,void 0,void 0,(function*(){if(this.isPartyWindowsActive())throw new Error("Invalid Set Chat");e&&(this.qt=t),t&&this.resetUnreadMessagesCount(),t&&!this.Ce()&&this.reloadChat()}))}incrementUnreadMessagesCount(){this.de++;const t=document.querySelector("#tp-chat-button");if(t){const e=t.querySelector(".unread-messages-count");if(e&&e.remove(),this.de>0){const e=document.createElement("span");e.textContent=String(this.de),e.className="unread-messages-count",Object.assign(e.style,{position:"absolute",top:"2px",right:"2px",background:"red",color:"white",borderRadius:"50%",width:"18px",height:"18px",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",fontWeight:"bold",zIndex:"10",textAlign:"center",boxShadow:"0 0 2px rgba(0,0,0,0.2)"}),""!==t.style.position&&"static"!==t.style.position||(t.style.position="relative"),t.appendChild(e)}}}resetUnreadMessagesCount(){this.de=0;const t=document.querySelector("#tp-chat-button");if(t){const e=t.querySelector(".unread-messages-count");e&&e.remove()}}getUnreadMessagesCount(){return this.de}be(t,e){const i=new K(P,$,{name:"error",action:{reason:e,description:t}});R.C(i)}getChatWindowVisible(){return this.ae}setChatWindowActive(t){this.re=t}isChatFrameActive(){return this.oe}isPartyWindowsActive(){return this.re}shouldChatBeVisible(){return this.qt}incrementEmojiCount(){this.te++}resetEmojiCount(){this.te=0}getEmojiCount(){return this.te}setChatFrameReady(t){this.ne&&this.Ee(),this.ne=!0,this._e=t,console.log("setChatFrameReady")}queueMessageForFrame(t,e){this.ie.pushTask((()=>he(this,void 0,void 0,(function*(){this.xe(t,e)}))),"queueMessageForFrame")}xe(t,e){return he(this,void 0,void 0,(function*(){const i=this._e,n={type:t,data:e,target:"TP_Sidebar",tabId:i,sender:P};R.C(n)}))}ke(){var t;return he(this,void 0,void 0,(function*(){try{console.log("Start delay"),yield ie((()=>this.ne&&null!=this._e),3e4)(),console.log("Chat Frame is Loaded"),this.se&&this.Ae(this.se),null===(t=this.De)||void 0===t||t.setResetChatButton()}catch(t){this.be("Sidewindow didn't load in time",t)}}))}ue(){return window.origin.includes(".crunchyroll.com"),window.origin.includes("tv.apple.com"),!1}Be(){return he(this,void 0,void 0,(function*(){yield R.C(new Z(P,$,G.LOAD_CHAT_WINDOW)),console.log(this._e)}))}resetChatWindow(t=!1){var e;return he(this,void 0,void 0,(function*(){yield R.C(new Z(P,$,G.RESET_CHAT_WINDOW)),console.log(this._e),this.ae=!0,this.qt=!0,top.postMessage({type:"exitFullscreen"},"*"),this.ce&&t&&(this.resetIconListener(),null===(e=this.De)||void 0===e||e.setResetChatButton())}))}hideChatWindow(){return he(this,void 0,void 0,(function*(){yield R.C(new Z(P,$,G.HIDE_CHAT_WINDOW)),this.ae=!1,this.qt=!1}))}Ie(){return he(this,void 0,void 0,(function*(){this.Be(),this.ie.pushTask(this.ke.bind(this),"waitChatFrameReady")}))}loadInitData(t){this.se=t}Ae(t){var e,i;return he(this,void 0,void 0,(function*(){const n=Object.assign({},t);if(n.iconMap=y,n.extensionBaseUrl=chrome.runtime.getURL(""),n.iconFrameMap=C,n.storageData){const t=yield Ft.getValidatedChromeStorageDataAsync();n.storageData=t}if(null===(e=n.sessionCallbackData)||void 0===e?void 0:e.sessionId){const{sessionId:t}=n.sessionCallbackData,e=yield ot.getItemsAsync(["REDIRECT_URL"]);e.REDIRECT_URL&&e.REDIRECT_URL[t]&&(n.sessionCallbackData.redirectUrl=e.REDIRECT_URL[t])}this.queueMessageForFrame(vt.LOAD_INIT_DATA,n);const s=yield this.getVideoTitle();this.queueMessageForFrame(vt.SET_PAGE_TITLE,{pageTitle:s}),this.queueMessageForFrame(vt.SET_USER_LIST,this.le),this.queueMessageForFrame(vt.UPDATE_SETTINGS,{userSettings:null===(i=this.Se)||void 0===i?void 0:i.userSettings})}))}Ee(){return he(this,void 0,void 0,(function*(){if(console.log("Reloading chat Frame"),this.se&&(yield this.Ae(this.se)),this.Se){const t=this.fe.getUserIconURL(this.Se.permId,this.Se.userIcon),e=this.fe.getUserIconFrameURL(this.Se.permId,this.Se.userIconFrame);this.queueMessageForFrame(vt.SET_USER_ICON_URL,t),this.queueMessageForFrame(vt.SET_USER_ICON_FRAME_URL,e)}const t=yield this.getVideoTitle();this.queueMessageForFrame(vt.SET_PAGE_TITLE,{pageTitle:t}),this.reloadMessages()}))}je(){return he(this,void 0,void 0,(function*(){this.Te(),yield ee(200)(),this.R("#tpChatFrame")[0].style.display="block",this.setChatVisible(!0),this.addIconSelector(),this.Me(),this.ge.setupPresenceIndicator(),this.checkInitReactionContainer()}))}get sessionReactionsDisabled(){return this.Qt}get userReactionsDisabled(){return this.Wt}setUserReactionsDisabledStatus(t){this.Wt=t}setSessionReactionDisabledStatus(t){this.Qt=t}$e(t){this.ve.initWindowListeners(),this.ue()&&this.Ie(),this.ie.pushTask(this.ke.bind(this),"InitChat, _waitChatFrameReady"),Bt(),this.Se=new M(t);const e=this.fe.getUserIconURL(this.Se.permId,this.Se.userIcon),i=this.fe.getUserIconFrameURL(this.Se.permId,this.Se.userIconFrame);this.fe.setUserIconUrl(e),this.fe.setUserIconFrameUrl(i),this.fe.renderSidebar(),this.Ce()&&this.removeChat(),this.pe=!0,this.Ve(),this.ue()?jQuery("body").after(`\n    <link rel="stylesheet" href="${chrome.runtime.getURL("css/alert.css")}">\n    <style tpInjected>\n      .on-screen-reaction {\n        position: absolute;\n        bottom: 0;\n        font-size: 100px;\n        z-index: 9999999999;\n      }\n      .on-screen-reaction-1 {\n        animation: 5s cubic-bezier(0.5, 1, 0.89, 1) forwards on-screen-reaction-slide,\n          12s cubic-bezier(0.5, 1, 0.89, 1) forwards on-screen-reaction-1;\n      }\n      .on-screen-reaction-2 {\n        animation: 6s cubic-bezier(0.5, 1, 0.89, 1) forwards on-screen-reaction-slide,\n          12s cubic-bezier(0.5, 1, 0.89, 1) forwards on-screen-reaction-2;\n      }\n      .on-screen-reaction-3 {\n        animation: 7s cubic-bezier(0.5, 1, 0.89, 1) forwards on-screen-reaction-slide,\n          12s cubic-bezier(0.5, 1, 0.89, 1) forwards on-screen-reaction-3;\n      }\n      @keyframes on-screen-reaction-slide {\n        0% {\n          opacity: 0;\n          transform: translateY(calc(0 - var(--reaction-size)));\n        }\n        20% {\n          opacity: 0.8;\n        }\n        30% {\n          opacity: 0.8;\n        }\n        90% {\n          opacity: 0;\n        }\n        100% {\n          transform: translateY(-100vh) translateX(-10px);\n          opacity: 0;\n        }\n      }\n      @keyframes on-screen-reaction-1 {\n        10% {\n          margin-left: -6px;\n        }\n        25% {\n          margin-left: 4px;\n        }\n        30% {\n          margin-left: -5px;\n        }\n        45% {\n          margin-left: 5px;\n        }\n        55% {\n          margin-left: -3px;\n        }\n        60% {\n          margin-left: 5px;\n        }\n        70% {\n          margin-left: -5px;\n        }\n        85% {\n          margin-left: 5px;\n        }\n        90% {\n          margin-left: -7px;\n        }\n        100% {\n          margin-left: 5px;\n        }\n      }\n      @keyframes on-screen-reaction-2 {\n        15% {\n          margin-left: -2px;\n        }\n        20% {\n          margin-left: 5px;\n        }\n        35% {\n          margin-left: -6px;\n        }\n        40% {\n          margin-left: 5px;\n        }\n        50% {\n          margin-left: -5px;\n        }\n        65% {\n          margin-left: 5px;\n        }\n        70% {\n          margin-left: -5px;\n        }\n        80% {\n          margin-left: 4px;\n        }\n        95% {\n          margin-left: -5px;\n        }\n        100% {\n          margin-left: 5px;\n        }\n      }\n      @keyframes on-screen-reaction-3 {\n        15% {\n          margin-left: -4px;\n        }\n        20% {\n          margin-left: 5px;\n        }\n        35% {\n          margin-left: -2px;\n        }\n        40% {\n          margin-left: 5px;\n        }\n        50% {\n          margin-left: -3px;\n        }\n        65% {\n          margin-left: 5px;\n        }\n        70% {\n          margin-left: -5px;\n        }\n        80% {\n          margin-left: 5px;\n        }\n        95% {\n          margin-left: -4px;\n        }\n        100% {\n          margin-left: 5px;\n        }\n      }\n    </style>\n  `):(this.je(),this.checkAddYoutubePromo())}checkAddYoutubePromo(){return he(this,void 0,void 0,(function*(){"true"!==(yield ot.getItemsAsync(["seenYoutubePromo"])).seenYoutubePromo&&(this.fe.addYoutubePromo(),j.setItemsAsync({seenYoutubePromo:"true"}))}))}sendInitDataToSidebar(t){var e;return he(this,void 0,void 0,(function*(){this.se=t;const i=Object.assign({},t);if(i.iconMap=y,i.extensionBaseUrl=chrome.runtime.getURL(""),i.iconFrameMap=C,null===(e=i.sessionCallbackData)||void 0===e?void 0:e.sessionId){const{sessionId:t}=i.sessionCallbackData,e=yield ot.getItemsAsync(["REDIRECT_URL"]);e.REDIRECT_URL&&e.REDIRECT_URL[t]&&(i.sessionCallbackData.redirectUrl=e.REDIRECT_URL[t])}this.queueMessageForFrame(vt.LOAD_INIT_DATA,i)}))}reloadChat(){return he(this,void 0,void 0,(function*(){console.log("Reload chat"),this.Ce()||this.isPartyWindowsActive()||(this.Te(),yield ee(200)(),this.R("#tpChatFrame")[0].style.display="block",this.setChatVisible(this.qt),this.addIconSelector(),this.Pe(),this.Me(),this.ge.setupPresenceIndicator(),this.reloadMessages(),this.scrollToBottom(),this.checkInitReactionContainer())}))}sendTeardown(t){const e=new J(P,$,t);R.C(e)}Ce(){return this.R("#chat-wrapper").length>0}clearUnreadCount(){this.fe.clearUnreadCount()}Le(){return he(this,void 0,void 0,(function*(){try{yield ie((()=>null!==document.querySelector("#chat-history")||this.re||this.ne&&this.oe),1e4)()}catch(t){this.be("Failed to find chat history",t)}}))}addMessage(t,e=!1){this.ie.pushTask((()=>he(this,void 0,void 0,(function*(){yield this.Le(),this.fe.addMessage(t,e)}))),"addMessage, _waitForChatHistory")}addGif(t){this.ie.pushTask((()=>he(this,void 0,void 0,(function*(){yield this.Le(),this.fe.addGif(t)}))),"addGif")}reloadMessages(){this.fe.reloadMessages()}scrollToBottom(){this.fe.scrollToBottom()}addReviewMessage(){this.fe.addReviewMessage(),this.ye=!0}get showingReveiwMessage(){return this.ye}set shouldReturnToVideo(t){this.ce=t}onBufferingMessage(t){this.ie.pushTask((()=>he(this,void 0,void 0,(function*(){yield this.Le(),this.ge.setBufferingPresenceVisible(t.usersBuffering.length>0)}))),"addBufferingMessage")}onTypingMessage(t){this.ie.pushTask((()=>he(this,void 0,void 0,(function*(){yield this.Le(),this.ge.setTypingPresenceVisible(t.usersTyping.length>0)}))),"onTypingMessage")}onWatchingAdsMessage(t){this.ie.pushTask((()=>he(this,void 0,void 0,(function*(){yield this.Le(),this.ge.setWatchingAdsPresenceVisible(t.usersWatchingAds.length>0)}))),"onWatchingAdsMessage")}getWatchingAds(){return this.ge.getWatchingAdsVisible()}onNextEpisodeAvailable(t){console.log("onNextEpisodeAvailable",t),this.queueMessageForFrame(vt.UPDATE_ACTIONS_STATE,{nextEpisodeReady:t})}doUpdateSettings(t){var e;null===(e=this.Se)||void 0===e||e.saveUserSettings(t),t.shouldBroadcast&&this.Oe(this.Re(t))}onUpdateSettingsMessage(t){if(this.fe.updateUserData(t.permId,t.userSettings.userIcon,t.userSettings.userNickname,t.userSettings.userIconFrame),this.Se){const t=this.fe.getUserIconURL(this.Se.permId,this.Se.userIcon),e=this.fe.getUserIconFrameURL(this.Se.permId,this.Se.userIconFrame);this.fe.setUserIconUrl(t),this.fe.setUserIconFrameUrl(e),this.fe.renderSidebar()}}Me(){ie((()=>this.Ce()),1e4)().then((()=>{this.ve.startListening()}))}Pe(){this.ve.stopListening(),this.Ne&&(clearTimeout(this.Ne),this.Xt=!1)}teardown(){this.pe=!1,this.Zt=void 0,this.He=void 0,this.Pe(),this.R("[tpInjected]").remove(),this.removeChat(),this.setChatVisible(!1),console.log("teardown")}focusChat(){this.R("#chat-input")[0].focus()}showEmojiPicker(){var t,e;this.R("#gif-picker-container").is(":hidden")||this.toggleGIFs(),this.R("#emoji-picker-btn-icon").css({opacity:"1"});const i=null!==(t=this.R("#bottom-chat-controls").outerHeight(!0))&&void 0!==t?t:parseInt(this.R("#bottom-chat-controls").css("height")),n=parseInt(this.R("#chat-input-container").css("padding-bottom")),s=(null!==(e=this.R("#chat-input").outerHeight(!0))&&void 0!==e?e:parseInt(this.R("#chat-input").css("height")))+i+n;this.R("#emoji-picker-container").css({bottom:s})}hideEmojiPicker(){this.R("#emoji-picker-btn-icon").css({opacity:""}),this.R("#emoji-picker-container").css("bottom","")}showReactionHolder(){this.R("#reaction-btn-icon").css({opacity:"1"}),this.R("#reaction-holder").css({display:"flex"}),this.R("#reaction-holder").css({"padding-top":"8px"}),this.R("#chat-input-container").css({"padding-top":"0"})}hideReactionHolder(){this.R("#reaction-btn-icon").css({opacity:""}),this.R("#reaction-btn").css({background:"",padding:""}),this.R("#reaction-holder").css({"padding-top":""}),this.R("#chat-input-container").css({"padding-top":""}),this.ie.pushTask((()=>j.setItemsAsync({[c]:!1})))}onOpenGifPicker(){var t,e;return he(this,void 0,void 0,(function*(){this.R("#emoji-picker-container").is(":hidden")||this.toggleEmojiClicker(),this.R("#gif-results-left")[0].innerHTML||this.fetchGIFs(),this.R("#gif-btn-icon").css({opacity:"1"});const i=null!==(t=this.R("#bottom-chat-controls").outerHeight(!0))&&void 0!==t?t:parseInt(this.R("#bottom-chat-controls").css("height")),n=parseInt(this.R("#chat-input-container").css("padding-bottom")),s=(null!==(e=this.R("#chat-input").outerHeight(!0))&&void 0!==e?e:parseInt(this.R("#chat-input").css("height")))+i+n;this.R("#gif-picker-container").css({bottom:s})}))}onCloseGifPicker(){this.R("#gif-btn-icon").css({opacity:""}),this.R("#gif-btn").css({background:"",padding:""})}toggleEmojiClicker(){this.R("#emoji-picker-container").slideToggle(0,(()=>{this.R("#emoji-picker-container").is(":hidden")?this.hideEmojiPicker():this.showEmojiPicker()}))}toggleReactions(){const t=document.querySelector("#chat-history");let e=!1;t&&Math.abs(t.scrollHeight-t.scrollTop-t.clientHeight)<10&&(e=!0),this.R("#reaction-holder").slideToggle(0,(()=>{const t=this.R("#reaction-holder").is(":hidden");t?this.hideReactionHolder():this.showReactionHolder(),!t&&e&&this.fe.scrollToBottom()}))}onVideoClick(){this.queueMessageForFrame(vt.ON_PAGE_CLICK)}toggleGIFs(){this.R("#gif-picker-container").slideToggle(0,(()=>{this.R("#gif-picker-container").is(":hidden")?this.onCloseGifPicker():this.onOpenGifPicker()}))}addEmojiPicker(t){t.stopPropagation();const e=new K(P,$,{name:"user_click",component:{name:"chat_input_container-emoji_picker",type:"button",origin:"tp"}});R.C(e),this.toggleEmojiClicker()}addGifPicker(t){t.stopPropagation();const e=new K(P,$,{name:"user_click",component:{name:"chat_input_container-gif_popup",type:"button",origin:"tp"}});R.C(e),this.toggleGIFs()}addReactionTab(t){t.stopPropagation();const e=new K(P,$,{name:"user_click",component:{name:"chat_input_container-reaction_pinner",type:"button",origin:"tp"}});R.C(e),this.toggleReactions()}Ve(){if(e("Set Chat Html called"),this.Ue=s(),this.Ue=this.Ue.replace(/{EXTENSION_LOGO}/g,b(chrome.runtime.getURL("img/tp_logo.svg"))),void 0===this.Se)throw new Error("Attempt to set chatHtml when _userSettings is undefined.");const t=chrome.runtime.getURL("");this.Ue=this.Ue.replace(/{CHAT_URL}/g,`${l}?t=${Date.now()}&id=${encodeURIComponent(t.substring(0,t.length-1))}`);for(const t of d){const e=new RegExp(`${t}_STATIC`.toUpperCase(),"g"),i=new RegExp(`${t}_GIF`.toUpperCase(),"g");this.Ue=this.Ue.replace(e,chrome.runtime.getURL(`img/reactions/${t}/${t}_static.svg`)),this.Ue=this.Ue.replace(i,chrome.runtime.getURL(`img/reactions/${t}/${t}.gif`))}this.Ue=this.Ue.replace(/{USER_NICKNAME}/g,this.Se.userNickname?b(this.Se.userNickname):"Add a nickname"),this.Ue=this.Ue.replace(/{USER_ICON}/g,this.fe.getUserIconURL(this.Se.permId,this.Se.userIcon)),this.Ue=this.Ue.replace(/{LINK_SVG}/g,chrome.runtime.getURL("img/icon_link_active.svg")),this.Ue=this.Ue.replace(/{RESET_SGV}/g,chrome.runtime.getURL("img/reset_chat.svg")),this.Ue=this.Ue.replace(/{EMOJI_PICKER_ICON}/g,chrome.runtime.getURL("img/emoji_picker.svg")),this.Ue=this.Ue.replace(/{REACTION_PICKER_ICON}/g,chrome.runtime.getURL("img/reaction-popup.svg")),this.Ue=this.Ue.replace(/{GIF_PICKER_ICON}/g,chrome.runtime.getURL("img/gif_icon.svg")),this.Ue=this.Ue.replace(/{GIF_BACK_BUTTON}/g,chrome.runtime.getURL("img/icon_chevron.svg")),this.Ue=this.Ue.replace(/{EMOJI_LIB}/g,chrome.runtime.getURL("lib/tp_emoji/picker_bundled.js")),this.Ue=this.Ue.replace(/{EMOJI_FRAME}/g,chrome.runtime.getURL("web/emojiPicker.html")),this.Ue=this.Ue.replace(/{X_CIRCLE}/g,chrome.runtime.getURL("img/x-circle.svg"))}toggleIconContainer(){var t,e,i,n;this.R("#chat-icon-container").data("active")?(this.R("#chat-icon-container").data("active",!1),this.R("#chat-icon-container").slideUp(),this.R(".chat-settings-container").slideUp(),this.R("#sidebar-tabs-container").slideDown(),this.he?this.R("#chat-history-container").slideDown():this.R("#chat-friends-frame").slideDown(),this.Xt&&this.R("#chat-ad-holder").show(),this.R("#chat-input-container").show(),this.R("#reaction-holder").hide(),this.hideReactionHolder(),this.R("#teleparty-blog-container").show(),this.R("#presence-indicator").show(),this.R("#chat-header-container").removeClass("chat-header-container-active")):(this.R("#chat-icon-container").data("active",!0),this.R(".chat-settings-container").show(),this.R("#chat-icon-container").hide(),this.R("#chat-link-container").hide(),this.R("#chat-history-container").hide(),this.R("#sidebar-tabs-container").hide(),this.R("#chat-friends-frame").slideUp(),this.R("#chat-ad-holder").hide(),this.R("#chat-input-container").hide(),this.R("#teleparty-blog-container").hide(),this.R("#presence-indicator").hide(),this.R("#reaction-holder").hide(),this.R("#nickname-edit").attr("placeholder",null!==(e=null===(t=this.Se)||void 0===t?void 0:t.userNickname)&&void 0!==e?e:""),this.R("#nickname-edit")[0].value=null!==(n=null===(i=this.Se)||void 0===i?void 0:i.userNickname)&&void 0!==n?n:"")}togglePartyTab(){this.R("#friends-tab").toggleClass("sidebar-tab-inactive",!0),this.R("#party-tab").toggleClass("sidebar-tab-inactive",!1),this.R("#chat-history-container").show(),this.R("#chat-friends-frame").slideUp(),this.R("#chat-input-container").show(),this.he=!0}toggleFriendsTab(){this.R("#friends-tab").toggleClass("sidebar-tab-inactive",!1),this.R("#party-tab").toggleClass("sidebar-tab-inactive",!0),this.R("#chat-friends-frame").removeClass("hidden"),this.R("#chat-friends-frame").slideDown(),this.R("#chat-history-container").slideUp(),this.R("#chat-input-container").hide(),this.he=!1}toggleLargeUserIconButton(){this.R("#chat-icon-container").data("active")&&(this.R("#chat-icon-container").show(),this.R(".chat-settings-container").hide(),this.R("#chat-header-container").addClass("chat-header-container-active"))}linkIconListener(){navigator.clipboard.writeText(this.getPartyUrl()),this.R("#link-icon .tooltiptext").text("Link copied"),setTimeout((()=>{this.R("#link-icon .tooltiptext").text("Copy Link")}),1e3)}resetIconListener(){var t;if(null===(t=this.Ge)||void 0===t?void 0:t.videoId){const t=new CustomEvent("YoutubeVideoMessage",{detail:{type:"jumpToNextEpisode",nextVideoId:this.Ge.videoId}});window.dispatchEvent(t)}}setPartyUrl(t){this.Yt=t}setMessageForwarder(t){this.Ge=t}setSessionId(t){this.Zt=t}onWebRTC(t){this.queueMessageForFrame(vt.ON_WEB_RTC,t)}setSocketConnectionId(t){this.queueMessageForFrame(vt.SET_CONNECTION_ID,t)}loadUserList(t){t.forEach((t=>{if(void 0!==t.userSettings&&void 0!==t.permId){const e=t.userSettings,i=this.fe.getUserIconURL(t.permId,e.userIcon),n=this.fe.getUserIconFrameURL(t.permId,e.userIconFrame),s=this.fe.getUserNickname(t.permId,e.userNickname);t.parsedData={userIconUrl:i,userNickname:s,userIconFrameUrl:n}}})),this.le=t,this.R("#user-count").text(t.length),this.queueMessageForFrame(vt.SET_USER_LIST,t)}setSessionCreated(t){this.He=t}getSessionCreated(){return this.He}getSessionId(){return this.Zt}getPartyUrl(){return this.Yt}userIconSelectorListener(t){const i=jQuery(t.currentTarget).data("icon");i&&(e("userIconSelector button clicked: "+i),this.Se&&(this.Se.saveUserIcon(i),this.queueMessageForFrame(vt.UPDATE_SETTINGS,{userSettings:this.Se.userSettings}),this.Oe(this.Re(this.Se.userSettings)))),this.toggleIconContainer()}removeChat(){this.clearUnreadCount(),this.R("#chat-container").remove(),this.R("#chat-wrapper").remove()}Oe(t,e){R.C(t).then(e)}ze(t){return new q(P,$,{reactionType:t})}We(t){return new X(P,$,{gifObject:t})}Qe(t){return new Q(P,$,{body:t})}Ye(t){return new W(P,$,{typing:t})}Re(t){return new Y(P,$,{userSettings:t})}Ze(t){return chrome.runtime.getURL(`img/reactions/${t}/${t}.gif`)}showReaction(t){if(!this.shouldShowReaction()||this.Wt)return;const e=t.reactionType,i=this.getReactionContainer();if(i){const t=Math.floor(40*Math.random())+40,n=i[0].offsetWidth-(this.shouldAddReactionSpace()?u:0)-t,s=Math.floor(Math.random()*n)+(this.shouldAddReactionSpace()?u:0),o=this.Ze(e),r=Math.ceil(3*Math.random()),a=jQuery(`<img class="on-screen-reaction on-screen-reaction-${r}" src='${o}' />`);a.css("right",`${s}px`),a.css("width",`${t}px`),a.css("height",`${t}px`),i.append(a),setTimeout((()=>{a.remove()}),5e3)}}onReactionClicked(t){console.log(t),this.Oe(this.ze(t));const e=new K(P,$,{name:"user_click",component:{name:"chat_input_container-reaction_holder-reaction",type:t,origin:"tp"}});R.C(e);const i=new K(P,$,{eventType:"reaction-"+t,sessionId:this.getSessionId()});R.C(i)}onChatKeyUp(t){t.stopPropagation()}onChatKeyDown(t){t.stopPropagation(),this.ve.resetIdleTimer()}initCustomListeners(){}getClientLocale(){if("undefined"!=typeof Intl)try{return Intl.NumberFormat().resolvedOptions().locale}catch(t){console.error("Cannot get locale from Intl"),this.be("Cannot get locale from Intl",t)}}clickGif(t){console.log("GIF was clicked");let e=t.target.id;if(isNaN(e))e="trending"===e?"":e,this.fetchGIFs(e),this.R("#gif-search")[0].value=e;else{const t=this.ee.find((t=>t.id===e));if(!t)return;const i={id:t.id,title:t.title,description:t.content_description,isSticker:!1,media:t.media};this.Oe(this.We(i),(()=>{this.logShare(t.id,this.R("#gif-search")[0].value);const e={name:"user_click",action:{description:"gif clicked",source:t.media.full.url},component:{name:"chat_input_container-gif_popup-gif",type:"video",origin:"tp"}},i=new K(P,$,e);R.C(i);const n=new K(P,$,{eventType:"gif-share",sessionId:this.getSessionId()});R.C(n)})),this.toggleGIFs()}}Je(t){const e=document.createElement("video"),i=124/(t.media.preview.dims[0]/t.media.preview.dims[1]);return e.autoplay=!0,e.loop=!0,e.playsInline=!0,e.setAttribute("disablePictureInPicture",""),e.setAttribute("disableRemotePlayback",""),e.src=t.media.preview.url,e.muted=!0,e.id=t.id,e.height=i,e.className="gif-img",e}Ke(t){const e=document.createElement("img"),i=124/(t.media.previewMobile.dims[0]/t.media.previewMobile.dims[1]);return e.setAttribute("disablePictureInPicture",""),e.setAttribute("disableRemotePlayback",""),e.src=t.media.previewMobile.url,e.id=t.id,e.height=i,e.className="gif-img",e}loadGIFs(t){this.R(".gif-placeholder").remove(),this.ee.push(...t.results),this.Jt=t.next,t.results.forEach((t=>{const e=this.shouldUseVideoGIF()?this.Je(t):this.Ke(t);(this.R("#gif-results-left")[0].scrollHeight>this.R("#gif-results-right")[0].scrollHeight?this.R("#gif-results-right")[0]:this.R("#gif-results-left")[0]).appendChild(e)})),this.zt<6&&this.qe(),setTimeout((()=>{this.Gt=!1}),100)}onScrollToBottom(t){return he(this,void 0,void 0,(function*(){const e=t.target.scrollHeight-t.target.scrollTop<=t.target.clientHeight+450;if(this.Gt)t.preventDefault();else if("0"!==this.Jt&&e&&this.zt<6){this.zt+=1,this.Gt=!0,t.preventDefault();const e=yield fetch(this.Kt+`&pos=${this.Jt}`),i=yield e.json();this.loadGIFs(i)}}))}resetGif(){this.R("#gif-search")[0].value="",this.R("#gif-input-back").hide(),this.R("#gif-search").css("width",""),this.fetchGIFs()}displayCategories(){this.R("#gif-search")[0].value="",this.R("#category-container").show(),this.R("#gif-results").hide(),this.R("#gif-input-back").hide(),this.R("#gif-search").css("width","")}showCategories(){this.R("#gif-search")[0].value="",this.R("#gif-input-back").hide(),this.R("#gif-search").css("width","");const t=document.createElement("div");["trending","dance","annoyed","omg","crazy","shrug","smile","awkward","ew","surprised","why","ouch "].forEach((e=>{const i=document.createElement("div"),n=document.createElement("span");n.id="category-txt",n.innerHTML=e,i.className="tp-category-div";const s=document.createElement("video");s.autoplay=!0,s.src="https://media.tenor.com/videos/166d7d5a1be3b0755e7f9e29ebefe2c3/mp4",s.className="category-img",s.id=e,s.loop=!0,i.appendChild(n),i.appendChild(s),t.appendChild(i)})),this.R("#category-container")[0].innerHTML=t.innerHTML}Xe(){const t=[],e=[];for(let i=0;i<4;i++){let i=Math.floor(4*Math.random())+1;for(;e.includes(i);)i=Math.floor(4*Math.random())+1;e.push(i);const n=document.createElement("div");n.className=`gif-placeholder gif-placeholder-${i} gif-img`,t.push(n)}return t}qe(){return he(this,void 0,void 0,(function*(){this.R("#gif-results-left")[0].append(...this.Xe()),this.R("#gif-results-right")[0].append(...this.Xe())}))}logShare(t,e){return he(this,void 0,void 0,(function*(){const i=this.getClientLocale(),n=i?`&locale=${i}`:"",s=`&id=${t}`,o=e&&e.length>0?`q=${e}`:"";yield fetch(`${h}/register-share?${o}${n}${s}`)}))}fetchGIFs(t){return he(this,void 0,void 0,(function*(){const e=yield this.getVideoTitle(),i=null==e?void 0:e.replace(/[^\w\s]/g,"");this.zt=1,this.Gt=!0,this.R("#category-container").hide(),this.R("#gif-columns-wrapper").show(),this.R("#gif-results-left")[0].innerHTML="",this.R("#gif-results-right")[0].innerHTML="",this.ee=[],this.qe();const n=this.getClientLocale(),s=n?`&locale=${n}`:"";let o=i?`search-gifs?q=${i}`:"trending-gifs?";o=t?`search-gifs?q=${t}`:o,this.Kt=`${h}/${o}${s}`;const r=yield fetch(`${h}/${o}${s}`),u=yield r.json();if(u.results&&u.results.length>0)this.loadGIFs(u);else if(!t){const t=yield fetch(`${h}/trending_gifs?${s}`);this.Kt=`${h}/trending_gifs?${s}`;const e=yield t.json();this.loadGIFs(e)}}))}onGifSearch(t){t.stopPropagation();const e=t.target.value;if(void 0!==this.Fe&&clearTimeout(this.Fe),!e)return this.R("#gif-input-back").hide(),this.R("#gif-search").css("width",""),void this.fetchGIFs();this.R("#gif-input-back").show(),this.R("#gif-search").css("width","90%"),this.Fe=setTimeout((()=>{this.fetchGIFs(e)}),500)}ti(t){return"string"==typeof t&&""!==t.replace(/^\s+|\s+$/g,"")}onChatKeyPress(t){if(t.stopPropagation(),"Enter"!==t.key||t.shiftKey)void 0===this.we?this.Oe(this.Ye(!0)):clearTimeout(this.we),this.we=setTimeout((()=>{this.we=void 0,this.Oe(this.Ye(!1))}),500);else{this.R("#emoji-picker-container").is(":hidden")||this.toggleEmojiClicker();const e=this.R("#chat-input"),i=e[0].textContent;if(i&&this.ti(i)){void 0!==this.we&&(clearTimeout(this.we),this.we=void 0,this.Oe(this.Ye(!1))),e.prop("contenteditable",!1),this.Oe(this.Qe(i.substring(0,1500)),(()=>{e[0].textContent="",e.prop("contenteditable",!0),this.focusChat(),this.onInputChange()}));const t={name:"chat_send",action:{description:"message was sent"},message:{id:function(){try{return pt()}catch(t){return""}}(),text:i.trim()}},n=new K(P,$,t);R.C(n)}else t.stopImmediatePropagation(),t.preventDefault(),e[0].textContent="",this.onInputChange()}}onInputChange(){const t=this.R("#chat-input");if(t.length>0){const e=t[0].textContent;e&&this.shouldShowIncreasedSize(e)?t.addClass("tp-emoji-large"):t.removeClass("tp-emoji-large")}this.R("#emoji-picker-container").css("bottom").length>0&&(this.R("#emoji-picker-container").is(":hidden")||this.showEmojiPicker())}shouldShowIncreasedSize(t){const e=t.replace(f,"").replace(/[\uFE0F]/g,""),i=((t||"").match(f)||[]).length;return 0===e.length&&i<=3&&i>0}saveChangesListener(){var t;const i=this.R("#nickname-edit").val().slice(0,25).replace(/^\s+|\s+$/g,"");e("saveChanges button clicked: "+i),i!==(null===(t=this.Se)||void 0===t?void 0:t.userNickname)&&this.Se&&(this.Se.saveUserNickname(i),this.queueMessageForFrame(vt.UPDATE_SETTINGS,{userSettings:this.Se.userSettings}),this.Oe(this.Re(this.Se.userSettings)),this.R("#nickname-edit").attr("placeholder",i),this.R("#nickname-edit").text(i)),this.toggleIconContainer()}cancelNicknameListener(){this.toggleIconContainer()}get inSession(){return this.pe}addIconSelector(){Object.keys(y).forEach((t=>{if(E[t]()){const e=y[t],i=jQuery('\n                <ul id="icon-holder"></ul>\n            ');for(const n of e)this.ei(`${t}/${n}`,i,n);const n=jQuery(`\n                <div class="icon-holder-wrap">\n                  <p class="extension-txt-indicator" data-tp-id="chat_container-new_icon_selection-category_name>${t}</p>\n                </div>\n            `);i.appendTo(n),n.appendTo(this.R("#icon-holder-template"))}}),this)}inputHeightCheck(){const t=this.R("#chat-input").text(),e=((t||"").match(f)||[]).length,i=t.replace(f,"");e<=3||i?this.R(".inTextEmoji").css("font-size","24px"):e>0?this.R(".inTextEmoji").css("font-size","20px"):this.R(".inTextEmoji").css("font-size","18px")}ei(t,e,i){jQuery(`\n            <a class="image-button">\n                <img class="img-class" src='${chrome.runtime.getURL("img/icons/"+t)}' data-tp-id="chat_container-new_icon_selection-${i}">\n            </a>\n        `).appendTo(e).data("icon",t)}}var de=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class De extends le{constructor(){super(),this.ii="\n          .videoFullscreenWithChat {\n            width: calc(100% - 340px);\n          }\n        "}ni(){const t=document.querySelectorAll(".webPlayerSDKContainer");let e=jQuery(".webPlayerSDKContainer").last();if([...t].forEach((t=>{var i;(null===(i=t.querySelector("video"))||void 0===i?void 0:i.src)&&(e=jQuery(t))})),e.length>0)return e;const i=document.querySelectorAll(".atvwebplayersdk-video-surface");let n=null;if([...i].forEach((t=>{var e;(null===(e=t.querySelector("video"))||void 0===e?void 0:e.src)&&(n=t)})),n)return jQuery(n);const s=document.querySelectorAll(".atvwebplayersdk-player-container");let o=null;return[...s].forEach((t=>{var e;(null===(e=t.querySelector("video"))||void 0===e?void 0:e.src)&&(o=t)})),o?jQuery(o):e}getReactionContainer(){return this.ni()}Te(){this.Ue&&this.ni().append(function(t,e=""){return`\n\n      <style tpInjected>\n    \n\n      .with-chat {\n        left: 0px !important;\n        width: calc(100% - 340px) !important;\n      }\n\n      .with-chat-absolute {\n        position: absolute !important;\n      }\n\n      .tp-video {\n        transition: width 250ms linear 0.2s;\n      }\n\n      [data-chat-visible="true"] {\n        left: 0px !important;\n        width: calc(100% - 340px) !important;\n        position: absolute !important;\n    }\n\n      ${e}\n      \n    </style>\n\n    <link tpInjected rel="stylesheet" href="${chrome.runtime.getURL("css/chat.css")}">\n    <link rel="stylesheet" href="${chrome.runtime.getURL("css/alert.css")}">\n\n    ${t}\n  `}(this.Ue,this.ii))}getVideoTitle(){var t;return de(this,void 0,void 0,(function*(){const e=document.querySelectorAll(".atvwebplayersdk-title-text")[0];return null!==(t=e.innerText)&&void 0!==t?t:void 0}))}getChatVisible(){return jQuery("#chat-wrapper").is(":visible")}removeChat(){super.removeChat()}setChatVisible(t,e=!0){const i=Object.create(null,{setChatVisible:{get:()=>super.setChatVisible}});return de(this,void 0,void 0,(function*(){try{yield i.setChatVisible.call(this,t,e)}catch(t){return}t?(this.ni().addClass(ft),jQuery("#chat-wrapper").show(),document.hasFocus()||this.clearUnreadCount()):(this.ni().removeClass(ft),jQuery("#chat-wrapper").hide(),jQuery(window).trigger("resize")),this.si(t);const n=document.querySelectorAll(".atvwebplayersdk-player-container");let s=null;[...n].forEach((t=>{var e;(null===(e=t.querySelector("video"))||void 0===e?void 0:e.src)&&(s=t)})),!s&&n.length>0&&(s=n[n.length-1]),this.oi(s,t)}))}si(t){document.webkitIsFullScreen&&(t?(jQuery("video").addClass("videoFullscreenWithChat"),this.ni().addClass(ft)):(jQuery("video").removeClass("videoFullscreenWithChat"),this.ni().removeClass(ft)))}shouldAddReactionSpace(){return!0}shouldShowReaction(){return!0}shouldUseVideoGIF(){return!0}onVideoResize(){ee(100)().then((()=>{this.shouldChatBeVisible()&&(document.webkitIsFullScreen?(jQuery("video").addClass("videoFullscreenWithChat"),this.ni().addClass(ft)):(jQuery("video").removeClass("videoFullscreenWithChat"),this.ni().removeClass(ft)))}))}oi(t,e){t&&t.style&&(t.style.width=e?"calc(100% - 340px)":"100%")}}var pe,ve,ge,fe,me=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class we{constructor(){this.ri=0,this.ui=!1}set hostOnly(t){this.ui=t}get hostOnly(){return this.ui}get uiEventsHappening(){return this.ri}getScreenSize(){return{width:window.outerWidth,height:window.outerHeight}}getVideoContent(t,e,i,n,s){let o,r,u;return s&&(s.episodeNum&&!isNaN(s.episodeNum)&&(o=s.episodeNum),s.seasonNum&&!isNaN(s.seasonNum)&&(r=s.seasonNum),u=s.title),{id:t,type:n,name:e,url:i,episode:o,season:r,episode_name:u,service:this.getInternalStreamingServiceName()}}logError(t,e){console.error("ERROR",t,e);const i=new K(P,$,{name:"video_error",action:{description:t,reason:e}});R.C(i)}doAdCheck(){return me(this,void 0,void 0,(function*(){}))}triggerNextEpisodeClick(){}}!function(t){t.LOADING="loading",t.PLAYING="playing",t.IDLE="idle",t.AD_PLAYING="ad_playing",t.PAUSED="paused",t.NOT_READY="not_ready"}(pe||(pe={})),function(t){t.PAUSED="paused",t.PLAYING="playing"}(ve||(ve={})),function(t){t.episode="episode",t.movie="movie"}(ge||(ge={}));class Fe{constructor(t,e,i,n,s,o=[],r=!0){this.requiredPermissions=t,this.serverName=i,this.name=n,this.contentScripts=e,this.syncFromEnd=s,this.browseScripts=o,this.shouldValidateVideoType=r}validateVideoId(t){return!!t}validateVideoType(t){return!!t}urlWithSessionId(t){return`${r}/join/${t}`}}!function(t){t.NETFLIX="Netflix",t.HULU="Hulu",t.DISNEY_PLUS="Disney",t.DISNEY_PLUS_MENA="DisneyMena",t.HBO_MAX="HBOMax",t.MAX="Max",t.YOUTUBE="Youtube",t.YOUTUBE_TV="YoutubeTV",t.AMAZON="Amazon",t.CRUNCHYROLL="Crunchyroll",t.ESPN="ESPN+",t.PARAMOUNT="Paramount+",t.FUNIMATION="Funimation",t.HOTSTAR="Hotstar",t.PEACOCK="Peacock TV",t.STAR_PLUS="Starplus",t.PLUTO_TV="PlutoTV",t.APPLE_TV="AppleTV",t.JIO_CINEMA="JioCinema",t.TUBI_TV="TubiTV",t.MUBI="Mubi",t.STAN="Stan",t.CRAVE="Crave",t.SLING="Sling",t.FUBO="Fubo",t.VIKI="Viki",t.SPOTIFY="Spotify",t.ZEE5="Zee5",t.SONY_LIV="SonyLiv",t.UNEXT="U-Next",t.HULU_JP="Hulu Japan",t.WILLOW="Willow",t.CANALPLUS="Canal+",t.FANCODE="Fancode",t.SHAHID="Shahid",t.VIU="Viu"}(fe||(fe={}));const ye=new class extends Fe{isValidUrl(t){return te(t)}isBrowsing(t){return te(t)||t.pathname.includes("amazon.")}getVideoId(t){const e=t.pathname.split("ref")[0].match(/^.*\/([a-z\-0-9.A-Z]+)(\?|\/ref)?.*/);return null!=e&&e.length>0?e[1]:void 0}}([],["content_scripts/amazon/amazon_content_bundled.js"],"amazon",fe.AMAZON,!1,["browse_scripts/amazon/amazon_browse_bundled.js"]);Object.freeze(ye);const Ce=ye;var be,Ee=i(7833),_e=i.n(Ee);class xe{constructor(t){this.namespace=t}debug(t){const e=t.methodName?`${this.namespace}:${t.methodName}`:this.namespace;t.message&&_e()(e)(t.message),t.object&&_e()(e)(t.object)}}!function(t){t.NETFLIX="netflix",t.HULU="hulu",t.DISNEY_PLUS="disney",t.STAR_PLUS="starplus",t.AMAZON="amazon",t.YOUTUBE="youtube",t.HBO_MAX="hbomax",t.MAX="max",t.FUBO="fubo",t.CRUNCHYROLL="crunchyroll",t.PARAMOUNT="paramount",t.PEACOCK="peacock",t.HOTSTAR="hotstar",t.DISNEY_PLUS_MENA="disneymena",t.APPLE_TV="appletv",t.PLUTO_TV="plutotv",t.FUNIMATION="funimation",t.TUBI_TV="tubitv",t.JIO_CINEMA="jiocinema",t.MUBI="mubi",t.CRAVE="crave",t.STAN="stan",t.SONY_LIV="sonyliv",t.ZEE5="zee5",t.HULU_JP="hulujp",t.UNEXT="unext",t.GLOBOPLAY="globoplay",t.WILLOW="willow",t.FANCODE="fancode",t.CANALPLUS="canalplus",t.SHAHID="shahid",t.RTL="rtl",t.ESPN="espn",t.SLING="sling",t.VIKI="viki",t.SPOTIFY="spotify",t.SHOWTIME="showtime",t.AMC_PLUS="amcplus",t.VIU="viu"}(be||(be={}));var ke=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class Ae extends we{constructor(){super(),this.ai=!1,this.ci=new xe("ext:ContentScripts:Amazon:AmazonVideoApi"),this.hi=!1,this.waitUpdateState=()=>ke(this,void 0,void 0,(function*(){if(!this.getVideoElement())return this.li;const t=Date.now();window.postMessage({type:"UpdateState"},"*");try{yield ie((()=>this.li.updatedAt>=t),500,10)()}catch(t){console.error("Failed to update state",t),this.li={currentTime:this.li.currentTime,duration:this.li.duration,adPlaying:this.li.adPlaying,state:this.li.state,updatedAt:Date.now()}}return this.li})),this.di=6e4,this.ri=0,this.Di=0,this.pi=[],this.vi=this.getVideoType(),this.gi=0,this.li={duration:0,currentTime:0,adPlaying:!1,updatedAt:0,state:0}}get videoId(){return this.fi}set videoId(t){this.fi=t}get videoType(){return this.vi}set videoType(t){this.vi=t}getVideoType(){const t=jQuery(".webPlayerContainer div:contains('Next Episode')");return t&&t.length?ge.episode:ge.movie}isWatchingAd(){return this.li.adPlaying}setVideoEventListener(t){this.mi=t}tryUpdateVideoId(){return this.wi!=this.videoId&&(this.ci.debug({methodName:"tryUpdateVideoId",message:`New video ID: ${this.wi}`}),this.videoId=this.wi,!0)}Fi(){var t,e;return ke(this,void 0,void 0,(function*(){try{const e=(new Date).getTime();if(!this.getVideoElement())throw new Error("Couldn't find video");return yield this.updateVideoId(),yield ie((()=>null!=this.Di&&this.Di>e),4e3)(),null!==(t=this.wi)&&void 0!==t?t:""}catch(t){return null!==(e=this.wi)&&void 0!==e?e:""}}))}yi(){var t,e;return ke(this,void 0,void 0,(function*(){try{if(null==this.fi&&this.wi)return this.ci.debug({methodName:"getCurrentVideoId",message:"Already have video Id"}),this.wi;const e=(new Date).getTime(),i=this.getVideoElement();if(!i)throw new Error("Couldn't find video");return yield ie(this.isVideoReady.bind(this),5e3)(),i.muted=!0,i.paused?(yield this.play(),yield ee(250)(),yield this.pause()):(yield this.pause(),yield ee(250)(),yield this.play()),i.muted=!1,this.ci.debug({methodName:"getCurrentVideoId",message:"Waiting for video id"}),yield this.updateVideoId(),yield ie((()=>null!=this.Di&&this.Di>e),4e3)(),null!==(t=this.wi)&&void 0!==t?t:""}catch(t){const i=this.getVideoElement();return i&&(i.muted=!1),this.ci.debug({methodName:"getCurrentVideoId",message:"Failed to load video id: "+t}),this.logError("Failed to load video id",t),null!==(e=Ce.getVideoId(new URL(window.location.href)))&&void 0!==e?e:""}}))}getVideoLookupData(){return ke(this,void 0,void 0,(function*(){try{const t=Date.now(),e=new CustomEvent("AmazonVideoMessage",{detail:{type:"getVideoLookupData"}});yield ie((()=>(window.dispatchEvent(e),0!=this.gi&&this.gi>t)),500,10)()}catch(t){console.log(t)}}))}Ci(){return ke(this,void 0,void 0,(function*(){void 0===this.fi&&(this.videoId=yield this.yi())}))}bi(){return ke(this,void 0,void 0,(function*(){const t=document.querySelector('[data-testid="dp-atf-play-button"]');console.log(t),t&&"false"===t.getAttribute("aria-disabled")&&!this.hi&&(this.hi=!0,console.log("Running click"),yield ee(1500)(),t.click())}))}waitVideoApiReadyAsync(){return ke(this,void 0,void 0,(function*(){if(!this.isPlayerPage())throw new Error(_);this.hi=!1,yield ie((()=>(this.bi(),this.isVideoReady())),1/0)(),yield this.skipPromo(),yield this.Ci(),this.videoType=this.getVideoType()}))}waitVideoDoneLoadingAsync(){return ke(this,void 0,void 0,(function*(){yield ie((()=>this.Ei()!==pe.LOADING),1e4)()}))}getStateAsync(){return ke(this,void 0,void 0,(function*(){return yield this.waitUpdateState(),new Promise(((t,e)=>{if(!this.isPlayerPage())return void e("Not on player page.");const i=this._i();if(-1==i)return void e("Could not get current player time.");t({playbackState:this.Ei(),playbackPositionMilliseconds:i})}))}))}checkUpdateId(t){this.wi==t&&(this.videoId=this.wi)}isTimeTextLoaded(){const t=document.querySelector(".atvwebplayersdk-timeindicator-text");return null!=t&&null!=t.textContent}skipPromo(){return ke(this,void 0,void 0,(function*(){if(!this.ai){this.ai=!0;try{let t=document.evaluate("//div[text()='Skip']",document,null,XPathResult.ANY_TYPE,null).iterateNext();t&&t instanceof HTMLElement&&(this.ci.debug({methodName:"skipPromo",message:"Skipped Ads"}),t.click(),yield ie((()=>(t=document.evaluate("//div[text()='Skip']",document,null,XPathResult.ANY_TYPE,null).iterateNext(),!t)),5e3)(),yield ee(250)())}finally{this.ai=!1}}}))}freeze(t){return ke(this,void 0,void 0,(function*(){this.ri+=1;try{yield this.pause(),yield ee(t)(),yield this.play()}finally{this.ri-=1}}))}isVideoReady(){const t=this.Ei();return"paused"===t||"playing"===t}episodeDataInteraction(t){if(t.source==window&&t.data.type&&"EPISODE_ID"==t.data.type&&t.data.videoIds)try{this.pi=JSON.parse(t.data.videoIds)}catch(t){this.ci.debug({methodName:"episodeDataInteraction",message:"Parse error:"+t}),this.logError("Parse Error for episoeData Interaction function",t)}}getVideoDataAsync(){var t,e,i;return ke(this,void 0,void 0,(function*(){yield this.updateVideoId(),yield this.getVideoLookupData();const n=null!==(t=this.xi())&&void 0!==t?t:"";this.videoType=this.getVideoType();const s=this.ki(),o=this.getScreenSize(),r=this.Ai(),u=this.getVideoContent(null!==(e=this.wi)&&void 0!==e?e:"",n,window.location.href,this.videoType,r),a=yield this.getStateAsync();let c,h,l,d;return this.Bi&&(c=this.Bi.title,d=this.Bi.type,l=this.Bi.releaseYear,h=this.Bi.episodeYear),{videoId:null!==(i=this.wi)&&void 0!==i?i:"",videoTitle:n,videoDuration:s,serviceDomain:window.location.hostname,screen:o,content:u,videoState:a.playbackState,originalTitle:c,episodeYear:h,type:d,releaseYear:l,service:"Amazon"}}))}jumpToNextEpisode(t){var e;return ke(this,void 0,void 0,(function*(){this.ri+=1;if((yield this.Ii())!==t.videoId)try{yield null===(e=this.mi)||void 0===e?void 0:e.reloadNextEpisode()}catch(t){console.log("Failed to jump to next episode:",t)}this.ri-=1}))}Si(){return new Promise(((t,e)=>{const i=document.evaluate("//div[text()='Next Episode']",document,null,XPathResult.ANY_TYPE,null).iterateNext();i instanceof HTMLElement?(i.click(),t()):e()}))}pause(){return ke(this,void 0,void 0,(function*(){this.ci.debug({methodName:"pause",message:"Attempting to Pause"}),this.ri+=1;try{const t=this.getVideoElement();if(null===t)throw new Error(B);t.pause(),yield ee(250)(),yield ie((()=>this.Ei()===pe.PAUSED),1250)()}finally{this.ri-=1}}))}getStreamingServiceName(){return fe.AMAZON}play(){return ke(this,void 0,void 0,(function*(){this.ci.debug({methodName:"play",message:"Attempting to play"}),this.ri+=1;try{const t=this.getVideoElement();if(null===t)throw new Error(B);yield t.play(),yield ie((()=>this.Ei()===pe.PLAYING),1250)()}finally{this.ri-=1}}))}setCurrentTime(t){return ke(this,void 0,void 0,(function*(){this.ri+=1;try{if(null===this.getVideoElement())throw new Error(B);const e=t/this.ki();this.ji(e),this.ci.debug({methodName:"setCurrentTime",message:"Manually clicked seek"}),yield ee(500)(),yield ie((()=>this.Ei()!==pe.LOADING),1/0)()}finally{this.ri-=1}}))}onNode(t){var e;const i=t.detail;"VideoId"==i.type?(this.wi=i.videoId,this.Di=Date.now()):"UpdateState"==i.type?this.li={duration:i.duration,currentTime:i.currentTime,adPlaying:i.adPlaying,updatedAt:i.updatedAt,state:(null===(e=this.mi)||void 0===e?void 0:e.isOthersWatchingAds())?"Paused":i.state}:"GetLookupData"==i.type&&(this.Bi=i.data,this.gi=Date.now())}updateVideoId(){return ke(this,void 0,void 0,(function*(){this.ci.debug({methodName:"updateVideoId",message:"Trying to update video ID"});try{yield ie((()=>{const t=new CustomEvent("AmazonVideoMessage",{detail:{type:"getVideoId"}});return window.dispatchEvent(t),!0}),1e4)()}catch(t){throw new Error("Couldn't get new videoId in time.")}}))}Ti(t){const e=document.querySelectorAll(".webPlayerSDKContainer");let i=e[0];if([...e].forEach((t=>{var e;(null===(e=t.querySelector("video"))||void 0===e?void 0:e.src)&&(i=t)})),null==i?void 0:i.querySelector(t))return null==i?void 0:i.querySelector(t);const n=document.querySelector(".atvwebplayersdk-video-surface");if(null==n?void 0:n.querySelector(t))return null==n?void 0:n.querySelector(t);const s=document.querySelector(".atvwebplayersdk-player-container");return(null==s?void 0:s.querySelector(t))?null==s?void 0:s.querySelector(t):null}ji(t){const e=this.Ti(".atvwebplayersdk-seekbar-range");if(null!==e){const i=this.Mi(t);null!==i&&(this.$i(e,i,"mousedown"),this.$i(e,i,"mouseup"))}}Mi(t){const e=this.Ti(".atvwebplayersdk-seekbar-range");if(e instanceof HTMLElement){const i=e.getBoundingClientRect();return t*e.offsetWidth+i.left}return null}$i(t,e,i){const{height:n,top:s}=t.getBoundingClientRect(),o=s+n/2;document.createEvent("MouseEvents").initMouseEvent(i,!0,!0,window,0,0,0,e,o,!1,!1,!1,!1,0,null);const r=new PointerEvent(i,{pointerId:1,isPrimary:!0,view:window,bubbles:!0,cancelable:!0,clientX:e,clientY:o});t.dispatchEvent(r)}getVideoElement(){if(!this.isPlayerPage())return null;const t=document.querySelectorAll(".rendererContainer video");let e=null;if([...t].forEach((t=>{t.src&&(e=t)})),e)return e;const i=document.querySelectorAll(".atvwebplayersdk-video-surface video");let n=null;return i.forEach((t=>{t instanceof HTMLVideoElement&&t.src&&(n=t)})),n}isPlayerPage(){return!!window.location.href.includes("?autoplay")||(null!=document.querySelector(".rendererContainer video")||null!=document.querySelector(".atvwebplayersdk-video-surface video"))&&null!=document.querySelector(".dv-player-fullscreen")}Ei(){const t=this.getVideoElement();let e;return e=t?t.readyState<4?pe.LOADING:t.paused?pe.PAUSED:pe.PLAYING:pe.NOT_READY,e}_i(){return this.li.currentTime}ki(){return this.li.duration}xi(){const t=this.Ti(".atvwebplayersdk-title-text");return t?t.innerHTML:null}Ai(){var t,e,i,n;const s=this.Ti(".atvwebplayersdk-subtitle-text"),o=null!==(e=null===(t=null==s?void 0:s.lastChild)||void 0===t?void 0:t.textContent)&&void 0!==e?e:void 0,r=null==s?void 0:s.firstChild;let u={};if(r&&r.textContent){const t=null!==(i=r.textContent.match(/Season\s(\d*),/))&&void 0!==i?i:[""],e=null!==(n=r.textContent.match(/\.\s(\d)/))&&void 0!==n?n:[""];u={episodeNum:Number(e[1]),seasonNum:Number(t[1]),title:o}}return u}Ii(){return new Promise(((t,e)=>{ie(this.Vi.bind(this),5e3)().then((()=>ke(this,void 0,void 0,(function*(){var i;try{this.ci.debug({methodName:"_getVideoIdAsync",message:"Attempting play/pause"});const n=(new Date).getTime(),s=this.getVideoElement();if(null===s)return void e();s.paused?(yield s.play(),yield ee(250)(),s.pause()):(s.pause(),yield ee(250)(),yield s.play()),null==this.videoId&&this.wi?(this.ci.debug({methodName:"_getVideoIdAsync",message:"Already have video Id"}),t(this.wi)):(this.ci.debug({methodName:"_getVideoIdAsync",message:"Waiting for video Id"}),yield this.updateVideoId(),yield ie((()=>null!=this.Di&&this.Di>n),4e3)(),t(null!==(i=this.wi)&&void 0!==i?i:""))}catch(t){this.ci.debug({methodName:"_getVideoIdAsync",message:"Failed to load video id with error: "}),this.logError("Failed to load video id",t),e()}}))))}))}Vi(){const t=this.Ei();return t===pe.PAUSED||t===pe.PLAYING}getUpdateSessionDataAsync(){return ke(this,void 0,void 0,(function*(){const t=yield this.getStateAsync(),e=this._i();if(null===e)throw new Error("Couldn't get update data");const i=Date.now();return{state:t.playbackState===pe.PLAYING?ve.PLAYING:ve.PAUSED,lastKnownTime:e,lastKnownTimeUpdatedAt:i,bufferingState:this.Ei()==pe.LOADING}}))}getInternalStreamingServiceName(){return be.AMAZON}}const Be=new class extends Fe{isValidUrl(t){return function(t){return t.hostname.includes("tv.apple.com")}(t)}isBrowsing(t){return!1}getVideoId(t){return t.toString().split("https://tv.apple.com/")[1]}}([],["content_scripts/appletv/appletv_content_bundled.js"],"appletv",fe.APPLE_TV,!1,["browse_scripts/appletv/appletv_browse_bundled.js"]);Object.freeze(Be);const Ie=Be;const Se=new class extends Fe{isValidUrl(t){return function(t){return t.hostname.includes(".canalplus.")&&["/cinema","/sport","/divertissement","/decouverte","/musique","/series"].some((e=>t.pathname.includes(e)))}(t)}isBrowsing(t){return t.hostname.includes(".canalplus.")}getVideoId(t){const e=t.pathname.split("/").filter(Boolean);return"live"===e[0]&&e.length>=2?e[1]:e.join("/")}}([],["content_scripts/canalplus/canalplus_content_bundled.js"],"canalplus",fe.CANALPLUS,!1,["browse_scripts/canalplus/canalplus_browse_bundled.js"]);Object.freeze(Se);const je=Se;const Te=new class extends Fe{isValidUrl(t){return function(t){const e=t.hostname.includes(".crave."),i=t.pathname.includes("/play/");return e&&i}(t)}isBrowsing(t){return t.hostname.includes(".crave.")}getVideoId(t){return t.pathname.substring(1)}}([],["content_scripts/crave/crave_content_bundled.js"],"crave",fe.CRAVE,!1,["browse_scripts/crave/crave_browse_bundled.js"]);Object.freeze(Te);const Me=Te;const $e=new class extends Fe{isBrowsing(t){return t.hostname.includes(".crunchyroll.")}isValidUrl(t){return function(t){return t.hostname.includes(".crunchyroll.")}(t)}getVideoId(t){const e=t.pathname.match(/watch\/(.*)\//);return e&&e.length>0?e[1]:void 0}}([],["content_scripts/crunchyroll/crunchyroll_content_bundled.js"],"crunchyroll",fe.CRUNCHYROLL,!1,["browse_scripts/crunchyroll/crunchyroll_browse_bundled.js"]);Object.freeze($e);const Ve=$e;const Pe=new class extends Fe{isValidUrl(t){return function(t){return t.hostname.includes(".disneyplus.")&&(t.pathname.includes("/video")||t.pathname.includes("/play"))}(t)}isBrowsing(t){return t.hostname.includes(".disneyplus.")&&!t.hostname.includes("apps.disneyplus.")}getVideoId(t){const e=t.pathname.match(/^.*\/([a-z\-0-9]+)\??.*/);return e&&e.length>0?e[1]:void 0}}([],["content_scripts/disney/disney_content_bundled.js"],"disney",fe.DISNEY_PLUS,!1,["browse_scripts/disney/disney_browse_bundled.js"]);Object.freeze(Pe);const Le=Pe;const Oe=new class extends Fe{isValidUrl(t){return function(t){return t.hostname.includes("apps.disneyplus.")&&t.pathname.includes("/watch")}(t)}isBrowsing(t){return t.hostname.includes("apps.disneyplus.")}getVideoId(t){const e=t.pathname.split("/");return e&&e.length>1?e[e.length-2]:void 0}}([],["content_scripts/disneymena/disneymena_content_bundled.js"],"disneymena",fe.DISNEY_PLUS_MENA,!1);Object.freeze(Oe);const Re=Oe;const Ne=new class extends Fe{isBrowsing(t){return t.hostname.includes(".espn.")}isValidUrl(t){return function(t){return t.hostname.includes(".espn.")&&t.pathname.includes("/player")}(t)}getVideoId(t){const e=t.pathname;return e.substring(e.lastIndexOf("/")+1)}}([],["content_scripts/espn/espn_content_bundled.js"],"espn",fe.ESPN,!1,["browse_scripts/espn/espn_browse_bundled.js"]);Object.freeze(Ne);const He=Ne;const Ue=new class extends Fe{isValidUrl(t){return function(t){const e=t.hostname.includes("fancode.com"),i=t.searchParams.get(Qt.MATCH_INFO_QUERY_PARAM.tag)===Qt.MATCH_INFO_QUERY_PARAM.value,n=t.pathname.includes(Qt.HIGHLIGHTS),s=Qt.LIVE_MATCH_PAGE_TYPES.some((e=>t.pathname.includes(e)));return e&&!i&&(n||s)}(t)}isBrowsing(t){return t.hostname.includes(".fancode.")}getVideoId(t){return t.pathname.substring(1)}}([],["content_scripts/fancode/fancode_content_bundled.js"],"fancode",fe.FANCODE,!1,["browse_scripts/fancode/fancode_browse_bundled.js"]);Object.freeze(Ue);const Ge=Ue;const ze=new class extends Fe{isValidUrl(t){return function(t){const e=t.hostname.includes("fubo.tv"),i=t.pathname.includes("watch");return e&&i}(t)}isBrowsing(t){return t.hostname.includes(".fubo.tv")}getVideoId(t){return t.search.substring(1)}}([],["content_scripts/fubo/fubo_content_bundled.js"],"fubo",fe.FUBO,!1,["browse_scripts/fubo/fubo_browse_bundled.js"]);Object.freeze(ze);const We=ze;const Qe=new class extends Fe{isBrowsing(t){return t.hostname.includes(".funimation.")}isValidUrl(t){return function(t){return t.hostname.includes(".funimation.")&&t.pathname.includes("/v/")}(t)}getVideoId(t){return t.pathname.split("/v/")[1]}}([],["content_scripts/funimation/funimation_content_bundled.js"],"funimation",fe.FUNIMATION,!1,["browse_scripts/funimation/funimation_browse_bundled.js"]);Object.freeze(Qe);const Ye=Qe;const Ze=new class extends Fe{isValidUrl(t){return function(t){return t.hostname.includes(".hbomax.")&&t.pathname.includes("video/watch")}(t)}isBrowsing(t){return t.hostname.includes("play.hbomax.")}getVideoId(t){if(t.pathname.includes("/watch/"))return t.pathname.split("/watch/")[1]}}([],["content_scripts/hbo_max/hbo_max_content_bundled.js"],"hbomax",fe.HBO_MAX,!1,["browse_scripts/hbo_max/hbo_max_browse_bundled.js"]);Object.freeze(Ze);const Je=Ze;const Ke=new class extends Fe{isValidUrl(t){return function(t){return t.hostname.includes(".hotstar.")&&t.pathname.includes("/watch")}(t)}isBrowsing(t){return t.hostname.includes(".hotstar.")}getVideoId(t){const e=t.pathname.split("/");return e.includes("live")?e&&e.length>2?e[e.length-4]:void 0:e&&e.length>1?e[e.length-2]:void 0}}([],["content_scripts/hotstar/hotstar_content_bundled.js"],"hotstar",fe.HOTSTAR,!1,["browse_scripts/hotstar/hotstar_browse_bundled.js"]);Object.freeze(Ke);const qe=Ke;const Xe=new class extends Fe{isValidUrl(t){return function(t){return t.hostname.includes(".hulu.")&&!t.hostname.includes("hulu.jp")&&t.pathname.includes("/watch")}(t)}isBrowsing(t){return t.hostname.includes(".hulu.")&&!t.hostname.includes("hulu.jp")}getVideoId(t){const e=t.pathname.match(/^.*\/([a-z\-0-9]+)\??.*/);return e&&e.length>0?e[1]:void 0}}([],["content_scripts/hulu/hulu_content_bundled.js"],"hulu",fe.HULU,!1,["browse_scripts/hulu/hulu_browse_bundled.js"]);Object.freeze(Xe);const ti=Xe;const ei=new class extends Fe{isValidUrl(t){return function(t){return t.hostname.includes("hulu.jp")&&t.pathname.startsWith("/watch/")}(t)}isBrowsing(t){return t.hostname.includes(".hulu.jp")}getVideoId(t){const e=t.pathname.split("watch/");if(e.length>1&&e[1].length>0)return e[1]}}([],["content_scripts/hulujp/hulujp_content_bundled.js"],"hulujp",fe.HULU_JP,!1,["browse_scripts/hulujp/hulujp_browse_bundled.js"]);Object.freeze(ei);const ii=ei;const ni=new class extends Fe{isValidUrl(t){return function(t){const e=t.hostname.includes(".jiocinema."),i=t.pathname.includes("/watch")&&t.pathname.includes("/movies/"),n=t.pathname.includes("/sports/"),s=t.pathname.includes("/tv-shows/"),o=t.pathname.includes("/news/");return e&&(i||n||s||o)}(t)}isBrowsing(t){return t.hostname.includes(".jiocinema.")}getVideoId(t){return t.pathname.substring(1)}}([],["content_scripts/jio_cinema/jio_cinema_content_bundled.js"],"jiocinema",fe.JIO_CINEMA,!1,["browse_scripts/jio_cinema/jio_cinema_browse_bundled.js"]);Object.freeze(ni);const si=ni;const oi=new class extends Fe{isValidUrl(t){return function(t){return t.hostname.includes(".max.")&&t.pathname.includes("video/watch")}(t)}isBrowsing(t){return t.hostname.includes("play.max.")}getVideoId(t){if(t.pathname.includes("/watch/"))return t.pathname.split("/watch/")[1]}}([],["content_scripts/max/max_content_bundled.js"],"max",fe.MAX,!1,["browse_scripts/max/max_browse_bundled.js"]);Object.freeze(oi);const ri=oi;const ui=new class extends Fe{isValidUrl(t){return function(t){const e=t.hostname.includes("mubi."),i=t.pathname.includes("player");return e&&i}(t)}isBrowsing(t){return t.hostname.includes("mubi.")}getVideoId(t){return t.pathname.substring(1)}}([],["content_scripts/mubi/mubi_content_bundled.js"],"mubi",fe.MUBI,!1,["browse_scripts/mubi/mubi_browse_bundled.js"]);Object.freeze(ui);const ai=ui;const ci=new class extends Fe{isValidUrl(t){return function(t){return t.hostname.includes(".netflix.")&&t.pathname.includes("/watch")}(t)}isBrowsing(t){return t.hostname.includes(".netflix.")}getVideoId(t){const e=t.pathname.match(/^.*\/([0-9]+)\??.*/);return e&&e.length>0?e[1]:void 0}}([],["content_scripts/netflix/netflix_content_bundled.js"],"netflix",fe.NETFLIX,!1,["browse_scripts/netflix/netflix_browse_bundled.js"],!1);Object.freeze(ci);const hi=ci;const li=new class extends Fe{isBrowsing(t){return t.hostname.includes(".paramountplus.")}isValidUrl(t){return function(t){return t.hostname.includes(".paramountplus.")&&(t.pathname.includes("/video")||t.pathname.includes("/stream")||t.pathname.includes("/movie"))}(t)}getVideoId(t){return t.pathname}}([],["content_scripts/paramount/paramount_content_bundled.js"],"paramount",fe.PARAMOUNT,!1,["browse_scripts/paramount/paramount_browse_bundled.js"]);Object.freeze(li);const di=li;const Di=new class extends Fe{isBrowsing(t){return t.hostname.includes(".peacocktv.")}isValidUrl(t){return function(t){return t.hostname.includes(".peacocktv.")&&t.pathname.includes("/watch")&&t.pathname.includes("/playback")}(t)}getVideoId(t){const e=t.pathname.match(/([^/?]+\/[^/?]+)(?=\?|$)/);return e&&e.length>0?e[1]:void 0}}([],["content_scripts/peacock/peacock_content_bundled.js"],"peacock",fe.PEACOCK,!1,["browse_scripts/peacock/peacock_browse_bundled.js"]);Object.freeze(Di);const pi=Di;const vi=new class extends Fe{isBrowsing(t){return t.hostname.includes("pluto.tv")}isValidUrl(t){return function(t){return t.hostname.includes("pluto.tv")&&!t.pathname.includes("/details")&&!t.pathname.includes("/search")}(t)}getVideoId(t){return t.href.split("pluto.tv/").pop()}}([],["content_scripts/plutotv/plutotv_content_bundled.js"],"plutotv",fe.PLUTO_TV,!1,["browse_scripts/plutotv/plutotv_browse_bundled.js"]);Object.freeze(vi);const gi=vi;const fi=new class extends Fe{isValidUrl(t){return function(t){const e=t.hostname.includes("shahid.mbc.net"),i=t.pathname.includes(Zt.VIDEO_TYPES.SHOW),n=t.pathname.includes(Zt.VIDEO_TYPES.LIVE_TV);return e&&(i||n)}(t)}isBrowsing(t){return t.hostname.includes("shahid.mbc.net")}getVideoId(t){return t.pathname.substring(4)}}([],["content_scripts/shahid/shahid_content_bundled.js"],"shahid",fe.SHAHID,!1,["browse_scripts/shahid/shahid_browse_bundled.js"]);Object.freeze(fi);const mi=fi;const wi=new class extends Fe{isValidUrl(t){return function(t){const e=t.hostname.includes("watch.sling.com"),i=t.pathname.split("/");return e&&i.length>0&&"watch"===i[i.length-1]}(t)}isBrowsing(t){return t.hostname.includes(".sling.com")}getVideoId(t){const e=t.pathname.split("/");if(e.length>3)return e[3]}}([],["content_scripts/sling/sling_content_bundled.js"],"slingtv",fe.SLING,!1,["browse_scripts/sling/sling_browse_bundled.js"]);Object.freeze(wi);const Fi=wi;const yi=new class extends Fe{isValidUrl(t){return function(t){const e=t.hostname.includes("sonyliv.com"),i="true"===t.searchParams.get("watch");return e&&i}(t)}isBrowsing(t){return t.hostname.includes(".sonyliv.com")}getVideoId(t){let e=t.pathname.substring(1);return t.search&&(e+=t.search),e}}([],["content_scripts/sonyliv/sonyliv_content_bundled.js"],"sonyliv",fe.SONY_LIV,!1,["browse_scripts/sonyliv/sonyliv_browse_bundled.js"]);Object.freeze(yi);const Ci=yi;const bi=new class extends Fe{isValidUrl(t){return function(t){return t.hostname.includes("spotify.com")}(t)}isBrowsing(t){return t.hostname.includes(".spotify.com")}getVideoId(t){return t.pathname.substring(1)+t.search}}([],["content_scripts/spotify/spotify_content_bundled.js"],"spotify",fe.SPOTIFY,!1);Object.freeze(bi);const Ei=bi;const _i=new class extends Fe{isValidUrl(t){return function(t){const e=t.hostname.includes("play.stan.com.au"),i=t.pathname.split("/");return e&&4===i.length&&"play"===i[3]}(t)}isBrowsing(t){return t.hostname.includes(".stan.com.au")}getVideoId(t){return t.pathname.split("/")[2]}}([],["content_scripts/stan/stan_content_bundled.js"],"stan",fe.STAN,!1,["browse_scripts/stan/stan_browse_bundled.js"]);Object.freeze(_i);const xi=_i;const ki=new class extends Fe{isValidUrl(t){return function(t){return t.hostname.includes(".starplus.")&&t.pathname.includes("/video")}(t)}isBrowsing(t){return t.hostname.includes(".starplus.")}getVideoId(t){const e=t.pathname.match(/^.*\/([a-z\-0-9]+)\??.*/);return e&&e.length>0?e[1]:void 0}}([],["content_scripts/starplus/starplus_content_bundled.js"],"starplus",fe.STAR_PLUS,!1);Object.freeze(ki);const Ai=ki;const Bi=new class extends Fe{isBrowsing(t){return t.hostname.includes("tubitv.com")}isValidUrl(t){return function(t){const e=t.pathname.includes("live"),i=["tv-shows","movies"].some((e=>t.pathname.includes(e)))&&t.pathname.split("/").length>2;return t.hostname.includes("tubitv.com")&&(e||i)}(t)}getVideoId(t){return t.pathname}}([],["content_scripts/tubitv/tubitv_content_bundled.js"],"tubitv",fe.TUBI_TV,!1,["browse_scripts/tubitv/tubitv_browse_bundled.js"]);Object.freeze(Bi);const Ii=Bi;const Si=new class extends Fe{isValidUrl(t){return function(t){return t.hostname.includes(".unext.")&&(t.pathname.includes("/play")||t.pathname.includes("/live"))}(t)}isBrowsing(t){return t.hostname.includes(".unext.")}getVideoId(t){const e=t.pathname.split("/").filter(Boolean);return"play"===e[0]&&e.length>=3?`${e[1]}/${e[2]}`:"live"===e[0]&&e.length>=2?e[1]:void 0}}([],["content_scripts/unext/unext_content_bundled.js"],"unext",fe.UNEXT,!1,["browse_scripts/unext/unext_browse_bundled.js"]);Object.freeze(Si);const ji=Si;const Ti=new class extends Fe{isValidUrl(t){return function(t){const e=t.hostname.includes("viki.com"),i=t.pathname.includes("videos");return e&&i}(t)}isBrowsing(t){return t.hostname.includes(".viki.com")}getVideoId(t){const e=t.pathname.split("/");if(3===e.length&&"videos"===e[1])return e[2]}}([],["content_scripts/viki/viki_content_bundled.js"],"viki",fe.VIKI,!1,["browse_scripts/viki/viki_browse_bundled.js"]);Object.freeze(Ti);const Mi=Ti;const $i=new class extends Fe{isValidUrl(t){return function(t){const e=t.hostname.includes("viu.com"),i=t.pathname.includes(Kt.VIDEO_TYPES.VIDEO),n=t.pathname.includes(Kt.VIDEO_TYPES.LIVE);return e&&(i||n)}(t)}isBrowsing(t){return t.hostname.includes(".viu.")}getVideoId(t){var e,i,n;return`${null===(e=t.pathname.split("/"))||void 0===e?void 0:e[4]}/${null===(i=t.pathname.split("/"))||void 0===i?void 0:i[5]}/${null===(n=t.pathname.split("/"))||void 0===n?void 0:n[6]}${t.search}`}}([],["content_scripts/viu/viu_content_bundled.js"],"viu",fe.VIU,!1,["browse_scripts/viu/viu_browse_bundled.js"]);Object.freeze($i);const Vi=$i;const Pi=new class extends Fe{isValidUrl(t){return function(t){return t.hostname.includes(".willow.tv")&&t.pathname.split("/").length>=3}(t)}isBrowsing(t){return t.hostname.includes(".willow.tv")}getVideoId(t){return t.pathname.substring(1)}}([],["content_scripts/willow/willow_content_bundled.js"],"willow",fe.WILLOW,!1,["browse_scripts/willow/willow_browse_bundled.js"]);Object.freeze(Pi);const Li=Pi;const Oi=new class extends Fe{isBrowsing(t){return!(t.href.includes(".hotstar.")||t.href.includes(".fubo.")||t.href.includes("apps.disneyplus.")||!t.href.includes("watch?"))}isValidUrl(t){return function(t){return!(t.hostname.includes("tv.youtube.com")&&!t.pathname.includes("/watch"))&&t.hostname.includes(".youtube.")}(t)}getVideoId(t){if(t.href.includes("/watch")||t.href.includes("/shorts/")){const e=/(youtu.*be.*)\/(watch\?v=|embed\/|v|shorts|)(.*?((?=[&#?])|$))/gm.exec(t.href);return null!=e&&e.length>3&&e[3]?e[3]:void 0}return"browsing"}}([],["content_scripts/youtube/youtube_content_bundled.js"],"youtube",fe.YOUTUBE,!1,[],!1);Object.freeze(Oi);const Ri=Oi;const Ni=new class extends Fe{isValidUrl(t){return function(t){return t.hostname.includes(".zee5.")&&t.pathname.split("/").length>=5}(t)}isBrowsing(t){return t.hostname.includes(".zee5.")}getVideoId(t){return t.pathname.substring(1)}}([],["content_scripts/zee5/zee5_content_bundled.js"],"zee5",fe.ZEE5,!1,["browse_scripts/zee5/zee5_browse_bundled.js"]);Object.freeze(Ni);const Hi=[hi,ti,Le,Je,Ce,Ri,Ve,He,di,qe,pi,Ai,ri,Ye,Ie,gi,si,Ii,ai,xi,Me,Fi,Re,We,Mi,Ei,ii,Ci,ji,Li,Ni,Ge,je,mi,Vi],Ui=Object.fromEntries(Hi.map((t=>[t.name,t])));function Gi(t){return Ui[t]}class zi{constructor(t,e){this.isBrowsing=!1,this.needsCSPBlock=!1,this.id=e,this.videoId,this.url=t;const i=[Ie];for(const e of Hi){if(e.isValidUrl(this.url)){this.streamingService=e,this.serviceName=e.name,this.videoId=e.getVideoId(t),i.includes(e)&&(this.needsCSPBlock=!0);break}if(e.isBrowsing(this.url)){this.isBrowsing=!0,this.streamingService=e,this.serviceName=e.name,i.includes(e)&&(this.needsCSPBlock=!0);break}}}urlWithSessionId(t){return this.streamingService?this.streamingService.urlWithSessionId(t):void 0}}var Wi;!function(t){t.CREATE_SESSION="createSession",t.RE_INJECT="reInject",t.GET_INIT_DATA="getInitData",t.GET_INIT_USER_SETTINGS="getInitUserSettings",t.IS_CONTENT_SCRIPT_READY="isContentScriptReady",t.IS_VIDEO_READY="isVideoReady",t.CHANGE_FIREBASE_PASSWORD="changeFirebasePassword",t.SET_CHAT_VISIBLE="setChatVisible",t.SET_USER_REACTIONS_DISABLED="setUserReactionsDisabled",t.DISCONNECT="teardown",t.CLOSE_POPUP="closePopup",t.GET_SCHEDULED_EVENTS="getScheduledEvents",t.GET_RECENT_SCHEDULED_EVENTS="getRecentScheduledEvents",t.GOOGLE_SIGN_IN="googleSignIn",t.EMAIL_SIGN_IN="emailSignIn",t.FORGOT_PASSWORD="forgotPassword",t.EMAIL_SIGN_UP="emailSignUp",t.ON_GOOGLE_SIGN_IN="OnGoogleSignIn",t.CREATE_SCHEDULED_EVENT="createScheduledEvent",t.DELETE_SCHEDULED_EVENT="deleteScheduledEvent",t.SET_USER_STATUS="SET_USER_STATUS",t.SIGN_IN_CREATE="SIGN_IN_CREATE",t.REDIRECT_DATA_SET="redirectDataSet",t.LOAD_REDIRECT_URL_FINISHED="loadRedirectUrlFinished",t.RESET_PASSWORD="resetPassword"}(Wi||(Wi={}));class Qi extends N{constructor(t,e,i){super(t,e,i),this.type=i}}class Yi extends Qi{constructor(t,e,i){super(t,e,Wi.CREATE_SESSION),this.data=i}}var Zi,Ji=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class Ki extends H{constructor(t,e,i){super(t,e,U.VALIDATION),this.data=i}}!function(t){t.VIDEO_ID_VALID="video_id_valid",t.VIDEO_TYPE_NOT_NULL="video_type_not_null",t.LISTENERS_PRESENT="listeners_present",t.PERIODIC_VIDEO_STATE="periodic_video_state_matches_expected"}(Zi||(Zi={}));var qi=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class Xi{constructor(t){var e;this.Pi=this.Li.bind(this),this.Oi=t,console.log("Video Event Listener"),this.Pi(),null===(e=window.teleparty)||void 0===e||e.injectScriptLoaded}getCurrentStatus(){return qi(this,void 0,void 0,(function*(){return""}))}getStatusMetaData(){return qi(this,void 0,void 0,(function*(){}))}reloadNextEpisode(){var t;return qi(this,void 0,void 0,(function*(){yield null===(t=this.Ge)||void 0===t?void 0:t.reloadNextEpisode()}))}validateListenersPresent(){return null!==this.Oi.getVideoElement()}startListening(){var t;const e=this.validateListenersPresent(),i=null===(t=Gi(this.Oi.getStreamingServiceName()))||void 0===t?void 0:t.serverName;i&&R.C(new Ki(P,$,{videoService:i,validations:{[Zi.LISTENERS_PRESENT]:e}})),this.Ri()}stopListening(){this.Ni()}Ri(){const t=navigator;t.mediaSession.setActionHandler("play",(()=>qi(this,void 0,void 0,(function*(){this.Hi(),this.Oi.play(),console.log("Bluetooth device played the video")})))),t.mediaSession.setActionHandler("pause",(()=>qi(this,void 0,void 0,(function*(){this.Hi(),this.Oi.pause(),console.log("Bluetooth device paused the video")}))))}Li(){this.Ui(),this.Gi=setInterval(this.Ui.bind(this),2e3)}Ui(){return qi(this,void 0,void 0,(function*(){const t=JSON.parse(localStorage.getItem("nativeParty")||"{}");if(t.shouldStart&&t.expiry>Date.now()&&t.randomId!==this.zi){const e=yield function(t,e,i){return Ji(this,void 0,void 0,(function*(){const n=yield R.C(new Z(V,$,G.GET_TAB_ID)),s=new zi(new URL(window.location.href),n),o=new Yi(V,$,{createSettings:{controlLock:t,reactionsDisabled:i},streamingService:s.streamingService,tabId:s.id,isNative:e});return R.C(o)}))}(!1,!0,!1);if(e&&!e.error){this.zi=t.randomId;const e={name:"user_click",component:{name:`${this.Oi.getInternalStreamingServiceName()}_native_start_party`,type:"button",origin:"tp"}},i=new K(P,$,e);R.C(i)}}}))}Ni(){const t=navigator;t.mediaSession.setActionHandler("play",null),t.mediaSession.setActionHandler("pause",null)}Wi(){var t;null===(t=this.Ge)||void 0===t||t.tryBroadcast(!1)}Hi(){var t;null===(t=this.Ge)||void 0===t||t.tryBroadcast(!0)}Qi(){var t;null===(t=this.Ge)||void 0===t||t.setBuffering(!0)}Yi(t){var e;null===(e=this.Ge)||void 0===e||e.setWatchingAds(!0,t)}Zi(){var t,e;null===(t=this.Ge)||void 0===t||t.setWatchingAds(!1),null===(e=this.Ge)||void 0===e||e.forceSync()}Ji(){var t;null===(t=this.Ge)||void 0===t||t.setBuffering(!1)}Ki(t){var e;null===(e=this.Ge)||void 0===e||e.sendNextEpisodeAsync(t)}qi(t){var e;null===(e=this.Ge)||void 0===e||e.sendTeardown(t)}setMessageForwarder(t){this.Ge=t}shouldSync(){return!0}}var tn,en=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class nn extends Xi{constructor(t,e){var i,n;super(t),this.Xi=this.tn.bind(this),this.en=this.onSeeking.bind(this),this.nn=this.Qi.bind(this),this.sn=this.Ji.bind(this),this.rn=this.un.bind(this),this.an=this.cn.bind(this),this.ci=new xe("ext:ContentScripts:Amazon:AmazonVideoEventListener"),this.hn=()=>{var t;console.log("load start"),this.Oi.isPlayerPage()?(null===(t=this.Ge)||void 0===t?void 0:t.changingVideo)||(this.Ge&&(this.Ge.changingVideo=!0),this.Oi.Fi().then((t=>{var e;const i=t;i!=(null===(e=this.Ge)||void 0===e?void 0:e.videoId)&&null!=i?this.Ki(i):this.Ge&&(this.Ge.changingVideo=!1)})).catch((t=>{var e,i;this.ci.debug({methodName:"onVideoLoadStart",message:t}),this.Ge&&(this.Ge.changingVideo=!1),this.Oi.videoId!==(null===(e=this.Ge)||void 0===e?void 0:e.videoId)&&((null===(i=this.Ge)||void 0===i?void 0:i.changingVideo)?this.qi(Tt):this.qi(jt))}))):this.qi(It)},this.Oi=t,this.H=e,this.Oi.setVideoEventListener(this),this.ln=this.H.onVideoResize.bind(this.H),this.dn=this.Oi.episodeDataInteraction.bind(this.Oi),this.Dn=this.Oi.onNode.bind(this.Oi),(null===(i=window.teleparty)||void 0===i?void 0:i.injectScriptLoaded)||oe(chrome.runtime.getURL("content_scripts/amazon/amazon_injected_bundled.js")),(null===(n=window.teleparty)||void 0===n?void 0:n.replaceScriptLoaded)||(this.ci.debug({methodName:"constructor",message:"Injecting replace script"}),oe(chrome.runtime.getURL("lib/replace_state_script.js"))),this.initListeners(),this.pn=new MutationObserver(this.vn.bind(this))}initListeners(){window.addEventListener("message",this.dn,!1),window.addEventListener("FromNode",this.Dn,!1)}tn(){console.log("on update"),this.Wi()}vn(){if(!this.Oi.isPlayerPage())return this.qi(It),void this.stopListening()}gn(){return en(this,void 0,void 0,(function*(){yield this.Oi.play(),yield ie((()=>(this.Oi.waitUpdateState(),this.Oi.isWatchingAd()||this.Zi(),!this.Oi.isWatchingAd())),1/0)()}))}onSeeking(){var t;if(!(null===(t=this.Ge)||void 0===t?void 0:t.getOthersWatchingAds())){console.log("on seek");const t=this.Oi.getVideoElement();t&&t.readyState<4&&this.Qi(),this.Wi()}}isOthersWatchingAds(){var t,e;return null!==(e=null===(t=this.Ge)||void 0===t?void 0:t.getOthersWatchingAds())&&void 0!==e&&e}cn(){var t,e;console.log("on change",null===(t=this.Ge)||void 0===t?void 0:t.getOthersWatchingAds()),(null===(e=this.Ge)||void 0===e?void 0:e.getOthersWatchingAds())||this.Xi()}reloadListeners(){const t=this.Oi.getVideoElement();t&&(t.addEventListener("waiting",this.nn),t.addEventListener("canplay",this.sn),t.addEventListener("play",this.an),t.addEventListener("pause",this.an),t.addEventListener("seeking",this.en),t.addEventListener("loadstart",this.hn))}startListening(){super.startListening();const t=this.Oi.getVideoElement();t&&t.addEventListener("loadstart",this.hn);const e=()=>en(this,void 0,void 0,(function*(){var t;try{const e=this.mn;if(this.mn=yield this.Oi.waitUpdateState(),(null===(t=this.Ge)||void 0===t?void 0:t.isWatchingAds())===this.mn.adPlaying&&void 0!==e||(console.log("Update watching ads"),this.mn.adPlaying?this.Yi():this.Zi()),e){const t=Math.abs(e.currentTime-this.mn.currentTime);(e.state!=this.mn.state||t>2500)&&this.Hi()}this.mn.state==(null==e?void 0:e.state)||0!==this.mn.state&&0!==(null==e?void 0:e.state)||(0===this.mn.state?this.Qi():this.Ji())}catch(t){}this.wn=setTimeout(e,250)}));e();const i=document.querySelector(".dv-player-fullscreen");this.pn.disconnect(),i&&this.pn.observe(i,{attributes:!0}),window.addEventListener("resize",this.ln),window.document.addEventListener("webkitfullscreenchange",this.ln),window.document.addEventListener("MSFullScreenChange",this.ln),jQuery(".atvwebplayersdk-fullscreen-button").on("click",this.ln),window.addEventListener("message",this.rn,!1)}stopListening(){super.stopListening(),this.Fn&&clearInterval(this.Fn),this.wn&&clearInterval(this.wn),this.pn.disconnect(),window.removeEventListener("resize",this.ln),window.document.removeEventListener("webkitfullscreenchange",this.ln),window.document.removeEventListener("MSFullScreenChange",this.ln),window.removeEventListener("message",this.dn,!1),window.removeEventListener("message",this.rn,!1)}un(t){t.source==window&&("FROM_PAGE_POP"!==t.data.type||this.Oi.isPlayerPage()||this.qi(It))}loadNewVideoAsync(t){return en(this,void 0,void 0,(function*(){yield this.Oi.skipPromo(),yield new Promise(((e,i)=>{const n=performance.now(),s=setInterval((()=>{if(this.Oi.videoId===t){const t=this.Oi.getVideoElement();t instanceof Element&&t.src&&(clearInterval(s),e())}else this.Oi.checkUpdateId(t),this.Oi.skipPromo();performance.now()-n>=2e4&&(clearInterval(s),i(new Error("Could not load new video in time.")))}),200)})),yield ie(this.Oi.isVideoReady.bind(this.Oi),1/0)(),yield ie(this.Oi.isTimeTextLoaded.bind(this.Oi),1/0)()}))}}class sn extends H{constructor(t,e,i){super(t,e,U.GET_SESSION_DATA),this.data=i}}class on{constructor(){this.yn=this.Cn.bind(this),this.bn=[],this.En()}addMessageListener(t){this.bn.push(t)}removeMessageListener(t){this.bn=this.bn.filter((t=>{}))}En(){R.addListener(this.yn)}teardown(){this.bn=[],R.removeListener(this.yn)}Cn(t,e,i){if(!this._n(t))return!1;return!!this.xn(t,e,i)||(i({}),!1)}_n(t){return t.target===P}xn(t,e,i){let n=!1;return this.bn.forEach((s=>{s.onMessage(t,e,i)&&(n=!0)})),n}}!function(t){t.INIT_CHAT="initChat",t.ON_MESSAGE="onMessage",t.ON_BUFFER="onBuffer",t.ON_TYPING="onTyping",t.ON_WATCHING_ADS="onWatchingAds",t.UPDATE_SETTINGS="updateSettings",t.ON_REACTION="onReaction",t.ON_GIF="onGif",t.ON_LOG_EVENT="onLogEvent",t.USER_LIST="userList",t.ON_WEB_RTC="onWebRTC"}(tn||(tn={}));var rn,un=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class an{constructor(t,i){this.H=t,this.De=i,e("Chat forwarder")}onMessage(t,e,i){var n,s,o,r,u;switch(t.type){case G.LOAD_SESSION:{const e=t;return this.kn(e.data),!1}case tn.ON_MESSAGE:{const e=t;return this.P(e),this.De.onChatMessage(),!1}case tn.ON_BUFFER:{const e=t;return this.An(e),!1}case tn.ON_TYPING:{const e=t;return this.Bn(e),!1}case tn.ON_WATCHING_ADS:{const e=t;return this.In(e),!1}case tn.UPDATE_SETTINGS:{const e=t;return this.Sn(e),!1}case tn.ON_REACTION:{const e=t;return this.jn(e),!1}case tn.ON_GIF:{const e=t;return this.Tn(e),!1}case tn.USER_LIST:{const e=t;return this.Mn(e),!1}case tn.ON_WEB_RTC:return this.H.onWebRTC(t.data),i(),!0;case Wi.SET_CHAT_VISIBLE:{const e=t;return this.$n(e.data),i(),!1}case Wi.SET_USER_REACTIONS_DISABLED:{const e=t;return this.H.setUserReactionsDisabledStatus(e.data.disabled),i(),!1}case vt.SIDEBAR_MESSAGING_READY:{console.log("Sidebar Ready");const t=null===(n=window.teleparty)||void 0===n?void 0:n.tabId;return console.log(t),this.H.setChatFrameReady(null!=t?t:0),i(),!0}case vt.DISPLAY_MODAL:{const e=t.data;return console.log(e),!0}case vt.SHARE_SHEET:{const e=t.data;return navigator.share({url:e.url,title:null==e?void 0:e.name,text:null==e?void 0:e.title}),i(),!0}case vt.TRACK_DATA:{const e=t.data;return window.postMessage({type:"TP_GTM_EVENT",payload:Object.assign({},e)},"*"),i(),!0}case vt.ON_UPDATE_SETTINGS:{const e=t.data;return this.H.doUpdateSettings(e),i(),!0}case vt.ON_CHROME_STORAGE_UPDATE:try{chrome.storage.local.set(t.data)}catch(t){console.log("Failed to update chrome storage")}return i(),!0;case vt.SET_REACTIONS_ACTIVE:{const e=t.data;return this.H.setReactionsActive(e),i(),!0}case vt.RESET_VIEW:return this.H.resetChatWindow(!0),i(),!0;case vt.ON_FOCUS:return this.H.onSidebarFocus(),i(),!0;case vt.PREVIEW_REACTION:{const e=t.data;return this.H.showReaction(e),i(),!0}case vt.RESET_CHAT_WINDOW:return this.H.setChatVisible(!1),this.H.removeChat(),this.H.reloadChat(),this.H.setChatVisible(!0),i(),!0;case"onUpdateSettings":{const e=t.data;return this.H.doUpdateSettings(e),i(),!0}case vt.RECEIVED_MESSAGE:return this.H.shouldChatBeVisible()||!1!==(null===(o=null===(s=t.data)||void 0===s?void 0:s.originalMessage)||void 0===o?void 0:o.isSystemMessage)&&!(null===(u=null===(r=t.data)||void 0===r?void 0:r.originalMessage)||void 0===u?void 0:u.gifObject)||(this.H.incrementUnreadMessagesCount(),i()),!0;default:return!1}}teardown(){this.H.teardown()}$n(t){return un(this,void 0,void 0,(function*(){const e=this.H.getSessionId();if(e){const t=yield ot.getItemsAsync(["REDIRECT_URL"]);t.REDIRECT_URL&&t.REDIRECT_URL[e]&&this.H.setPartyUrl(t.REDIRECT_URL[e])}this.H.isPartyWindowsActive()?t.visible?yield this.H.resetChatWindow():yield this.H.hideChatWindow():(yield this.H.setChatVisible(t.visible),this.H.fixPageControls())}))}kn(t){const e=t.sessionCallbackData.sessionId,i=`${r}/join/${e}`;if(this.H.loadInitData(t),this.H.setPartyUrl(i),this.H.setSessionId(e),this.H.setSessionReactionDisabledStatus("true"===t.sessionCallbackData.reactionsDisabled),this.H.$e(t.storageData),this.De.onInitChat(),this.H.setSessionCreated(t.isCreate),this.H.sendInitDataToSidebar(t),t.sessionCallbackData.userList&&this.H.loadUserList(t.sessionCallbackData.userList),t.showReviewMessage&&this.H.addReviewMessage(),!t.isCreate)for(const e of t.sessionCallbackData.messages)"gifObject"in e?this.H.addGif(e):this.H.addMessage(e,!0)}P(t){this.H.addMessage(t.data)}jn(t){this.H.showReaction(t.data)}Tn(t){this.H.addGif(t.data)}An(t){this.H.onBufferingMessage(t.data)}Bn(t){this.H.onTypingMessage(t.data)}In(t){this.H.onWatchingAdsMessage(t.data)}Sn(t){this.H.onUpdateSettingsMessage(t.data)}Mn(t){this.H.loadUserList(t.data.userList),this.H.setSocketConnectionId(t.data.socketConnectionId)}}!function(t){t.UPDATE_SESSION="updateSession",t.NEXT_EPISODE="nextEpisode",t.REBOOT_SESSION="rebootSession",t.GET_SERVER_TIME="getServerTime",t.RELOAD_PARTY="reloadParty"}(rn||(rn={}));class cn extends H{constructor(t,e,i){super(t,e,U.BROADCAST),this.data=i}}class hn extends N{constructor(t,e,i){super(t,e,i),this.type=i}}class ln extends hn{constructor(t,e){super(t,e,rn.GET_SERVER_TIME)}}class dn extends H{constructor(t,e,i){super(t,e,U.BROADCAST_NEXT_EPISODE),this.data=i}}class Dn extends H{constructor(t,e,i){super(t,e,U.SET_BUFFERING),this.data=i}}class pn extends H{constructor(t,e,i){super(t,e,U.SET_WATCHING_ADS),this.data=i}}const vn="PING",gn="SYNC",fn="PERIODIC_VALIDATION",mn="BROADCAST";class wn extends Z{constructor(t,e,i){super(t,e,G.STAY_ALIVE),this.data=i}}var Fn=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};const yn=new class{getRedirectDataForTabAsync(t){return Fn(this,void 0,void 0,(function*(){const e=(yield ot.getItemsAsync([v])).redirectDataMap,i=this.Vn(t);if(e&&e[i]){const t=e[i];if(this.Pn(t))return t}}))}deleteRedirectDataForTabAsync(t){return Fn(this,void 0,void 0,(function*(){const e=(yield ot.getItemsAsync([v])).redirectDataMap,i=this.Vn(t);e&&e[i]&&delete e[i],yield j.setItemsAsync({[v]:e})}))}Vn(t){return t}storeRedirectDataForTabAsync(t,e){return Fn(this,void 0,void 0,(function*(){console.log("store data for tab "+t);const i=this.Vn(e);let n=yield ot.getItemsAsync([v]);n[i]=t,n=this.Ln(n),yield j.setItemsAsync({[v]:n})}))}Ln(t){return function(t,e){const i={};let n;for(n in t)t.hasOwnProperty(n)&&e(t[n])&&(i[n]=t[n]);return i}(t,this.Pn)}Pn(t){const e=t.date;return void 0!==e&&"number"==typeof e&&e<=Date.now()&&Date.now()-e<108e5}};Object.freeze(yn);const Cn=yn;var bn;!function(t){t.EPISODE="episode",t.FEATURE="feature",t.LIVE="live",t.EXTRA="extra",t.EVENT="event",t.OTHER="other"}(bn||(bn={}));var En=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class _n{constructor(t,i,n){this.On=[],this.Rn=0,this.Nn=0,this.Hn=[],this.Un=!1,this.Rt=!1,this.ui=!1,this.Gn=!1,this.zn=!1,this.Wn=void 0,this.Qn=()=>En(this,void 0,void 0,(function*(){try{yield fetch("https://www3.doubleclick.net",{method:"HEAD",mode:"no-cors",cache:"no-store"}),this.Wn=!1}catch(t){this.Wn=!0}})),this.Yn=(t=!1,e=!1)=>En(this,void 0,void 0,(function*(){if(this.Zn)return;if(this.ui)return void this.forceSync();if(!this.zn&&!e)return;const i=yield this.Jn();if(yield this.Kn(i.data,e))yield this.qn(i);else if(t){if(yield this.Xn(e)){const t=yield this.Jn();yield this.qn(t)}}})),this.ts=()=>En(this,void 0,void 0,(function*(){if(this.es==ve.PAUSED&&this.ns&&(clearInterval(this.ns),this.ns=setInterval((()=>{this.ss()}),6e4)),this.os())return;if(yield this.Oi.waitVideoDoneLoadingAsync(),this.os())return;const t=yield this.Oi.getStateAsync();yield this.rs(t),yield this.us(t),!1===this.zn&&(this.zn=!0)})),this.Oi=t,this.H=i,this.mi=n,this.mi.setMessageForwarder(this),this.cs=0,this.Zn=!1,this.es=ve.PAUSED,this.hs=0,this.ls=0,this.ds=0,this.Ds=this.Oi.getStreamingServiceName(),e("Video forwarder"),this.Qn()}onMessage(t,e,i){switch(t.type){case G.GET_VIDEO_DATA:return this.ps(i),!0;case G.LOAD_SESSION:{const e=t;return this.vs(e.data),!1}case rn.UPDATE_SESSION:{const e=t;return this.gs(e.data),!1}case rn.NEXT_EPISODE:{const e=t;return this.fs(e.data),!1}case rn.REBOOT_SESSION:{const e=t;return this.ws(e.data,i),!0}case rn.RELOAD_PARTY:return this.reloadNextEpisode().then((()=>console.log("Party Reloaded"))),!0;case tn.ON_WATCHING_ADS:{const e=t;return this.In(e),!1}case vt.GO_NEXT_EPISODE:return this.Oi.triggerNextEpisodeClick(),!0;default:return!1}}In(t){t.data.anyoneWatchingAds&&!this.Rt&&(it.pushTask(this.Oi.doAdCheck.bind(this.Oi),"doAdCheck"),this.forceSync()),this.Rt=t.data.anyoneWatchingAds}Fs(){var t;return En(this,void 0,void 0,(function*(){const e=yield this.Oi.getVideoDataAsync(),i=yield this.Oi.getStateAsync(),n=i.playbackState.toString()===this.es.toString()&&Math.abs(i.playbackPositionMilliseconds-this.ys())<2500&&this.fi===e.videoId||i.playbackState!==pe.PLAYING&&i.playbackState!==pe.PAUSED||this.Zn,s=null===(t=Gi(this.Oi.getStreamingServiceName()))||void 0===t?void 0:t.serverName;s&&R.C(new Ki(P,$,{videoService:s,validations:{[Zi.PERIODIC_VIDEO_STATE]:n}}))}))}getOthersWatchingAds(){return this.Rt}get videoId(){return this.fi}set videoId(t){this.fi=t}sendTeardown(t){const e=new J(P,$,t);R.C(e)}teardown(){this.Zt&&this.Oi.pause(),this.Zt=void 0,this.Cs&&clearInterval(this.Cs),this.ns&&clearInterval(this.ns),it.disable(),this.mi.stopListening()}isInParty(){return null!=this.Zt}ws(t,e){it.resetTasks(),this.fi==t.videoId&&this.gs(t),e(this.fi==t.videoId);const i=new K(P,$,{eventType:"reboot",sessionId:this.Zt});R.C(i)}tryBroadcast(t=!1){this.Un||(this.ui?this.forceSync():0!=this.Oi.uiEventsHappening||this.Zn||!this.Zt||it.hasTaskInQueue(mn)||it.pushTask((()=>this.Yn(t)),mn))}setBuffering(t){if(this.Zt){const e=new Dn(P,$,{buffering:t});R.C(e)}}isWatchingAds(){return this.Un}setWatchingAds(t,e){if(this.Zt){this.Un=t;const i=new pn(P,$,{watchingAds:t,adDurationLeft:e});R.C(i)}}sendNextEpisodeAsync(t){return En(this,void 0,void 0,(function*(){if(this.Zt&&t!==this.fi&&t!==this.bs){this.bs=t,this.Zn=!0;const e=new dn(P,$,{nextEpisode:t}),i=yield R.C(e);i&&"Locked Session"===i.errorMessage&&(yield this.Es(t))}}))}Es(t){return En(this,void 0,void 0,(function*(){try{yield ie((()=>t==this.fi),1e4)(),this.Zn=!1}catch(t){this.be("An error has occured when trying to wait till the episode changed videos");const e={showAlert:!0,alertModal:Et};this.sendTeardown(e)}}))}Kn(t,e){return En(this,void 0,void 0,(function*(){if(null==t.lastKnownTime||null==t.lastKnownTimeUpdatedAt||null==t.state)return!1;if(e&&t.state===ve.PAUSED&&t.lastKnownTime<yt)return!1;const i=Math.abs(t.lastKnownTime-this.ys());if(t.state==this.es&&i<yt)return!1;if(i>=yt){const t=new K(P,$,{name:"video_seek",action:{source:"self"}});R.C(t),this.Ds==fe.AMAZON||this.Ds==fe.PARAMOUNT?yield ee(200)():this.Ds==fe.HBO_MAX&&(yield ee(500)())}return!0}))}Jn(){return En(this,void 0,void 0,(function*(){const t=yield this.Oi.getUpdateSessionDataAsync();t.lastKnownTimeUpdatedAt-=this.Nn,t.lastKnownTime=Math.round(t.lastKnownTime);return new cn(P,$,t)}))}forceSync(){it.pushTask(this.ts,gn)}fs(t){return En(this,void 0,void 0,(function*(){this.cs=Date.now(),it.pushTask((()=>this._s(t)),"onNextEpisodeAsync")}))}_s(t){return En(this,void 0,void 0,(function*(){try{e("Continue next episode called"),this.Zn=!0,yield this.Oi.jumpToNextEpisode(t),yield this.mi.loadNewVideoAsync(t.videoId),e("After load new video"),this.mi.reloadListeners(),yield this.Oi.waitVideoDoneLoadingAsync(),this.ds<this.cs&&(this.es=ve.PAUSED,this.hs=0,this.ls=Date.now(),e("Sending broadcast after next episode"),it.pushTask((()=>this.Yn(!0,!0)),mn),it.removeTask(gn)),this.fi=t.videoId,this.Zn=!1;const i=new K(P,$,{name:"video_start",action:{description:"video session has begun"}});R.C(i)}catch(t){this.be("Error loading new video."),console.log("Error was",t),yield this.reloadNextEpisode()}}))}persistExtension(t){var e,i;return En(this,void 0,void 0,(function*(){console.log("persist here");const n=null!==(i=null===(e=window.teleparty)||void 0===e?void 0:e.tabId)&&void 0!==i?i:0,s=new wn(P,$,{tabId:n,persist:t});R.C(s);const o=yield this.xs();o.date=Date.now(),Cn.storeRedirectDataForTabAsync(o,n)}))}reloadNextEpisode(){var t,e;return En(this,void 0,void 0,(function*(){try{console.log("Reloading party");const i=yield this.xs();i.date=Date.now();const n=this.ks(i),s=null!==(e=null===(t=window.teleparty)||void 0===t?void 0:t.tabId)&&void 0!==e?e:0,o=new wn(P,$,{tabId:s,persist:!1});yield R.C(o),yield Cn.storeRedirectDataForTabAsync(i,s),console.log("Redirect URL is",n),window.location.href=n}catch(t){console.log("Error reloading party",t),this.be("Failed to fix next episode.");const e=new J(P,$,{showAlert:!0,alertModal:xt});R.C(e)}}))}xs(){return En(this,void 0,void 0,(function*(){return new Promise(((t,e)=>{const i=new XMLHttpRequest;i.timeout=1e4,i.ontimeout=()=>{e(new Error)},i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE)try{const e=JSON.parse(i.responseText);t(e)}catch(t){e(t),this.be("Unable to get video endpoint data to reload session")}},i.open("GET",`${o}/video?session=`+this.Zt,!0),i.send(null)}))}))}ks(t){if("object"==typeof(e=t)&&null!==e&&"videoService"in e&&"videoId"in e){switch(t.videoService.toLowerCase()){case"crunchyroll":return`https://www.crunchyroll.com/watch/${t.videoId}`;case"netflix":return`https://www.netflix.com/watch/${t.videoId}`;case"hulu":return`https://www.hulu.com/watch/${t.videoId}`;case"disney":return`https://www.disneyplus.com/${"other"===t.videoType?"video":"play"}/${t.videoId}`;case"starplus":return`https://www.starplus.com/video/${t.videoId}`;case"amazon":{const e=t.serviceDomain;if(e)return`https://${e}/gp/video/detail/${t.videoId}?autoplay=0`;throw new Error("No service Domain")}case"hbomax":return`https://play.hbomax.com/video/watch/${t.videoId}`;case"youtube":{const e=t.videoId,i=t.serviceDomain;if(i)return e&&"browsing"!==e?`https://${i}/watch/${e}`:`https://${i}/`;throw new Error("No service Domain")}case"espn":return`https://www.espn.com/watch/player/_/id/${t.videoId}`;case"paramount":return`https://www.paramountplus.com${t.videoId}`;case"hotstar":return`https://www.hotstar.com/${t.videoId}/watch`;case"disneymena":return`https://apps.disneyplus.com/${t.videoId}/watch`;case"max":return`https://play.max.com/video/watch/${t.videoId}`;case"plutotv":return`https://www.pluto.tv/${t.videoId}`;case"jiocinema":return`https://www.jiocinema.com/${t.videoId}`;case"tubitv":return`https://tubitv.com${t.videoId}`;case"funimation":return`https://www.funimation.com/v/${t.videoId}`;case"crave":return`https://www.crave.ca/${t.videoId}`;case"mubi":return`https://mubi.com/${t.videoId}`;case"stan":return`https://play.stan.com.au/programs/${t.videoId}/play`;case"slingtv":return`https://watch.sling.com/1/asset/${t.videoId}/watch`;case"fubo":return`https://www.fubo.tv/p/watch?${t.videoId}`;case"viki":return`https://www.viki.com/videos/${t.videoId}`;case"spotify":return`https://open.spotify.com/${t.videoId}`;case"zee5":return`https://www.zee5.com/${t.videoId}`;case"sonyliv":return`https://www.sonyliv.com/${t.videoId}`;case"unext":return`https://video.unext.jp/${t.videoType===bn.LIVE?"live":"play"}/${t.videoId}`;case"hulujp":return`https://www.hulu.jp/watch/${t.videoId}`;case"canalplus":return`https://${t.serviceDomain||"www.canalplus.com"}/${t.videoId}`;case"willow":return`https://www.willow.tv/${t.videoId}`;case"fancode":return`https://www.fancode.com/${t.videoId}`;case"shahid":return`https://shahid.mbc.net/${t.videoId}`;case"viu":return`https://www.viu.com/${t.videoId}`;default:throw new Error}}var e;throw new Error("Invalid Session Response")}gs(t){this.ds=Date.now(),it.pushTask(this.As(t).bind(this),"Update Session Data")}As(t){if(t.state===ve.PAUSED&&this.es===ve.PLAYING){this.ss();const t=new K(P,$,{name:"video_pause",action:{description:"video was played from pause",reason:"Video was played"}});R.C(t)}else if(t.state===ve.PLAYING&&this.es===ve.PAUSED){const t=new K(P,$,{name:"video_resume",action:{description:"video was played from pause",reason:"Video was played"}});R.C(t),this.ss()}return this.es=t.state,this.hs=t.lastKnownTime,this.ls=t.lastKnownTimeUpdatedAt,this.ts}ps(t){return En(this,void 0,void 0,(function*(){try{const e=yield this.Oi.getVideoDataAsync(),i=yield this.Oi.getStateAsync();e.is_player_fullscreen=null!=document.fullscreenElement||document.webkitIsFullScreen,e.is_chat_visible=this.H.getChatVisible(),e.is_adblock_enabled=this.Wn,e.video_ts_ms=Math.round(i.playbackPositionMilliseconds),e.party_ts_ms=this.hs,t(e)}catch(e){console.error(e),t({error:e})}}))}be(t){const e=new K(P,$,{name:"video_error",action:{description:t,reason:"An errors has occurred during video playback"}});R.C(e)}Xn(t){return En(this,void 0,void 0,(function*(){return new Promise((e=>{const i=performance.now(),n=()=>En(this,void 0,void 0,(function*(){if(performance.now()-i>=2500)e(!1);else{const i=yield this.Jn();(yield this.Kn(i.data,t))?e(!0):setTimeout((()=>{n()}),50)}}));n()}))}))}qn(t){return En(this,void 0,void 0,(function*(){if(this.Zn||this.Un)return;const e=this.es;if(t.data.bufferingState){t.data.state=ve.PAUSED,yield R.C(t,1e3),yield this.Oi.waitVideoDoneLoadingAsync();const i=yield this.Jn();i.data.bufferingState=!0,e==ve.PLAYING&&(i.data.state=ve.PLAYING),yield R.C(i,1e3)}else yield R.C(t,1e3)}))}vs(t){return En(this,void 0,void 0,(function*(){const e=t.sessionCallbackData;this.Zt=e.sessionId,this.es=e.state,this.hs=Number(e.lastKnownTime),this.ls=Number(e.lastKnownTimeUpdatedAt),this.fi=e.videoId,this.Rt=!1,"true"==e.controlLock&&(this.ui=!0),"true"==e.reactionsDisabled&&(this.Gn=!0),t.isCreate?(this.zn=!0,it.pushTask(this.Yn.bind(this),mn)):this.forceSync();const i=new K(P,$,{name:"video_start",action:{description:"video session has begun"}});R.C(i),this.mi.startListening(),this.Bs()}))}Is(){return new Promise((t=>{const i=new ln(P,$),n=Date.now();R.C(i).then((t=>{const e=Date.now();if(t){const i=t.serverTime;i&&(ne(this.On,e-n,5),this.Rn=se(this.On),ne(this.Hn,e-Math.round(this.Rn/2)-i,5),this.Nn=se(this.Hn))}})).catch((t=>{e(t),this.be(t)})),t()}))}ss(){const t=new K(P,$,{name:"video_heartbeat",action:{description:"new heartbeat",reason:"Heartbeat session was due"}});R.C(t)}Bs(){this.Cs&&clearInterval(this.Cs),this.ns&&clearInterval(this.ns),this.Cs=setInterval((()=>{it.hasTaskInQueue(gn)||it.pushTask(this.ts,gn)}),5e3),this.ns=setInterval((()=>{this.ss()}),6e4),this.Ss=setInterval((()=>{it.hasTaskInQueue(vn)||it.pushTask(this.Is.bind(this),vn)}),12500),this.js=setInterval((()=>{it.hasTaskInQueue(fn)||it.pushTask(this.Fs.bind(this),fn)}),3e5),this.Is()}os(){return!this.Zt||this.Oi.uiEventsHappening>0||this.Un||this.Zn||!this.mi.shouldSync()}rs(t){return En(this,void 0,void 0,(function*(){const e=this.ys();if(Math.abs(e-t.playbackPositionMilliseconds)>2500){yield this.Oi.setCurrentTime(e),yield this.Oi.play();const t=new K(P,$,{name:"video_seek",action:{source:"another user"}});R.C(t)}}))}us(t){return En(this,void 0,void 0,(function*(){t.playbackState.toString()!==this.es.toString()&&(this.es===ve.PAUSED?yield this.Oi.pause():this.es===ve.PLAYING&&(yield this.Oi.play()))}))}Ts(){return this.es===ve.PLAYING?Date.now()-(this.ls+this.Nn):0}ys(){return this.hs+this.Ts()}get changingVideo(){return this.Zn}set changingVideo(t){this.Zn=t}}i(7588);class xn extends Z{constructor(t,e,i){super(t,e,G.POSTHOG_HAS_FEATURE),this.data={featureName:i}}}var kn=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};function An(t,e,i="",n=!0,s="after"){if(n){const e=document.getElementById(t);e&&e.remove()}if(e){const n=document.createElement("div");return n.id=t,i&&(n.style.cssText=i),"before"===s&&e.firstChild?e.insertBefore(n,e.firstChild):e.appendChild(n),n}return null}function Bn(t){const e=`img/reactions/${encodeURIComponent(t)}`;return{staticSrc:chrome.runtime.getURL(`${e}/${encodeURIComponent(t)}_static.svg`),gifSrc:chrome.runtime.getURL(`${e}/${encodeURIComponent(t)}.gif`)}}function In(t){return kn(this,void 0,void 0,(function*(){R.C(new K(P,$,{name:t},z.POSTHOG))}))}function Sn(t,e,i,n){const s=e?`id="${e}" `:"",o=i?`style="${i}" `:"",r=t.indexOf(">")+1;return`${t.slice(0,r).replace(/<svg /,`<svg ${s}${o}`)}${n?`<title>${n}</title>`:""}${t.slice(r)}`}function jn(t,e){return Sn('\n        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <g clip-path="url(#clip0_1785_27366)">\n            <path d="M9.99999 0C4.47718 0 0 4.47719 0 10C0 15.5231 4.47718 20 9.99999 20C15.5231 20 20.0003 15.5231 20.0003 10C20.0003 4.47719 15.5231 0 9.99999 0ZM9.99999 18.7697C5.1753 18.7697 1.25 14.8247 1.25 9.99996C1.25 5.17527 5.1753 1.24996 9.99999 1.24996C14.8247 1.24996 18.7503 5.17529 18.7503 9.99996C18.7503 14.8246 14.8247 18.7697 9.99999 18.7697ZM9.08092 15.6344H10.6534V14.0475H9.08092V15.6344ZM9.98155 4.36592C9.06592 4.36592 8.31157 4.61279 7.71907 5.10594C7.12657 5.59936 6.83845 6.58748 6.85314 7.40623L6.87626 7.45186H8.31063C8.31063 6.96342 8.47344 6.26154 8.79907 6.00967C9.12438 5.75811 9.51876 5.63217 9.98188 5.63217C10.5156 5.63217 10.9259 5.77717 11.2138 6.06715C11.5013 6.35715 11.6447 6.77184 11.6447 7.31059C11.6447 7.7634 11.5384 8.14996 11.325 8.47027C11.1109 8.79059 10.7522 9.24842 10.2491 9.84375C9.73001 10.3119 9.40938 10.6881 9.28751 10.9728C9.16532 11.2578 9.10188 11.769 9.09719 12.5062H10.6003C10.6003 12.0437 10.6297 11.7028 10.6881 11.484C10.7462 11.2656 10.9128 11.0187 11.1875 10.744C11.7778 10.1747 12.2519 9.61779 12.6109 9.07312C12.9691 8.52904 13.1484 7.92873 13.1484 7.27248C13.1484 6.35686 12.8716 5.64342 12.3169 5.13248C11.7619 4.62123 10.9834 4.36592 9.98155 4.36592Z" fill="#4B4D4D"/>\n            </g>\n            <defs>\n            <clipPath id="clip0_1785_27366">\n            <rect width="20" height="20" fill="white"/>\n            </clipPath>\n            </defs>\n        </svg>\n    ',t,e)}function Tn(t,e){return Sn('\n            <svg width="32" height="32" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M7 7L17 17M7 17L17 7" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>\n            </svg>\n        ',t,e)}function Mn(t,e,i){return Sn('\n        <svg class="chat-option" width="42" height="42" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M17.5 22.75L21 19.25M21 19.25L24.5 15.75M21 19.25L17.5 15.75M21 19.25L24.5 22.75M12.467 32.7268L9.8 34.8617C8.34225 36.0255 7.61425 36.6083 7.00175 36.61C6.73843 36.6102 6.47846 36.551 6.24121 36.4368C6.00396 36.3225 5.79555 36.1562 5.6315 35.9502C5.25 35.4725 5.25 34.5397 5.25 32.6742V12.6018C5.25 10.6418 5.25 9.66 5.6315 8.90925C5.9675 8.25125 6.50125 7.7175 7.161 7.3815C7.91 7 8.89 7 10.85 7H31.15C33.11 7 34.09 7 34.8372 7.3815C35.497 7.7175 36.0325 8.25125 36.3685 8.911C36.75 9.65825 36.75 10.6382 36.75 12.5948V25.907C36.75 27.8617 36.75 28.84 36.3685 29.589C36.0329 30.2475 35.4975 30.7829 34.839 31.1185C34.0918 31.5 33.1117 31.5 31.1552 31.5H15.9653C15.2355 31.5 14.8733 31.5 14.525 31.57C14.2159 31.6339 13.9169 31.7393 13.636 31.8832C13.321 32.0425 13.041 32.2683 12.4863 32.7128L12.467 32.7268Z" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n        ',t,e,i)}function $n(t,e,i){return Sn('\n        <svg class="chat-option" width="42" height="42" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M26.25 15.75L19.25 22.75L15.75 19.25M12.467 32.7268L9.8 34.8617C8.34225 36.0255 7.61425 36.6083 7.00175 36.61C6.73843 36.6102 6.47846 36.551 6.24121 36.4368C6.00396 36.3225 5.79555 36.1562 5.6315 35.9502C5.25 35.4725 5.25 34.5397 5.25 32.6742V12.6018C5.25 10.6418 5.25 9.66 5.6315 8.90925C5.9675 8.25125 6.50125 7.7175 7.161 7.3815C7.91 7 8.89 7 10.85 7H31.15C33.11 7 34.09 7 34.839 7.3815C35.4975 7.71705 36.0329 8.25246 36.3685 8.911C36.75 9.65825 36.75 10.6382 36.75 12.5948V25.907C36.75 27.8617 36.75 28.84 36.3685 29.589C36.0329 30.2475 35.4975 30.7829 34.839 31.1185C34.0918 31.5 33.1135 31.5 31.157 31.5H15.9653C15.2373 31.5 14.8715 31.5 14.5232 31.57C14.2147 31.634 13.9163 31.7394 13.636 31.8832C13.321 32.0442 13.0375 32.27 12.4722 32.7232L12.467 32.7268Z" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n        ',t,e,i)}function Vn(t,e,i){return Sn('<svg class="chat-option" id="tp-allchat-show-create-post" width="42" height="42" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">\n                <path d="M21 24.5V19.25M21 19.25V14M21 19.25H15.75M21 19.25H26.25M12.467 32.7268L9.8 34.8617C8.34225 36.0255 7.61425 36.6083 7.00175 36.61C6.73843 36.6102 6.47846 36.551 6.24121 36.4368C6.00396 36.3225 5.79555 36.1562 5.6315 35.9502C5.25 35.4725 5.25 34.5397 5.25 32.6742V12.6018C5.25 10.6418 5.25 9.66 5.6315 8.90925C5.9675 8.25125 6.50125 7.7175 7.161 7.3815C7.91 7 8.89 7 10.85 7H31.15C33.11 7 34.09 7 34.839 7.3815C35.4975 7.71705 36.0329 8.25246 36.3685 8.911C36.75 9.65825 36.75 10.6382 36.75 12.5948V25.907C36.75 27.8617 36.75 28.84 36.3685 29.589C36.0329 30.2475 35.4975 30.7829 34.839 31.1185C34.0918 31.5 33.1135 31.5 31.157 31.5H15.9653C15.2373 31.5 14.8715 31.5 14.5232 31.57C14.2147 31.634 13.9163 31.7394 13.636 31.8832C13.321 32.0442 13.0375 32.27 12.4722 32.7232L12.467 32.7268Z" stroke="white" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>',t,e,i)}function Pn(t){return`\n        <div id="tp-allchat-options" class="chat-options-container" ${t.containerStyling?`style="${t.containerStyling}"`:""}>\n            ${e=t.liveChatShowing,e?Mn("tp-allchat-toggle",void 0,"Turn Allchat Off"):$n("tp-allchat-toggle",void 0,"Turn Allchat On")}\n            ${t.liveChatShowing?Vn("tp-allchat-show-create-post",void 0,"Post Comment"):""}\n        </div>\n    `;var e}function Ln(t,e){if(e){e.innerHTML=Pn(t);const i=document.getElementById("tp-allchat-toggle"),n=document.getElementById("tp-allchat-show-create-post");i&&i.addEventListener("click",(e=>{e.stopPropagation(),t.toggleLiveChat()})),n&&n.addEventListener("click",(e=>{e.stopPropagation(),In("allchat_open_create_comment_clicked"),t.showCreatePost()}))}}var On=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};function Rn(t){return t?'\n        <svg id="tp-allchat-chatbox-pauseplay" width="37" height="37" viewBox="0 0 37 37" fill="none" xmlns="http://www.w3.org/2000/svg">\n        <path d="M8.68344 3.25195C8.29705 3.25195 7.92649 3.40544 7.65327 3.67866C7.38005 3.95188 7.22656 4.32244 7.22656 4.70883V32.2912C7.22656 32.6776 7.38005 33.0481 7.65327 33.3213C7.92649 33.5946 8.29705 33.748 8.68344 33.748H13.4298C13.8162 33.748 14.1868 33.5946 14.46 33.3213C14.7332 33.0481 14.8867 32.6776 14.8867 32.2912V4.70883C14.8867 4.32244 14.7332 3.95188 14.46 3.67866C14.1868 3.40544 13.8162 3.25195 13.4298 3.25195H8.68344ZM23.5702 3.25195C23.1838 3.25195 22.8132 3.40544 22.54 3.67866C22.2668 3.95188 22.1133 4.32244 22.1133 4.70883V32.2912C22.1133 32.6776 22.2668 33.0481 22.54 33.3213C22.8132 33.5946 23.1838 33.748 23.5702 33.748H28.3166C28.7029 33.748 29.0735 33.5946 29.3467 33.3213C29.6199 33.0481 29.7734 32.6776 29.7734 32.2912V4.70883C29.7734 4.51751 29.7358 4.32806 29.6625 4.15131C29.5893 3.97455 29.482 3.81395 29.3467 3.67866C29.2114 3.54338 29.0508 3.43607 28.8741 3.36285C28.6973 3.28964 28.5079 3.25195 28.3166 3.25195H23.5702Z" fill="white"/>\n        </svg>\n\n    ':'\n        <svg id="tp-allchat-chatbox-pauseplay" width="44" height="44" viewBox="0 0 44 44" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M12.661 8.31787C12.494 8.21885 12.3038 8.1658 12.1096 8.1641C11.9155 8.16241 11.7243 8.21213 11.5556 8.30822C11.3869 8.4043 11.2466 8.54333 11.149 8.71118C11.0515 8.87903 11 9.06972 11 9.26387V34.7362C11 34.9304 11.0515 35.121 11.149 35.2889C11.2466 35.4567 11.3869 35.5958 11.5556 35.6919C11.7243 35.7879 11.9155 35.8377 12.1096 35.836C12.3038 35.8343 12.494 35.7812 12.661 35.6822L34.1532 22.946C34.3173 22.8486 34.4533 22.7102 34.5477 22.5443C34.6422 22.3785 34.6918 22.1909 34.6918 22C34.6918 21.8092 34.6422 21.6216 34.5477 21.4557C34.4533 21.2899 34.3173 21.1514 34.1532 21.054L12.661 8.31787Z" fill="white" stroke="white" stroke-width="2.7" stroke-linecap="round" stroke-linejoin="round"/>\n        </svg>\n\n    '}let Nn=!1,Hn=null;function Un(t){return On(this,void 0,void 0,(function*(){const e=yield t.isVideoPlaying();e?yield t.pauseVideo():yield t.playVideo(),Hn=!e;const i=document.getElementById("tp-allchat-chatbox-pauseplay");i&&(i.outerHTML=Rn(Hn))}))}function Gn(t,e){return On(this,void 0,void 0,(function*(){if(e&&t.shouldRender){const i=yield t.isVideoPlaying();e.innerHTML=function(t,e){return`\n        <div id="tp-allchat-chatbox-controls" class="allchat-chatbox-controls-container" ${t.containerStyling?`style="${t.containerStyling}"`:""}>\n            ${Rn(e)}\n        </div>\n    `}(t,i);const n=document.getElementById("tp-allchat-chatbox-pauseplay");n&&n.addEventListener("click",(e=>{e.stopPropagation(),Un(t)})),Nn||(setInterval((()=>On(this,void 0,void 0,(function*(){const e=yield t.isVideoPlaying();if(e!==Hn){Hn=e;const i=yield Rn(e),n=document.getElementById("tp-allchat-chatbox-pauseplay");if(n){n.outerHTML=i;const e=document.getElementById("tp-allchat-chatbox-pauseplay");e&&e.addEventListener("click",(e=>{e.stopPropagation(),Un(t)}))}}}))),100),Nn=!0)}}))}class zn extends Qi{constructor(t,e){super(t,e,Wi.GET_INIT_USER_SETTINGS)}}var Wn;!function(t){t.GET_AUTH_TOKEN="getAuthToken",t.SIGN_OUT="signOut",t.GET_SIGN_OUT_EPOCH="getSignOutEpoch"}(Wn||(Wn={}));class Qn extends N{constructor(t,e,i){super(t,e,i),this.type=i}}class Yn extends Qn{constructor(t,e){super(t,e,Wn.GET_AUTH_TOKEN)}}var Zn=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};const Jn=3e3,Kn=6e5;let qn=null,Xn=0;function ts(t,e){var i,n,s;return Zn(this,void 0,void 0,(function*(){const o=yield R.C(new zn(V,$)),r=(null===(i=null==o?void 0:o.userSettings)||void 0===i?void 0:i.userNickname)||(null===(n=null==o?void 0:o.currentUser)||void 0===n?void 0:n.displayName)||"Anonymous",u=ae.parseIconSrc(null===(s=null==o?void 0:o.userSettings)||void 0===s?void 0:s.userIcon);t.innerHTML=function(t,e,i){const n=e.slice(0,1).toUpperCase();return`\n    <div class="user-pill rounded-container gray-border" style="cursor: pointer !important;" id="allchat-user-pill">\n      <span class="user-pill-avatar">\n        ${t?`<img src="${t}" alt="${e}"/>`:`<span class="user-pill-initial">${n}</span>`}\n      </span>\n      <div style="display: flex; flex-direction: column">\n        <span class="user-pill-name">${e}</span>\n        <span class="user-pill-edit" id="allchat-edit-profile-open-btn">Edit</span>\n      </div>\n    </div>\n  `}(u,r);const a=document.getElementById("allchat-user-pill");a&&a.addEventListener("click",(t=>{t.stopPropagation(),e.onEditClicked()}))}))}function es(){null!==qn&&(clearInterval(qn),qn=null)}function is(t,e){return Zn(this,void 0,void 0,(function*(){if(!e)return;const i=void 0!==t.containerStyling&&t.containerStyling.length>0?` style="${t.containerStyling}"`:"";e.innerHTML=`<div class="user-identity-root"${i}></div>`;const n=e.firstElementChild;let s;try{s=yield R.C(new zn(V,$))}catch(t){}if(null==s?void 0:s.signedIn)yield ts(n,t);else{n.innerHTML=`\n    <a id="tp-user-login-btn"\n      class="tp-login-cta rounded-container"\n      href="${r}/signup?ref=allchat" target="_blank" rel="noopener noreferrer">\n      Login\n    </a>\n  `;const e=n.querySelector("#tp-user-login-btn");e&&e.addEventListener("click",(()=>{!function(t,e){null===qn&&(Xn=Date.now()+Kn,qn=window.setInterval((()=>Zn(this,void 0,void 0,(function*(){if(document.body.contains(t))if(Date.now()>=Xn)es();else try{const i=yield R.C(new zn(V,$));(null==i?void 0:i.signedIn)&&(es(),yield ts(t,e))}catch(t){}else es()}))),Jn))}(n,t)}))}}))}function ns(t,e){if(!e)return null;const i=t.id||`tp-flair-${Math.random().toString(36).slice(2,9)}`,{staticSrc:n,gifSrc:s}=Bn(t.reaction);e.innerHTML=function(t){const{id:e,reaction:i,staticSrc:n,shadowColor:s}=t;return`\n    <button\n      id="${e}"\n      class="tp-flair-icon"\n      type="button"\n      data-active="false"\n      aria-pressed="false"\n      aria-label="${i}"\n      style="--tp-flair-shadow-color: ${s};"\n    >\n      <img src="${n}" alt="${i}" />\n    </button>\n  `}({id:i,reaction:t.reaction,staticSrc:n,gifSrc:s,shadowColor:t.shadowColor});const o=document.getElementById(i),r=null==o?void 0:o.querySelector("img");if(!o||!r)return null;return(new Image).src=s,o.addEventListener("mouseenter",(t=>{t.stopPropagation(),r&&(r.src=s)})),o.addEventListener("mouseleave",(t=>{t.stopPropagation(),r&&(r.src=n)})),o.addEventListener("click",(e=>{e.stopPropagation();const i="true"!==o.dataset.active;!function(t,e){const i="string"==typeof t?document.getElementById(t):t;if(!i)return;e&&function(t){const e=t.closest(".tp-flair-row, #tp-flair-row")||document;e.querySelectorAll(".tp-flair-icon[data-active='true']").forEach((e=>{e!==t&&(e.setAttribute("data-active","false"),e.setAttribute("aria-pressed","false"))}))}(i);i.setAttribute("data-active",e?"true":"false"),i.setAttribute("aria-pressed",e?"true":"false")}(o,i),t.onClick&&t.onClick()})),o}function ss(t,e=document.getElementById("tp-flair-row")){if(!e)return null;const i=document.createElement("div");return i.className="tp-flair-cell",e.appendChild(i),ns(t,i)}class os{constructor(t,e=2e3,i){this.onRemove=i,this.duration=e;const n=document.createElement("div");n.className="allchat-toast",n.innerHTML=t,n.style.position="fixed",n.style.opacity="0",n.style.visibility="hidden",n.addEventListener("mouseenter",(()=>this.pause())),n.addEventListener("mouseleave",(()=>this.resume())),this.el=n}measure(){const t=this.el.getBoundingClientRect();return{w:Math.ceil(t.width),h:Math.ceil(t.height)}}reveal(){this.el.style.visibility="visible",this.el.style.opacity="1"}setPosition(t,e){this.el.style.left=`${t}px`,this.el.style.bottom=`${e}px`}clearTimers(){this.fadeTimer&&window.clearInterval(this.fadeTimer),this.removeTimer&&window.clearTimeout(this.removeTimer)}scheduleDismiss(){this.clearTimers(),this.removeTimer=window.setTimeout((()=>{this.fadeTimer=window.setInterval((()=>{const t=parseFloat(this.el.style.opacity||"1");if(!isNaN(t)&&t>0){const e=Math.max(0,t-.05);this.el.style.opacity=e.toString()}else window.clearInterval(this.fadeTimer),this.destroy()}),50)}),this.duration)}pause(){this.clearTimers(),this.el.style.opacity="1"}resume(){this.scheduleDismiss()}destroy(){this.el.remove(),this.onRemove()}}const rs=new class{constructor(t){this.active=[],this.queue=[],this.id="tp-allchat-toast-container",this.MAX_ACTIVE=3,this.TOAST_GAP=12,this.HORIZ_MARGIN=36,this.VERT_MARGIN_BOTTOM=90,this.ensureContainer(t),window.__allchat_toast_resize_bound||(window.addEventListener("resize",(()=>this.layout())),window.__allchat_toast_resize_bound=!0)}ensureContainer(t){let e=document.getElementById(this.id);e||(e=document.createElement("div"),e.id=this.id,e.style.position="fixed",e.style.zIndex="9991",(null!=t?t:document.body).appendChild(e)),this.container=e}show(t,e,i){const n=null!=i?i:`toast_${Date.now()}_${Math.random().toString(36).slice(2)}`;return this.queue.push({html:t,duration:e,id:n}),this.pump(),n}dismiss(t){const e=this.active.findIndex((e=>e.id===t));if(e>=0){const{toast:t}=this.active[e];t.destroy(),this.active.splice(e,1),this.pump()}else{const e=this.queue.findIndex((e=>e.id===t));e>=0&&this.queue.splice(e,1)}}pump(){for(this.container||this.ensureContainer();this.active.length<this.MAX_ACTIVE&&this.queue.length>0;){const{html:t,duration:e,id:i}=this.queue.shift(),n=new os(t,e,(()=>{const t=this.active.findIndex((t=>t.toast===n));t>=0&&this.active.splice(t,1),this.pump()}));this.container.appendChild(n.el),n.setPosition(this.HORIZ_MARGIN,this.VERT_MARGIN_BOTTOM),n.reveal(),n.scheduleDismiss(),this.active.push({id:i,toast:n})}this.layout()}layout(){if(!this.active.length)return;const t=window.innerWidth,e=window.innerHeight;let i=this.VERT_MARGIN_BOTTOM;for(const{toast:n}of this.active){const{w:s,h:o}=n.measure(),r=Math.min(Math.max(Math.round(.15*o),0),Math.max(e-o-this.VERT_MARGIN_BOTTOM,0)),u=Math.min(this.HORIZ_MARGIN,t-s-this.HORIZ_MARGIN),a=Math.min(i+r,e-o-this.VERT_MARGIN_BOTTOM);n.setPosition(u,a),i=a+o+this.TOAST_GAP}}};function us(t,e=2e3,i){return rs.show(t,e,i)}class as extends Z{constructor(t,e){super(t,e,G.GET_PERM_ID)}}var cs=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};const hs=120;function ls(t){return`\n        <div id="tp-allchat-chatbox" style="display: flex; flex-direction: column; width: 100%; background-color: black; align-items: flex-end; padding: 12px 20px;">\n            <div class="allchat-chatbox-container" ${t.containerStyling?`style="${t.containerStyling}"`:""}>\n                ${Sn('\n        <svg width="33" height="33" viewBox="0 0 33 33" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <mask id="mask0_1785_33205" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="33" height="33">\n            <path d="M19.796 7.45659V0.85791H0V7.45659H6.59868V25.6079H13.1974V7.45659H19.796Z" fill="#EF3E3A"/>\n            <path d="M23.9243 9.10791C18.9109 9.10791 14.8487 13.1702 14.8487 18.1836V32.2066H21.4474V26.9158C22.2334 27.1403 23.0657 27.2592 23.9243 27.2592C28.9378 27.2592 33 23.197 33 18.1836C33 13.1702 28.9311 9.10791 23.9243 9.10791ZM23.9243 20.6539C22.557 20.6539 21.4474 19.5443 21.4474 18.177C21.4474 16.8097 22.557 15.7 23.9243 15.7C25.2916 15.7 26.4013 16.8097 26.4013 18.177C26.3947 19.5509 25.2916 20.6539 23.9243 20.6539Z" fill="#EF3E3A"/>\n            </mask>\n            <g mask="url(#mask0_1785_33205)">\n            <rect width="33" height="33" fill="url(#paint0_linear_1785_33205)"/>\n            </g>\n            <defs>\n            <linearGradient id="paint0_linear_1785_33205" x1="0" y1="0" x2="37.984" y2="7.39309" gradientUnits="userSpaceOnUse">\n            <stop stop-color="#E34248"/>\n            <stop offset="1" stop-color="#9E55A0"/>\n            </linearGradient>\n            </defs>\n        </svg>\n    ',e,i)}\n                ${t.videoControlProps.shouldRender?'<div id="tp-allchat-chatbox-controls-container" style="display: flex; width: 56px; height: 44px; justify-content: center;"></div>':""}\n                <div style="display:flex; align-items:center; position:relative; flex-grow:1">\n                    <div class="tp-chatbox-input-wrapper" style="flex-grow:1; position:relative;">\n                        <input\n                        id="tp-allchat-chatbox-input"\n                        value="${t.curComment}"\n                        type="text"\n                        class="allchat-chatbox-input"\n                        placeholder="Add your comment here"\n                        style="flex-grow:1; padding-right:160px; padding-left:12px;"\n                        >\n\n                        <div class="tp-input-right-rail">\n                            <div id="tp-flair-row" class="tp-flair-row"></div>\n                            <span id="tp-allchat-chatbox-length" class="allchat-chatbox-length">\n                                ${t.curComment.length}/${hs}\n                            </span>\n                        </div>\n                    </div>\n                </div>\n\n                <div style="display: flex; flex-direction: row">\n                    <span\n                        id="tp-allchat-cancel-btn"\n                        class="allchat-chatbox-button rounded-container gray-border"\n                        style="height: 52px; display: flex; align-items: center; margin-right: 6px"\n                    >\n                        Cancel\n                    </span>\n                    \n                    <span\n                        id="tp-allchat-post-btn"\n                        class="allchat-chatbox-button rounded-container gradient-border"\n                        style="font-weight:600; height: 52px; display: flex; align-items: center;"\n                    >\n                        <span class="gradient-200-text">Post</span>\n                    </span>\n                </div>\n                <div id="tp-user-identity" style="margin-left:16px;"></div>\n                ${jn("allchat-chatbox-open-help","cursor: pointer !important; width: 33px; height: 33px;")}\n                \n                <div id="tp-allchat-message-box" class="allchat-message-box"></div>\n            </div>\n            <a\n                style="font-size: 12px; color: gray; margin-top: 4px; cursor: pointer; padding-bottom: 4px;"\n                class="allchat-underline-text"\n                id="tp-leave-feedback-text"\n                href="https://docs.google.com/forms/d/e/1FAIpQLSdkFbtU1o-vw9LXVG4STZiryRbrcF0j445c3b1EfwNoJYUT7w/viewform?usp=dialog"\n                target="_blank"\n            >\n                Leave Feedback\n            </a>\n        </div>\n    `;var e,i}function ds(){const t=document.getElementById("tp-flair-row");if(t)for(const e of t.children){const t=e.querySelector("button");if("true"===(null==t?void 0:t.getAttribute("data-active")))return null==t?void 0:t.getAttribute("aria-label")}}function Ds(t,e,i,n){var s,o;return cs(this,void 0,void 0,(function*(){const r=document.getElementById("tp-allchat-post-btn");try{r&&(r.textContent="Posting...");const u=new K(P,$,{name:"allchat_message_sent",message:{text:e}});R.C(u);const a=yield R.C(new as(P,$)),c=yield ue("comments","POST",Boolean(i.signedIn||t.loginRequired),{message:e,vidTime:yield t.getVidTime(),service:t.service,vidId:t.vidId,displayName:(null===(s=i.userSettings)||void 0===s?void 0:s.userNickname)||(null===(o=i.currentUser)||void 0===o?void 0:o.displayName)||"anonymous",vidDuration:t.vidDuration,flair:ds(),permId:a},n,void 0,!0);t.onPostComment(c),t.shouldPlayVideoAfterClose&&t.videoControlProps.playVideo(),t.closeChatbox(),In("allchat_message_accepted")}catch(t){try{const e=JSON.parse(t.message);e.error?(In("allchat_message_rejected"),"User is confused"===e.error?us("Message violates community guidelines"):us(e.error)):(In("allchat_message_errored"),us("An error occurred"))}catch(e){In("allchat_message_errored"),console.error(`GOT ERROR ${t}`),us("An error occurred")}}finally{t.onCommentEdited(""),r&&(r.textContent="Post"),function(t){const e=document.getElementById("tp-allchat-chatbox-length");e&&(e.innerText=`${t.curComment.length}/${hs}`)}(t)}}))}function ps(t){is({onEditClicked:()=>{t.openEditProfileModal((()=>ps(t)))}},document.getElementById("tp-user-identity"))}function vs(){const t="allchat-feedback-bubble",e="allchat-feedback-bubble-dismissed";if("true"===localStorage.getItem(e))return;const i=localStorage.getItem(t),n=i?JSON.parse(i):{count:0,last:0},{count:s,last:o}=n;Date.now()-o>=Math.min(3e5*Math.pow(2,s),864e5)&&setTimeout((()=>{us(`\n        <div style="display: flex; flex-direction: column;">\n            <div style="display: flex; flex-direction: row; justify-content: space-between; align-items: center; gap: 20px; margin-bottom: 20px">\n                <span>Want to help All Chat improve? Leave your thoughts here!</span>\n                ${Tn("allchat-close-feedback","transform: translateY(-2px); cursor: pointer;")}\n            </div>\n            <div style="display: flex; flex-direction: row; align-items: center; justify-content: flex-end; gap: 12px;">\n                <span class="allchat-underline-text" \n                      style="font-size: 12px; color: gray; cursor: pointer;" \n                      id="allchat-dont-show-feedback">\n                    Don't Show Again\n                </span>\n                <a class="gradient-200-button leave-feedback-button" target="_blank"\n                   href="https://docs.google.com/forms/d/e/1FAIpQLSdkFbtU1o-vw9LXVG4STZiryRbrcF0j445c3b1EfwNoJYUT7w/viewform?usp=dialog">\n                    Leave Feedback\n                </a>\n            </div>\n        </div>\n    `,1e4,"feedback-bubble"),localStorage.setItem(t,JSON.stringify({count:s+1,last:Date.now()}));const i=document.querySelector(".leave-feedback-button"),n=document.getElementById("allchat-dont-show-feedback"),o=document.getElementById("allchat-close-feedback"),r=()=>{rs.dismiss("feedback-bubble")};i&&i.addEventListener("click",(()=>{localStorage.setItem(e,"true"),r()})),n&&n.addEventListener("click",(()=>{localStorage.setItem(e,"true"),r()})),o&&o.addEventListener("click",r)}),3e3)}function gs(t,e){if(e){e.innerHTML=ls(t),Gn(t.videoControlProps,document.getElementById("tp-allchat-chatbox-controls-container")),ps(t);const i=document.getElementById("tp-allchat-chatbox-input"),n=document.getElementById("tp-allchat-cancel-btn"),s=document.getElementById("tp-allchat-post-btn"),o=document.getElementById("allchat-chatbox-open-help"),r=document.getElementById("tp-flair-row");r&&(ss({reaction:"heart",shadowColor:"rgba(255, 77, 166, 0.8)"},r),ss({reaction:"cry",shadowColor:"rgba(9, 239, 247, 1)"},r),ss({reaction:"surprise",shadowColor:"rgba(255, 216, 77, 0.8)"},r)),i&&(i.addEventListener("focus",(t=>{t.stopPropagation(),localStorage.setItem("allchat-has-focus","true")})),i.addEventListener("blur",(()=>{localStorage.setItem("allchat-has-focus","false")})),i.addEventListener("click",(t=>{t.stopPropagation()})),i.addEventListener("keydown",(t=>{t.stopPropagation()})),i.addEventListener("input",(e=>{let n=e.target.value;n.length>hs&&(n=n.substring(0,hs),i.value=n),t.onCommentEdited(n);const s=document.getElementById("tp-allchat-chatbox-length");s&&(s.innerHTML=`${n.length}/${hs}`)}))),n&&n.addEventListener("click",(e=>{e.stopPropagation(),t.shouldPlayVideoAfterClose&&t.videoControlProps.playVideo(),In("allchat_cancel_post_clicked"),t.closeChatbox()})),s&&s.addEventListener("click",(e=>{e.stopPropagation(),function(t){cs(this,void 0,void 0,(function*(){const e=yield R.C(new zn(V,$)),i=yield R.C(new Yn(V,$));if(In("allchat_post_button_clicked"),!e.signedIn&&t.loginRequired)return In("allchat_login_modal_opened"),void t.openLoginModal();const n=document.getElementById("tp-allchat-chatbox-input"),s=n.value;!s||s.length>120?us("Message must be between 1-120 characters"):"true"!==localStorage.getItem("guidelinesModalSeen")?(In("allchat_guidelines_modal_opened"),t.openGuidelinesModal({onAgree:()=>{Ds(t,s,e,i.token),n.value="",t.closeModal(),localStorage.setItem("guidelinesModalSeen","true")},onCancel:t.closeModal,boxesChecked:[],onToggleBox:(e,i)=>{const n=t.getStoredGuidelinesModalProps();if(n)if(i)n.boxesChecked.push(e);else{const t=n.boxesChecked.indexOf(e);t>-1&&n.boxesChecked.splice(t,1)}}})):(Ds(t,s,e,i.token),n.value="",t.closeModal())}))}(t)})),o&&o.addEventListener("click",(e=>{e.stopPropagation(),t.openHelpModal()})),vs()}}class fs{constructor(t){this.host=null,this.onKeyDownRef=null,this.props=t}getCloseSelector(){return"#tp-allchat-modal-close"}open(t){if(!t)return;this.host=t;const e=this.getHtml(),i=this.props.containerStyling?`style="${this.props.containerStyling}"`:"";this.host.innerHTML=`\n      <div id="tp-allchat-modal" class="allchat-modal-container" ${i}>\n        <div id="allchat-modal-content" class="allchat-modal-content">\n          ${e}\n        </div>\n      </div>\n    `,this.bindBaseEvents(),this.bindInnerEvents()}close(){this.unbindBaseEvents(),this.host&&(this.host.innerHTML="")}destroy(){this.close(),this.host=null}bindBaseEvents(){this.onKeyDownRef=t=>{"Escape"!==t.key&&"Esc"!==t.key&&"Enter"!==t.key||(t.preventDefault(),this.close())},window.addEventListener("keydown",this.onKeyDownRef);const t=this.getCloseSelector();if(t){const e=document.querySelector(t);e&&e.addEventListener("click",(t=>{t.stopPropagation(),this.close()}))}}unbindBaseEvents(){this.onKeyDownRef&&(window.removeEventListener("keydown",this.onKeyDownRef),this.onKeyDownRef=null)}setContent(t){const e=document.getElementById("allchat-modal-content");e&&(e.innerHTML=t)}}class ms extends fs{constructor(){super(...arguments),this.ID_CANCEL="tp-allchat-modal-cancel-btn",this.ID_CONFIRM="tp-allchat-confirm-post",this.ID_ERROR="tp-allchat-guidelines-modal-error"}checkboxHtml(t,e){return`\n      <label for="${e}" style="display:flex; align-items:center; margin-bottom:8px;">\n        <input type="checkbox" id="${e}" data-teleparty-guidelines="true" ${this.props.boxesChecked.includes(e)?"checked":""} style="margin-right:8px;" />\n        <span class="allchat-checkbox-text">${t}</span>\n      </label>\n    `}getHtml(){return`\n      <div style="display:flex; flex-direction:column; width:470px;">\n        <span class="allchat-modal-header" style="margin-bottom:4px;">Community Guidelines</span>\n        <span class="allchat-modal-body">Please agree to the following community guidelines before commenting:</span>\n\n        <div style="display:flex; flex-direction:column; gap:8px; margin-top:20px; margin-bottom:20px;">\n          ${this.checkboxHtml("I agree that my message is relevant to the content and does not contain spoilers, spam, or advertisements","ac-guideline-1")}\n          ${this.checkboxHtml("I agree that my message is not rude, inappropriate, or hateful","ac-guideline-2")}\n          ${this.checkboxHtml("I understand that my message will be shown to ALL Teleparty users, not just those in my current party if I am in one","ac-guideline-3")}\n          <span class="allchat-error-text" id="${this.ID_ERROR}"></span>\n        </div>\n\n        <div style="display:flex; flex-direction:row; align-items:center; justify-content:right; width:100%;">\n          <span id="${this.ID_CANCEL}" class="allchat-chatbox-button" style="font-weight:600; margin-right:16px; font-size:16px;">Cancel</span>\n          <span id="${this.ID_CONFIRM}" class="gradient-200-button">Post Comment</span>\n        </div>\n      </div>\n    `}bindInnerEvents(){const t=document.getElementById(this.ID_CANCEL),e=document.getElementById(this.ID_CONFIRM);t&&t.addEventListener("click",(t=>{t.stopPropagation(),this.props.onCancel(),this.close()})),e&&e.addEventListener("click",(t=>{t.stopPropagation();const e=document.querySelectorAll('input[type="checkbox"][data-teleparty-guidelines="true"]');if(Array.from(e).every((t=>t.checked)))this.props.onAgree(),this.close();else{const t=document.getElementById(this.ID_ERROR);t&&(t.textContent="Please agree to all guidelines before posting")}}));document.querySelectorAll('input[type="checkbox"][data-teleparty-guidelines="true"]').forEach((t=>{t.addEventListener("change",(()=>{this.props.onToggleBox(t.id,t.checked)}))}))}}var ws=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class Fs extends fs{constructor(){super(...arguments),this.ID_CLOSE="tp-allchat-modal-close",this.ID_SAVE="allchat-save-name",this.ID_INPUT="allchat-display-name-input"}open(t){super.open(t),this.loadAndRender()}close(){super.close(),this.props.closeModal()}getHtml(){return`\n      <div style="display:flex; flex-direction:column; width:400px; overflow:hidden; overflow-y:auto; scrollbar-width:none; -ms-overflow-style:none;">\n        \x3c!-- Header --\x3e\n        <div style="display:flex; justify-content:flex-end; width:100%; position:sticky; top:0; background-color:rgba(0,0,0,0.9); z-index:10000;">\n          ${Tn(this.ID_CLOSE,"cursor: pointer !important;")}\n        </div>\n        <div class="allchat-modal-body" style="padding:16px; color:#a0a0a0;">Loading profile‚Ä¶</div>\n      </div>\n    `}bindInnerEvents(){const t=document.getElementById(this.ID_CLOSE);t&&t.addEventListener("click",(t=>{t.stopPropagation(),this.close()}))}loadAndRender(){var t,e,i;return ws(this,void 0,void 0,(function*(){try{const n=yield R.C(new zn(V,$)),s=(null===(t=n.userSettings)||void 0===t?void 0:t.userNickname)||(null===(e=n.currentUser)||void 0===e?void 0:e.displayName)||"Anonymous",o=ae.parseIconSrc(null===(i=n.userSettings)||void 0===i?void 0:i.userIcon);this.setContent(this.getEditProfileHtml(s,o)),this.bindFormEvents()}catch(t){console.error(t),this.setContent('\n        <div class="allchat-modal-body" style="padding:16px; color:#fca5a5;">\n          Failed to load profile. Please try again later.\n        </div>\n      '),this.bindInnerEvents()}}))}getEditProfileHtml(t,e){const i=t.replace(/"/g,"&quot;"),n=e?`<img src="${e}" alt="Avatar" style="width:100px; height:100px; opacity:0.9;" />`:'<div style="\n            width:100px; height:100px; border-radius:50%;\n            border:2px solid #aaa; color:#aaa;\n            display:flex; align-items:center; justify-content:center;\n            font-size:12px; text-align:center;\n          ">No Profile</div>';return`\n      <div style="display:flex; flex-direction:column; width:400px; overflow:hidden; overflow-y:auto; scrollbar-width:none; -ms-overflow-style:none;">\n        \x3c!-- Header --\x3e\n        <div style="display:flex; justify-content:flex-end; width:100%; position:sticky; top:0; background-color:rgba(0,0,0,0.9); z-index:10000;">\n          ${Tn(this.ID_CLOSE,"cursor: pointer !important;")}\n        </div>\n\n        \x3c!-- Avatar --\x3e\n        <div style="display:flex; align-items:center; justify-content:center; margin-top:8px; margin-bottom:8px;">\n          <div style="position:relative; width:100px; height:100px;">\n            <div style="width:100px; height:100px; border-radius:50%; background:#545454; display:flex; align-items:center; justify-content:center;">\n              ${n}\n            </div>\n            \x3c!--\n            <button id="allchat-edit-avatar" title="Change avatar" style="\n              position:absolute; right:-2px; bottom:6px;\n              width:32px; height:32px; border-radius:50%;\n              background:#5b7cff; border:none; display:grid; place-items:center; cursor:pointer;">\n              \n            </button>\n            --\x3e\n          </div>\n        </div>\n\n        \x3c!-- Form --\x3e\n        <div style="display:flex; flex-direction:column; gap:10px; margin-top:6px;">\n          <span class="user-pill-name" style="padding-left:4px;">Change Display Name</span>\n          <div style="\n            display:flex; align-items:center; gap:8px; background:#1f1f1f;\n            border-radius:4px; padding-left:14px; height:48px;">\n            <input\n              id="${this.ID_INPUT}"\n              type="text"\n              value="${i}"\n              maxlength="16"\n              autocomplete="name"\n              aria-label="Display name"\n              style="flex:1; background:transparent; border:none; outline:none; color:white; font-size:18px;"\n            />\n          </div>\n        </div>\n\n        \x3c!-- Actions --\x3e\n        <div style="display:flex; flex-direction:column; width:100%; margin-top:24px; align-items:center">\n          <button id="${this.ID_SAVE}" class="gradient-200-button" style="height:48px; border-radius:4px; font-weight:700; cursor:pointer; border:none; outline:none; width:100%">\n            Save\n          </button>\n        </div>\n\n        \x3c!--\n        <div style="margin-top:12px;">\n          <button id="allchat-sign-out" class="allchat-chatbox-button" style="width:100%; text-align:center;">\n            Sign out\n          </button>\n        </div>\n        --\x3e\n      </div>\n    `}bindFormEvents(){const t=document.getElementById(this.ID_CLOSE),e=document.getElementById(this.ID_SAVE),i=document.getElementById(this.ID_INPUT);t&&t.addEventListener("click",(t=>{t.stopPropagation(),this.close()})),e&&e.addEventListener("click",(t=>ws(this,void 0,void 0,(function*(){t.stopPropagation(),i&&(yield j.setItemsAsync({userNickname:i.value})),this.close(),this.props.onAuthUpdated()}))))}}class ys extends fs{constructor(){super(...arguments),this.CONTINUE_ID="allchat-help-modal-continue",this.TOGGLE_ID="allchat-help-modal-toggle",this.CLOSE_ID="tp-allchat-modal-close"}getCloseSelector(){return`#${this.CLOSE_ID}`}open(t){super.open(t)}close(){super.close(),this.props.closeModal()}getHtml(){const t=this.props.getLiveChatShowing(),e=t?"Disable All Chat":"Enable All Chat",i=t?"allchat-toggle--disable":"allchat-toggle--enable";return`\n    <div style="\n      display:flex; flex-direction:column; width:470px; height:600px;\n      position:relative; overflow:hidden; background-color:rgba(0,0,0,0.9);\n      font-family:'Poppins', sans-serif; padding-bottom:76px; box-sizing:border-box;\n    ">\n      <div style="display:flex; padding-bottom:6px; flex-direction:row; align-items:center; justify-content:space-between; width:100%;">\n        <div style="display:flex; flex-direction:row; align-items:center">\n          <span class="allchat-modal-header" style="margin-right:8px;">Introducing All Chat</span>\n          ${Sn('<svg width="45" height="19" viewBox="0 0 45 19" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <rect width="45" height="19" rx="9.5" fill="#FBC45A"/>\n            <path d="M13.58 9.704C14.052 9.792 14.44 10.028 14.744 10.412C15.048 10.796 15.2 11.236 15.2 11.732C15.2 12.18 15.088 12.576 14.864 12.92C14.648 13.256 14.332 13.52 13.916 13.712C13.5 13.904 13.008 14 12.44 14H8.828V5.624H12.284C12.852 5.624 13.34 5.716 13.748 5.9C14.164 6.084 14.476 6.34 14.684 6.668C14.9 6.996 15.008 7.368 15.008 7.784C15.008 8.272 14.876 8.68 14.612 9.008C14.356 9.336 14.012 9.568 13.58 9.704ZM10.508 9.08H12.044C12.444 9.08 12.752 8.992 12.968 8.816C13.184 8.632 13.292 8.372 13.292 8.036C13.292 7.7 13.184 7.44 12.968 7.256C12.752 7.072 12.444 6.98 12.044 6.98H10.508V9.08ZM12.2 12.632C12.608 12.632 12.924 12.536 13.148 12.344C13.38 12.152 13.496 11.88 13.496 11.528C13.496 11.168 13.376 10.888 13.136 10.688C12.896 10.48 12.572 10.376 12.164 10.376H10.508V12.632H12.2ZM18.2189 6.98V9.08H21.0389V10.412H18.2189V12.632H21.3989V14H16.5389V5.612H21.3989V6.98H18.2189ZM28.6257 5.624V6.98H26.3937V14H24.7137V6.98H22.4817V5.624H28.6257ZM34.9874 12.404H31.6514L31.0994 14H29.3354L32.3474 5.612H34.3034L37.3154 14H35.5394L34.9874 12.404ZM34.5314 11.06L33.3194 7.556L32.1074 11.06H34.5314Z" fill="#050505"/>\n        </svg>\n        ',n,s)}\n        </div>\n        ${Tn(this.CLOSE_ID,"cursor: pointer !important;")}\n      </div>\n\n      <span class="allchat-modal-body" style="color:#a0a0a0; margin-top:6px;">\n        Teleparty All Chat is a beta feature that allows viewers to engage with each other by leaving short comments on videos they watch.\n      </span>\n\n      <div class="allchat-scrollbox" style="\n        display:flex; flex-direction:column; background-color:#282828; padding:16px; margin-top:20px;\n        flex:1 1 auto; overflow-y:auto; border-radius:8px;\n      ">\n        <img style="margin-bottom:20px; max-width:100%; height:auto;" src="${chrome.runtime.getURL("img/allchat_comment.png")}" />\n\n        <span class="allchat-modal-subheader">How do I turn this feature on/off?</span>\n        <span class="allchat-modal-body">\n          To disable All Chat, press the ${Mn("","width: 26px; height: 26px; transform: translateY(25%);")} button on the top right of the video.\n          To enable it, press ${$n("","width: 26px; height: 26px; transform: translateY(25%);")}.\n        </span>\n\n        <span class="allchat-modal-subheader" style="margin-top:40px; margin-bottom:10px">How do I add a comment to the video?</span>\n        <span class="allchat-modal-body">\n          To add comments to the video, sign in to teleparty and press the ${Vn("","width: 26px; height: 26px; transform: translateY(25%);")} button on the top right of the video.\n        </span>\n\n        <span class="allchat-modal-subheader" style="margin-top:40px; margin-bottom:10px">Who sees these comments?</span>\n        <span class="allchat-modal-body">\n          Comments are shown to <span style="font-weight:700">all Teleparty users</span>. This chat is global unlike the typical Teleparty chat.\n        </span>\n\n        <span class="allchat-modal-subheader" style="margin-top:40px; margin-bottom:10px">Will I see comments when I'm not in a party?</span>\n        <span class="allchat-modal-body">\n          Yes, comments are shown whenever allchat is enabled, including when you are not in a party. By default, allchat is turned off.\n        </span>\n\n        <span class="allchat-modal-subheader" style="margin-top:40px; margin-bottom:10px">When will my comments show up for other users?</span>\n        <span class="allchat-modal-body">\n          Comments will show up for other users after about a minute.\n        </span>\n      </div>\n\n      <div style="\n        position:absolute; left:0; right:0; bottom:0;\n        display:flex; flex-direction:row; gap:10px; align-items:stretch;\n        padding:6px; background-color:rgba(0,0,0,0.9);\n        border-top:1px solid rgba(255,255,255,0.08);\n      ">\n        <span id="${this.TOGGLE_ID}" class="allchat-toggle-btn ${i}">${e}</span>\n        <span id="${this.CONTINUE_ID}" class="gradient-200-button" style="\n          flex:1 1 0; display:inline-flex; align-items:center; justify-content:center; white-space:nowrap;\n        ">Continue</span>\n      </div>\n    </div>`;var n,s}bindInnerEvents(){const t=document.getElementById(this.CONTINUE_ID),e=document.getElementById(this.TOGGLE_ID);t&&t.addEventListener("click",(t=>{t.stopPropagation(),this.close()})),e&&e.addEventListener("click",(t=>{t.stopPropagation(),this.props.toggleLiveChat();this.props.getLiveChatShowing()?(e.classList.remove("allchat-toggle--enable"),e.classList.add("allchat-toggle--disable"),e.textContent="Disable All Chat"):(e.classList.remove("allchat-toggle--disable"),e.classList.add("allchat-toggle--enable"),e.textContent="Enable All Chat")}))}}function Cs(t){var e;const i=t.containerStyling?`style="${t.containerStyling}"`:"",n=Bn(null!==(e=t.flair)&&void 0!==e?e:"");return`\n        <div id="tp-allchat-live-feed" class="live-feed-container" ${i}>\n            ${t.flair?`<div style="position: absolute; top: 0; right: 0; transform: translate(60%, -40%)" id="tp-flair-container">\n                            <img src=${n.gifSrc} alt=${t.flair} width="48 height="48"/>\n                        </div>`:""}\n            <div style="display: flex; flex-direction: row; width: 100%; justify-content: space-between; align-items: center">\n                ${Sn('\n        <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <g opacity="0.2">\n            <mask id="mask0_1785_27357" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="16" height="16">\n            <path d="M9.59808 3.61537V0.416016H0V3.61537H3.19936V12.416H6.39872V3.61537H9.59808Z" fill="#EF3E3A"/>\n            <path d="M11.5997 4.41602C9.16894 4.41602 7.19936 6.38559 7.19936 8.81634V15.6154H10.3987V13.0501C10.7798 13.159 11.1833 13.2167 11.5997 13.2167C14.0304 13.2167 16 11.2471 16 8.81634C16 6.38559 14.0272 4.41602 11.5997 4.41602ZM11.5997 10.0141C10.9368 10.0141 10.3987 9.47606 10.3987 8.81313C10.3987 8.1502 10.9368 7.61217 11.5997 7.61217C12.2626 7.61217 12.8006 8.1502 12.8006 8.81313C12.7974 9.47927 12.2626 10.0141 11.5997 10.0141Z" fill="#EF3E3A"/>\n            </mask>\n            <g mask="url(#mask0_1785_27357)">\n            <rect width="16" height="16" fill="white"/>\n            </g>\n            </g>\n        </svg>\n    ',s,o)}\n                <div style="display: flex; flex-direction: row; align-items: center">\n                    ${jn("tp-allchat-comment-help","cursor: pointer !important;")}\n                    ${function(t,e){return Sn('\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n            <path d="M5 21V4H14L14.4 6H20V16H13L12.6 14H7V21H5ZM14.65 14H18V8H12.75L12.35 6H7V12H14.25L14.65 14Z" fill="#4B4D4D"/>\n        </svg>\n    ',t,e)}("tp-allchat-report-flag","cursor: pointer !important; margin-left: 6px;")}\n                </div>\n            </div>\n            <p class="live-feed-comment-username">${t.username}</p>\n            <p class="live-feed-comment-message">${t.message}</p>\n        </div>\n    `;var s,o}class bs extends fs{constructor(){super(...arguments),this.ID_CANCEL="tp-allchat-login-cancel-btn",this.ID_SIGNIN="tp-allchat-login-signin"}open(t){super.open(t)}close(){super.close(),this.props.closeModal()}getHtml(){return`\n      <span class="allchat-modal-message" style="margin-bottom: 6px">\n        Please sign in to Teleparty to<br>leave a comment\n      </span>\n      <div style="display:flex; flex-direction:row; align-items:center; justify-content:right; width:100%">\n        <span id="${this.ID_CANCEL}" class="allchat-chatbox-button" style="font-weight:600; margin-right:16px; font-size:16px">Cancel</span>\n        <a id="${this.ID_SIGNIN}" class="gradient-200-button" href="${r}/signup?ref=allchat" target="_blank" rel="noopener noreferrer">Sign In</a>\n      </div>\n    `}bindInnerEvents(){const t=document.getElementById(this.ID_CANCEL),e=document.getElementById(this.ID_SIGNIN);t&&t.addEventListener("click",(t=>{t.stopPropagation(),this.close()})),e&&e.addEventListener("click",(()=>{this.close()}))}}var Es=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class _s extends fs{constructor(){super(...arguments),this.ID_CANCEL="tp-allchat-report-cancel-btn",this.ID_CONFIRM="tp-allchat-report-confirm-btn",this.ID_CONTENT="allchat-modal-content"}open(t){super.open(t)}close(){super.close(),this.props.closeModal()}getHtml(){return this.getConfirmHtml()}bindInnerEvents(){this.bindConfirmEvents()}getConfirmHtml(){return`\n      <span class="allchat-modal-message" style="margin-bottom: 6px">\n        Are you sure you want to report<br>this comment?\n      </span>\n      <div style="display:flex; flex-direction:row; align-items:center; justify-content:right; width:100%">\n        <span id="${this.ID_CANCEL}" class="allchat-chatbox-button" style="font-weight:600; margin-right:16px; font-size:16px">Cancel</span>\n        <span id="${this.ID_CONFIRM}" class="gradient-200-button">Report</span>\n      </div>\n    `}getFinishedHtml(t){return`\n      <span class="allchat-modal-message">${t}</span>\n      <span id="${this.ID_CANCEL}" class="allchat-chatbox-button" style="font-weight:600; font-size:16px; width:100%; text-align:center; margin-top:10px">Close</span>\n    `}bindConfirmEvents(){const t=document.getElementById(this.ID_CANCEL),e=document.getElementById(this.ID_CONFIRM);t&&t.addEventListener("click",(t=>{t.stopPropagation(),this.close()})),e&&e.addEventListener("click",(t=>{t.stopPropagation(),this.onReportClick(e)}))}bindFinishedEvents(){const t=document.getElementById(this.ID_CANCEL);t&&t.addEventListener("click",(t=>{t.stopPropagation(),this.close()}))}onReportClick(t){return Es(this,void 0,void 0,(function*(){t.textContent="Reporting...",t.style.pointerEvents="none",t.style.opacity="0.7";try{yield ue(`comments/${this.props.commentId}/report`,"POST",!1),this.setContent(this.getFinishedHtml("Message reported successfully.")),this.bindFinishedEvents(),this.props.removeMessage(this.props.commentId)}catch(t){console.error(t),this.setContent(this.getFinishedHtml("An error occurred. Please try again later.")),this.bindFinishedEvents()}}))}}var xs=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class ks{constructor(t,e,i,n){this.ALLCHAT_OPTIONS_ROOT_ID="tp-allchat-options-root",this.ALLCHAT_CHATBOX_ROOT_ID="tp-allchat-chatbox-root",this.ALLCHAT_LIVECHAT_ROOT_ID="tp-allchat-livechat-root",this.ALLCHAT_MODAL_ROOT_ID="tp-allchat-modal-root",this.Ms="true"===localStorage.getItem("tpLiveChatShowing"),this.$s=!1,this.Vs=!1,this.Ps="",this.Ls=!0,this.Os="",this.Rs=null,this.Ns=!1,this.Hs=0,this.Us=!0,this.Gs=()=>{this.zs(),this.injectAllChat()},this.zs=()=>{for(const t of[this.ALLCHAT_CHATBOX_ROOT_ID,this.ALLCHAT_LIVECHAT_ROOT_ID,this.ALLCHAT_OPTIONS_ROOT_ID]){const e=document.getElementById(t);e&&e.remove()}},this.Ws=t=>{t?this.Qs():this.Ys()},this.Zs=()=>{const t=document.head||document.getElementsByTagName("head")[0],e=document.createElement("link");e.rel="stylesheet",e.href=chrome.runtime.getURL("css/all-chat.css"),t.appendChild(e);const i=document.createElement("link");i.rel="stylesheet",i.href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap",t.appendChild(i)},this.Js=()=>{if(0!=this.Hs){const t=Date.now()-this.Hs;R.C(new K(P,$,{name:"allchat_time_spent",allchat_usage:{time_spend:t}})),this.Hs=0}},this.Ks=()=>{const t=this.qs();t&&(t.innerHTML=""),this.Rs=null},this.Xs=t=>{this.eo=t,this.Rs="report";new _s({commentId:t,closeModal:this.Ks,removeMessage:this.io}).open(this.qs())},this.no=()=>xs(this,void 0,void 0,(function*(){try{const t=(yield this.Oi.getVideoDataAsync()).videoId,e=this.Oi.getStreamingServiceName();t&&e||console.error("Failed to get video info, live chat not loading");const i=yield ue(`comments?univKey=${e}%23${t}`,"GET",!1);this.so=i.comments.sort(((t,e)=>t.vidTime-e.vidTime)),console.log(this.so)}catch(t){console.error(t)}})),this.io=t=>{this.so&&(this.so=this.so.filter((e=>e.commentId!==t)))},this.oo=(t=5e3)=>xs(this,void 0,void 0,(function*(){if(!this.so||0===this.so.length)return null;const e=(yield this.Oi.getStateAsync()).playbackPositionMilliseconds;let i=null,n=1/0;for(const s of this.so){const o=e-s.vidTime;if(o>=0&&o<n&&o<=t&&(i=s,n=o),s.vidTime>e)break}return i})),this.ro=()=>{this.Rs="help";new ys({closeModal:this.Ks,toggleLiveChat:this.uo,getLiveChatShowing:()=>this.Ms}).open(this.qs())},this.ao=t=>{this.Rs="guidelines";new ms(t).open(this.qs()),this.co=t},this.ho=t=>{this.Rs="editProfile",this.lo={closeModal:this.Ks,onAuthUpdated:t};new Fs(this.lo).open(this.qs())},this.do=t=>{if(this.so){let e=!1;for(let i=0;i<this.so.length;i++)if(this.so[i].vidTime>=t.vidTime){this.so[i].vidTime===t.vidTime&&(this.so[i].vidTime-=1e-4),this.so.splice(i,0,t),e=!0;break}e||this.so.push(t)}else this.so=[t];this.Ms&&this.Do()},this.po=()=>{this.Rs="login";new bs({closeModal:this.Ks}).open(this.qs())},this.Do=()=>xs(this,void 0,void 0,(function*(){const t=yield this.vo();if(t.message)!function(t,e){if(e){e.innerHTML=Cs(t);const i=document.getElementById("tp-allchat-report-flag"),n=document.getElementById("tp-allchat-comment-help");i&&i.addEventListener("click",(e=>{e.stopPropagation(),t.onReportFlagClicked()})),n&&n.addEventListener("click",(e=>{e.stopPropagation(),t.openHelpModal()}))}}(t,this.fo()),t.commentId!=this.mo&&(this.mo=t.commentId);else{const t=this.fo();t&&(t.innerHTML="")}})),this.wo=()=>{this.Do(),this.Fo||(this.Fo=setInterval(this.Do,1e3))},this.yo=()=>{const t=this.fo();t&&(t.innerHTML=""),this.Fo&&(clearInterval(this.Fo),this.Fo=void 0)},this.Os=window.location.href,this.De=t,this.Oi=e,this.H=i,this.serviceName=n,this.Co=this.Co.bind(this),this.bo=this.bo.bind(this),this.Eo=this.Eo.bind(this),this._o=this._o.bind(this),this.vo=this.vo.bind(this),this.xo=this.xo.bind(this),this.ko=this.ko.bind(this),this.fo=this.fo.bind(this),this.qs=this.qs.bind(this),this.uo=this.uo.bind(this),this.Ys=this.Ys.bind(this),this.Qs=this.Qs.bind(this),this.Ao=this.Ao.bind(this),this.De.registerMenuStateChangeCallback(this.Ws),this.Ao(),this.no(),this.Bo(),this.Ms&&(this.Hs=Date.now()),window.addEventListener("pagehide",(()=>this.Js())),window.addEventListener("pageshow",(()=>{this.Ms&&0===this.Hs&&(this.Hs=Date.now())}))}xo(){return document.getElementById(this.ALLCHAT_OPTIONS_ROOT_ID)}ko(){return document.getElementById(this.ALLCHAT_CHATBOX_ROOT_ID)}fo(){return document.getElementById(this.ALLCHAT_LIVECHAT_ROOT_ID)}qs(){return document.getElementById(this.ALLCHAT_MODAL_ROOT_ID)}Qs(){this.Gs()}Ys(){this.Gs()}uo(){if(this.Ms=!this.Ms,localStorage.setItem("tpLiveChatShowing",this.Ms.toString()),Ln(this._o(),this.xo()),this.Ms)this.wo(),this.Hs=Date.now(),R.C(new K(P,$,{name:"allchat_toggled_on"}));else{this.yo(),this.Js(),R.C(new K(P,$,{name:"allchat_toggled_off"}));const t=this.ko();t&&(t.innerHTML="")}}bo(){this.$s=!0,(()=>{xs(this,void 0,void 0,(function*(){gs(yield this.Eo(),this.ko()),this.Ls&&(yield this.Oi.pause())}))})()}Co(){this.$s=!1,this.Ps="";const t=this.ko();t&&(t.innerHTML="")}_o(){return{toggleLiveChat:this.uo,showCreatePost:this.bo,liveChatShowing:this.Ms}}Bo(){return xs(this,void 0,void 0,(function*(){const t=yield R.C(new xn(P,$,"allchat-login-disabled"));this.Us=!t.hasFeature}))}vo(){return xs(this,void 0,void 0,(function*(){const t=yield this.oo();return t?{message:t.message,username:t.displayName,commentId:t.commentId,onReportFlagClicked:()=>this.Xs(t.commentId),openHelpModal:this.ro,flair:t.flair}:{}}))}Eo(){return xs(this,void 0,void 0,(function*(){const t=yield this.Oi.getVideoDataAsync(),e=this.Oi.getStreamingServiceName(),i=(yield this.Oi.getStateAsync()).playbackState===pe.PLAYING;return{onPostComment:this.do,openGuidelinesModal:this.ao,getStoredGuidelinesModalProps:()=>this.co,closeModal:this.Ks,videoControlProps:{pauseVideo:this.Oi.pause,playVideo:this.Oi.play,isVideoPlaying:()=>xs(this,void 0,void 0,(function*(){return(yield this.Oi.getStateAsync()).playbackState===pe.PLAYING})),shouldRender:!0},curComment:this.Ps,onCommentEdited:t=>{this.Ps=t},closeChatbox:this.Co,getVidTime:()=>xs(this,void 0,void 0,(function*(){return(yield this.Oi.getStateAsync()).playbackPositionMilliseconds})),service:e.toString(),vidId:t.videoId,vidDuration:t.videoDuration,openHelpModal:this.ro,openLoginModal:this.po,shouldPlayVideoAfterClose:i,openEditProfileModal:this.ho,loginRequired:this.Us}}))}Ao(){this.Io=setInterval((()=>{window.location.href!=this.Os&&(this.Os=window.location.href,this.no())}),100)}injectAllChat(){return xs(this,void 0,void 0,(function*(){const t=this.De.shouldMenuBeVisible();(yield this.So(t))?(this.Vs||(this.Zs(),this.Vs=!0),yield this.jo(t),Ln(this._o(),this.xo()),this.Ms&&this.wo(),this.$s&&gs(yield this.Eo(),this.ko()),"true"!==localStorage.getItem("allChatHelpModalSeen")&&(this.ro(),localStorage.setItem("allChatHelpModalSeen","true")),"help"==this.Rs?this.ro():"report"==this.Rs&&this.eo?this.Xs(this.eo):"login"==this.Rs?this.po():"guidelines"==this.Rs&&this.co?this.ao(this.co):"editProfile"==this.Rs&&this.lo&&this.ho(this.lo.onAuthUpdated),Ln(this._o(),this.xo()),this.Ms&&this.wo()):this.Ns||(this.Ns=!0,R.C(new K(P,$,{name:"allchat_page_invalid",message:{text:`{"serviceName": "${this.serviceName}", "url": "${window.location.href}"}`}})))}))}}var As=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};const Bs={[fe.NETFLIX.toString()]:class extends ks{constructor(){super(...arguments),this.To=!1,this.jo=t=>As(this,void 0,void 0,(function*(){if(An(this.ALLCHAT_MODAL_ROOT_ID,document.querySelector(".watch-video")),t){this.To=!0,yield ee(20)();const t=document.querySelector(".watch-video--flag-container"),e=document.querySelector(".watch-video--bottom-controls-container");e&&(this.$s&&(e.style.display="none"),An(this.ALLCHAT_CHATBOX_ROOT_ID,e.parentElement,"display: flex")),An(this.ALLCHAT_OPTIONS_ROOT_ID,t);const i=document.querySelector(".watch-video--back-container");i&&(i.setAttribute("style",i.getAttribute("style")+" flex-direction: column;"),An(this.ALLCHAT_LIVECHAT_ROOT_ID,i))}else{this.To=!1;const t=document.querySelector("[data-uia=player]");An(this.ALLCHAT_LIVECHAT_ROOT_ID,t,"padding: 20px;"),An(this.ALLCHAT_CHATBOX_ROOT_ID,t,"position: fixed; bottom: 0; left: 0; width: 100%")}})),this.Mo=t=>{const e=t.getBoundingClientRect();return{x:Math.random()*e.width+e.left,y:Math.random()*e.height+e.top}},this.$o=t=>{const{x:e,y:i}=this.Mo(t),n=new PointerEvent("pointermove",{bubbles:!0,cancelable:!0,clientX:e,clientY:i,pointerType:"mouse",view:window});t.dispatchEvent(n)}}So(t){return As(this,void 0,void 0,(function*(){return(t?["[data-uia=player]",".watch-video--flag-container",".watch-video--bottom-controls-container",".watch-video--back-container",".watch-video"]:["[data-uia=player]"]).every((t=>null!==document.querySelector(t)))}))}Vo(t){const e=document.querySelector(".watch-video--bottom-controls-container");e&&(e.style.display=t)}bo(){this.Vo("none"),super.bo()}Co(){this.Vo("block"),super.Co()}uo(){this.Vo("block"),super.uo()}Eo(){const t=Object.create(null,{Eo:{get:()=>super.Eo}});return As(this,void 0,void 0,(function*(){const e=yield t.Eo.call(this),i=document.querySelector("video");return i&&(e.videoControlProps.pauseVideo=()=>As(this,void 0,void 0,(function*(){i.pause()})),e.videoControlProps.playVideo=()=>As(this,void 0,void 0,(function*(){i.play()}))),e}))}_o(){return Object.assign(Object.assign({},super._o()),{containerStyling:"margin-left: 8px; top: 5px;"})}Po(){return null!=this.Rs||this.$s}Ao(){super.Ao(),this.Lo=setInterval((()=>{if(this.Po()&&this.To){const t=document.querySelector("[data-uia=player]");t&&this.$o(t)}}),500)}}};var Is=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class Ss{constructor(t,e,i,n,s=!1,o=""){this.H=t,this.Oi=e,this.mi=i,this.De=n,window.teleparty&&!window.teleparty.pageControls?(window.teleparty.pageControls=n,console.log("Setting Page COntrols")):(n.setChatApi(this.H),console.log("Resetting Chat Api for old controls")),this.Oo=new an(this.H,this.De),this.Ge=new _n(this.Oi,this.H,this.mi),this.Ro=!1,this.No=!1,this.ye=!1,this.yn=new on,this.yn.addMessageListener(this.Ge),this.yn.addMessageListener(this.Oo),this.yn.addMessageListener(this),this.Ho=!1,this.serviceName=o,s&&(this.Uo=function(t,e,i,n){return t?new Bs[t](e,i,n,t):void 0}(this.serviceName,this.De,this.Oi,this.H)),this.Go()}zo(){return Is(this,void 0,void 0,(function*(){yield this.De.addTpIcon(),this.De.startEventListener()}))}loadBrowseButton(){return Is(this,void 0,void 0,(function*(){yield this.De.addTpIcon(),this.De.startEventListener()}))}Go(){const t=chrome.runtime.connect();t.onDisconnect.addListener((()=>{if(this.Ge.isInParty()){console.log("Lost background script. Teardown");const t={showAlert:this.H.inSession,alertModal:kt};this.Wo(t)}})),t.onMessage.addListener((()=>{e("Got background script"),this.Ho=!0}));const i=()=>{console.log("Requesting ping"),t.postMessage({type:"ping"})},n=setInterval((()=>{this.Ho?clearInterval(n):i()}),3e3);i()}onMessage(t,e,i){if(t.target==P){if(t.type===Wi.IS_CONTENT_SCRIPT_READY){if(this.Ro){i({ready:!0})}else this.No=!0,this.Qo().then(i);return!0}if(t.type===Wi.IS_VIDEO_READY)return console.log("Checking if video is ready",!!this.Oi.getVideoElement()),i({hasVideo:!!this.Oi.getVideoElement()}),!0;if(t.type===Wi.GET_INIT_DATA){return i(this.Yo()),!0}if(t.type===Wi.DISCONNECT&&t.sender==V){const t=new J(P,$,It);R.C(t),i()}else{if(t.type==G.TEARDOWN){const e=t;return this.Wo(e.data),i(),!0}t.type===G.ON_NOTIF?this.Zo():t.type===G.GET_ALLCHAT_HAS_FOCUS&&i("true"===localStorage.getItem("allchat-has-focus"))}}return!1}Zo(){console.log("Show Notification")}Wo(t){var e,i,n;if(t.showAlert&&t.alertModal){const i=null!==(e=t.buttonUrl)&&void 0!==e?e:this.H.getPartyUrl();At(t.alertModal,i)}this.De.teardown(),this.Ge.teardown(),this.Oo.teardown(),this.yn.teardown(),this.mi.stopListening();const s={name:"error",action:{description:null===(i=t.alertModal)||void 0===i?void 0:i.title,reason:null===(n=t.alertModal)||void 0===n?void 0:n.content}},o=new K(P,$,s);R.C(o),window.teleparty&&(window.teleparty.contentScriptInjected=!1)&&(window.teleparty.contentScriptReady=!1)}be(t){if(t===_)return;const e=new K(P,$,{name:"error",action:{reason:t}});R.C(e)}Jo(){return Is(this,void 0,void 0,(function*(){return ie((()=>this.Ho),5e3)()}))}Qo(){return Is(this,void 0,void 0,(function*(){try{yield this.Jo();const t=yield this.Ko();return this.zo(),t}catch(t){const e={message:k,showButton:!1};return this.be(k),{ready:!1,error:e}}finally{this.No=!1}}))}Ko(){return Is(this,void 0,void 0,(function*(){let t;try{yield this.Oi.waitVideoApiReadyAsync();const i=yield this.qo();console.log("Got session response",i),i&&i.error?(e("Error is:",i.error),t={message:i.error,showButton:!0},this.Ro=!0,window.teleparty&&(window.teleparty.contentScriptReady=!0)):(i&&i.showReviewMessage&&(this.ye=!0),this.Ro=!0,window.teleparty&&(window.teleparty.contentScriptReady=!0)),this.Uo&&this.Uo.injectAllChat()}catch(e){t={message:e.message,showButton:!1},this.be(e.message)}return{ready:this.Ro,error:t}}))}Yo(){return{reactionsDisabled:this.H.sessionReactionsDisabled,userReactionsDisabled:this.H.userReactionsDisabled,inSession:this.H.inSession,isChatVisible:this.H.isPartyWindowsActive()?this.H.getChatWindowVisible():this.H.getChatVisible(),partyUrl:this.H.getPartyUrl(),showReviewMessage:!1,partyWindowsActive:this.H.isPartyWindowsActive()}}qo(){return Is(this,void 0,void 0,(function*(){const t=yield this.Xo();return R.C(t)}))}Xo(){return Is(this,void 0,void 0,(function*(){console.log("Getting session request data");const t={videoId:(yield this.Oi.getVideoDataAsync()).videoId};return new sn(P,$,t)}))}}var js=i(7076),Ts=i.n(js);class Ms extends Qi{constructor(t,e,i){super(t,e,Wi.RE_INJECT),this.data=i}}var $s=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class Vs{constructor(t,e){var i,n,s;this.tr=!1,this.er=!1,this.ir=!1,this.Gn=!1,this.nr=0,this.sr=!1,this.rr=!1,this.ur=!1,this.ar=!1,this.checkShowMenu=()=>{const t=this.shouldMenuBeVisible();t!=this.ar&&(this.ar=t,this.cr.forEach((e=>e(t)))),t&&!this.hr.getChatVisible()?this.lr():this.dr()},console.log("Teleparty Browse Loaded "+(null===(i=window.teleparty)||void 0===i?void 0:i.tabId)),this.Dr=new zi(new URL(window.location.href),null!==(s=null===(n=window.teleparty)||void 0===n?void 0:n.tabId)&&void 0!==s?s:0),this.hr=t,this.hr.setPageControls(this),this.cr=[],this.R=$t(e||"")}setChatApi(t){this.hr=t,this.hr.setPageControls(this)}registerMenuStateChangeCallback(t){this.cr.push(t)}getReactionsDisabled(){return this.Gn}pr(){this.R("#tp-control-lock-button .tooltiptext").text(this.ir?"Only I have control":"Everyone has control"),this.ir?(this.R("#tp-unlocked-image").addClass("hidden"),this.R("#tp-locked-image").removeClass("hidden")):(this.R("#tp-unlocked-image").removeClass("hidden"),this.R("#tp-locked-image").addClass("hidden"))}vr(){this.er||(this.ir=!this.ir,this.pr())}setResetChatButton(){this.hr.getChatWindowVisible()?(this.R("#tp-chat-button .tooltiptext").text("Reset View"),this.hr.shouldReturnToVideo&&this.R("#tp-chat-button .tooltiptext").text("Return to Video"),this.R("#tp-chat-reset").removeClass("hidden"),this.R("#tp-chat-gray").addClass("hidden"),this.R("#tp-chat-button .tp-hover-image").addClass("hidden"),this.R("#tp-chat-hidden").addClass("hidden")):(this.R("#tp-chat-button .tooltiptext").text("Open Chat"),this.R("#tp-chat-reset").addClass("hidden"),this.R("#tp-chat-gray").removeClass("hidden"),this.R("#tp-chat-button .tp-hover-image").removeClass("hidden"),this.R("#tp-chat-hidden").removeClass("hidden"))}gr(){this.R("#tp-chat-hidden").addClass("hidden"),this.hr.isPartyWindowsActive()?(this.setResetChatButton(),this.R("#tp-message-indicator").removeClass("hidden")):(this.R("#tp-message-indicator").removeClass("hidden"),this.R("#tp-chat-button .tooltiptext").text(`${this.nr} unread ${1==this.nr?"message":"messages"}`),this.R("#tp-chat-gray").removeClass("hidden"),this.R("#tp-chat-reset").addClass("hidden"),this.R("#tp-chat-button .tp-hover-image").removeClass("hidden"))}hideMessageIndicator(){this.R("#tp-message-indicator").addClass("hidden"),this.hr.isPartyWindowsActive()?this.setResetChatButton():(this.R("#tp-chat-button .tp-hover-image").removeClass("hidden"),this.R("#tp-chat-button .tooltiptext").text("Show chat"),this.R("#tp-chat-gray").addClass("hidden"),this.R("#tp-chat-hidden").removeClass("hidden"),this.R("#tp-chat-reset").addClass("hidden"))}onChatMessage(){this.hr.shouldChatBeVisible()||this.hr.isPartyWindowsActive()||(this.nr++,this.gr(),this.sr=!0,this.lr(),ee(1e3)().then((()=>{this.sr=!1})))}teardown(){this.mr(),this.dr(),this.wr&&clearInterval(this.wr)}Fr(){var t;return $s(this,void 0,void 0,(function*(){if(this.er||this.hr.inSession)return;if(this.yr(),this.er=!0,!(null===(t=window.teleparty)||void 0===t?void 0:t.contentScriptInjected)){console.log("Re injecting");const t=new Ms(L,$,{extensionTabData:this.Dr});try{yield R.C(t)}catch(t){return console.log(t),this.Cr(),this.be(t),this.br(A),void(this.er=!1)}}console.log("Sending create");const e=this.Er();try{const t=yield R.C(e);t.error?(this.br(t.error.message),this.be(t.error.message)):(this.er=!1,this._r(),this.enablePartyIcons())}catch(t){console.log(t),this.br(A),this.be(t)}this.Cr(),this.er=!1}))}enablePartyIcons(){this.hideError(),this.R("#tp-party-active").removeClass("hidden"),this.R("#tp-party-inactive").addClass("hidden"),this.R("#tp-icon-container .tooltiptext").addClass("hidden"),this.R("#tp-icon-container").attr("style","cursor: auto")}mr(){this.R("#tp-party-active").addClass("hidden"),this.R("#tp-party-inactive").removeClass("hidden"),this.R("#tp-icon-container .tooltiptext").html("Open Teleparty"),this.R("#tp-icon-container").removeClass("play-chat-active"),this.R("#play-chat-icon").addClass("hidden"),this.R("#tp-icon-white").removeClass("hidden")}be(t){const e=new K(V,$,{name:"error",action:{description:"an error has occured",reason:t}});R.C(e)}br(t){this.R("#tp-controls-error-text").text(t),this.R("#tp-error-box").removeClass("hidden"),this.R("#tp-icon-container .tooltiptext").addClass("hidden")}hideError(){this.R("#tp-error-box").addClass("hidden")}kr(t){return t.replace(/{EXTENSION_LOGO_WHITE}/g,b(chrome.runtime.getURL("img/icon_white.svg"))).replace(/{EXTENSION_LOGO_GRADIENT}/g,b(chrome.runtime.getURL("img/icon_gradient.svg"))).replace(/{PLAY_IMAGE}/g,b(chrome.runtime.getURL("img/play.svg"))).replace(/{UNLOCKED_IMAGE}/g,b(chrome.runtime.getURL("img/icon_remote_inactive.svg"))).replace(/{LOCKED_IMAGE}/g,b(chrome.runtime.getURL("img/icon_remote_active.svg"))).replace(/{ARROW_RIGHT}/g,b(chrome.runtime.getURL("img/arrow-right.svg"))).replace(/{LINK_IMAGE}/g,b(chrome.runtime.getURL("img/icon_link_inactive.svg"))).replace(/{LINK_ACTIVE_IMAGE}/g,b(chrome.runtime.getURL("img/icon_link_active.svg"))).replace(/{CHAT_HIDDEN_IMAGE}/g,b(chrome.runtime.getURL("img/icon_chat_inactive.svg"))).replace(/{CHAT_GRAY_IMAGE}/g,b(chrome.runtime.getURL("img/icon_chatgray_active.svg"))).replace(/{CHAT_ACTIVE_IMAGE}/g,b(chrome.runtime.getURL("img/icon_chat_active.svg"))).replace(/{DISCONNECT_IMAGE}/g,b(chrome.runtime.getURL("img/icon_logout_active.svg"))).replace(/{RESET_CHAT_IMAGE}/g,b(chrome.runtime.getURL("img/reset_chat.svg")))}dr(){this.sr||(this.hideError(),this.R("#tpIconContainer").addClass("hidden"))}lr(){return $s(this,void 0,void 0,(function*(){if(!this.rr&&(this.ur||this.hr.inSession)){this.rr=!0;try{yield this.addTpIcon(),this.hr.inSession?this.enablePartyIcons():this.mr(),this.R("#tpIconContainer").removeClass("hidden"),this.setChatButtons()}finally{this.rr=!1}}}))}startEventListener(){this.wr=setInterval(this.checkShowMenu,200)}stopEventListener(){this.wr&&clearInterval(this.wr)}Ar(){return"100px"}addTpIcon(){return $s(this,void 0,void 0,(function*(){if((this.ur||this.hr.inSession)&&0===this.R("#tpIconContainer").length){const t=this.kr(Ts()),e=yield this.getControlsRoot();e.length>0&&(e.append(function(t,e=""){return`\n    <link rel="stylesheet" href="${chrome.runtime.getURL("css/overlay.css")}">\n    <style>\n      ${e}\n    </style>\n    ${t}\n  `}(t)),this.Br())}}))}Br(){this.R("#tp-control-lock-button").click(this.vr.bind(this)),this.R("#tp-buttons-container").attr("style",`top:${this.Ar()}`),this.R("#tp-chat-close-button").attr("style",`top:${this.Ar()}`),this.R("#tp-error-box").attr("style",`top:${this.Ar()}`),this.R("#tp-link-button").click(this.Ir.bind(this)),this.R("#tp-chat-button").on("click",(t=>(this.Sr(),t.stopImmediatePropagation(),t.stopPropagation(),!1))),this.R("#tp-disconnect-button").on("click",(()=>{this.jr()}))}jr(){const t=new J(L,$,It);R.C(t),this.dr()}Ir(){this.hr.linkIconListener(),this.R("#tp-link-button .tooltiptext").text("Link copied"),setTimeout((()=>{this.R("#tp-link-button .tooltiptext").text("Copy join link")}),1e3)}Sr(){return $s(this,void 0,void 0,(function*(){this.nr=0,this.hideMessageIndicator(),this.hr.isPartyWindowsActive()?this.hr.resetChatWindow(!0):(yield this.hr.setChatVisible(!this.hr.shouldChatBeVisible()),this.setChatButtons())}))}onInitChat(){this.tr&&this.lr()}setChatButtons(){this.hr.inSession&&this.hr.getChatVisible()?this._r():this.Tr(),this.hr.isPartyWindowsActive()?this.setResetChatButton():this.hideMessageIndicator()}_r(){return $s(this,void 0,void 0,(function*(){this.hr.inSession&&this.hr.shouldChatBeVisible()&&(this.R("#tp-chat-close-button").removeClass("hidden"),this.R("#tp-buttons-container").addClass("hidden"))}))}Tr(){this.R("#tp-chat-close-button").addClass("hidden"),this.R("#tp-buttons-container").removeClass("hidden")}Er(){return new Yi(L,$,this.Mr())}Mr(){return{createSettings:{controlLock:this.ir,reactionsDisabled:this.Gn},streamingService:this.Dr.streamingService,tabId:this.Dr.id,source:"pc"}}yr(){this.R("#tp-icon-container .tooltiptext").html('Loading <span class="ellipsis-anim"><span>.</span><span>.</span><span>.</span></span>')}Cr(){this.R("#tp-icon-container .tooltiptext").html("Start a party")}}var Ps=function(t,e,i,n){return new(i||(i=Promise))((function(s,o){function r(t){try{a(n.next(t))}catch(t){o(t)}}function u(t){try{a(n.throw(t))}catch(t){o(t)}}function a(t){var e;t.done?s(t.value):(e=t.value,e instanceof i?e:new i((function(t){t(e)}))).then(r,u)}a((n=n.apply(t,e||[])).next())}))};class Ls extends Vs{constructor(){super(...arguments),this.ci=new xe("ext:ContentScripts:Amazon:AmazonPageControls")}ni(){const t=document.querySelectorAll(".webPlayerSDKContainer");let e=jQuery(".webPlayerSDKContainer").last();if([...t].forEach((t=>{var i;(null===(i=t.querySelector("video"))||void 0===i?void 0:i.src)&&(e=jQuery(t))})),e.length>0)return e;const i=document.querySelector(".atvwebplayersdk-player-container");if(i)return jQuery(i);const n=document.querySelector(".atvwebplayersdk-video-surface");return n?jQuery(n):e}getControlsRoot(){return Ps(this,void 0,void 0,(function*(){return yield ie(this.$r,1/0)(),this.ci.debug({methodName:"getControlsRoot",message:"found player page"}),this.ni()}))}shouldMenuBeVisible(){const t=document.querySelector(".atvwebplayersdk-hideabletopbuttons-container");return null!=t&&!t.classList.contains("hide")}$r(){return!!window.location.href.includes("?autoplay")||(null!=document.querySelector(".rendererContainer video")||null!=document.querySelector(".atvwebplayersdk-video-surface video"))&&null!=document.querySelector(".dv-player-fullscreen")}}class Os extends Ss{constructor(){const t=new De,e=new Ae,i=new nn(e,t),n=new xe("ext:ContentScripts:Amazon:AmazonContentScript");let s;window.teleparty&&window.teleparty.pageControls?(s=window.teleparty.pageControls,console.log("Using AmazonPageControls page controls")):s=new Ls(t),super(t,e,i,s),n.debug({methodName:"constructor",message:"Initialize Amazon Content Script"})}}const Rs=new xe("ext:ContentScripts:Amazon:AmazonContent");(function(){var t;return!window.teleparty||!(null===(t=window.teleparty)||void 0===t?void 0:t.contentScriptInjected)})()&&(window.teleparty||(window.teleparty={}),window.teleparty.contentScriptInjected=!0,new Os,Rs.debug({message:"Initialized content script"}))})()})();