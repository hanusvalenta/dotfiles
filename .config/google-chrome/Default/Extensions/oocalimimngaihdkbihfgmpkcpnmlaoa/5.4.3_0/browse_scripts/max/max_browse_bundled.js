/*******************************************************
* Copyright (C) 2018-2024 WP Interactive Media, Inc. - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
*******************************************************/
(()=>{var e={7588:()=>{!function(e,n,i){"use strict";if(e.MutationObserver&&"undefined"!=typeof HTMLElement){var t,o=0,r=(t=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector,{matchesSelector:function(e,n){return e instanceof HTMLElement&&t.call(e,n)},addMethod:function(e,n,i){var t=e[n];e[n]=function(){return i.length==arguments.length?i.apply(this,arguments):"function"==typeof t?t.apply(this,arguments):void 0}},callCallbacks:function(e,n){n&&n.options.onceOnly&&1==n.firedElems.length&&(e=[e[0]]);for(var i,t=0;i=e[t];t++)i&&i.callback&&i.callback.call(i.elem,i.elem);n&&n.options.onceOnly&&1==n.firedElems.length&&n.me.unbindEventWithSelectorAndCallback.call(n.target,n.selector,n.callback)},checkChildNodesRecursively:function(e,n,i,t){for(var o,a=0;o=e[a];a++)i(o,n,t)&&t.push({callback:n.callback,elem:o}),o.childNodes.length>0&&r.checkChildNodesRecursively(o.childNodes,n,i,t)},mergeArrays:function(e,n){var i,t={};for(i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);for(i in n)n.hasOwnProperty(i)&&(t[i]=n[i]);return t},toElementsArray:function(n){return void 0===n||"number"==typeof n.length&&n!==e||(n=[n]),n}}),a=function(){var e=function(){this.i=[],this.t=null,this.o=null};return e.prototype.addEvent=function(e,n,i,t){var o={target:e,selector:n,options:i,callback:t,firedElems:[]};return this.t&&this.t(o),this.i.push(o),o},e.prototype.removeEvent=function(e){for(var n,i=this.i.length-1;n=this.i[i];i--)if(e(n)){this.o&&this.o(n);var t=this.i.splice(i,1);t&&t.length&&(t[0].callback=null)}},e.prototype.beforeAdding=function(e){this.t=e},e.prototype.beforeRemoving=function(e){this.o=e},e}(),s=function(n,t){var o=new a,s=this,c={fireOnAttributesModification:!1};return o.beforeAdding((function(i){var o,r=i.target;r!==e.document&&r!==e||(r=document.getElementsByTagName("html")[0]),o=new MutationObserver((function(e){t.call(this,e,i)}));var a=n(i.options);o.observe(r,a),i.observer=o,i.me=s})),o.beforeRemoving((function(e){e.observer.disconnect()})),this.bindEvent=function(e,n,i){n=r.mergeArrays(c,n);for(var t=r.toElementsArray(this),a=0;a<t.length;a++)o.addEvent(t[a],e,n,i)},this.unbindEvent=function(){var e=r.toElementsArray(this);o.removeEvent((function(n){for(var t=0;t<e.length;t++)if(this===i||n.target===e[t])return!0;return!1}))},this.unbindEventWithSelectorOrCallback=function(e){var n,t=r.toElementsArray(this),a=e;n="function"==typeof e?function(e){for(var n=0;n<t.length;n++)if((this===i||e.target===t[n])&&e.callback===a)return!0;return!1}:function(n){for(var o=0;o<t.length;o++)if((this===i||n.target===t[o])&&n.selector===e)return!0;return!1},o.removeEvent(n)},this.unbindEventWithSelectorAndCallback=function(e,n){var t=r.toElementsArray(this);o.removeEvent((function(o){for(var r=0;r<t.length;r++)if((this===i||o.target===t[r])&&o.selector===e&&o.callback===n)return!0;return!1}))},this},c=new function(){var e={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};function n(e,n,t){return!(!r.matchesSelector(e,n.selector)||(e.u===i&&(e.u=o++),-1!=n.firedElems.indexOf(e.u)))&&(n.firedElems.push(e.u),!0)}var t=(c=new s((function(e){var n={attributes:!1,childList:!0,subtree:!0};return e.fireOnAttributesModification&&(n.attributes=!0),n}),(function(e,i){e.forEach((function(e){var t=e.addedNodes,o=e.target,a=[];null!==t&&t.length>0?r.checkChildNodesRecursively(t,i,n,a):"attributes"===e.type&&n(o,i,a)&&a.push({callback:i.callback,elem:o}),r.callCallbacks(a,i)}))}))).bindEvent;return c.bindEvent=function(n,i,o){void 0===o?(o=i,i=e):i=r.mergeArrays(e,i);var a=r.toElementsArray(this);if(i.existing){for(var s=[],c=0;c<a.length;c++)for(var u=a[c].querySelectorAll(n),m=0;m<u.length;m++)s.push({callback:o,elem:u[m]});if(i.onceOnly&&s.length)return o.call(s[0].elem,s[0].elem);setTimeout(r.callCallbacks,1,s)}t.call(this,n,i,o)},c},u=new function(){var e={};function n(e,n){return r.matchesSelector(e,n.selector)}var i=(u=new s((function(){return{childList:!0,subtree:!0}}),(function(e,i){e.forEach((function(e){var t=e.removedNodes,o=[];null!==t&&t.length>0&&r.checkChildNodesRecursively(t,i,n,o),r.callCallbacks(o,i)}))}))).bindEvent;return u.bindEvent=function(n,t,o){void 0===o?(o=t,t=e):t=r.mergeArrays(e,t),i.call(this,n,t,o)},u};n&&p(n.fn),p(HTMLElement.prototype),p(NodeList.prototype),p(HTMLCollection.prototype),p(HTMLDocument.prototype),p(Window.prototype);var m={};return l(c,m,"unbindAllArrive"),l(u,m,"unbindAllLeave"),m}function l(e,n,i){r.addMethod(n,i,e.unbindEvent),r.addMethod(n,i,e.unbindEventWithSelectorOrCallback),r.addMethod(n,i,e.unbindEventWithSelectorAndCallback)}function p(e){e.arrive=c.bindEvent,l(c,e,"unbindArrive"),e.leave=u.bindEvent,l(u,e,"unbindLeave")}}(window,"undefined"==typeof jQuery?null:jQuery,void 0)}},n={};function i(t){var o=n[t];if(void 0!==o)return o.exports;var r=n[t]={exports:{}};return e[t](r,r.exports,i),r.exports}(()=>{"use strict";var e,n;function t(e){return function(){return new Promise((n=>{setTimeout((()=>{n()}),e)}))}}function o(e){const n=document.createElement("script");n.setAttribute("tpInjected",""),n.src=e,(document.head||document.documentElement).appendChild(n),n.remove()}!function(e){e.REGISTER="register",e.PARTY_START="party_start",e.PARTY_JOIN="party_join",e.PARTY_END="party_end",e.PARTY_SHARE="party_share"}(e||(e={})),function(e){e.NETFLIX="Netflix",e.HULU="Hulu",e.DISNEY_PLUS="Disney",e.DISNEY_PLUS_MENA="DisneyMena",e.HBO_MAX="HBOMax",e.MAX="Max",e.YOUTUBE="Youtube",e.YOUTUBE_TV="YoutubeTV",e.AMAZON="Amazon",e.CRUNCHYROLL="Crunchyroll",e.ESPN="ESPN+",e.PARAMOUNT="Paramount+",e.FUNIMATION="Funimation",e.HOTSTAR="Hotstar",e.PEACOCK="Peacock TV",e.STAR_PLUS="Starplus",e.PLUTO_TV="PlutoTV",e.APPLE_TV="AppleTV",e.JIO_CINEMA="JioCinema",e.TUBI_TV="TubiTV",e.MUBI="Mubi",e.STAN="Stan",e.CRAVE="Crave",e.SLING="Sling",e.FUBO="Fubo",e.VIKI="Viki",e.SPOTIFY="Spotify",e.ZEE5="Zee5",e.SONY_LIV="SonyLiv",e.UNEXT="U-Next",e.HULU_JP="Hulu Japan",e.WILLOW="Willow",e.CANALPLUS="Canal+",e.FANCODE="Fancode",e.SHAHID="Shahid",e.VIU="Viu"}(n||(n={}));const r="Service_Background",a="Popup",s="Content_Script";var c;!function(e){e[e.CHROME=1]="CHROME",e[e.FIREFOX=2]="FIREFOX",e[e.EDGE=4]="EDGE",e[e.SAFARI=8]="SAFARI"}(c||(c={}));c.CHROME;const u=chrome.runtime.id,m=(chrome.runtime.getManifest().version,"redirectDataMap");var l=console.log.bind(self.console),p=function(e,n,i,t){return new(i||(i=Promise))((function(o,r){function a(e){try{c(t.next(e))}catch(e){r(e)}}function s(e){try{c(t.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,s)}c((t=t.apply(e,n||[])).next())}))};const g=new class{addListener(e){chrome.runtime.onMessage.addListener(e)}removeListener(e){chrome.runtime.onMessage.removeListener(e)}sendMessageToTabAsync(e,n,i=2e4){return p(this,void 0,void 0,(function*(){return new Promise(((t,o)=>{const r=setTimeout((()=>{console.log("send timeout"),o("Message Timeout")}),i);try{chrome.tabs.sendMessage(n,e,(n=>{chrome.runtime.lastError&&l(chrome.runtime.lastError.message+JSON.stringify(e)),clearTimeout(r),t(n)}))}catch(e){clearTimeout(r),o(e)}}))}))}m(e,n){return p(this,void 0,void 0,(function*(){return new Promise(((i,t)=>{let o=null;n&&(o=setTimeout((()=>{t({error:"Send Message Timeout"})}),n));try{chrome.runtime.sendMessage(u,e,(n=>{chrome.runtime.lastError&&console.log(chrome.runtime.lastError.message+JSON.stringify(e)),o&&clearTimeout(o),i(n)}))}catch(e){o&&clearTimeout(o),t(e)}}))}))}};class d{constructor(){this.l=this.p.bind(this),this.v=[],this.h()}addMessageListener(e){this.v.push(e)}removeMessageListener(e){this.v=this.v.filter((e=>{}))}h(){g.addListener(this.l)}teardown(){this.v=[],g.removeListener(this.l)}p(e,n,i){if(!this._(e))return!1;return!!this.S(e,n,i)||(i({}),!1)}_(e){return e.target===s}S(e,n,i){let t=!1;return this.v.forEach((o=>{o.onMessage(e,n,i)&&(t=!0)})),t}}var v,h;i(7588);!function(e){e.CREATE_SESSION="createSession",e.RE_INJECT="reInject",e.GET_INIT_DATA="getInitData",e.GET_INIT_USER_SETTINGS="getInitUserSettings",e.IS_CONTENT_SCRIPT_READY="isContentScriptReady",e.IS_VIDEO_READY="isVideoReady",e.CHANGE_FIREBASE_PASSWORD="changeFirebasePassword",e.SET_CHAT_VISIBLE="setChatVisible",e.SET_USER_REACTIONS_DISABLED="setUserReactionsDisabled",e.DISCONNECT="teardown",e.CLOSE_POPUP="closePopup",e.GET_SCHEDULED_EVENTS="getScheduledEvents",e.GET_RECENT_SCHEDULED_EVENTS="getRecentScheduledEvents",e.GOOGLE_SIGN_IN="googleSignIn",e.EMAIL_SIGN_IN="emailSignIn",e.FORGOT_PASSWORD="forgotPassword",e.EMAIL_SIGN_UP="emailSignUp",e.ON_GOOGLE_SIGN_IN="OnGoogleSignIn",e.CREATE_SCHEDULED_EVENT="createScheduledEvent",e.DELETE_SCHEDULED_EVENT="deleteScheduledEvent",e.SET_USER_STATUS="SET_USER_STATUS",e.SIGN_IN_CREATE="SIGN_IN_CREATE",e.REDIRECT_DATA_SET="redirectDataSet",e.LOAD_REDIRECT_URL_FINISHED="loadRedirectUrlFinished",e.RESET_PASSWORD="resetPassword"}(v||(v={}));class f{constructor(e,n,i){this.sender=e,this.target=n,this.type=i}}class w extends f{constructor(e,n,i){super(e,n,i),this.type=i}}class y extends w{constructor(e,n){super(e,n,v.GET_INIT_USER_SETTINGS)}}!function(e){e.NETFLIX="netflix",e.HULU="hulu",e.DISNEY_PLUS="disney",e.STAR_PLUS="starplus",e.AMAZON="amazon",e.YOUTUBE="youtube",e.HBO_MAX="hbomax",e.MAX="max",e.FUBO="fubo",e.CRUNCHYROLL="crunchyroll",e.PARAMOUNT="paramount",e.PEACOCK="peacock",e.HOTSTAR="hotstar",e.DISNEY_PLUS_MENA="disneymena",e.APPLE_TV="appletv",e.PLUTO_TV="plutotv",e.FUNIMATION="funimation",e.TUBI_TV="tubitv",e.JIO_CINEMA="jiocinema",e.MUBI="mubi",e.CRAVE="crave",e.STAN="stan",e.SONY_LIV="sonyliv",e.ZEE5="zee5",e.HULU_JP="hulujp",e.UNEXT="unext",e.GLOBOPLAY="globoplay",e.WILLOW="willow",e.FANCODE="fancode",e.CANALPLUS="canalplus",e.SHAHID="shahid",e.RTL="rtl",e.ESPN="espn",e.SLING="sling",e.VIKI="viki",e.SPOTIFY="spotify",e.SHOWTIME="showtime",e.AMC_PLUS="amcplus",e.VIU="viu"}(h||(h={}));const b=[{domains:[".netflix."],serverName:h.NETFLIX,name:n.NETFLIX,homepage:"https://netflix.com",premium:!1,iconUrl:"/img/service_logos/netflix.svg",popularity:64184.49597},{domains:[".disneyplus."],serverName:h.DISNEY_PLUS,name:n.DISNEY_PLUS,homepage:"https://disneyplus.com",premium:!1,iconUrl:"/img/service_logos/disney.svg",popularity:7139.926064},{domains:[".hbomax.",".max."],serverName:h.HBO_MAX,name:n.HBO_MAX,homepage:"https://play.max.com",premium:!1,iconUrl:"/img/service_logos/max.svg",popularity:8070.383044},{domains:[".hulu."],serverName:h.HULU,name:n.HULU,homepage:"https://hulu.com",premium:!1,iconUrl:"/img/service_logos/hulu.svg",popularity:1854.542783},{domains:[".amazon.",".primevideo."],serverName:h.AMAZON,name:n.AMAZON,homepage:"https://www.amazon.com/Amazon-Video/b?ie=UTF8&node=2858778011",premium:!1,iconUrl:"/img/service_logos/prime.svg",popularity:3003.498061},{domains:[".youtube."],serverName:h.YOUTUBE,name:n.YOUTUBE,homepage:"https://youtube.com",premium:!1,iconUrl:"/img/service_logos/youtube.svg",popularity:4812.704642},{domains:[".paramountplus."],serverName:h.PARAMOUNT,name:n.PARAMOUNT,homepage:"https://www.paramountplus.com/",premium:!0,notificationBannerImage:"img/paramount_banner.png",iconUrl:"/img/service_logos/paramount.svg",popularity:130.809939},{domains:[".peacocktv."],serverName:h.PEACOCK,name:n.PEACOCK,homepage:"https://www.peacocktv.com/",premium:!0,notificationBannerImage:"img/peacock_banner.png",iconUrl:"/img/service_logos/peacock.svg",popularity:193.353472},{domains:[".crunchyroll."],serverName:h.CRUNCHYROLL,name:n.CRUNCHYROLL,homepage:"https://beta.crunchyroll.com",premium:!0,notificationBannerImage:"img/crunch_banner.png",iconUrl:"/img/service_logos/crunchyroll.svg",popularity:634.02917},{domains:[".fubo.tv"],serverName:h.FUBO,name:n.FUBO,homepage:"https://www.fubo.tv/",premium:!0,notificationBannerImage:"img/fubo_banner.png",iconUrl:"/img/service_logos/fubo.svg",popularity:0},{domains:[".espn."],serverName:h.ESPN,name:n.ESPN,homepage:"https://plus.espn.com/",premium:!0,notificationBannerImage:"img/espn_banner.png",iconUrl:"/img/service_logos/espnplus.svg",popularity:0},{domains:[".hotstar."],serverName:h.HOTSTAR,name:n.HOTSTAR,homepage:"https://www.hotstar.com/",premium:!0,notificationBannerImage:"img/hotstar_banner.png",iconUrl:"/img/service_logos/jiohotstar.svg",popularity:52.29375},{domains:["tv.apple."],serverName:h.APPLE_TV,name:n.APPLE_TV,homepage:"https://tv.apple.com",premium:!0,notificationBannerImage:"img/apple_tv_banner.png",iconUrl:"/img/service_logos/appletv.svg",popularity:13.574957},{domains:["tubitv.com"],serverName:h.TUBI_TV,name:n.TUBI_TV,homepage:"https://tubitv.com",premium:!1,notificationBannerImage:"img/tubi_tv_banner.png",iconUrl:"/img/service_logos/tubi.svg",popularity:223.183048},{domains:[".sling."],serverName:h.SLING,name:n.SLING,homepage:"https://watch.sling.com/",premium:!0,notificationBannerImage:"img/sling_banner.png",iconUrl:"/img/service_logos/sling.svg",popularity:0},{domains:["pluto."],serverName:h.PLUTO_TV,name:n.PLUTO_TV,homepage:"https://www.pluto.tv",premium:!1,notificationBannerImage:"img/pluto_tv_banner.png",iconUrl:"/img/service_logos/pluto.svg",popularity:0},{domains:["mubi."],serverName:h.MUBI,name:n.MUBI,homepage:"https://mubi.com",premium:!0,notificationBannerImage:"img/mubi_banner.png",iconUrl:"/img/service_logos/mubi.svg",popularity:0},{domains:["stan."],serverName:h.STAN,name:n.STAN,homepage:"https://play.stan.com.au/",premium:!0,notificationBannerImage:"img/stan_banner.png",iconUrl:"/img/service_logos/stan.svg",popularity:0},{domains:[".crave."],serverName:h.CRAVE,name:n.CRAVE,homepage:"https://crave.ca",premium:!0,notificationBannerImage:"img/crave_banner.png",iconUrl:"/img/service_logos/crave.svg",popularity:0},{domains:[".viki."],serverName:h.VIKI,name:n.VIKI,homepage:"https://www.viki.com/",premium:!0,notificationBannerImage:"img/viki_banner.png",iconUrl:"/img/service_logos/viki.svg",popularity:0},{domains:[".spotify."],serverName:h.SPOTIFY,name:n.SPOTIFY,homepage:"https://open.spotify.com/",premium:!1,iconUrl:"/img/service_logos/spotify.svg",popularity:0},{domains:[".zee5."],serverName:h.ZEE5,name:n.ZEE5,homepage:"https://www.zee5.com/",premium:!0,notificationBannerImage:"img/zee5_banner.png",iconUrl:"/img/service_logos/zee5.svg",popularity:0},{domains:[".sonyliv."],serverName:h.SONY_LIV,name:n.SONY_LIV,homepage:"https://www.sonyliv.com/",premium:!0,notificationBannerImage:"img/sonyliv_banner.png",iconUrl:"/img/service_logos/sonyliv.svg",popularity:0},{domains:[".willow."],serverName:h.WILLOW,name:n.WILLOW,homepage:"https://www.willow.tv/",premium:!0,iconUrl:"/img/service_logos/willow.svg",popularity:0},{domains:[".fancode."],serverName:h.FANCODE,name:n.FANCODE,homepage:"https://www.fancode.com/",premium:!0,notificationBannerImage:"img/fancode_banner.png",iconUrl:"/img/service_logos/fancode.svg",popularity:0},{domains:[".canalplus."],serverName:h.CANALPLUS,name:n.CANALPLUS,homepage:"https://www.canalplus.com/",premium:!0,notificationBannerImage:"img/canalplus_banner.png",iconUrl:"/img/service_logos/canalplus.svg",popularity:0,disabled:!1},{domains:["shahid."],serverName:h.SHAHID,name:n.SHAHID,homepage:"https://shahid.mbc.net/",premium:!0,notificationBannerImage:"img/shahid_banner.png",iconUrl:"/img/service_logos/shahid.svg",popularity:0},{domains:[".viu."],serverName:h.VIU,name:n.VIU,homepage:"https://www.viu.com/",premium:!0,notificationBannerImage:"img/viu_banner.png",iconUrl:"/img/service_logos/viu.svg",popularity:0},{domains:[".unext."],serverName:h.UNEXT,name:n.UNEXT,homepage:"https://video.unext.jp/",premium:!0,notificationBannerImage:"img/unext_banner.png",iconUrl:"/img/service_logos/unext.svg",popularity:0},{domains:[".hulu.jp"],serverName:h.HULU_JP,name:n.HULU_JP,homepage:"https://www.hulu.jp/",premium:!0,notificationBannerImage:"img/hulujp_banner.png",iconUrl:"/img/service_logos/hulujp.svg",popularity:0},{domains:[".showtime."],serverName:h.SHOWTIME,disabled:!0,premium:!0,iconUrl:"",popularity:0},{domains:[".amcplus."],serverName:h.AMC_PLUS,disabled:!0,premium:!0,iconUrl:"",popularity:0},{domains:[".funimation."],serverName:h.FUNIMATION,name:n.FUNIMATION,disabled:!0,premium:!0,iconUrl:"",popularity:0},{domains:[".starplus."],serverName:h.STAR_PLUS,name:n.STAR_PLUS,homepage:"https://www.starplus.com/",premium:!0,disabled:!0,notificationBannerImage:"img/starplus_banner.png",iconUrl:"/img/service_logos/starplus.svg",popularity:0},{domains:[".jiocinema."],serverName:h.JIO_CINEMA,name:n.JIO_CINEMA,homepage:"https://www.jiocinema.com",premium:!0,notificationBannerImage:"img/jiocinema_banner.png",disabled:!0,iconUrl:"/img/service_logos/jiocinema.svg",popularity:0}].filter((e=>!e.disabled)),_=(b.flatMap((e=>e.domains)),b.filter((e=>e.notificationBannerImage)).flatMap((e=>e.domains)),b.filter((e=>e.premium)).map((e=>e.serverName))),S="Failed to read chrome storage. Please refresh the page and try again";var N=function(e,n,i,t){return new(i||(i=Promise))((function(o,r){function a(e){try{c(t.next(e))}catch(e){r(e)}}function s(e){try{c(t.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,s)}c((t=t.apply(e,n||[])).next())}))};const T=new class{getItemAsync(e){var n;return N(this,void 0,void 0,(function*(){const i=yield chrome.storage.local.get(e);return null!==(n=i[e])&&void 0!==n?n:null}))}getItemsAsync(e){return N(this,void 0,void 0,(function*(){return new Promise(((n,i)=>{chrome.storage.local.get(e,(e=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError),i(new Error(S))):n(e)}))}))}))}getStorageUse(){return N(this,void 0,void 0,(function*(){return new Promise(((e,n)=>{chrome.storage.local.getBytesInUse(null,(i=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError),n(new Error(S))):e(i)}))}))}))}getAllItemsAsync(){return N(this,void 0,void 0,(function*(){return new Promise(((e,n)=>{chrome.storage.local.get(null,(i=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError),n(new Error(S))):e(i)}))}))}))}};Object.freeze(T);const P=T;var U=function(e,n,i,t){return new(i||(i=Promise))((function(o,r){function a(e){try{c(t.next(e))}catch(e){r(e)}}function s(e){try{c(t.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,s)}c((t=t.apply(e,n||[])).next())}))};const I=new class{setItemsAsync(e){return U(this,void 0,void 0,(function*(){return new Promise(((n,i)=>{chrome.storage.local.set(e,(()=>{chrome.runtime.lastError?i(new Error("Failed to write to chrome storage. Please refresh the page and try again")):n()}))}))}))}};Object.freeze(I);const j=I;var A=function(e,n,i,t){return new(i||(i=Promise))((function(o,r){function a(e){try{c(t.next(e))}catch(e){r(e)}}function s(e){try{c(t.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,s)}c((t=t.apply(e,n||[])).next())}))};const R=new class{getRedirectDataForTabAsync(e){return A(this,void 0,void 0,(function*(){const n=(yield P.getItemsAsync([m])).redirectDataMap,i=this.N(e);if(n&&n[i]){const e=n[i];if(this.T(e))return e}}))}deleteRedirectDataForTabAsync(e){return A(this,void 0,void 0,(function*(){const n=(yield P.getItemsAsync([m])).redirectDataMap,i=this.N(e);n&&n[i]&&delete n[i],yield j.setItemsAsync({[m]:n})}))}N(e){return e}storeRedirectDataForTabAsync(e,n){return A(this,void 0,void 0,(function*(){console.log("store data for tab "+e);const i=this.N(n);let t=yield P.getItemsAsync([m]);t[i]=e,t=this.P(t),yield j.setItemsAsync({[m]:t})}))}P(e){return function(e,n){const i={};let t;for(t in e)e.hasOwnProperty(t)&&n(e[t])&&(i[t]=e[t]);return i}(e,this.T)}T(e){const n=e.date;return void 0!==n&&"number"==typeof n&&n<=Date.now()&&Date.now()-n<108e5}};Object.freeze(R);const E=R;class x extends f{constructor(e,n,i){super(e,n,i),this.type=i}}var D,M;!function(e){e.JOIN_SESSION="joinSession",e.ACCEPT_DROPIN="acceptDropin",e.SET_STATUS_TYPE="setStatusType",e.SET_DATA="setData",e.GET_DATA="getData",e.GET_STATUS_TYPE="getStatusType",e.GET_PARTY_STATUS="getPartyStatus",e.GET_VIDEO_DATA="getVideoData",e.LOAD_SESSION="loadSession",e.NO_SESSION_DATA="noSessionData",e.ON_NOTIF="onNotif",e.FORWARD_TO_SIDEBAR="forwardToSidebar",e.TEARDOWN="teardown",e.ON_VIDEO_UPDATE="onVideoUpdate",e.SOCKET_LOST_CONNECTION="socketLostConnection",e.REBOOT="socketReconnect",e.LOG_EVENT="logEvent",e.LOG_EXPERIMENT="logExperiment",e.STAY_ALIVE="stayAlive",e.LOAD_CHAT_WINDOW="loadChatWindow",e.RESET_CHAT_WINDOW="resetChatWindow",e.HIDE_CHAT_WINDOW="hideChatWindow",e.SET_USER_PRESENCE="setUserPresence",e.TOGGLE_OPEN_PARTY="toggleOpenParty",e.GET_ACTIVE_PARTY="getActiveParty",e.GET_TAB_ID="getTabId",e.SET_ACTIVE_PARTY="setActiveParty",e.FULLSCREEN_WINDOW="fullscreenWindow",e.MAX_WINDOW="maxWindow",e.GET_EXPERIMENT_FLAG="getExpFlag",e.USER_LIST="userList",e.USER_AUTHENTICATED="userAuthenticated",e.BLOCK_CSP="blockCSP",e.REDIRECT_DATA_SET="redirectDataSet",e.LOAD_NETFLIX_DATA="loadNetflixData",e.TOGGLE_BACKGROUND_TAB="toggleBackgroundTab",e.GET_ALLCHAT_HAS_FOCUS="getAllchatHasFocus",e.SET_REDIRECT_URL="setRedirectUrl",e.GET_REDIRECT_URL="getRedirectUrl",e.SET_POSTHOG_DISTINCT_ID="setPosthogDistinctId",e.POSTHOG_HAS_FEATURE="posthogHasFeature",e.GET_PERM_ID="getPermId"}(D||(D={}));class B extends x{constructor(e,n){super(e,n,D.GET_PARTY_STATUS)}}!function(e){e[e.PARTY_STATE_NONE=0]="PARTY_STATE_NONE",e[e.PARTY_STATE_IN_SESSION=1]="PARTY_STATE_IN_SESSION"}(M||(M={}));class k extends w{constructor(e,n){super(e,n,v.IS_CONTENT_SCRIPT_READY)}}var L,O=function(e,n,i,t){return new(i||(i=Promise))((function(o,r){function a(e){try{c(t.next(e))}catch(e){r(e)}}function s(e){try{c(t.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof i?n:new i((function(e){e(n)}))).then(a,s)}c((t=t.apply(e,n||[])).next())}))};class C{constructor(e,n,i=!0){this.l=new d,this.l.addMessageListener(this),this.serviceName=e,this.colloquialServiceName=n,this.U(),this.I(),i&&this.j()}isLoggingIn(){return!0}I(){return O(this,void 0,void 0,(function*(){const e=yield g.m(new y(a,r)),n=_.includes(this.serviceName),i=(null==e?void 0:e.has_premium)||!1;this.A(n,i)}))}A(e,n){sessionStorage.setItem("telepartyPremiumConfig",JSON.stringify({serviceIsPremium:e,userHasPremium:n,timestamp:Date.now()})),o(chrome.runtime.getURL(`browse_scripts/${this.serviceName}/${this.serviceName}_browse_injected_bundled.js`))}U(){chrome.runtime.connect().onMessage.addListener((()=>{console.log("Ping received")}))}j(){var e,n,i;return O(this,void 0,void 0,(function*(){const o=yield E.getRedirectDataForTabAsync(null!==(n=null===(e=window.teleparty)||void 0===e?void 0:e.tabId)&&void 0!==n?n:0);if(!(null==o?void 0:o.partyUrl))return;const r=JSON.parse(null!==(i=localStorage.getItem("autoRejoinPartyData"))&&void 0!==i?i:"{}");r.partyUrl!=o.partyUrl&&(console.log("New party detected. Clearing old rejoin data"),console.log(r,o),localStorage.setItem("autoRejoinPartyData",JSON.stringify({partyUrl:o.partyUrl,firstJoinAttempt:Date.now(),numRetries:0}))),yield t(2e3)(),this.R()}))}D(){localStorage.removeItem("autoRejoinPartyData"),this.M&&clearTimeout(this.M)}B(){var e;return O(this,void 0,void 0,(function*(){const n=yield g.m(new B(a,r));return console.log("CUR PARTY: ",n),(null===(e=window.teleparty)||void 0===e?void 0:e.contentScriptInjected)&&(null==n?void 0:n.partyState)===M.PARTY_STATE_IN_SESSION}))}k(e){try{if(window.location.hostname.includes("disneyplus")){const n=window.location.pathname.split("/"),i=n[n.length-1],t=e.partyUrl.split("/");return t[t.length-1]!==i}if(window.location.hostname.includes("primevideo")){const n=window.location.href.split("/").pop();return e.partyUrl.split("/").pop()!==n}if(window.location.hostname.includes("apple")){const n=window.location.pathname.split("/").pop();return e.partyUrl.split("/").pop()!==n}return window.location.href!==e.partyUrl}catch(e){return!0}}L(e){var n,i;return O(this,void 0,void 0,(function*(){if(yield this.B())return;console.log("Rejoining party");const t=JSON.parse(null!==(n=localStorage.getItem("autoRejoinPartyData"))&&void 0!==n?n:"{}"),o=(null!==(i=t.numRetries)&&void 0!==i?i:0)+1;console.log(t,o),o>=3||(localStorage.setItem("autoRejoinPartyData",JSON.stringify(Object.assign(Object.assign({},t),{numRetries:o}))),this.k(e)&&(console.log(`Redirecting to ${e.partyUrl} from ${window.location.href}`),window.location.href=e.partyUrl),g.m(new k(a,s)))}))}R(){var e;const n=JSON.parse(null!==(e=localStorage.getItem("autoRejoinPartyData"))&&void 0!==e?e:"{}");this.M=window.setTimeout((()=>O(this,void 0,void 0,(function*(){var e;console.log("Checking if party has started"),console.log(null===(e=window.teleparty)||void 0===e?void 0:e.contentScriptInjected,n.partyUrl,this.isLoggingIn());(yield this.B())?this.D():n.partyUrl&&!this.isLoggingIn()&&(yield this.L(n),this.D())}))),2e3)}onMessage(e,n,i){return!0}}class F extends C{constructor(){super("max",n.MAX,!1)}isLoggingIn(){return window.location.href.includes("/login")||window.location.href.includes("?reason=anonymous")||window.location.href.includes("/profile-picker")}}window.teleparty&&(null===(L=window.teleparty)||void 0===L?void 0:L.browseScriptInjected)||(window.teleparty||(window.teleparty={}),window.teleparty.browseScriptInjected=!0,new F)})()})();