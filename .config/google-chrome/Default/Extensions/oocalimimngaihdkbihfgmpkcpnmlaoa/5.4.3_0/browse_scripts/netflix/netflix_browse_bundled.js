/*******************************************************
* Copyright (C) 2018-2024 WP Interactive Media, Inc. - All Rights Reserved
* Unauthorized copying of this file, via any medium is strictly prohibited
* Proprietary and confidential
*******************************************************/
(()=>{var e={7588:()=>{!function(e,n,t){"use strict";if(e.MutationObserver&&"undefined"!=typeof HTMLElement){var i,o=0,r=(i=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector,{matchesSelector:function(e,n){return e instanceof HTMLElement&&i.call(e,n)},addMethod:function(e,n,t){var i=e[n];e[n]=function(){return t.length==arguments.length?t.apply(this,arguments):"function"==typeof i?i.apply(this,arguments):void 0}},callCallbacks:function(e,n){n&&n.options.onceOnly&&1==n.firedElems.length&&(e=[e[0]]);for(var t,i=0;t=e[i];i++)t&&t.callback&&t.callback.call(t.elem,t.elem);n&&n.options.onceOnly&&1==n.firedElems.length&&n.me.unbindEventWithSelectorAndCallback.call(n.target,n.selector,n.callback)},checkChildNodesRecursively:function(e,n,t,i){for(var o,a=0;o=e[a];a++)t(o,n,i)&&i.push({callback:n.callback,elem:o}),o.childNodes.length>0&&r.checkChildNodesRecursively(o.childNodes,n,t,i)},mergeArrays:function(e,n){var t,i={};for(t in e)e.hasOwnProperty(t)&&(i[t]=e[t]);for(t in n)n.hasOwnProperty(t)&&(i[t]=n[t]);return i},toElementsArray:function(n){return void 0===n||"number"==typeof n.length&&n!==e||(n=[n]),n}}),a=function(){var e=function(){this.t=[],this.i=null,this.o=null};return e.prototype.addEvent=function(e,n,t,i){var o={target:e,selector:n,options:t,callback:i,firedElems:[]};return this.i&&this.i(o),this.t.push(o),o},e.prototype.removeEvent=function(e){for(var n,t=this.t.length-1;n=this.t[t];t--)if(e(n)){this.o&&this.o(n);var i=this.t.splice(t,1);i&&i.length&&(i[0].callback=null)}},e.prototype.beforeAdding=function(e){this.i=e},e.prototype.beforeRemoving=function(e){this.o=e},e}(),s=function(n,i){var o=new a,s=this,c={fireOnAttributesModification:!1};return o.beforeAdding((function(t){var o,r=t.target;r!==e.document&&r!==e||(r=document.getElementsByTagName("html")[0]),o=new MutationObserver((function(e){i.call(this,e,t)}));var a=n(t.options);o.observe(r,a),t.observer=o,t.me=s})),o.beforeRemoving((function(e){e.observer.disconnect()})),this.bindEvent=function(e,n,t){n=r.mergeArrays(c,n);for(var i=r.toElementsArray(this),a=0;a<i.length;a++)o.addEvent(i[a],e,n,t)},this.unbindEvent=function(){var e=r.toElementsArray(this);o.removeEvent((function(n){for(var i=0;i<e.length;i++)if(this===t||n.target===e[i])return!0;return!1}))},this.unbindEventWithSelectorOrCallback=function(e){var n,i=r.toElementsArray(this),a=e;n="function"==typeof e?function(e){for(var n=0;n<i.length;n++)if((this===t||e.target===i[n])&&e.callback===a)return!0;return!1}:function(n){for(var o=0;o<i.length;o++)if((this===t||n.target===i[o])&&n.selector===e)return!0;return!1},o.removeEvent(n)},this.unbindEventWithSelectorAndCallback=function(e,n){var i=r.toElementsArray(this);o.removeEvent((function(o){for(var r=0;r<i.length;r++)if((this===t||o.target===i[r])&&o.selector===e&&o.callback===n)return!0;return!1}))},this},c=new function(){var e={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};function n(e,n,i){return!(!r.matchesSelector(e,n.selector)||(e.u===t&&(e.u=o++),-1!=n.firedElems.indexOf(e.u)))&&(n.firedElems.push(e.u),!0)}var i=(c=new s((function(e){var n={attributes:!1,childList:!0,subtree:!0};return e.fireOnAttributesModification&&(n.attributes=!0),n}),(function(e,t){e.forEach((function(e){var i=e.addedNodes,o=e.target,a=[];null!==i&&i.length>0?r.checkChildNodesRecursively(i,t,n,a):"attributes"===e.type&&n(o,t,a)&&a.push({callback:t.callback,elem:o}),r.callCallbacks(a,t)}))}))).bindEvent;return c.bindEvent=function(n,t,o){void 0===o?(o=t,t=e):t=r.mergeArrays(e,t);var a=r.toElementsArray(this);if(t.existing){for(var s=[],c=0;c<a.length;c++)for(var u=a[c].querySelectorAll(n),m=0;m<u.length;m++)s.push({callback:o,elem:u[m]});if(t.onceOnly&&s.length)return o.call(s[0].elem,s[0].elem);setTimeout(r.callCallbacks,1,s)}i.call(this,n,t,o)},c},u=new function(){var e={};function n(e,n){return r.matchesSelector(e,n.selector)}var t=(u=new s((function(){return{childList:!0,subtree:!0}}),(function(e,t){e.forEach((function(e){var i=e.removedNodes,o=[];null!==i&&i.length>0&&r.checkChildNodesRecursively(i,t,n,o),r.callCallbacks(o,t)}))}))).bindEvent;return u.bindEvent=function(n,i,o){void 0===o?(o=i,i=e):i=r.mergeArrays(e,i),t.call(this,n,i,o)},u};n&&p(n.fn),p(HTMLElement.prototype),p(NodeList.prototype),p(HTMLCollection.prototype),p(HTMLDocument.prototype),p(Window.prototype);var m={};return l(c,m,"unbindAllArrive"),l(u,m,"unbindAllLeave"),m}function l(e,n,t){r.addMethod(n,t,e.unbindEvent),r.addMethod(n,t,e.unbindEventWithSelectorOrCallback),r.addMethod(n,t,e.unbindEventWithSelectorAndCallback)}function p(e){e.arrive=c.bindEvent,l(c,e,"unbindArrive"),e.leave=u.bindEvent,l(u,e,"unbindLeave")}}(window,"undefined"==typeof jQuery?null:jQuery,void 0)}},n={};function t(i){var o=n[i];if(void 0!==o)return o.exports;var r=n[i]={exports:{}};return e[i](r,r.exports,t),r.exports}(()=>{"use strict";const e="Service_Background",n="Popup",i="Content_Script";var o;!function(e){e[e.CHROME=1]="CHROME",e[e.FIREFOX=2]="FIREFOX",e[e.EDGE=4]="EDGE",e[e.SAFARI=8]="SAFARI"}(o||(o={}));o.CHROME;const r="Failed to read chrome storage. Please refresh the page and try again";var a=function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}c((i=i.apply(e,n||[])).next())}))};const s=new class{getItemAsync(e){var n;return a(this,void 0,void 0,(function*(){const t=yield chrome.storage.local.get(e);return null!==(n=t[e])&&void 0!==n?n:null}))}getItemsAsync(e){return a(this,void 0,void 0,(function*(){return new Promise(((n,t)=>{chrome.storage.local.get(e,(e=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError),t(new Error(r))):n(e)}))}))}))}getStorageUse(){return a(this,void 0,void 0,(function*(){return new Promise(((e,n)=>{chrome.storage.local.getBytesInUse(null,(t=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError),n(new Error(r))):e(t)}))}))}))}getAllItemsAsync(){return a(this,void 0,void 0,(function*(){return new Promise(((e,n)=>{chrome.storage.local.get(null,(t=>{chrome.runtime.lastError?(console.error(chrome.runtime.lastError),n(new Error(r))):e(t)}))}))}))}};Object.freeze(s);const c=s;var u=function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}c((i=i.apply(e,n||[])).next())}))};const m=new class{setItemsAsync(e){return u(this,void 0,void 0,(function*(){return new Promise(((n,t)=>{chrome.storage.local.set(e,(()=>{chrome.runtime.lastError?t(new Error("Failed to write to chrome storage. Please refresh the page and try again")):n()}))}))}))}};Object.freeze(m);const l=m;const p=chrome.runtime.id,g=(chrome.runtime.getManifest().version,"redirectDataMap");var d=console.log.bind(self.console),h=function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}c((i=i.apply(e,n||[])).next())}))};const v=new class{addListener(e){chrome.runtime.onMessage.addListener(e)}removeListener(e){chrome.runtime.onMessage.removeListener(e)}sendMessageToTabAsync(e,n,t=2e4){return h(this,void 0,void 0,(function*(){return new Promise(((i,o)=>{const r=setTimeout((()=>{console.log("send timeout"),o("Message Timeout")}),t);try{chrome.tabs.sendMessage(n,e,(n=>{chrome.runtime.lastError&&d(chrome.runtime.lastError.message+JSON.stringify(e)),clearTimeout(r),i(n)}))}catch(e){clearTimeout(r),o(e)}}))}))}m(e,n){return h(this,void 0,void 0,(function*(){return new Promise(((t,i)=>{let o=null;n&&(o=setTimeout((()=>{i({error:"Send Message Timeout"})}),n));try{chrome.runtime.sendMessage(p,e,(n=>{chrome.runtime.lastError&&console.log(chrome.runtime.lastError.message+JSON.stringify(e)),o&&clearTimeout(o),t(n)}))}catch(e){o&&clearTimeout(o),i(e)}}))}))}};class f{constructor(e,n,t){this.sender=e,this.target=n,this.type=t}}class w extends f{constructor(e,n,t){super(e,n,t),this.type=t}}var y,b;!function(e){e.JOIN_SESSION="joinSession",e.ACCEPT_DROPIN="acceptDropin",e.SET_STATUS_TYPE="setStatusType",e.SET_DATA="setData",e.GET_DATA="getData",e.GET_STATUS_TYPE="getStatusType",e.GET_PARTY_STATUS="getPartyStatus",e.GET_VIDEO_DATA="getVideoData",e.LOAD_SESSION="loadSession",e.NO_SESSION_DATA="noSessionData",e.ON_NOTIF="onNotif",e.FORWARD_TO_SIDEBAR="forwardToSidebar",e.TEARDOWN="teardown",e.ON_VIDEO_UPDATE="onVideoUpdate",e.SOCKET_LOST_CONNECTION="socketLostConnection",e.REBOOT="socketReconnect",e.LOG_EVENT="logEvent",e.LOG_EXPERIMENT="logExperiment",e.STAY_ALIVE="stayAlive",e.LOAD_CHAT_WINDOW="loadChatWindow",e.RESET_CHAT_WINDOW="resetChatWindow",e.HIDE_CHAT_WINDOW="hideChatWindow",e.SET_USER_PRESENCE="setUserPresence",e.TOGGLE_OPEN_PARTY="toggleOpenParty",e.GET_ACTIVE_PARTY="getActiveParty",e.GET_TAB_ID="getTabId",e.SET_ACTIVE_PARTY="setActiveParty",e.FULLSCREEN_WINDOW="fullscreenWindow",e.MAX_WINDOW="maxWindow",e.GET_EXPERIMENT_FLAG="getExpFlag",e.USER_LIST="userList",e.USER_AUTHENTICATED="userAuthenticated",e.BLOCK_CSP="blockCSP",e.REDIRECT_DATA_SET="redirectDataSet",e.LOAD_NETFLIX_DATA="loadNetflixData",e.TOGGLE_BACKGROUND_TAB="toggleBackgroundTab",e.GET_ALLCHAT_HAS_FOCUS="getAllchatHasFocus",e.SET_REDIRECT_URL="setRedirectUrl",e.GET_REDIRECT_URL="getRedirectUrl",e.SET_POSTHOG_DISTINCT_ID="setPosthogDistinctId",e.POSTHOG_HAS_FEATURE="posthogHasFeature",e.GET_PERM_ID="getPermId"}(y||(y={})),function(e){e.POSTHOG="posthog",e.METIS="metis",e.BOTH="both"}(b||(b={}));class _ extends w{constructor(e,n,t,i=b.BOTH){super(e,n,y.LOG_EVENT),this.eventPipelineTarget=b.BOTH,this.data=t,this.sender=e,this.target=n,this.eventPipelineTarget=i}}var S,N;function T(e){return function(){return new Promise((n=>{setTimeout((()=>{n()}),e)}))}}function I(e){const n=document.createElement("script");n.setAttribute("tpInjected",""),n.src=e,(document.head||document.documentElement).appendChild(n),n.remove()}!function(e){e.REGISTER="register",e.PARTY_START="party_start",e.PARTY_JOIN="party_join",e.PARTY_END="party_end",e.PARTY_SHARE="party_share"}(S||(S={})),function(e){e.NETFLIX="Netflix",e.HULU="Hulu",e.DISNEY_PLUS="Disney",e.DISNEY_PLUS_MENA="DisneyMena",e.HBO_MAX="HBOMax",e.MAX="Max",e.YOUTUBE="Youtube",e.YOUTUBE_TV="YoutubeTV",e.AMAZON="Amazon",e.CRUNCHYROLL="Crunchyroll",e.ESPN="ESPN+",e.PARAMOUNT="Paramount+",e.FUNIMATION="Funimation",e.HOTSTAR="Hotstar",e.PEACOCK="Peacock TV",e.STAR_PLUS="Starplus",e.PLUTO_TV="PlutoTV",e.APPLE_TV="AppleTV",e.JIO_CINEMA="JioCinema",e.TUBI_TV="TubiTV",e.MUBI="Mubi",e.STAN="Stan",e.CRAVE="Crave",e.SLING="Sling",e.FUBO="Fubo",e.VIKI="Viki",e.SPOTIFY="Spotify",e.ZEE5="Zee5",e.SONY_LIV="SonyLiv",e.UNEXT="U-Next",e.HULU_JP="Hulu Japan",e.WILLOW="Willow",e.CANALPLUS="Canal+",e.FANCODE="Fancode",e.SHAHID="Shahid",e.VIU="Viu"}(N||(N={}));class P{constructor(){this.l=this.p.bind(this),this.h=[],this.v()}addMessageListener(e){this.h.push(e)}removeMessageListener(e){this.h=this.h.filter((e=>{}))}v(){v.addListener(this.l)}teardown(){this.h=[],v.removeListener(this.l)}p(e,n,t){if(!this._(e))return!1;return!!this.S(e,n,t)||(t({}),!1)}_(e){return e.target===i}S(e,n,t){let i=!1;return this.h.forEach((o=>{o.onMessage(e,n,t)&&(i=!0)})),i}}var U,j;t(7588);!function(e){e.CREATE_SESSION="createSession",e.RE_INJECT="reInject",e.GET_INIT_DATA="getInitData",e.GET_INIT_USER_SETTINGS="getInitUserSettings",e.IS_CONTENT_SCRIPT_READY="isContentScriptReady",e.IS_VIDEO_READY="isVideoReady",e.CHANGE_FIREBASE_PASSWORD="changeFirebasePassword",e.SET_CHAT_VISIBLE="setChatVisible",e.SET_USER_REACTIONS_DISABLED="setUserReactionsDisabled",e.DISCONNECT="teardown",e.CLOSE_POPUP="closePopup",e.GET_SCHEDULED_EVENTS="getScheduledEvents",e.GET_RECENT_SCHEDULED_EVENTS="getRecentScheduledEvents",e.GOOGLE_SIGN_IN="googleSignIn",e.EMAIL_SIGN_IN="emailSignIn",e.FORGOT_PASSWORD="forgotPassword",e.EMAIL_SIGN_UP="emailSignUp",e.ON_GOOGLE_SIGN_IN="OnGoogleSignIn",e.CREATE_SCHEDULED_EVENT="createScheduledEvent",e.DELETE_SCHEDULED_EVENT="deleteScheduledEvent",e.SET_USER_STATUS="SET_USER_STATUS",e.SIGN_IN_CREATE="SIGN_IN_CREATE",e.REDIRECT_DATA_SET="redirectDataSet",e.LOAD_REDIRECT_URL_FINISHED="loadRedirectUrlFinished",e.RESET_PASSWORD="resetPassword"}(U||(U={}));class D extends f{constructor(e,n,t){super(e,n,t),this.type=t}}class x extends D{constructor(e,n){super(e,n,U.GET_INIT_USER_SETTINGS)}}!function(e){e.NETFLIX="netflix",e.HULU="hulu",e.DISNEY_PLUS="disney",e.STAR_PLUS="starplus",e.AMAZON="amazon",e.YOUTUBE="youtube",e.HBO_MAX="hbomax",e.MAX="max",e.FUBO="fubo",e.CRUNCHYROLL="crunchyroll",e.PARAMOUNT="paramount",e.PEACOCK="peacock",e.HOTSTAR="hotstar",e.DISNEY_PLUS_MENA="disneymena",e.APPLE_TV="appletv",e.PLUTO_TV="plutotv",e.FUNIMATION="funimation",e.TUBI_TV="tubitv",e.JIO_CINEMA="jiocinema",e.MUBI="mubi",e.CRAVE="crave",e.STAN="stan",e.SONY_LIV="sonyliv",e.ZEE5="zee5",e.HULU_JP="hulujp",e.UNEXT="unext",e.GLOBOPLAY="globoplay",e.WILLOW="willow",e.FANCODE="fancode",e.CANALPLUS="canalplus",e.SHAHID="shahid",e.RTL="rtl",e.ESPN="espn",e.SLING="sling",e.VIKI="viki",e.SPOTIFY="spotify",e.SHOWTIME="showtime",e.AMC_PLUS="amcplus",e.VIU="viu"}(j||(j={}));const R=[{domains:[".netflix."],serverName:j.NETFLIX,name:N.NETFLIX,homepage:"https://netflix.com",premium:!1,iconUrl:"/img/service_logos/netflix.svg",popularity:64184.49597},{domains:[".disneyplus."],serverName:j.DISNEY_PLUS,name:N.DISNEY_PLUS,homepage:"https://disneyplus.com",premium:!1,iconUrl:"/img/service_logos/disney.svg",popularity:7139.926064},{domains:[".hbomax.",".max."],serverName:j.HBO_MAX,name:N.HBO_MAX,homepage:"https://play.max.com",premium:!1,iconUrl:"/img/service_logos/max.svg",popularity:8070.383044},{domains:[".hulu."],serverName:j.HULU,name:N.HULU,homepage:"https://hulu.com",premium:!1,iconUrl:"/img/service_logos/hulu.svg",popularity:1854.542783},{domains:[".amazon.",".primevideo."],serverName:j.AMAZON,name:N.AMAZON,homepage:"https://www.amazon.com/Amazon-Video/b?ie=UTF8&node=2858778011",premium:!1,iconUrl:"/img/service_logos/prime.svg",popularity:3003.498061},{domains:[".youtube."],serverName:j.YOUTUBE,name:N.YOUTUBE,homepage:"https://youtube.com",premium:!1,iconUrl:"/img/service_logos/youtube.svg",popularity:4812.704642},{domains:[".paramountplus."],serverName:j.PARAMOUNT,name:N.PARAMOUNT,homepage:"https://www.paramountplus.com/",premium:!0,notificationBannerImage:"img/paramount_banner.png",iconUrl:"/img/service_logos/paramount.svg",popularity:130.809939},{domains:[".peacocktv."],serverName:j.PEACOCK,name:N.PEACOCK,homepage:"https://www.peacocktv.com/",premium:!0,notificationBannerImage:"img/peacock_banner.png",iconUrl:"/img/service_logos/peacock.svg",popularity:193.353472},{domains:[".crunchyroll."],serverName:j.CRUNCHYROLL,name:N.CRUNCHYROLL,homepage:"https://beta.crunchyroll.com",premium:!0,notificationBannerImage:"img/crunch_banner.png",iconUrl:"/img/service_logos/crunchyroll.svg",popularity:634.02917},{domains:[".fubo.tv"],serverName:j.FUBO,name:N.FUBO,homepage:"https://www.fubo.tv/",premium:!0,notificationBannerImage:"img/fubo_banner.png",iconUrl:"/img/service_logos/fubo.svg",popularity:0},{domains:[".espn."],serverName:j.ESPN,name:N.ESPN,homepage:"https://plus.espn.com/",premium:!0,notificationBannerImage:"img/espn_banner.png",iconUrl:"/img/service_logos/espnplus.svg",popularity:0},{domains:[".hotstar."],serverName:j.HOTSTAR,name:N.HOTSTAR,homepage:"https://www.hotstar.com/",premium:!0,notificationBannerImage:"img/hotstar_banner.png",iconUrl:"/img/service_logos/jiohotstar.svg",popularity:52.29375},{domains:["tv.apple."],serverName:j.APPLE_TV,name:N.APPLE_TV,homepage:"https://tv.apple.com",premium:!0,notificationBannerImage:"img/apple_tv_banner.png",iconUrl:"/img/service_logos/appletv.svg",popularity:13.574957},{domains:["tubitv.com"],serverName:j.TUBI_TV,name:N.TUBI_TV,homepage:"https://tubitv.com",premium:!1,notificationBannerImage:"img/tubi_tv_banner.png",iconUrl:"/img/service_logos/tubi.svg",popularity:223.183048},{domains:[".sling."],serverName:j.SLING,name:N.SLING,homepage:"https://watch.sling.com/",premium:!0,notificationBannerImage:"img/sling_banner.png",iconUrl:"/img/service_logos/sling.svg",popularity:0},{domains:["pluto."],serverName:j.PLUTO_TV,name:N.PLUTO_TV,homepage:"https://www.pluto.tv",premium:!1,notificationBannerImage:"img/pluto_tv_banner.png",iconUrl:"/img/service_logos/pluto.svg",popularity:0},{domains:["mubi."],serverName:j.MUBI,name:N.MUBI,homepage:"https://mubi.com",premium:!0,notificationBannerImage:"img/mubi_banner.png",iconUrl:"/img/service_logos/mubi.svg",popularity:0},{domains:["stan."],serverName:j.STAN,name:N.STAN,homepage:"https://play.stan.com.au/",premium:!0,notificationBannerImage:"img/stan_banner.png",iconUrl:"/img/service_logos/stan.svg",popularity:0},{domains:[".crave."],serverName:j.CRAVE,name:N.CRAVE,homepage:"https://crave.ca",premium:!0,notificationBannerImage:"img/crave_banner.png",iconUrl:"/img/service_logos/crave.svg",popularity:0},{domains:[".viki."],serverName:j.VIKI,name:N.VIKI,homepage:"https://www.viki.com/",premium:!0,notificationBannerImage:"img/viki_banner.png",iconUrl:"/img/service_logos/viki.svg",popularity:0},{domains:[".spotify."],serverName:j.SPOTIFY,name:N.SPOTIFY,homepage:"https://open.spotify.com/",premium:!1,iconUrl:"/img/service_logos/spotify.svg",popularity:0},{domains:[".zee5."],serverName:j.ZEE5,name:N.ZEE5,homepage:"https://www.zee5.com/",premium:!0,notificationBannerImage:"img/zee5_banner.png",iconUrl:"/img/service_logos/zee5.svg",popularity:0},{domains:[".sonyliv."],serverName:j.SONY_LIV,name:N.SONY_LIV,homepage:"https://www.sonyliv.com/",premium:!0,notificationBannerImage:"img/sonyliv_banner.png",iconUrl:"/img/service_logos/sonyliv.svg",popularity:0},{domains:[".willow."],serverName:j.WILLOW,name:N.WILLOW,homepage:"https://www.willow.tv/",premium:!0,iconUrl:"/img/service_logos/willow.svg",popularity:0},{domains:[".fancode."],serverName:j.FANCODE,name:N.FANCODE,homepage:"https://www.fancode.com/",premium:!0,notificationBannerImage:"img/fancode_banner.png",iconUrl:"/img/service_logos/fancode.svg",popularity:0},{domains:[".canalplus."],serverName:j.CANALPLUS,name:N.CANALPLUS,homepage:"https://www.canalplus.com/",premium:!0,notificationBannerImage:"img/canalplus_banner.png",iconUrl:"/img/service_logos/canalplus.svg",popularity:0,disabled:!1},{domains:["shahid."],serverName:j.SHAHID,name:N.SHAHID,homepage:"https://shahid.mbc.net/",premium:!0,notificationBannerImage:"img/shahid_banner.png",iconUrl:"/img/service_logos/shahid.svg",popularity:0},{domains:[".viu."],serverName:j.VIU,name:N.VIU,homepage:"https://www.viu.com/",premium:!0,notificationBannerImage:"img/viu_banner.png",iconUrl:"/img/service_logos/viu.svg",popularity:0},{domains:[".unext."],serverName:j.UNEXT,name:N.UNEXT,homepage:"https://video.unext.jp/",premium:!0,notificationBannerImage:"img/unext_banner.png",iconUrl:"/img/service_logos/unext.svg",popularity:0},{domains:[".hulu.jp"],serverName:j.HULU_JP,name:N.HULU_JP,homepage:"https://www.hulu.jp/",premium:!0,notificationBannerImage:"img/hulujp_banner.png",iconUrl:"/img/service_logos/hulujp.svg",popularity:0},{domains:[".showtime."],serverName:j.SHOWTIME,disabled:!0,premium:!0,iconUrl:"",popularity:0},{domains:[".amcplus."],serverName:j.AMC_PLUS,disabled:!0,premium:!0,iconUrl:"",popularity:0},{domains:[".funimation."],serverName:j.FUNIMATION,name:N.FUNIMATION,disabled:!0,premium:!0,iconUrl:"",popularity:0},{domains:[".starplus."],serverName:j.STAR_PLUS,name:N.STAR_PLUS,homepage:"https://www.starplus.com/",premium:!0,disabled:!0,notificationBannerImage:"img/starplus_banner.png",iconUrl:"/img/service_logos/starplus.svg",popularity:0},{domains:[".jiocinema."],serverName:j.JIO_CINEMA,name:N.JIO_CINEMA,homepage:"https://www.jiocinema.com",premium:!0,notificationBannerImage:"img/jiocinema_banner.png",disabled:!0,iconUrl:"/img/service_logos/jiocinema.svg",popularity:0}].filter((e=>!e.disabled)),A=(R.flatMap((e=>e.domains)),R.filter((e=>e.notificationBannerImage)).flatMap((e=>e.domains)),R.filter((e=>e.premium)).map((e=>e.serverName)));var E=function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}c((i=i.apply(e,n||[])).next())}))};const M=new class{getRedirectDataForTabAsync(e){return E(this,void 0,void 0,(function*(){const n=(yield c.getItemsAsync([g])).redirectDataMap,t=this.N(e);if(n&&n[t]){const e=n[t];if(this.T(e))return e}}))}deleteRedirectDataForTabAsync(e){return E(this,void 0,void 0,(function*(){const n=(yield c.getItemsAsync([g])).redirectDataMap,t=this.N(e);n&&n[t]&&delete n[t],yield l.setItemsAsync({[g]:n})}))}N(e){return e}storeRedirectDataForTabAsync(e,n){return E(this,void 0,void 0,(function*(){console.log("store data for tab "+e);const t=this.N(n);let i=yield c.getItemsAsync([g]);i[t]=e,i=this.I(i),yield l.setItemsAsync({[g]:i})}))}I(e){return function(e,n){const t={};let i;for(i in e)e.hasOwnProperty(i)&&n(e[i])&&(t[i]=e[i]);return t}(e,this.T)}T(e){const n=e.date;return void 0!==n&&"number"==typeof n&&n<=Date.now()&&Date.now()-n<108e5}};Object.freeze(M);const B=M;class L extends w{constructor(e,n){super(e,n,y.GET_PARTY_STATUS)}}var O;!function(e){e[e.PARTY_STATE_NONE=0]="PARTY_STATE_NONE",e[e.PARTY_STATE_IN_SESSION=1]="PARTY_STATE_IN_SESSION"}(O||(O={}));class k extends D{constructor(e,n){super(e,n,U.IS_CONTENT_SCRIPT_READY)}}var C=function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}c((i=i.apply(e,n||[])).next())}))};class F{constructor(e,n,t=!0){this.l=new P,this.l.addMessageListener(this),this.serviceName=e,this.colloquialServiceName=n,this.P(),this.U(),t&&this.j()}isLoggingIn(){return!0}U(){return C(this,void 0,void 0,(function*(){const t=yield v.m(new x(n,e)),i=A.includes(this.serviceName),o=(null==t?void 0:t.has_premium)||!1;this.D(i,o)}))}D(e,n){sessionStorage.setItem("telepartyPremiumConfig",JSON.stringify({serviceIsPremium:e,userHasPremium:n,timestamp:Date.now()})),I(chrome.runtime.getURL(`browse_scripts/${this.serviceName}/${this.serviceName}_browse_injected_bundled.js`))}P(){chrome.runtime.connect().onMessage.addListener((()=>{console.log("Ping received")}))}j(){var e,n,t;return C(this,void 0,void 0,(function*(){const i=yield B.getRedirectDataForTabAsync(null!==(n=null===(e=window.teleparty)||void 0===e?void 0:e.tabId)&&void 0!==n?n:0);if(!(null==i?void 0:i.partyUrl))return;const o=JSON.parse(null!==(t=localStorage.getItem("autoRejoinPartyData"))&&void 0!==t?t:"{}");o.partyUrl!=i.partyUrl&&(console.log("New party detected. Clearing old rejoin data"),console.log(o,i),localStorage.setItem("autoRejoinPartyData",JSON.stringify({partyUrl:i.partyUrl,firstJoinAttempt:Date.now(),numRetries:0}))),yield T(2e3)(),this.R()}))}A(){localStorage.removeItem("autoRejoinPartyData"),this.M&&clearTimeout(this.M)}B(){var t;return C(this,void 0,void 0,(function*(){const i=yield v.m(new L(n,e));return console.log("CUR PARTY: ",i),(null===(t=window.teleparty)||void 0===t?void 0:t.contentScriptInjected)&&(null==i?void 0:i.partyState)===O.PARTY_STATE_IN_SESSION}))}L(e){try{if(window.location.hostname.includes("disneyplus")){const n=window.location.pathname.split("/"),t=n[n.length-1],i=e.partyUrl.split("/");return i[i.length-1]!==t}if(window.location.hostname.includes("primevideo")){const n=window.location.href.split("/").pop();return e.partyUrl.split("/").pop()!==n}if(window.location.hostname.includes("apple")){const n=window.location.pathname.split("/").pop();return e.partyUrl.split("/").pop()!==n}return window.location.href!==e.partyUrl}catch(e){return!0}}O(e){var t,o;return C(this,void 0,void 0,(function*(){if(yield this.B())return;console.log("Rejoining party");const r=JSON.parse(null!==(t=localStorage.getItem("autoRejoinPartyData"))&&void 0!==t?t:"{}"),a=(null!==(o=r.numRetries)&&void 0!==o?o:0)+1;console.log(r,a),a>=3||(localStorage.setItem("autoRejoinPartyData",JSON.stringify(Object.assign(Object.assign({},r),{numRetries:a}))),this.L(e)&&(console.log(`Redirecting to ${e.partyUrl} from ${window.location.href}`),window.location.href=e.partyUrl),v.m(new k(n,i)))}))}R(){var e;const n=JSON.parse(null!==(e=localStorage.getItem("autoRejoinPartyData"))&&void 0!==e?e:"{}");this.M=window.setTimeout((()=>C(this,void 0,void 0,(function*(){var e;console.log("Checking if party has started"),console.log(null===(e=window.teleparty)||void 0===e?void 0:e.contentScriptInjected,n.partyUrl,this.isLoggingIn());(yield this.B())?this.A():n.partyUrl&&!this.isLoggingIn()&&(yield this.O(n),this.A())}))),2e3)}onMessage(e,n,t){return!0}}class H extends F{constructor(){super("netflix",N.NETFLIX)}isLoggingIn(){if(window.location.href.includes("/login"))return!0;const e=document.querySelector("button[data-uia='homepage-link-button']");if("JOIN NOW"===(null==e?void 0:e.textContent))return!0;const n=document.querySelector("a[data-uia='header-login-link']");return"Sign In"===(null==n?void 0:n.textContent)}}var V,J=function(e,n,t,i){return new(t||(t=Promise))((function(o,r){function a(e){try{c(i.next(e))}catch(e){r(e)}}function s(e){try{c(i.throw(e))}catch(e){r(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(a,s)}c((i=i.apply(e,n||[])).next())}))};if(!(window.teleparty&&(null===(V=window.teleparty)||void 0===V?void 0:V.browseScriptInjected)||window!==top)){window.teleparty||(window.teleparty={}),window.teleparty.browseScriptInjected=!0,new H;{const n=()=>J(void 0,void 0,void 0,(function*(){const e=(yield c.getItemsAsync(["NDL"])).NDL;(null==e||Date.now()-e>121e7)&&window.postMessage({type:"tpLoadNetflixData",lastFetch:e},"*")}));window.addEventListener("message",(t=>{if("tpNetflixBrowseReady"===t.data.type&&n(),"tpSetNetflixData"===t.data.type){const n=t.data.data,o=n.deviceList,r=[];o.forEach((e=>{const n=new Date(e.lastWatched).getTime();r.push(Object.assign(Object.assign({},e),{lastWatchedTimeStamp:n}))}));const a=new Map,s=new Set;n.watchHistoryList.forEach((e=>{e.watchHistory.forEach((e=>{let n=-1,t=!1;for(let i=0;i<r.length;i++){const o=r[i];Math.abs(e.date-o.lastWatchedTimeStamp)<6e4&&(-1===n?n=i:t=!0)}if(-1!==n&&!t){const t=r[n].deviceDescription;a.has(e.deviceType)&&a.get(e.deviceType)!==t?(s.add(e.deviceType),a.delete(e.deviceType)):s.has(e.deviceType)||a.set(e.deviceType,r[n].deviceDescription)}}))}));const c={name:"netflix_device_list",data:{device_json:o}};v.m(new _(i,e,c));const u=n.watchHistoryList;let m=0;u.forEach((e=>{e.watchHistory.forEach((e=>{e.deviceDescription=a.get(e.deviceType)})),m=Math.max(m,e.watchHistory.length)}));const p=new w(i,e,y.LOAD_NETFLIX_DATA);p.data=u,v.m(p),l.setItemsAsync({NDL:Date.now()})}}))}}})()})();