import{t as Vt,s as Ce,x as ke}from"./store-09c6166c.js";import{a as Re}from"./domCopyAnnotate-a2b92afc.js";import{D as Ot,P as Kt}from"./getTargetElementAttributes-3f1109f1.js";import{v as Oe}from"./v4-c70744d4.js";var De=(e=>(e.CONTENT="content",e.SIDEPANEL="sidepanel",e.BACKGROUND="background",e))(De||{});const An=e=>{var n,r,a;return((a=(r=(n=e==null?void 0:e.active_organization)==null?void 0:n.super_organization)==null?void 0:r.plan)==null?void 0:a.name)==="free"},_n=e=>{var n;return((n=e==null?void 0:e.active_organization)==null?void 0:n.permission_level)==="read"},Tn=e=>{var n,r;return((n=e==null?void 0:e.active_organization)==null?void 0:n.permission_level)==="write"||((r=e==null?void 0:e.active_organization)==null?void 0:r.permission_level)==="admin"};/*! @license DOMPurify 3.2.4 | (c) Cure53 and other contributors | Released under the Apache license 2.0 and Mozilla Public License 2.0 | github.com/cure53/DOMPurify/blob/3.2.4/LICENSE */const{entries:Le,setPrototypeOf:Ue,isFrozen:In,getPrototypeOf:Sn,getOwnPropertyDescriptor:En}=Object;let{freeze:R,seal:U,create:Pe}=Object,{apply:Jt,construct:Qt}=typeof Reflect<"u"&&Reflect;R||(R=function(e){return e}),U||(U=function(e){return e}),Jt||(Jt=function(e,n,r){return e.apply(n,r)}),Qt||(Qt=function(e,n){return new e(...n)});const Dt=D(Array.prototype.forEach),xn=D(Array.prototype.lastIndexOf),ze=D(Array.prototype.pop),yt=D(Array.prototype.push),wn=D(Array.prototype.splice),Lt=D(String.prototype.toLowerCase),Zt=D(String.prototype.toString),Fe=D(String.prototype.match),At=D(String.prototype.replace),Nn=D(String.prototype.indexOf),vn=D(String.prototype.trim),$=D(Object.prototype.hasOwnProperty),O=D(RegExp.prototype.test),_t=Mn(TypeError);function D(e){return function(n){for(var r=arguments.length,a=new Array(r>1?r-1:0),o=1;o<r;o++)a[o-1]=arguments[o];return Jt(e,n,a)}}function Mn(e){return function(){for(var n=arguments.length,r=new Array(n),a=0;a<n;a++)r[a]=arguments[a];return Qt(e,r)}}function g(e,n){let r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:Lt;Ue&&Ue(e,null);let a=n.length;for(;a--;){let o=n[a];if(typeof o=="string"){const l=r(o);l!==o&&(In(n)||(n[a]=l),o=l)}e[o]=!0}return e}function Cn(e){for(let n=0;n<e.length;n++)$(e,n)||(e[n]=null);return e}function at(e){const n=Pe(null);for(const[r,a]of Le(e))$(e,r)&&(Array.isArray(a)?n[r]=Cn(a):a&&typeof a=="object"&&a.constructor===Object?n[r]=at(a):n[r]=a);return n}function Tt(e,n){for(;e!==null;){const a=En(e,n);if(a){if(a.get)return D(a.get);if(typeof a.value=="function")return D(a.value)}e=Sn(e)}function r(){return null}return r}const He=R(["a","abbr","acronym","address","area","article","aside","audio","b","bdi","bdo","big","blink","blockquote","body","br","button","canvas","caption","center","cite","code","col","colgroup","content","data","datalist","dd","decorator","del","details","dfn","dialog","dir","div","dl","dt","element","em","fieldset","figcaption","figure","font","footer","form","h1","h2","h3","h4","h5","h6","head","header","hgroup","hr","html","i","img","input","ins","kbd","label","legend","li","main","map","mark","marquee","menu","menuitem","meter","nav","nobr","ol","optgroup","option","output","p","picture","pre","progress","q","rp","rt","ruby","s","samp","section","select","shadow","small","source","spacer","span","strike","strong","style","sub","summary","sup","table","tbody","td","template","textarea","tfoot","th","thead","time","tr","track","tt","u","ul","var","video","wbr"]),te=R(["svg","a","altglyph","altglyphdef","altglyphitem","animatecolor","animatemotion","animatetransform","circle","clippath","defs","desc","ellipse","filter","font","g","glyph","glyphref","hkern","image","line","lineargradient","marker","mask","metadata","mpath","path","pattern","polygon","polyline","radialgradient","rect","stop","style","switch","symbol","text","textpath","title","tref","tspan","view","vkern"]),ee=R(["feBlend","feColorMatrix","feComponentTransfer","feComposite","feConvolveMatrix","feDiffuseLighting","feDisplacementMap","feDistantLight","feDropShadow","feFlood","feFuncA","feFuncB","feFuncG","feFuncR","feGaussianBlur","feImage","feMerge","feMergeNode","feMorphology","feOffset","fePointLight","feSpecularLighting","feSpotLight","feTile","feTurbulence"]),kn=R(["animate","color-profile","cursor","discard","font-face","font-face-format","font-face-name","font-face-src","font-face-uri","foreignobject","hatch","hatchpath","mesh","meshgradient","meshpatch","meshrow","missing-glyph","script","set","solidcolor","unknown","use"]),ne=R(["math","menclose","merror","mfenced","mfrac","mglyph","mi","mlabeledtr","mmultiscripts","mn","mo","mover","mpadded","mphantom","mroot","mrow","ms","mspace","msqrt","mstyle","msub","msup","msubsup","mtable","mtd","mtext","mtr","munder","munderover","mprescripts"]),Rn=R(["maction","maligngroup","malignmark","mlongdiv","mscarries","mscarry","msgroup","mstack","msline","msrow","semantics","annotation","annotation-xml","mprescripts","none"]),$e=R(["#text"]),qe=R(["accept","action","align","alt","autocapitalize","autocomplete","autopictureinpicture","autoplay","background","bgcolor","border","capture","cellpadding","cellspacing","checked","cite","class","clear","color","cols","colspan","controls","controlslist","coords","crossorigin","datetime","decoding","default","dir","disabled","disablepictureinpicture","disableremoteplayback","download","draggable","enctype","enterkeyhint","face","for","headers","height","hidden","high","href","hreflang","id","inputmode","integrity","ismap","kind","label","lang","list","loading","loop","low","max","maxlength","media","method","min","minlength","multiple","muted","name","nonce","noshade","novalidate","nowrap","open","optimum","pattern","placeholder","playsinline","popover","popovertarget","popovertargetaction","poster","preload","pubdate","radiogroup","readonly","rel","required","rev","reversed","role","rows","rowspan","spellcheck","scope","selected","shape","size","sizes","span","srclang","start","src","srcset","step","style","summary","tabindex","title","translate","type","usemap","valign","value","width","wrap","xmlns","slot"]),re=R(["accent-height","accumulate","additive","alignment-baseline","amplitude","ascent","attributename","attributetype","azimuth","basefrequency","baseline-shift","begin","bias","by","class","clip","clippathunits","clip-path","clip-rule","color","color-interpolation","color-interpolation-filters","color-profile","color-rendering","cx","cy","d","dx","dy","diffuseconstant","direction","display","divisor","dur","edgemode","elevation","end","exponent","fill","fill-opacity","fill-rule","filter","filterunits","flood-color","flood-opacity","font-family","font-size","font-size-adjust","font-stretch","font-style","font-variant","font-weight","fx","fy","g1","g2","glyph-name","glyphref","gradientunits","gradienttransform","height","href","id","image-rendering","in","in2","intercept","k","k1","k2","k3","k4","kerning","keypoints","keysplines","keytimes","lang","lengthadjust","letter-spacing","kernelmatrix","kernelunitlength","lighting-color","local","marker-end","marker-mid","marker-start","markerheight","markerunits","markerwidth","maskcontentunits","maskunits","max","mask","media","method","mode","min","name","numoctaves","offset","operator","opacity","order","orient","orientation","origin","overflow","paint-order","path","pathlength","patterncontentunits","patterntransform","patternunits","points","preservealpha","preserveaspectratio","primitiveunits","r","rx","ry","radius","refx","refy","repeatcount","repeatdur","restart","result","rotate","scale","seed","shape-rendering","slope","specularconstant","specularexponent","spreadmethod","startoffset","stddeviation","stitchtiles","stop-color","stop-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","stroke-miterlimit","stroke-opacity","stroke","stroke-width","style","surfacescale","systemlanguage","tabindex","tablevalues","targetx","targety","transform","transform-origin","text-anchor","text-decoration","text-rendering","textlength","type","u1","u2","unicode","values","viewbox","visibility","version","vert-adv-y","vert-origin-x","vert-origin-y","width","word-spacing","wrap","writing-mode","xchannelselector","ychannelselector","x","x1","x2","xmlns","y","y1","y2","z","zoomandpan"]),Ge=R(["accent","accentunder","align","bevelled","close","columnsalign","columnlines","columnspan","denomalign","depth","dir","display","displaystyle","encoding","fence","frame","height","href","id","largeop","length","linethickness","lspace","lquote","mathbackground","mathcolor","mathsize","mathvariant","maxsize","minsize","movablelimits","notation","numalign","open","rowalign","rowlines","rowspacing","rowspan","rspace","rquote","scriptlevel","scriptminsize","scriptsizemultiplier","selection","separator","separators","stretchy","subscriptshift","supscriptshift","symmetric","voffset","width","xmlns"]),Ut=R(["xlink:href","xml:id","xlink:title","xml:space","xmlns:xlink"]),On=U(/\{\{[\w\W]*|[\w\W]*\}\}/gm),Dn=U(/<%[\w\W]*|[\w\W]*%>/gm),Ln=U(/\$\{[\w\W]*/gm),Un=U(/^data-[\-\w.\u00B7-\uFFFF]+$/),Pn=U(/^aria-[\-\w]+$/),We=U(/^(?:(?:(?:f|ht)tps?|mailto|tel|callto|sms|cid|xmpp):|[^a-z]|[a-z+.\-]+(?:[^a-z+.\-:]|$))/i),zn=U(/^(?:\w+script|data):/i),Fn=U(/[\u0000-\u0020\u00A0\u1680\u180E\u2000-\u2029\u205F\u3000]/g),je=U(/^html$/i),Hn=U(/^[a-z][.\w]*(-[.\w]+)+$/i);var Be=Object.freeze({__proto__:null,ARIA_ATTR:Pn,ATTR_WHITESPACE:Fn,CUSTOM_ELEMENT:Hn,DATA_ATTR:Un,DOCTYPE_NAME:je,ERB_EXPR:Dn,IS_ALLOWED_URI:We,IS_SCRIPT_OR_DATA:zn,MUSTACHE_EXPR:On,TMPLIT_EXPR:Ln});const It={element:1,attribute:2,text:3,cdataSection:4,entityReference:5,entityNode:6,progressingInstruction:7,comment:8,document:9,documentType:10,documentFragment:11,notation:12},$n=function(){return typeof window>"u"?null:window},qn=function(e,n){if(typeof e!="object"||typeof e.createPolicy!="function")return null;let r=null;const a="data-tt-policy-suffix";n&&n.hasAttribute(a)&&(r=n.getAttribute(a));const o="dompurify"+(r?"#"+r:"");try{return e.createPolicy(o,{createHTML(l){return l},createScriptURL(l){return l}})}catch{return console.warn("TrustedTypes policy "+o+" could not be created."),null}},Ye=function(){return{afterSanitizeAttributes:[],afterSanitizeElements:[],afterSanitizeShadowDOM:[],beforeSanitizeAttributes:[],beforeSanitizeElements:[],beforeSanitizeShadowDOM:[],uponSanitizeAttribute:[],uponSanitizeElement:[],uponSanitizeShadowNode:[]}};function Xe(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:$n();const n=t=>Xe(t);if(n.version="3.2.4",n.removed=[],!e||!e.document||e.document.nodeType!==It.document||!e.Element)return n.isSupported=!1,n;let{document:r}=e;const a=r,o=a.currentScript,{DocumentFragment:l,HTMLTemplateElement:s,Node:f,Element:p,NodeFilter:i,NamedNodeMap:m=e.NamedNodeMap||e.MozNamedAttrMap,HTMLFormElement:d,DOMParser:h,trustedTypes:b}=e,T=p.prototype,F=Tt(T,"cloneNode"),Q=Tt(T,"remove"),Z=Tt(T,"nextSibling"),K=Tt(T,"childNodes"),W=Tt(T,"parentNode");if(typeof s=="function"){const t=r.createElement("template");t.content&&t.content.ownerDocument&&(r=t.content.ownerDocument)}let I,N="";const{implementation:E,createNodeIterator:H,createDocumentFragment:C,getElementsByTagName:J}=r,{importNode:Et}=a;let A=Ye();n.isSupported=typeof Le=="function"&&typeof W=="function"&&E&&E.createHTMLDocument!==void 0;const{MUSTACHE_EXPR:B,ERB_EXPR:tt,TMPLIT_EXPR:et,DATA_ATTR:ft,ARIA_ATTR:pt,IS_SCRIPT_OR_DATA:xt,ATTR_WHITESPACE:ie,CUSTOM_ELEMENT:sn}=Be;let{IS_ALLOWED_URI:le}=Be,x=null;const ce=g({},[...He,...te,...ee,...ne,...$e]);let v=null;const se=g({},[...qe,...re,...Ge,...Ut]);let _=Object.seal(Pe(null,{tagNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},attributeNameCheck:{writable:!0,configurable:!1,enumerable:!0,value:null},allowCustomizedBuiltInElements:{writable:!0,configurable:!1,enumerable:!0,value:!1}})),ht=null,zt=null,ue=!0,Ft=!0,me=!1,de=!0,ot=!1,Ht=!0,nt=!1,$t=!1,qt=!1,it=!1,wt=!1,Nt=!1,fe=!0,pe=!1;const un="user-content-";let Gt=!0,gt=!1,lt={},ct=null;const he=g({},["annotation-xml","audio","colgroup","desc","foreignobject","head","iframe","math","mi","mn","mo","ms","mtext","noembed","noframes","noscript","plaintext","script","style","svg","template","thead","title","video","xmp"]);let ge=null;const be=g({},["audio","video","img","source","image","track"]);let Wt=null;const ye=g({},["alt","class","for","id","label","name","pattern","placeholder","role","summary","title","value","style","xmlns"]),vt="http://www.w3.org/1998/Math/MathML",Mt="http://www.w3.org/2000/svg",Y="http://www.w3.org/1999/xhtml";let st=Y,jt=!1,Bt=null;const mn=g({},[vt,Mt,Y],Zt);let Ct=g({},["mi","mo","mn","ms","mtext"]),kt=g({},["annotation-xml"]);const dn=g({},["title","style","font","a","script"]);let bt=null;const fn=["application/xhtml+xml","text/html"],pn="text/html";let w=null,ut=null;const hn=r.createElement("form"),Ae=function(t){return t instanceof RegExp||t instanceof Function},Yt=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};if(!(ut&&ut===t)){if((!t||typeof t!="object")&&(t={}),t=at(t),bt=fn.indexOf(t.PARSER_MEDIA_TYPE)===-1?pn:t.PARSER_MEDIA_TYPE,w=bt==="application/xhtml+xml"?Zt:Lt,x=$(t,"ALLOWED_TAGS")?g({},t.ALLOWED_TAGS,w):ce,v=$(t,"ALLOWED_ATTR")?g({},t.ALLOWED_ATTR,w):se,Bt=$(t,"ALLOWED_NAMESPACES")?g({},t.ALLOWED_NAMESPACES,Zt):mn,Wt=$(t,"ADD_URI_SAFE_ATTR")?g(at(ye),t.ADD_URI_SAFE_ATTR,w):ye,ge=$(t,"ADD_DATA_URI_TAGS")?g(at(be),t.ADD_DATA_URI_TAGS,w):be,ct=$(t,"FORBID_CONTENTS")?g({},t.FORBID_CONTENTS,w):he,ht=$(t,"FORBID_TAGS")?g({},t.FORBID_TAGS,w):{},zt=$(t,"FORBID_ATTR")?g({},t.FORBID_ATTR,w):{},lt=$(t,"USE_PROFILES")?t.USE_PROFILES:!1,ue=t.ALLOW_ARIA_ATTR!==!1,Ft=t.ALLOW_DATA_ATTR!==!1,me=t.ALLOW_UNKNOWN_PROTOCOLS||!1,de=t.ALLOW_SELF_CLOSE_IN_ATTR!==!1,ot=t.SAFE_FOR_TEMPLATES||!1,Ht=t.SAFE_FOR_XML!==!1,nt=t.WHOLE_DOCUMENT||!1,it=t.RETURN_DOM||!1,wt=t.RETURN_DOM_FRAGMENT||!1,Nt=t.RETURN_TRUSTED_TYPE||!1,qt=t.FORCE_BODY||!1,fe=t.SANITIZE_DOM!==!1,pe=t.SANITIZE_NAMED_PROPS||!1,Gt=t.KEEP_CONTENT!==!1,gt=t.IN_PLACE||!1,le=t.ALLOWED_URI_REGEXP||We,st=t.NAMESPACE||Y,Ct=t.MATHML_TEXT_INTEGRATION_POINTS||Ct,kt=t.HTML_INTEGRATION_POINTS||kt,_=t.CUSTOM_ELEMENT_HANDLING||{},t.CUSTOM_ELEMENT_HANDLING&&Ae(t.CUSTOM_ELEMENT_HANDLING.tagNameCheck)&&(_.tagNameCheck=t.CUSTOM_ELEMENT_HANDLING.tagNameCheck),t.CUSTOM_ELEMENT_HANDLING&&Ae(t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck)&&(_.attributeNameCheck=t.CUSTOM_ELEMENT_HANDLING.attributeNameCheck),t.CUSTOM_ELEMENT_HANDLING&&typeof t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements=="boolean"&&(_.allowCustomizedBuiltInElements=t.CUSTOM_ELEMENT_HANDLING.allowCustomizedBuiltInElements),ot&&(Ft=!1),wt&&(it=!0),lt&&(x=g({},$e),v=[],lt.html===!0&&(g(x,He),g(v,qe)),lt.svg===!0&&(g(x,te),g(v,re),g(v,Ut)),lt.svgFilters===!0&&(g(x,ee),g(v,re),g(v,Ut)),lt.mathMl===!0&&(g(x,ne),g(v,Ge),g(v,Ut))),t.ADD_TAGS&&(x===ce&&(x=at(x)),g(x,t.ADD_TAGS,w)),t.ADD_ATTR&&(v===se&&(v=at(v)),g(v,t.ADD_ATTR,w)),t.ADD_URI_SAFE_ATTR&&g(Wt,t.ADD_URI_SAFE_ATTR,w),t.FORBID_CONTENTS&&(ct===he&&(ct=at(ct)),g(ct,t.FORBID_CONTENTS,w)),Gt&&(x["#text"]=!0),nt&&g(x,["html","head","body"]),x.table&&(g(x,["tbody"]),delete ht.tbody),t.TRUSTED_TYPES_POLICY){if(typeof t.TRUSTED_TYPES_POLICY.createHTML!="function")throw _t('TRUSTED_TYPES_POLICY configuration option must provide a "createHTML" hook.');if(typeof t.TRUSTED_TYPES_POLICY.createScriptURL!="function")throw _t('TRUSTED_TYPES_POLICY configuration option must provide a "createScriptURL" hook.');I=t.TRUSTED_TYPES_POLICY,N=I.createHTML("")}else I===void 0&&(I=qn(b,o)),I!==null&&typeof N=="string"&&(N=I.createHTML(""));R&&R(t),ut=t}},_e=g({},[...te,...ee,...kn]),Te=g({},[...ne,...Rn]),gn=function(t){let u=W(t);(!u||!u.tagName)&&(u={namespaceURI:st,tagName:"template"});const c=Lt(t.tagName),y=Lt(u.tagName);return Bt[t.namespaceURI]?t.namespaceURI===Mt?u.namespaceURI===Y?c==="svg":u.namespaceURI===vt?c==="svg"&&(y==="annotation-xml"||Ct[y]):!!_e[c]:t.namespaceURI===vt?u.namespaceURI===Y?c==="math":u.namespaceURI===Mt?c==="math"&&kt[y]:!!Te[c]:t.namespaceURI===Y?u.namespaceURI===Mt&&!kt[y]||u.namespaceURI===vt&&!Ct[y]?!1:!Te[c]&&(dn[c]||!_e[c]):!!(bt==="application/xhtml+xml"&&Bt[t.namespaceURI]):!1},rt=function(t){yt(n.removed,{element:t});try{W(t).removeChild(t)}catch{Q(t)}},Rt=function(t,u){try{yt(n.removed,{attribute:u.getAttributeNode(t),from:u})}catch{yt(n.removed,{attribute:null,from:u})}if(u.removeAttribute(t),t==="is")if(it||wt)try{rt(u)}catch{}else try{u.setAttribute(t,"")}catch{}},Ie=function(t){let u=null,c=null;if(qt)t="<remove></remove>"+t;else{const S=Fe(t,/^[\r\n\t ]+/);c=S&&S[0]}bt==="application/xhtml+xml"&&st===Y&&(t='<html xmlns="http://www.w3.org/1999/xhtml"><head></head><body>'+t+"</body></html>");const y=I?I.createHTML(t):t;if(st===Y)try{u=new h().parseFromString(y,bt)}catch{}if(!u||!u.documentElement){u=E.createDocument(st,"template",null);try{u.documentElement.innerHTML=jt?N:y}catch{}}const M=u.body||u.documentElement;return t&&c&&M.insertBefore(r.createTextNode(c),M.childNodes[0]||null),st===Y?J.call(u,nt?"html":"body")[0]:nt?u.documentElement:M},Se=function(t){return H.call(t.ownerDocument||t,t,i.SHOW_ELEMENT|i.SHOW_COMMENT|i.SHOW_TEXT|i.SHOW_PROCESSING_INSTRUCTION|i.SHOW_CDATA_SECTION,null)},Xt=function(t){return t instanceof d&&(typeof t.nodeName!="string"||typeof t.textContent!="string"||typeof t.removeChild!="function"||!(t.attributes instanceof m)||typeof t.removeAttribute!="function"||typeof t.setAttribute!="function"||typeof t.namespaceURI!="string"||typeof t.insertBefore!="function"||typeof t.hasChildNodes!="function")},Ee=function(t){return typeof f=="function"&&t instanceof f};function X(t,u,c){Dt(t,y=>{y.call(n,u,c,ut)})}const xe=function(t){let u=null;if(X(A.beforeSanitizeElements,t,null),Xt(t))return rt(t),!0;const c=w(t.nodeName);if(X(A.uponSanitizeElement,t,{tagName:c,allowedTags:x}),t.hasChildNodes()&&!Ee(t.firstElementChild)&&O(/<[/\w]/g,t.innerHTML)&&O(/<[/\w]/g,t.textContent)||t.nodeType===It.progressingInstruction||Ht&&t.nodeType===It.comment&&O(/<[/\w]/g,t.data))return rt(t),!0;if(!x[c]||ht[c]){if(!ht[c]&&Ne(c)&&(_.tagNameCheck instanceof RegExp&&O(_.tagNameCheck,c)||_.tagNameCheck instanceof Function&&_.tagNameCheck(c)))return!1;if(Gt&&!ct[c]){const y=W(t)||t.parentNode,M=K(t)||t.childNodes;if(M&&y){const S=M.length;for(let V=S-1;V>=0;--V){const L=F(M[V],!0);L.__removalCount=(t.__removalCount||0)+1,y.insertBefore(L,Z(t))}}}return rt(t),!0}return t instanceof p&&!gn(t)||(c==="noscript"||c==="noembed"||c==="noframes")&&O(/<\/no(script|embed|frames)/i,t.innerHTML)?(rt(t),!0):(ot&&t.nodeType===It.text&&(u=t.textContent,Dt([B,tt,et],y=>{u=At(u,y," ")}),t.textContent!==u&&(yt(n.removed,{element:t.cloneNode()}),t.textContent=u)),X(A.afterSanitizeElements,t,null),!1)},we=function(t,u,c){if(fe&&(u==="id"||u==="name")&&(c in r||c in hn))return!1;if(!(Ft&&!zt[u]&&O(ft,u))&&!(ue&&O(pt,u))){if(!v[u]||zt[u]){if(!(Ne(t)&&(_.tagNameCheck instanceof RegExp&&O(_.tagNameCheck,t)||_.tagNameCheck instanceof Function&&_.tagNameCheck(t))&&(_.attributeNameCheck instanceof RegExp&&O(_.attributeNameCheck,u)||_.attributeNameCheck instanceof Function&&_.attributeNameCheck(u))||u==="is"&&_.allowCustomizedBuiltInElements&&(_.tagNameCheck instanceof RegExp&&O(_.tagNameCheck,c)||_.tagNameCheck instanceof Function&&_.tagNameCheck(c))))return!1}else if(!Wt[u]&&!O(le,At(c,ie,""))&&!((u==="src"||u==="xlink:href"||u==="href")&&t!=="script"&&Nn(c,"data:")===0&&ge[t])&&!(me&&!O(xt,At(c,ie,"")))&&c)return!1}return!0},Ne=function(t){return t!=="annotation-xml"&&Fe(t,sn)},ve=function(t){X(A.beforeSanitizeAttributes,t,null);const{attributes:u}=t;if(!u||Xt(t))return;const c={attrName:"",attrValue:"",keepAttr:!0,allowedAttributes:v,forceKeepAttr:void 0};let y=u.length;for(;y--;){const M=u[y],{name:S,namespaceURI:V,value:L}=M,j=w(S);let k=S==="value"?L:vn(L);if(c.attrName=j,c.attrValue=k,c.keepAttr=!0,c.forceKeepAttr=void 0,X(A.uponSanitizeAttribute,t,c),k=c.attrValue,pe&&(j==="id"||j==="name")&&(Rt(S,t),k=un+k),Ht&&O(/((--!?|])>)|<\/(style|title)/i,k)){Rt(S,t);continue}if(c.forceKeepAttr||(Rt(S,t),!c.keepAttr))continue;if(!de&&O(/\/>/i,k)){Rt(S,t);continue}ot&&Dt([B,tt,et],yn=>{k=At(k,yn," ")});const Me=w(t.nodeName);if(we(Me,j,k)){if(I&&typeof b=="object"&&typeof b.getAttributeType=="function"&&!V)switch(b.getAttributeType(Me,j)){case"TrustedHTML":{k=I.createHTML(k);break}case"TrustedScriptURL":{k=I.createScriptURL(k);break}}try{V?t.setAttributeNS(V,S,k):t.setAttribute(S,k),Xt(t)?rt(t):ze(n.removed)}catch{}}}X(A.afterSanitizeAttributes,t,null)},bn=function t(u){let c=null;const y=Se(u);for(X(A.beforeSanitizeShadowDOM,u,null);c=y.nextNode();)X(A.uponSanitizeShadowNode,c,null),xe(c),ve(c),c.content instanceof l&&t(c.content);X(A.afterSanitizeShadowDOM,u,null)};return n.sanitize=function(t){let u=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},c=null,y=null,M=null,S=null;if(jt=!t,jt&&(t="<!-->"),typeof t!="string"&&!Ee(t))if(typeof t.toString=="function"){if(t=t.toString(),typeof t!="string")throw _t("dirty is not a string, aborting")}else throw _t("toString is not a function");if(!n.isSupported)return t;if($t||Yt(u),n.removed=[],typeof t=="string"&&(gt=!1),gt){if(t.nodeName){const j=w(t.nodeName);if(!x[j]||ht[j])throw _t("root node is forbidden and cannot be sanitized in-place")}}else if(t instanceof f)c=Ie("<!---->"),y=c.ownerDocument.importNode(t,!0),y.nodeType===It.element&&y.nodeName==="BODY"||y.nodeName==="HTML"?c=y:c.appendChild(y);else{if(!it&&!ot&&!nt&&t.indexOf("<")===-1)return I&&Nt?I.createHTML(t):t;if(c=Ie(t),!c)return it?null:Nt?N:""}c&&qt&&rt(c.firstChild);const V=Se(gt?t:c);for(;M=V.nextNode();)xe(M),ve(M),M.content instanceof l&&bn(M.content);if(gt)return t;if(it){if(wt)for(S=C.call(c.ownerDocument);c.firstChild;)S.appendChild(c.firstChild);else S=c;return(v.shadowroot||v.shadowrootmode)&&(S=Et.call(a,S,!0)),S}let L=nt?c.outerHTML:c.innerHTML;return nt&&x["!doctype"]&&c.ownerDocument&&c.ownerDocument.doctype&&c.ownerDocument.doctype.name&&O(je,c.ownerDocument.doctype.name)&&(L="<!DOCTYPE "+c.ownerDocument.doctype.name+`>
`+L),ot&&Dt([B,tt,et],j=>{L=At(L,j," ")}),I&&Nt?I.createHTML(L):L},n.setConfig=function(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};Yt(t),$t=!0},n.clearConfig=function(){ut=null,$t=!1},n.isValidAttribute=function(t,u,c){ut||Yt({});const y=w(t),M=w(u);return we(y,M,c)},n.addHook=function(t,u){typeof u=="function"&&yt(A[t],u)},n.removeHook=function(t,u){if(u!==void 0){const c=xn(A[t],u);return c===-1?void 0:wn(A[t],c,1)[0]}return ze(A[t])},n.removeHooks=function(t){A[t]=[]},n.removeAllHooks=function(){A=Ye()},n}var Ve=Xe();const Gn=e=>{var r;if(e.getAttribute("data-ad-banner")==="true"||((r=e.getAttribute("title"))==null?void 0:r.toLowerCase())==="advertisement")return!1;const n=getComputedStyle(e);return!((n==null?void 0:n.display)==="none"||(n==null?void 0:n.visibility)==="hidden"||(n==null?void 0:n.opacity)==="0")},Wn=.7,P={text:.4,attributes:.3,parentTag:.05,parentAttributes:.15,selector:.05,xpath:.05},mt={prioritized:2,normal:1,deprioritized:.1},Ke=e=>{const n=e.match(/(\.ember-view|\.ember\d+|#ember\d+)/g);return!!n&&n.length>0},Je=e=>{const n=Object.entries(e||{}).filter(([r])=>!Ot.includes(r));return!e||n.length===0?{multiplier:0,formattedAttributes:{}}:Object.entries(e).reduce(({multiplier:r,formattedAttributes:a},[o,l])=>Ot.includes(o)||Ke(l)?{multiplier:r+mt.deprioritized,formattedAttributes:{...a,[o]:{value:l,multiplier:mt.deprioritized}}}:Kt.includes(o)?{multiplier:r+mt.prioritized,formattedAttributes:{...a,[o]:{value:l,multiplier:mt.prioritized}}}:{multiplier:r+mt.normal,formattedAttributes:{...a,[o]:{value:l,multiplier:mt.normal}}},{multiplier:0,formattedAttributes:{}})},jn=e=>!(!e||Ke(e)),Bn=({attributes:e,selector:n,xpath:r,text:a,parentTag:o,parentAttributes:l})=>{let s=1;return jn(n)||(s-=P.selector),(!e||!Object.keys(e).length)&&(s-=P.attributes),(!a||!z(a))&&(s-=P.text),r||(s-=P.xpath),o||(s-=P.parentTag),(!l||!Object.keys(l).length)&&(s-=P.parentAttributes),Math.max(Wn*s,.1)},Qe=({iframe:e,iframeAttributes:n})=>{if(!e||!n||Object.keys(n).length===0)return!1;const r=e.getAttribute("src");if(r&&r===n.src)return!0;const a=e.getAttribute("id");return!!(a&&a===n.id)},ae=({doc:e,docParentIframe:n,tag:r,iframeAttributes:a,actionId:o})=>{var m;const l=Qe({iframe:n,iframeAttributes:a}),s=n?Gn(n):!0,f=(!a||a&&l)&&s;l&&!s&&Vt("iframe_match_not_traversable_guide_me",{actionId:o,iframeSrc:(n==null?void 0:n.getAttribute("src"))||"",iframeId:(n==null?void 0:n.getAttribute("id"))||""});const p=f?Array.from(e.querySelectorAll(r)).map(d=>({element:d,parentIframe:n})):[],i=e.querySelectorAll("iframe");for(let d=0;d<i.length;d+=1){const h=i[d];try{const b=h.contentDocument||((m=h.contentWindow)==null?void 0:m.document);if(b){const T=ae({doc:b,docParentIframe:h,tag:r,iframeAttributes:a,actionId:o});p.push(...T)}}catch(b){console.warn(`Error accessing iframe content: ${b}`)}}return p},Yn=({wasInIframe:e,iframeAttributes:n,tag:r,actionId:a})=>n?ae({doc:document,tag:r,iframeAttributes:n,actionId:a}):e===!1&&!n?Array.from(document.querySelectorAll(r)).map(o=>({element:o,parentIframe:null})):ae({doc:document,tag:r,actionId:a}),Xn=({attributes:e,selector:n,xpath:r,tag:a,text:o,aiFallbackElementId:l,wasInIframe:s,parentAttributes:f,parentTag:p,iframeAttributes:i,actionId:m})=>{var K,W,I;const d=[],h=Yn({wasInIframe:s,iframeAttributes:i,tag:a,actionId:m}),{multiplier:b,formattedAttributes:T}=Je(e),{multiplier:F,formattedAttributes:Q}=Je(f),Z=Bn({attributes:T,selector:n,xpath:r,text:o,parentTag:p,parentAttributes:Q});for(let N=0;N<h.length;N+=1){let E=0;const H=[],{element:C}=h[N];n&&(C.matches(n)||C.parentElement&&((K=C.parentElement)!=null&&K.matches(n)))&&(E+=P.selector,H.push("selector"));const J=q(C);if(o&&J&&(o===J||z(o)===z(J)||z(o,!1)===z(J,!1))&&(E+=P.text,H.push("text")),T){const A=Object.entries(T).reduce((B,[tt,{value:et,multiplier:ft}])=>{const pt=ft/b*P.attributes;return C.getAttribute(tt)===et?B+pt:B},0);E+=A,A>0&&H.push("attributes")}if(p&&p.toLowerCase()===((W=C.parentElement)==null?void 0:W.tagName.toLowerCase())&&(E+=P.parentTag,H.push("parentTag")),f&&C.parentElement){const A=Object.entries(Q).reduce((B,[tt,{value:et,multiplier:ft}])=>{var xt;const pt=ft/F*P.parentAttributes;return((xt=C.parentElement)==null?void 0:xt.getAttribute(tt))===et?B+pt:B},0);E+=A,A>0&&H.push("attributes")}const Et=dt({xpath:r,doc:((I=h[N].parentIframe)==null?void 0:I.contentDocument)||void 0});Et&&Et===C&&(E+=P.xpath,H.push("xpath")),E>=Z&&d.push({element:C,score:E,matchMethods:H,parentIframe:h[N].parentIframe})}if(d.length){const N=d.sort((C,J)=>J.score-C.score),E=N[0],H=N.filter(C=>C.score===E.score);if(E&&H.length===1)return{element:E.element,matchMethod:E.matchMethods.join(", "),parentIframe:E.parentIframe}}if(l){const N=document.querySelector(`[_i_d="${l}"]`);if(N)return{element:N,matchMethod:"ai_fallback"}}return{element:null,matchMethod:null}},St=({doc:e,text:n,tag:r,selector:a,xpath:o,attributes:l,actionId:s,docParentIframe:f,wasInIframe:p,iframeAttributes:i,callback:m})=>{var F,Q;let d=[],h=null;const b=Qe({iframe:(F=e==null?void 0:e.defaultView)==null?void 0:F.frameElement,iframeAttributes:i});if((b||!i)&&(h=m({doc:e,text:n,tag:r,selector:a,xpath:o,attributes:l,actionId:s})),h&&d.push({element:h,parentIframe:f}),p===!1&&!i||b&&h)return d;const T=e.querySelectorAll("iframe");for(let Z=0;Z<T.length;Z+=1){const K=T[Z];try{const W=K.contentDocument||((Q=K.contentWindow)==null?void 0:Q.document);if(W){const I=St({doc:W,docParentIframe:K,text:n,tag:r,selector:a,xpath:o,attributes:l,actionId:s,wasInIframe:p,iframeAttributes:i,callback:m});if(d=[...d,...I],d.length>1)break}}catch{G("guide_me_iframe_access_error",{actionId:s})}}return d},Vn=({doc:e=document,selector:n,xpath:r,text:a})=>{if(!n)return null;const o=e.querySelectorAll(n);if((o==null?void 0:o.length)>1){if(a){const l=Pt({text:a,doc:e}).find(s=>Array.prototype.includes.call(o,s));if(l)return l}if(r){const l=dt({xpath:r,doc:e});if(Array.from(o).find(s=>s===l))return l}}return(o==null?void 0:o.length)===1?o[0]:null},Ze=({attributes:e,selector:n,xpath:r,tag:a,text:o,aiFallbackElementId:l,actionId:s,wasInIframe:f,iframeAttributes:p})=>{if(o&&z(o)){const i=St({doc:document,text:o,tag:a,selector:n,xpath:r,attributes:e,actionId:s,wasInIframe:f,iframeAttributes:p,callback:m=>cn({doc:m.doc,text:m.text,tag:m.tag})});if(i.length===1)return{...i[0],matchMethod:"text"}}if(e){const i=St({doc:document,text:o,tag:a,selector:n,xpath:r,attributes:e,actionId:s,wasInIframe:f,iframeAttributes:p,callback:m=>oe({doc:m.doc,attributes:m.attributes,actionId:m.actionId,tag:m.tag})});if(i.length===1)return{...i[0],matchMethod:"attributes"}}if(n){const i=St({doc:document,text:o,tag:a,selector:n,xpath:r,attributes:e,actionId:s,wasInIframe:f,iframeAttributes:p,callback:m=>Vn({doc:m.doc,selector:m.selector,text:m.text,xpath:m.xpath})});if(i.length===1)return{...i[0],matchMethod:"selector"}}if(r){const i=St({doc:document,text:o,tag:a,selector:n,xpath:r,attributes:e,actionId:s,wasInIframe:f,iframeAttributes:p,callback:m=>dt({doc:m.doc,xpath:m.xpath})});if(i.length===1)return{...i[0],matchMethod:"xpath"}}if(l){const i=document.querySelector(`[_i_d="${l}"]`);if(i)return{element:i,matchMethod:"ai_fallback"}}return{element:null,matchMethod:null}},Kn=e=>{chrome.storage.local.set({liveAction:JSON.stringify(e)})},Jn=()=>{chrome.storage.local.remove("liveAction")},Qn=()=>new Promise(e=>{chrome.storage.local.get("liveAction",n=>{const r=n.liveAction?JSON.parse(n.liveAction):void 0;e(r)})}),tn=e=>{chrome.storage.local.set({displayErrorToasts:e})},Zn=e=>{chrome.storage.local.get("isGuiding",n=>{chrome.storage.local.set({isGuiding:e.toString()}),n.isGuiding==="false"&&e===!0?chrome.storage.local.set({guideMeSessionId:Oe()}):n.isGuiding==="true"&&e===!1&&chrome.storage.local.set({guideMeSessionId:""})}),e||tn([])},tr=()=>new Promise(e=>{chrome.storage.local.get("isGuiding",n=>{const r=n.isGuiding==="true";e(r)})}),er=e=>{chrome.storage.local.set({canEdit:e.toString()})},nr=()=>new Promise(e=>{chrome.storage.local.get("canEdit",n=>{const r=n.canEdit==="true";e(r)})}),en=()=>new Promise(e=>{chrome.storage.local.get("guideMeSessionId",n=>{e(n.guideMeSessionId)})}),q=e=>e instanceof HTMLElement?e.innerText||e.textContent||"":e.textContent||"",z=(e,n=!0)=>{if(!e||e.trim()==="")return"";let r=e.trim().toLowerCase();return n?[r]=r.split(`
`):r.replace(/\n/g," "),[r]=r.split("	"),r=r.replace(/[^a-z]/g,""),r},Pt=({text:e,doc:n=document})=>{var r;return(r=Array.from(n.querySelectorAll("*")))==null?void 0:r.filter(a=>{var o;return(o=q(a))==null?void 0:o.includes(e)})},dt=({xpath:e,doc:n=document})=>{var a;if(!n)return null;let r=null;return e&&(r=(a=n.evaluate(e,n,null,XPathResult.FIRST_ORDERED_NODE_TYPE,null))==null?void 0:a.singleNodeValue),r},oe=({attributes:e,tag:n,actionId:r,doc:a=document})=>{if(!e)return null;const o=Object.entries(e).reduce((f,[p,i])=>`${f}[${CSS.escape(p)}="${CSS.escape(i)}"]`,""),l=a.querySelectorAll(`${n}${o}`);if(l.length===1)return l[0];if(l.length!==1){const[f,p]=Object.entries(e).reduce(([i,m],[d,h])=>{const b=Ot.includes(d)?i:`${i}[${CSS.escape(d)}="${CSS.escape(h)}"]`,T=Kt.includes(d)?`${m}[${CSS.escape(d)}="${CSS.escape(h)}"]`:m;return[b,T]},["",""]);if(f){const i=a.querySelectorAll(`${n}${f}`);if(i.length===1)return i[0]}if(p){const i=a.querySelectorAll(`${n}${p}`);if(i.length===1)return i[0]}}const{guideMeIndividualAttrMatch:s}=ke(Ce.getState());return s?hr({attributes:e,tag:n,actionId:r,doc:a}):null},nn=(e,n=document)=>{var a,o;const r=Array.from(n.querySelectorAll("iframe"));for(let l=0;l<r.length;l+=1){const s=r[l];if(((a=s.contentDocument)==null?void 0:a.querySelector(e))!==null)return s;const f=s.contentDocument||((o=s.contentWindow)==null?void 0:o.document);if(f)return nn(e,f)}return null},rn=({selector:e,xpath:n,text:r})=>{var s;const a=nn(e),o=(s=a==null?void 0:a.contentDocument)==null?void 0:s.querySelectorAll(e),l=(o==null?void 0:o.length)&&o||document.querySelectorAll(e);if((l==null?void 0:l.length)>1){if(r){const f=Pt({text:r}).find(p=>Array.prototype.includes.call(l,p));if(f)return{element:f,parentIframe:a,matchedIframeChildren:o}}if(n){const f=dt({xpath:n});if(Array.from(l).find(p=>p===f))return{element:f,parentIframe:a,matchedIframeChildren:o}}}return{element:l.length===1?l[0]:null,parentIframe:a,matchedIframeChildren:o}},an=["a","button","details","summary",'[role="button"]','[role="link"]','[role="menuitem"]','[role="treeitem"]'],rr=["input","textarea","select","option","label",'[tabindex]:not([tabindex="-1"])',"[contenteditable]",'[role="option"]'],on=[...an,...rr],ln=e=>{const n=e.matches(on.join(", ")),r=e instanceof HTMLElement?e.hasAttribute("tabindex"):!1,a=e.hasAttribute("onclick")||e.hasAttribute("onkeydown")||e.hasAttribute("onkeypress")||e.hasAttribute("onkeyup"),o=window.getComputedStyle(e).cursor==="pointer",l=getComputedStyle(e),s=e.getBoundingClientRect();return l.display==="none"||l.visibility==="hidden"||l.opacity==="0"||s.width===0&&s.height===0?!1:n||a||o||r},ar=(e=document)=>Array.from(e.querySelectorAll("*")).filter(n=>ln(n)),cn=({doc:e=document,text:n,tag:r})=>{const a=z(n);if(!a)return null;const o=e.querySelectorAll(r),l=[];if(o.forEach(i=>{z(q(i))===a&&l.push(i)}),l.length===1)return l[0];if(l.length>1){const i=[];if(l.forEach(m=>{q(m)===n&&i.push(m)}),i.length===1)return i[0]}const s=ar(e).filter(i=>z(q(i)||"").includes(a));if(s.length===1)return s[0];if(s.length>1){const i=[];if(s.forEach(m=>{q(m)===n&&i.push(m)}),i.length===1)return i[0]}const f=Pt({doc:e,text:a}),p=Pt({doc:e,text:n});if(f.length===1)return f[0];if(f.length>1){const i=[];if(p.forEach(m=>{q(m)===n&&i.push(m)}),i.length===1)return i[0]}return null},or=(e,n,r,a,o,l,s)=>{const f=cn({tag:n,text:e});if(f)return{element:f,matchMethod:"text"};const p=oe({attributes:o,tag:n,actionId:l});if(p)return{element:p,matchMethod:"attributes"};const i=z(e);if(r){const{element:d,parentIframe:h,matchedIframeChildren:b}=rn({selector:r,xpath:a,text:e});if(d&&(z(q(d)??"")===i||q(d)===e))return{element:d,matchMethod:"selector",parentIframe:h,matchedIframeChildren:b}}const m=dt({xpath:a});if(m&&(z(q(m)??"")===i||q(m)===e))return{element:m,matchMethod:"xpath"};if(s){const d=document.querySelector(`[_i_d="${s}"]`);if(d)return{element:d,matchMethod:"ai_fallback"}}return{element:null,matchMethod:null}},ir=({attributes:e,selector:n,xpath:r,tag:a,text:o,aiFallbackElementId:l,actionId:s})=>{if(o)return or(o,a,n,r,e,s,l);if(!o){const f=oe({attributes:e,tag:a,actionId:s});if(f)return{element:f,matchMethod:"attributes"};if(n){const{element:i,parentIframe:m,matchedIframeChildren:d}=rn({selector:n,xpath:r,text:o});if(i)return{element:i,matchMethod:"selector",parentIframe:m,matchedIframeChildren:d}}const p=dt({xpath:r});if(p)return{element:p,matchMethod:"xpath"};if(l){const i=document.querySelector(`[_i_d="${l}"]`);if(i)return{element:i,matchMethod:"ai_fallback"}}}return{element:null,matchMethod:null}},lr=({selector:e,attributes:n,xpath:r,tag:a,text:o,algoVersion:l,algoV3Enabled:s,isAiFallbackEnabled:f,isAiFallbackAlwaysOnEnabled:p,aiFallbackElementId:i,actionId:m,wasInIframe:d,iframeAttributes:h,parentAttributes:b,parentTag:T})=>{if(f&&p)return i?{element:document.querySelector(`[_i_d="${i}"]`),matchMethod:"ai_fallback",algorithm:"ai_fallback"}:{element:null,matchMethod:null,algorithm:"ai_fallback"};if(l==="v4"){const F=Xn({selector:e,xpath:r,tag:a,text:o,attributes:n,parentAttributes:b,parentTag:T,aiFallbackElementId:i,wasInIframe:d,iframeAttributes:h,actionId:m});return F.element?{...F,algorithm:"v4"}:{...Ze({selector:e,xpath:r,tag:a,text:o,attributes:n,aiFallbackElementId:i,actionId:m,wasInIframe:d,iframeAttributes:h}),algorithm:"v3"}}return s?{...Ze({selector:e,xpath:r,tag:a,text:o,attributes:n,aiFallbackElementId:i,actionId:m,wasInIframe:d,iframeAttributes:h}),algorithm:"v3"}:{...ir({selector:e,xpath:r,tag:a,text:o,attributes:n,aiFallbackElementId:i,actionId:m}),algorithm:"text matching"}},cr=e=>{chrome.storage.local.set({liveActionMatches:e})},sr=()=>new Promise(e=>{chrome.storage.local.get("liveActionMatches",n=>{const r=n.liveActionMatches?n.liveActionMatches:[];e(r)})}),G=(e,n)=>{en().then(r=>{Vt(e,{...n,sessionId:r})}).catch(()=>{Vt(e,n)})},ur=async({actionId:e,matchMethod:n,url:r,algorithm:a})=>{const o=await sr()||[];o.find(l=>l.actionId===e)||(G("matching_algorithm_guide_me",{actionId:e,matchMethod:n,algorithm:a}),cr([...o,{actionId:e,method:n,url:r}]))},mr=()=>new Promise(e=>{chrome.storage.local.get("displayErrorToasts",n=>{const r=n.displayErrorToasts?n.displayErrorToasts:[];e(r)})}),dr=async({api:e,scribeId:n,actionId:r})=>{const a={name:`${Oe()}.html`,is_scribe_live:!0,scribe_live_scribe_id:n,scribe_live_action_id:r};try{const o=await e.post("/signed_urls/",a),{upload_url:l,download_url:s}=o.data;return{uploadUrl:l,downloadUrl:s}}catch(o){return console.error("Error fetching signed URL:",o),{uploadUrl:"",downloadUrl:""}}},fr=async({documentId:e,actionId:n,domString:r,uploadUrl:a})=>{try{const o=new AbortController,l=setTimeout(()=>o.abort(),6e4),s=await fetch(a,{method:"PUT",body:r,headers:{"Content-Type":"text/html"},signal:o.signal});if(clearTimeout(l),!s.ok)throw new Error(`Upload failed with status ${s.status}`);G("guide_me_s3_dom_upload_success",{documentId:e,actionId:n})}catch(o){console.error("Error uploading DOM to S3:",o),G("guide_me_s3_dom_upload_error",{documentId:e,actionId:n,error:o})}},pr=async({api:e,documentId:n,actionId:r,type:a,domString:o,trackingDetails:l})=>{if(!r)return;const s=await mr()||[],f=s.find(h=>h.actionId===r),p=Ce.getState(),{guideMeSaveDom:i,domUpload:m}=ke(p);let d="different_page_fallback_guide_me";if(a==="selector_not_found"?d="refer_to_screenshot_fallback_guide_me":a==="selector_found"&&(d="click_target_displayed_guide_me"),!f&&i&&o&&m){const{uploadUrl:h,downloadUrl:b}=await dr({api:e,scribeId:n,actionId:r});h&&await fr({documentId:n,actionId:r,domString:o,uploadUrl:h}),G(d,{documentId:n,actionId:r,type:a,s3Url:b,...l}),tn([...s,{actionId:r}]);return}G(d,{documentId:n,actionId:r,type:a,...l})},hr=({attributes:e,tag:n,actionId:r,doc:a=document})=>{const[o,l]=Object.entries(e).reduce(([i,m],[d,h])=>{const b=CSS.escape(h),T=Ot.includes(d),F=Kt.includes(d);return[T?i:{...i,[d]:b},F?{...m,[d]:b}:m]},[{},{}]);if(l!=null&&l.name){const i=a.getElementsByName(l.name);if(G("matching_algorithm_guide_me",{actionId:r,matchMethod:"attr-name"}),i.length===1)return i[0]}const s=new Set;for(const[i,m]of Object.entries(l)){const d=`${n}[${CSS.escape(i)}="${CSS.escape(m)}"]`,h=a.querySelectorAll(d);for(const b of h)s.add(b)}if(s.size===1)return G("matching_algorithm_guide_me",{actionId:r,matchMethod:"attr-prioritized"}),[...s][0];const f=new Set;for(const[i,m]of Object.entries(o)){const d=`${n}[${CSS.escape(i)}="${CSS.escape(m)}"]`,h=a.querySelectorAll(d);for(const b of h)f.add(b)}if(f.size===1)return G("matching_algorithm_guide_me",{actionId:r,matchMethod:"attr-deprioritized"}),[...f][0];const p=new Set;for(const[i,m]of Object.entries(e)){const d=`${n}[${CSS.escape(i)}="${CSS.escape(m)}"]`,h=a.querySelectorAll(d);for(const b of h)p.add(b)}return p.size===1?(G("matching_algorithm_guide_me",{actionId:r,matchMethod:"attr-any"}),[...p][0]):null},gr=()=>{const e=(r,a)=>{var l,s;const o=r.querySelectorAll("iframe");for(let f=o.length-1;f>=0;f-=1)try{const p=o[f],i=p.contentDocument||((l=p.contentWindow)==null?void 0:l.document),m=a.querySelectorAll("iframe")[f];if(i&&i.body){const d=Re(i==null?void 0:i.body);e(i,d);const h=r.createElement("div");h.setAttribute("scribe-data-replaced-iframe-src",p.src);const b=(s=i==null?void 0:i.body)==null?void 0:s.innerHTML;b&&(h.innerHTML=Ve.sanitize(b)),m.replaceWith(h)}}catch{const p=a.querySelectorAll("iframe")[f];p&&p.setAttribute("scribe-data-error","Could not inline iframe content")}},n=Re(document==null?void 0:document.body);return e(document,n),n.outerHTML};export{on as I,De as M,_n as a,An as b,G as c,gr as d,en as e,lr as f,tr as g,nr as h,ln as i,Qn as j,Tn as k,an as l,Jn as m,pr as n,Kn as o,Ve as p,er as q,Zn as s,ur as t};
