import{p as w}from"./appTagUtils-c74c75cd.js";const f="ExtensionPreferences",g=1,s="settings",p="allowedDomains",d="allowedAppTags";let u=null;const y=()=>u?Promise.resolve(u):new Promise((n,t)=>{const e=indexedDB.open(f,g);e.onupgradeneeded=()=>{const r=e.result;r.objectStoreNames.contains(s)||r.createObjectStore(s,{keyPath:"key"})},e.onsuccess=()=>{u=e.result,n(u)},e.onerror=()=>t(e.error)}),A=async()=>{const n=await y();return new Promise(t=>{const e=n.transaction(s,"readonly").objectStore(s).get(p);e.onsuccess=()=>{var c;const r=(c=e.result)==null?void 0:c.value,a=Array.isArray(r)?r:[],i=Array.from(new Set(a.map(o=>{try{const m=String(o||"").trim().toLowerCase().replace(/^https?:\/\//,"").split("/")[0],l=w(m);return l?l.toLowerCase():null}catch{return null}}).filter(Boolean)));t(i)},e.onerror=()=>t([])})},S=async n=>{const t=await y();return new Promise((e,r)=>{const a=t.transaction(s,"readwrite").objectStore(s),i=Array.from(new Set((Array.isArray(n)?n:[]).map(o=>{try{const m=String(o||"").trim().toLowerCase().replace(/^https?:\/\//,"").split("/")[0],l=w(m);return l?l.toLowerCase():null}catch{return null}}).filter(Boolean))),c=a.put({key:p,value:i});c.onsuccess=()=>e(),c.onerror=()=>r(c.error)})},b=async n=>{const t=await y();return new Promise((e,r)=>{const a=t.transaction(s,"readwrite").objectStore(s).put({key:d,value:n});a.onsuccess=()=>e(),a.onerror=()=>r(a.error)})},P=async()=>{const n=await y();return new Promise(t=>{const e=n.transaction(s,"readonly").objectStore(s).get(d);e.onsuccess=()=>{var c;const r=(c=e.result)==null?void 0:c.value,a=o=>!!o&&typeof o=="object"&&"domain"in o&&typeof o.domain=="string",i=Array.isArray(r)?r.filter(a).map(o=>({...o,domain:o.domain.toLowerCase()})):[];t(i)},e.onerror=()=>t([])})};export{S as a,A as b,P as g,b as s};
