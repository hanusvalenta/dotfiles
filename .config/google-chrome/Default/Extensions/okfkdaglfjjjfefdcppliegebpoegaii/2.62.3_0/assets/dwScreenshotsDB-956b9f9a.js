const p="DWScreenshotsDB",u="screenshots",l=()=>new Promise((a,c)=>{const n=indexedDB.open(p,1);n.onupgradeneeded=t=>{const s=t.target.result;s.objectStoreNames.contains(u)||s.createObjectStore(u,{keyPath:"action_id"})},n.onsuccess=t=>{a(t.target.result)},n.onerror=()=>c(n.error)});async function b(a,c){const n=await l(),t=n.transaction([u],"readwrite"),s=t.objectStore(u),i={action_id:a,blob:c,stored_at_ms:Date.now()};await new Promise((e,o)=>{const r=s.put(i);r.onsuccess=()=>e(),r.onerror=()=>o(r.error),t.oncomplete=()=>n.close(),t.onerror=()=>o(t.error)});try{await m()}catch{}}async function f(a){const c=await l(),n=c.transaction([u],"readonly"),t=n.objectStore(u);return new Promise((s,i)=>{const e=t.get(a);e.onsuccess=()=>{const o=e.result;s((o==null?void 0:o.blob)??null)},e.onerror=()=>i(e.error),n.oncomplete=()=>c.close()})}async function m(){const a=Date.now()-12096e5,c=await l(),n=c.transaction([u],"readwrite"),t=n.objectStore(u);let s=0;return await new Promise((i,e)=>{const o=t.openCursor();o.onsuccess=()=>{const r=o.result;if(!r){i();return}const w=r.value;if(typeof(w==null?void 0:w.stored_at_ms)=="number"&&w.stored_at_ms<a){const d=r.delete();d.onsuccess=()=>{s+=1,r.continue()},d.onerror=()=>e(d.error)}else r.continue()},o.onerror=()=>e(o.error)}),await new Promise(i=>{n.oncomplete=()=>{c.close(),i()}}),s}async function _(){const a=await l(),c=a.transaction([u],"readonly"),n=c.objectStore(u),t=[];return await new Promise((s,i)=>{const e=n.openCursor();e.onsuccess=()=>{const o=e.result;if(!o){s();return}const r=o.value;r!=null&&r.action_id&&t.push(r.action_id),o.continue()},e.onerror=()=>i(e.error)}),await new Promise(s=>{c.oncomplete=()=>{a.close(),s()}}),t}async function y(){const a=await l(),c=a.transaction([u],"readwrite"),n=c.objectStore(u);let t=0;return await new Promise((s,i)=>{const e=n.openCursor();e.onsuccess=()=>{const o=e.result;if(!o){s();return}const r=o.delete();r.onsuccess=()=>{t+=1,o.continue()},r.onerror=()=>i(r.error)},e.onerror=()=>i(e.error)}),await new Promise(s=>{c.oncomplete=()=>{a.close(),s()}}),t}export{m as a,y as c,f as g,_ as l,l as o,b as p};
