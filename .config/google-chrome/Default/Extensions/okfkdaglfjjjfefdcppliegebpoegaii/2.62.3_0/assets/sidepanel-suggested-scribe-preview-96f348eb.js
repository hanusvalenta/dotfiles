import"./modulepreload-polyfill-3cfb730f.js";import{j as s,c as Y}from"./Icon-709cfd25.js";import{r as u,R as Ve}from"./index-8b3efc3f.js";import{c as Ye}from"./client-e8432e69.js";import{u as Re,P as Ze}from"./react-redux-52a3bd12.js";import{w as Je,x as Ke,z as O,C as Z,m as J,D as Ne,F as Qe,G as De,H as et,I as tt,s as it}from"./store-09c6166c.js";import{p as st}from"./production-ca86ce5a.js";import{c as at,d as rt,e as $e,g as nt}from"./index-7ec85ebb.js";import{B as ot,t as ct,g as lt}from"./Badge-efc00514.js";import{D as dt}from"./DocumentIcon-a843a224.js";import{u as ut}from"./useBackgroundReduxState-a039e2db.js";import{g as ht,i as Ue,h as ze}from"./dwResultsDB-40675cfa.js";import{g as le,p as mt}from"./dwScreenshotsDB-956b9f9a.js";import{l as Ce}from"./dw-telemetry-83cc94a3.js";import{B as ae}from"./Button-28102c4e.js";import{T as pt}from"./Toolbar-76b5973a.js";import"./_commonjsHelpers-de833af9.js";import"./v4-c70744d4.js";import"./index-e309a1d1.js";import"./index-7bc06dca.js";import"./appTagUtils-c74c75cd.js";const ft="FB923C",Pe=(a,r)=>{const m=Math.floor(r*255).toString(16).padStart(2,"0");return`${a}${m}`},gt=({x:a,y:r,color:m,animate:h})=>{const e=m||ft;return s.jsx("div",{"data-testid":"action-click-target",className:Y("pointer-events-none absolute left-0 top-0 size-11 overflow-hidden rounded-full border-2 transition-transform duration-300 will-change-[translate] group-hover:scale-125",h?"transition-[translate,transform]":"transition-transform"),style:{translate:`calc(-50% + ${a}px) calc(-50% + ${r}px)`,borderColor:Pe(`#${e}`,.75),backgroundColor:Pe(`#${e}`,.5)}})},_t=.3,wt=1.5,ge=.1,bt=({scale:a,minScale:r=_t,maxScale:m=wt,onChange:h,className:e})=>{const H=x=>Math.round(x*10)/10,j=u.useCallback(x=>M=>{M.stopPropagation();const v=a+(x==="in"?ge:-ge),P=H(v),p=P<r&&r||P>m&&m||P;(x==="in"&&P<=m||x==="out"&&P>=r)&&h(p)},[a,r,m,h]);return s.jsxs("div",{className:Y("flex flex-col space-y-1 absolute bottom-2 right-2 z-1 bg-slate-800 bg-opacity-30 backdrop-blur-sm rounded-full p-1.5",e),children:[s.jsx(ae,{className:Y("flex items-center justify-center w-7 h-7 text-white rounded-full",a+ge>m?"opacity-50 cursor-not-allowed":"hover:bg-slate-700/50"),onClick:j("in"),disabled:a+ge>m,title:"Zoom in",icon:at,variant:"ghost",size:"small"}),s.jsx(ae,{className:Y("flex items-center justify-center w-7 h-7 text-white rounded-full",a<=r?"opacity-50 cursor-not-allowed":"hover:bg-slate-700/50"),onClick:j("out"),disabled:a<=r,title:"Zoom out",icon:rt,variant:"ghost",size:"small"})]})},xt=.7,Ie=.3,Me=1.5,_e=a=>a&&typeof a=="object"&&"x"in a&&"y"in a&&typeof a.x=="number"&&typeof a.y=="number",Ae=({screenshot:a,clickPosition:r,altText:m="",className:h})=>{var D,me;const e=u.useRef(null),[H,j]=u.useState(!1),[x,M]=u.useState({x:0,y:0}),[v,P]=u.useState(xt),[p,re]=u.useState({width:0,height:0}),[z,ne]=u.useState(!1),[de,ue]=u.useState(window.devicePixelRatio||1),K=u.useRef(!1);u.useEffect(()=>{const c=()=>{ue(window.devicePixelRatio||1)},w=window.matchMedia(`(resolution: ${window.devicePixelRatio}dppx)`);return w.addEventListener("change",c),()=>{w.removeEventListener("change",c)}},[]),u.useEffect(()=>{const c=()=>{M(w=>({...w}))};return window.addEventListener("resize",c),()=>window.removeEventListener("resize",c)},[]);const I=((D=e.current)==null?void 0:D.clientWidth)||0,A=((me=e.current)==null?void 0:me.clientHeight)||0,we=p.width&&p.height?Math.max(I/p.width,A/p.height):0,Q=Math.max(Ie,we||0),be=p.width*v>I,xe=p.height*v>A,q=be||xe,R=u.useCallback((c,w)=>{const i=p.width*c,n=p.height*c,_=I-i,g=A-n,S=i>I?_/2:0,X=n>A?g/2:0;return{x:Math.min(Math.max(w.x,S),-S),y:Math.min(Math.max(w.y,X),-X)}},[p,I,A]);u.useEffect(()=>{z&&M(c=>R(v,c))},[z,R,v]),u.useCallback(()=>{if(_e(r)){const c=p.width/2,w=p.height/2,i=r.x,n=r.y;return{x:(c-i)*v,y:(w-n)*v}}return x},[r,p,v,x]);const U=u.useCallback(c=>{if(!q||c.button!==0)return;c.preventDefault(),j(!0);const w=c.clientX-x.x,i=c.clientY-x.y,n=g=>{const S=R(v,{x:g.clientX-w,y:g.clientY-i});M(S)},_=()=>{j(!1),document.removeEventListener("mousemove",n),document.removeEventListener("mouseup",_)};document.addEventListener("mousemove",n),document.addEventListener("mouseup",_)},[q,x,R]),oe=r&&z?{x:r.x*v+x.x+(I-p.width*v)/2,y:r.y*v+x.y+(A-p.height*v)/2}:null,ye=c=>{const w=c.currentTarget,{naturalWidth:i}=w,{naturalHeight:n}=w;re({width:i,height:n}),ne(!0)},he=u.useCallback(c=>{const w=c/v;if(_e(r)){const i=p.width/2,n=p.height/2,_=(i-r.x)*c,g=(n-r.y)*c;M(R(c,{x:_,y:g}))}else{const i=x.x*w,n=x.y*w;M(R(c,{x:i,y:n}))}P(c)},[r,p.height,p.width,R,v,x]);return u.useEffect(()=>{if(!(!z||p.width===0||p.height===0)){if(!K.current&&I>0&&A>0){const c=Math.min(Math.max(Q,Ie),Me);if(_e(r)){const w=p.width/2,i=p.height/2,n=(w-r.x)*c,_=(i-r.y)*c;M(R(c,{x:n,y:_}))}else M(R(c,{x:0,y:0}));P(c),K.current=!0;return}if(v<Q){const c=Math.min(Math.max(Q,Ie),Me);if(_e(r)){const w=p.width/2,i=p.height/2,n=(w-r.x)*c,_=(i-r.y)*c;M(R(c,{x:n,y:_}))}else{const w=c/v,i=x.x*w,n=x.y*w;M(R(c,{x:i,y:n}))}P(c)}else M(c=>R(v,c))}},[I,A,p.width,p.height,z,v,r,R,x.x,x.y,Q]),s.jsxs("div",{ref:e,className:Y("relative flex items-center justify-center overflow-hidden rounded-lg group",h),style:{height:"100%",width:"100%"},children:[s.jsxs("div",{className:"relative flex items-center justify-center bg-slate-100 h-full w-full",children:[a&&s.jsx("img",{src:a,alt:m,className:Y("select-none transition-opacity duration-300 max-w-none",!H&&"transition-[translate,scale] will-change-[translate,scale]",q?H?"cursor-grabbing":"cursor-grab":"cursor-default"),style:{translate:`${x.x}px ${x.y}px`,scale:`${v}`,opacity:z?1:0},onMouseDown:U,onLoad:ye}),oe&&z&&s.jsx(gt,{x:oe.x,y:oe.y,animate:!H}),z&&s.jsx(bt,{scale:v,minScale:Q,maxScale:Me,onChange:he})]}),s.jsx("div",{className:"pointer-events-none absolute inset-0 rounded-lg shadow-inner"})]})},Be=({onBack:a,children:r,totalScribes:m,className:h})=>s.jsxs("div",{className:Y("flex flex-col h-screen pt-4",h),children:[s.jsx(pt,{className:"px-4",onVisitWorkspaceDocuments:()=>{},onGoToOptionsPage:()=>{},onBack:a,showTeamSelector:!1,showHomeIcon:!1,showSettingsIcon:!1,centerContent:s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx("h4",{className:"text-md font-semibold m-0",children:"Discovered Workflow"}),typeof m=="number"&&m>0&&s.jsx(ot,{children:m})]})}),r]}),te=a=>{var m,h;if(!a)return"";const r=(h=(m=a==null?void 0:a.actions)==null?void 0:m[0])==null?void 0:h.url;if(r)try{return new URL(r).hostname.replace(/^www\./,"")}catch{}return""};function yt(a){var h,e,H;const r=(e=(h=a==null?void 0:a.active_organization)==null?void 0:h.super_organization)==null?void 0:e.id,m=(H=a==null?void 0:a.active_organization)==null?void 0:H.id;return!r||!m?null:`${r}|${m}`}function We(a){if(a!=null){if(typeof a=="number")return a<2e12?a*1e3:a;if(typeof a=="string"){const r=a.trim();if(/^\d+$/.test(r)){const h=Number(r);return h<2e12?h*1e3:h}const m=Date.parse(r);return Number.isNaN(m)?void 0:m}}}const vt=688,kt=384;function Te(a){try{const r=Number(a==null?void 0:a.width),m=Number(a==null?void 0:a.height);if(!r||!m)return;const h=vt/r,e=kt/m;return Math.max(h,e)*1.08}catch{return}}const jt=()=>{ut();const{userData:a}=Re(Je),r=Re(Ke),m=!!((r==null?void 0:r.lrr2025)??(r==null?void 0:r.lrr_2025)),h=u.useMemo(()=>yt(a),[a]),[e,H]=u.useState(null),[j,x]=u.useState([]),[M,v]=u.useState([]),[P,p]=u.useState(!0),[re,z]=u.useState(!1),[ne,de]=u.useState(!1),[ue,K]=u.useState(null),[I,A]=u.useState(new Set),[we,Q]=u.useState(null),[be,xe]=u.useState(""),[q,R]=u.useState(0),[U,oe]=u.useState(0),ye=u.useRef(null),he=u.useCallback(async i=>{var n;try{if(p(!0),!m)throw new Error("DW disabled");if(!h)throw new Error("Missing org context");const _=(n=await ht(h))==null?void 0:n.payload,g=(Array.isArray(_==null?void 0:_.scribes)?_.scribes:[]).find(o=>(o==null?void 0:o.suggestion_id)===i||(o==null?void 0:o.id)===i)||null;if(!g)throw new Error("Scribe not found");H(g),xe((g==null?void 0:g.description)||"");const S=[];for(const o of g.actions||[]){if(!(typeof(o==null?void 0:o.id)=="string"&&o.id.startsWith("stack_"))){const y=await le(o.id),B=(o.description||o.current_description||o.short_description||"").trim()||(o.kind==="keyboard_sequence_action"?"Type here":o.kind||"Action");if(S.push({id:o.id,description:B,screenshot:y||void 0,type:o.type,kind:o.kind,url:o.url||"",position:o.position||void 0,has_screenshot:!!y}),!y)try{Ce("DW.Data.ScreenshotMissing",{actionId:o.id})}catch{}continue}const W=Array.isArray(o==null?void 0:o.actions)?o.actions:[];let ie;for(const y of W)typeof(y==null?void 0:y.stack_short_description)=="string"&&y.stack_short_description.trim()?ie=y.stack_short_description.trim():typeof(y==null?void 0:y.stack_description)=="string"&&y.stack_description.trim()&&(ie=y.stack_description.trim());let k=null,G=null;for(let y=W.length-1;y>=0;y-=1){const B=W[y],V=await le(B==null?void 0:B.id);if(V){k=B,G=V;break}}!k&&W.length>0&&(k=W[W.length-1]);let T;for(let y=W.length-1;y>=0;y-=1){const B=W[y],V=((B==null?void 0:B.description)||(B==null?void 0:B.current_description)||"").trim();if(V){T=V;break}}const pe=ie&&ie.trim()||k&&(k.description||k.current_description)||T||"No description available";if(G)try{await mt(o.id,G)}catch{}else try{Ce("DW.Data.ScreenshotMissing",{actionId:o.id})}catch{}S.push({id:o.id,description:pe,screenshot:G||void 0,type:(k==null?void 0:k.type)||o.type,kind:(k==null?void 0:k.kind)||o.kind,url:(k==null?void 0:k.url)||o.url||"",position:(k==null?void 0:k.position)||void 0,has_screenshot:!!G})}x(S),v(S),A(new Set),O("suggested_scribe_loaded",{location:"sidepanel_suggested_scribe_preview",scribe_id:i,scribe_title:g==null?void 0:g.title,scribe_domain:te(g),total_steps:S.length,remaining_scribes:U,has_screenshots:S.some(o=>o.screenshot),screenshot_count:S.filter(o=>o.screenshot).length}),await chrome.storage.local.set({previewScribeId:i});const X=new URLSearchParams(window.location.search);X.set("id",i),window.history.replaceState(null,"",`${window.location.pathname}?${X}`)}catch(_){const g=_ instanceof Error?_.message:String(_);O("suggested_scribe_load_failed",{location:"sidepanel_suggested_scribe_preview",scribe_id:i,error_message:g||"Unknown error occurred",remaining_scribes:U}),Q(i),K("An error occurred. Please go back.")}finally{p(!1)}},[m,h,U]);u.useEffect(()=>{if(!m||!h){p(!1);return}(async()=>{let i=new URLSearchParams(window.location.search).get("id");if(i||(i=(await chrome.storage.local.get(["previewScribeId"])).previewScribeId),i){try{if(h&&await Ue(h,i)){await chrome.storage.local.remove(["previewScribeId"]),await Z(J.RecommendedScribes);return}}catch{}he(i)}else K("No scribe ID provided"),p(!1)})()},[he,m,h]),u.useEffect(()=>{const i=async n=>{if((n==null?void 0:n.messageType)==="dwHiddenUpdated")try{if(!h)return;const _=new URLSearchParams(window.location.search),g=await chrome.storage.local.get(["previewScribeId"]),S=_.get("id")||g.previewScribeId;if(!S)return;await Ue(h,S)&&(await chrome.storage.local.remove(["previewScribeId"]),await Z(J.RecommendedScribes))}catch{}};try{chrome.runtime.onMessage.addListener(i)}catch{}return()=>{try{chrome.runtime.onMessage.removeListener(i)}catch{}}},[h]),u.useEffect(()=>{chrome.storage.local.get(["totalSuggestedScribes"]).then(i=>{R(i.totalSuggestedScribes||0)})},[]),u.useEffect(()=>{chrome.storage.local.get(["suggestedScribes","rejectionCount"]).then(i=>{oe(i.suggestedScribes||0)})},[]);const D=async()=>{if(O("suggested_scribe_preview_back_clicked",{location:"sidepanel_suggested_scribe_preview",scribe_id:e==null?void 0:e.id,scribe_title:e==null?void 0:e.title,scribe_domain:e==null?void 0:e.domain,total_steps:M.length,remaining_steps:j.length,deleted_steps_count:I.size,remaining_scribes:U}),ue&&we){await chrome.storage.local.remove(["previewScribeId"]),await Z(J.RecommendedScribes);return}await chrome.storage.local.remove(["previewScribeId"]),U===1?await Z(J.Home):await Z(J.RecommendedScribes)},me=i=>{const n=j.find(g=>g.id===i);O("suggested_scribe_step_deleted",{location:"sidepanel_suggested_scribe_preview",scribe_id:e==null?void 0:e.id,scribe_title:e==null?void 0:e.title,scribe_domain:e==null?void 0:e.domain,step_id:i,step_description:n==null?void 0:n.description,step_type:n==null?void 0:n.type,step_kind:n==null?void 0:n.kind,steps_remaining_after_delete:j.length-1,total_deleted_steps:I.size+1});const _=new Set(I);_.add(i),A(_),x(j.filter(g=>g.id!==i))},c=async()=>{var i,n,_,g,S,X;if(e){O("add_auto_captured_scribe_clicked",{location:"extension",document_id:e.id,scribe_title:e.title,scribe_domain:e.domain,original_steps_count:M.length,final_steps_count:j.length,deleted_steps_count:I.size,remaining_scribes_after_accept:U-1,progress_percentage:q>1?(q-U+1)/q*100:0});try{z(!0);const o=j.filter(l=>!I.has(l.id)),W=l=>new Promise((t,f)=>{const b=new FileReader;b.onloadend=()=>t(typeof b.result=="string"?b.result:""),b.onerror=()=>f(b.error),b.readAsDataURL(l)}),ie=async l=>{const t=async f=>{if(f instanceof Blob)return f;if(typeof f=="string"){if(f.startsWith("data:"))return(await fetch(f)).blob();try{const b=atob(f),N=b.length,E=new Uint8Array(N);for(let $=0;$<N;$++)E[$]=b.charCodeAt($);return new Blob([E],{type:"image/png"})}catch{return new Blob([])}}return new Blob([])};try{const f=await t(l),b=await createImageBitmap(f),N=new OffscreenCanvas(Math.max(1,b.width),Math.max(1,b.height)),E=N.getContext("2d");E&&E.drawImage(b,0,0);const $=await N.convertToBlob({type:"image/jpeg",quality:1});return(await W($)).split(",")[1]||""}catch{return(await W(await t(l))).split(",")[1]||""}},k=async l=>{const t=async f=>{if(f instanceof Blob)return f;if(typeof f=="string"){if(f.startsWith("data:"))return(await fetch(f)).blob();try{const b=atob(f),N=b.length,E=new Uint8Array(N);for(let $=0;$<N;$++)E[$]=b.charCodeAt($);return new Blob([E],{type:"image/png"})}catch{return new Blob([])}}return new Blob([])};try{const f=await t(l),b=await createImageBitmap(f),N=new OffscreenCanvas(Math.max(1,b.width),Math.max(1,b.height)),E=N.getContext("2d");return E&&E.drawImage(b,0,0),await N.convertToBlob({type:"image/jpeg",quality:1})}catch{const f=await t(l);return f.type==="image/jpeg"?f:new Blob([f],{type:"image/jpeg"})}},G=async l=>{var b;if(!l)return null;const t=!!((b=a==null?void 0:a.active_organization)!=null&&b.smart_privacy_screen_enabled),f=(a==null?void 0:a.email)||null;try{if(t){const se=await ie(l),ee=await Ne.post("/sps/",{name:"screenshot",needs_redaction:"True",image_data:se,email:f}),{uploaded_file:ke}=ee.data||{};return{screenshot:ke}}const N=await Ne.post("/signed_urls/",{name:"a screenshot"}),{upload_url:E,internal_url:$,download_url:ve}=N.data||{},ce=await k(l);return await Qe(E,ce,"image/jpeg",{timeout:6e4}),{screenshot_url:$,download_url:ve}}catch{return null}},T=[],pe=l=>{if(!l)return"instruction";const t=String(l).toLowerCase();return t==="mouse_click_action"||t==="keyboard_action"||t==="keyboard_sequence_action"||t==="keyboard_combination_action"||t==="instruction"?t:t.includes("click")?"mouse_click_action":t.includes("keyboard_sequence")?"keyboard_sequence_action":t.includes("keyboard_combination")?"keyboard_combination_action":t.includes("keyboard")?"keyboard_action":t};for(const l of o){if(!(typeof l.id=="string"&&l.id.startsWith("stack_"))){const{screenshot:C,id:F,kind:He,description:qe,url:Fe,position:Oe}=l,Xe=await G(C),je=pe(He),Ee=je==="mouse_click_action",fe=je.startsWith("keyboard_"),d=Array.isArray(e==null?void 0:e.actions)?e.actions.find(Se=>(Se==null?void 0:Se.id)===F):void 0;if(!d)try{Ce("DW.Data.ActionIdMismatch",{actionId:F})}catch{}const Ge={kind:je,description:qe,url:Fe||(d==null?void 0:d.url)||"",timestamp:We(d==null?void 0:d.timestamp),target_xpath:(d==null?void 0:d.target_xpath)||void 0,position:Ee||fe?Oe||(d==null?void 0:d.position):void 0,devicePixelRatio:d==null?void 0:d.devicePixelRatio,viewport:d==null?void 0:d.viewport,scrollPosition:d==null?void 0:d.scrollPosition,default_scale_factor:fe?Te(d==null?void 0:d.viewport):void 0,button:d==null?void 0:d.button,click_count:d==null?void 0:d.click_count,show_position_indicator:Ee?!0:void 0,keys:fe?d==null?void 0:d.keys:void 0,count:fe?d==null?void 0:d.count:void 0,...Xe||{},tempId:F};T.push(Ge);continue}let t=null,f;const b=await le(l.id),N=(i=e==null?void 0:e.actions)==null?void 0:i.find(C=>(C==null?void 0:C.id)===l.id),E=Array.isArray(N==null?void 0:N.actions)?N.actions:[];for(const C of E)if((C==null?void 0:C.kind)==="click"){const F=await le(C.id);if(F){t=C,f=F;break}}if(!t)for(const C of E){const F=await le(C.id);if(F){t=C,f=F;break}}if(!t&&b&&(f=b,t={kind:l.kind,url:l.url,position:l.position}),!t&&!l.description)continue;const $=await G(f),ve=(((_=(n=e==null?void 0:e.actions)==null?void 0:n.find(C=>(C==null?void 0:C.id)===l.id))==null?void 0:_.description)||l.description||(t==null?void 0:t.description)||(t==null?void 0:t.current_description)||"").trim(),ce=pe(t==null?void 0:t.kind),se=ce==="mouse_click_action",ee=ce.startsWith("keyboard_"),ke={url:(t==null?void 0:t.url)||l.url||"",timestamp:We(t==null?void 0:t.timestamp),target_xpath:(t==null?void 0:t.target_xpath)||void 0,position:se||ee?t==null?void 0:t.position:void 0,kind:se?"mouse_click_action":ee?ce:"instruction",devicePixelRatio:t==null?void 0:t.devicePixelRatio,viewport:t==null?void 0:t.viewport,scrollPosition:t==null?void 0:t.scrollPosition,default_scale_factor:ee?Te(t==null?void 0:t.viewport):void 0,button:t==null?void 0:t.button,click_count:t==null?void 0:t.click_count,show_position_indicator:se?!0:void 0,keys:ee?t==null?void 0:t.keys:void 0,count:ee?t==null?void 0:t.count:void 0,description:ve||(se&&(t!=null&&t.url)?`Navigate to ${t.url}`:"Instruction"),...$||{},tempId:l.id};T.push(ke)}if(T.length>0&&T[0].kind!=="instruction"){const l=T.find(t=>!!t.url)||T[0];T.unshift({kind:"instruction",description:l.url?`Navigate to ${l.url}`:"Start",url:l.url,tempId:`instr_${Date.now()}`})}const y=(g=a==null?void 0:a.active_organization)==null?void 0:g.id;if(!y)throw new Error("No active organization found");const B={name:e.title,actions:T,recorder_type:"web",recorder_os:De(),created_with_copilot:!1,create_with_id:!0,id:crypto!=null&&crypto.randomUUID?crypto.randomUUID():`${Date.now()}`,entry_point:"extension",insert_before_action:null,organization_id:y,task_id:"",transcribed_audio:null,capture_type:et.ExtensionAutoCapture},V=be||e.description;V&&(B.description=V);const L=await Ne.post("/scribe_file/",B);if(!(L!=null&&L.status)||!(L.status>=200&&L.status<300))throw new Error("Failed to create scribe");O("suggested_scribe_created_successfully",{location:"sidepanel_suggested_scribe_preview",scribe_id:e==null?void 0:e.suggestion_id,scribe_title:e==null?void 0:e.title,scribe_domain:te(e)});try{const l=(e==null?void 0:e.suggestion_id)||(e==null?void 0:e.id);h&&l&&await ze(h,l)}catch{}try{const l=(S=L==null?void 0:L.data)==null?void 0:S.id,t=(X=L==null?void 0:L.data)==null?void 0:X.name;l&&t&&chrome.tabs.create({url:tt(l,t)})}catch{}try{chrome.runtime.sendMessage({messageType:"dwHiddenUpdated"})}catch{}await chrome.storage.local.remove(["previewScribeId"]),U<=1?await Z(J.Home):await Z(J.RecommendedScribes),z(!1)}catch(o){O("suggested_scribe_accept_failed",{location:"sidepanel_suggested_scribe_preview",scribe_id:e==null?void 0:e.suggestion_id,scribe_title:e==null?void 0:e.title,scribe_domain:te(e),error_message:o instanceof Error?o.message:"Unknown error",final_steps_count:j.length,deleted_steps_count:I.size}),K(o instanceof Error?o.message:"Unknown error occurred"),z(!1)}}},w=async()=>{if(e){O("auto_captured_scribe_clicked",{location:"extension",document_id:e.id,scribe_title:e.title,scribe_domain:e.domain,original_steps_count:M.length,final_steps_count:j.length,deleted_steps_count:I.size,remaining_scribes_after_reject:U-1,progress_percentage:q>1?(q-U+1)/q*100:0});try{de(!0);const{rejectionCount:i=0}=await chrome.storage.local.get(["rejectionCount"]);await chrome.storage.local.set({rejectionCount:i+1});try{const n=(e==null?void 0:e.suggestion_id)||(e==null?void 0:e.id);h&&n&&await ze(h,n)}catch{}try{chrome.runtime.sendMessage({messageType:"dwHiddenUpdated"})}catch{}await chrome.storage.local.remove(["previewScribeId"]),await Z(J.RecommendedScribes),de(!1)}catch(i){O("suggested_scribe_reject_failed",{location:"sidepanel_suggested_scribe_preview",scribe_id:e==null?void 0:e.suggestion_id,scribe_title:e==null?void 0:e.title,scribe_domain:te(e),error_message:i instanceof Error?i.message:"Unknown error",final_steps_count:j.length,deleted_steps_count:I.size}),K(i instanceof Error?i.message:"Unknown error occurred"),de(!1)}}};return P?s.jsx(Be,{onBack:D,children:s.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center",children:[s.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-slate-800 mb-6"}),s.jsx("p",{className:"text-base text-slate-600",children:"Loading scribe preview..."})]})}):ue?s.jsx(Be,{onBack:D,children:s.jsxs("div",{className:"flex-1 flex flex-col items-center justify-center p-6",children:[s.jsx("div",{className:"text-center text-slate-700",children:s.jsx("p",{className:"text-base font-medium",children:"An error occurred. Please go back."})}),s.jsx(ae,{variant:"secondary",onClick:D,className:"mt-4",children:"Back to Suggestions"})]})}):s.jsxs(s.Fragment,{children:[s.jsx(Be,{onBack:D,totalScribes:U,className:"bg-slate-50 pb-2",children:s.jsxs("div",{ref:ye,className:"flex-1 overflow-y-auto pb-[60px] px-4",children:[s.jsxs("div",{className:"flex-none px-4 py-4 bg-slate-50",children:[e&&s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(dt,{logo:{name:ct[te(e)]||te(e),icon_url:lt(te(e),64,!0)}}),s.jsx("h2",{className:"m-0 text-lg font-semibold text-slate-900",children:e.title})]}),s.jsx("div",{className:"mt-3"})]}),j.length===0?s.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:s.jsx("p",{className:"text-slate-600",children:"No steps found in this scribe."})}):s.jsx("div",{className:"space-y-6",children:j.map((i,n)=>s.jsxs("div",{className:"p-4 bg-white rounded-2xl shadow overflow-hidden relative",children:[s.jsxs("div",{className:"flex justify-between",children:[s.jsxs("div",{className:"flex items-center",children:[s.jsx("div",{className:" items-center flex-shrink-0 h-8 w-8 bg-brand-50 text-brand-500 rounded-full flex justify-center font-bold text-base mr-3",children:n+1}),s.jsx("div",{className:"public-sans md:text-base text-sm text-slate-800 p1",children:i.description})]}),s.jsx(ae,{onClick:()=>me(i.id),className:Y("h-8 w-8 p-0","hover:text-red-500","focus:text-red-500"),title:"Remove this step",icon:$e,variant:"ghost",size:"small"})]}),i.screenshot&&s.jsx("div",{className:"pt-4",children:s.jsx("div",{className:"rounded overflow-hidden",style:{height:"165px"},children:typeof i.screenshot=="string"?s.jsx(Ae,{screenshot:i.screenshot,clickPosition:i.position,altText:`Step ${n+1}: ${i.description}`,className:"w-full h-full"}):typeof i.screenshot=="object"&&i.screenshot instanceof Blob?s.jsx(Ae,{screenshot:URL.createObjectURL(i.screenshot),clickPosition:i.position,altText:`Step ${n+1}: ${i.description}`,className:"w-full h-full"}):s.jsx("div",{className:"h-full flex items-center justify-center bg-slate-200 text-slate-500 text-sm",children:"Screenshot unavailable"})})})]},i.id))})]})}),s.jsx("div",{className:"flex-none p-4 fixed bottom-0 left-0 right-0 backdrop-blur-xs bg-gradient-to-t from-white to-white/0",children:s.jsx("div",{className:"flex flex-col space-y-2",children:s.jsxs("div",{className:"flex space-x-2",children:[s.jsx(ae,{variant:"secondary",className:"flex-1",onClick:w,disabled:re||ne,icon:$e,children:s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[ne&&s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-slate-200 border-b-slate-800"}),s.jsx("span",{children:"Discard"})]})}),s.jsx(ae,{variant:"primary",className:"flex-1",onClick:c,disabled:re||ne||j.length===0,icon:nt,children:s.jsxs("div",{className:"flex items-center justify-center gap-2",children:[re&&s.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white/20 border-b-white/100"}),s.jsx("span",{children:"Add Scribe"})]})})]})})})]})},St=()=>s.jsxs(Ve.StrictMode,{children:[s.jsx("style",{type:"text/css",children:st}),s.jsx(Ze,{store:it,children:s.jsx(jt,{})})]}),Le=document.getElementById("root");Le&&Ye(Le).render(s.jsx(St,{}));
