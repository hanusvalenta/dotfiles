import{m as p}from"./index-24f6db5b.js";import{s as h}from"./store-f163b43d.js";import{w as c}from"./waitForPageSettled-5dce853c.js";import"./index-8b3efc3f.js";import"./_commonjsHelpers-de833af9.js";import"./appTagUtils-f127d137.js";import"./v4-c70744d4.js";const m={enabled:!1,stages:{domContentLoaded:!0,windowLoad:!0,networkIdle:!0,fullySettled:!0,bestEffort:!0},timing:"document_start",saveLocally:!1,captureScreenshot:!0,maxWaitTime:1e4,settlementTimeout:500,checkInterval:100,allowedPendingRequests:0,weights:{dom:1,network:1,layout:1,longtask:1}};var b=typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};b.SENTRY_RELEASE={id:"1305c76edd7b4291b80d5f57cd104316065124a5"};let i=!1,s,o=null;const r=new Set;function w(){var t;try{const n=((t=h.getState().flagsmith)==null?void 0:t.flags)||{},e=n.dom_settlement_capture===!0,a=n.dom_settlement_config;return{...m,...a,enabled:e,saveLocally:!0,stages:{domContentLoaded:!1,windowLoad:!1,networkIdle:!1,fullySettled:!0,bestEffort:!1}}}catch{return m}}function y(t){return!(t.startsWith("chrome://")||t.startsWith("chrome-extension://")||t.startsWith("about:")||t.startsWith("file://"))}async function d(t,n){if(!r.has(t)){r.add(t);try{const e=window.scrollX||window.pageXOffset||0,a=window.scrollY||window.pageYOffset||0,g={messageType:"domSettlementStage",stage:t,data:{url:window.location.href,timingMs:n,timestamp:Date.now(),scrollPosition:{x:e,y:a,atTop:a===0}}};await p.send("domSettlementStage",g)}catch{}}}function l(t){var n;if(!i&&y(window.location.href)){if(i=!0,s=performance.now(),(n=performance.timing)!=null&&n.navigationStart||Date.now(),r.clear(),t.stages.domContentLoaded)if(document.readyState==="loading")document.addEventListener("DOMContentLoaded",()=>{const e=performance.now()-s;d("domContentLoaded",e)});else{const e=performance.now()-s;d("domContentLoaded",e)}if(t.stages.windowLoad)if(document.readyState!=="complete")window.addEventListener("load",()=>{const e=performance.now()-s;d("windowLoad",e)});else{const e=performance.now()-s;d("windowLoad",e)}t.stages.networkIdle&&c(()=>{const e=performance.now()-s;d("networkIdle",e)},{timeoutMs:300,checkInterval:t.checkInterval,allowedPending:2,weights:{dom:.5,network:1,layout:.5,longtask:.5},enableLogging:!1}),t.stages.fullySettled&&(o=c(()=>{const e=performance.now()-s;d("fullySettled",e),i=!1,o=null},{timeoutMs:t.settlementTimeout,checkInterval:t.checkInterval,allowedPending:t.allowedPendingRequests,weights:t.weights,enableLogging:!1})),setTimeout(()=>{if(i&&!r.has("bestEffort")){const e=performance.now()-s;d("bestEffort",e),o&&(o(),o=null),i=!1}},t.maxWaitTime)}}function f(){if(window!==window.top)return;const t=w();if(t.enabled)switch(t.timing){case"document_start":l(t);break;case"document_idle":document.readyState==="complete"?l(t):window.addEventListener("load",()=>{setTimeout(()=>l(t),100)});break}}chrome.runtime.onMessage.addListener((t,n,e)=>{if(t.messageType==="startDomSettlementMonitoring"){const a=w();a.enabled&&a.timing==="on_record"&&(l(a),e({success:!0}))}else t.messageType==="stopDomSettlementMonitoring"&&(o&&(o(),o=null,i=!1),e({success:!0}));return!0}),f();let u=window.location.href;const L=new MutationObserver(()=>{window.location.href!==u&&(u=window.location.href,o&&(o(),o=null),i=!1,r.clear(),f())});L.observe(document.body,{childList:!0,subtree:!0});
