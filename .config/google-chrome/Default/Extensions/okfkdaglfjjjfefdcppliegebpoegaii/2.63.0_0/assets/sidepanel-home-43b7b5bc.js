import"./modulepreload-polyfill-3cfb730f.js";import{j as s}from"./Icon-f3e43e02.js";import{r as i,R as ye}from"./index-8b3efc3f.js";import{c as we}from"./client-2e7161fd.js";import{u as f,P as fe}from"./react-redux-52a3bd12.js";import{v as be,w as je,x as ke,s as ve}from"./store-f163b43d.js";import{p as Ce}from"./production-ca86ce5a.js";import{s as Se,E as Ne}from"./ExtensionDropdown-d7f09c83.js";import{u as Ee}from"./useBackgroundReduxState-bd3d6a86.js";import{u as Ie,a as Pe}from"./useDomainAllowlistListener-7908de64.js";import{u as ze}from"./useExtensionMessagesListener-367ac98c.js";import{B as p}from"./Button-97d280d1.js";import{i as Ae,e as Me,a as $e,b as _e}from"./importDWResultsFromFile-215db9d8.js";import"./sidepanel-active-state-adf8eaaf.js";import"./_commonjsHelpers-de833af9.js";import"./v4-c70744d4.js";import"./util-e36b51ae.js";import"./domCopyAnnotate-a2b92afc.js";import"./getTargetElementAttributes-3f1109f1.js";import"./options-d8a3c135.js";import"./Tooltip-cd1b4e9d.js";import"./index-3744168d.js";import"./index-0b89f2da.js";import"./index-6034fac0.js";import"./index-025f2019.js";import"./AudioSwitch-0040166e.js";import"./index-eeca2896.js";import"./Switch-3bd90944.js";import"./Badge-4b362304.js";import"./index-e309a1d1.js";import"./Banner-f157b97e.js";import"./allowedDomainsDB-163b9f7f.js";import"./appTagUtils-f127d137.js";import"./Chip-a9e6023b.js";import"./index-9279c646.js";import"./Toolbar-58c4db6f.js";import"./index-3e4171d5.js";import"./FAIcon-609711c8.js";import"./index.esm-e3d6f8ec.js";import"./getGuideMeOptimizedElement-ced88426.js";import"./useToast-35be614d.js";import"./DocumentIcon-1c27b6c5.js";import"./TextInput-abe61b07.js";import"./index-24f6db5b.js";import"./browserContext-85999045.js";import"./dwResultsDB-a3d52d5f.js";import"./dwActionLoggingDB-f05b22f9.js";import"./dwScreenshotsDB-956b9f9a.js";const Te=()=>{const{workspaceScribes:q,galleryScribes:W,scribeCountOnDomain:H}=f(be),{userData:m,userGrowthState:J}=f(je),{isMissingPermissions:K}=f(Se);ze(),Ee(),Ie(),Pe();const[k,v]=i.useState(!1),[C,g]=i.useState(null),[S,N]=i.useState(!1),[E,Q]=i.useState(!0),[I,V]=i.useState(!1),[P,X]=i.useState(!0),[Y,z]=i.useState(!1),[Z,ee]=i.useState(0),[A,o]=i.useState(null),[M,$]=i.useState(!1),[_,T]=i.useState(!1),[L,R]=i.useState(!1),[D,U]=i.useState(!1),c=f(ke),x=(c==null?void 0:c.cap1303ShouldDisplayAutocaptureImportForDev)??!1,F=!!((c==null?void 0:c.lrr2025)??(c==null?void 0:c.lrr_2025)),O=!!((c==null?void 0:c.lrrManualRefreshEnabled)??(c==null?void 0:c.lrr_manual_refresh_enabled)),se=F&&O||x,te=()=>{const e=document.createElement("input");e.type="file",e.accept="application/json",e.onchange=async()=>{var r,a,n,h;const t=(r=e.files)==null?void 0:r[0];if(t)try{v(!0),g("Importing\u2026");const l=m,u=((n=(a=l==null?void 0:l.active_organization)==null?void 0:a.super_organization)==null?void 0:n.id)||"unknown",j=((h=l==null?void 0:l.active_organization)==null?void 0:h.id)||"unknown",{actionsImported:he,scribesImported:xe}=await Ae(t,{superOrgId:u,orgId:j},{generateDummyScreenshots:I,importUnderCurrentUser:P,currentUserId:(m==null?void 0:m.user_id)||(m==null?void 0:m.id)||"unknown"});g(`Imported ${xe} scribes and ${he} actions`)}catch(l){const u=l instanceof Error?l.message:"Unknown error";g(`Import failed: ${u}`)}finally{v(!1)}},e.click()},ae=async()=>{var e,t,r;try{N(!0),g("Exporting\u2026");const a=m,n=((t=(e=a==null?void 0:a.active_organization)==null?void 0:e.super_organization)==null?void 0:t.id)||"unknown",h=((r=a==null?void 0:a.active_organization)==null?void 0:r.id)||"unknown",{fileName:l,screenshotCount:u}=await Me({superOrgId:n,orgId:h},{slim:E});g(`Exported ${u} screenshots in ${l}`)}catch(a){const n=a instanceof Error?a.message:"Unknown error";g(`Export failed: ${n}`)}finally{N(!1)}},w=async()=>{try{const e=await new Promise(t=>{chrome.runtime.sendMessage({messageType:"dwActionLogGetCount"},r=>t(r))});e!=null&&e.success&&typeof e.count=="number"&&ee(e.count)}catch{}},re=async()=>{try{const e=await new Promise(t=>{chrome.runtime.sendMessage({messageType:"dwActionLogGetEnabled"},r=>t(r))});e!=null&&e.success&&z(!!e.enabled)}catch{}};i.useEffect(()=>{x&&(re(),w())},[x]);const ne=async e=>{try{z(e),await new Promise(t=>{chrome.runtime.sendMessage({messageType:"dwActionLogSetEnabled",enabled:e},r=>t(r))}),o(e?"Action logging enabled.":"Action logging disabled.")}catch{}},ie=async()=>{try{R(!0),o("Replaying\u2026");const e=await new Promise(t=>{chrome.runtime.sendMessage({messageType:"dwActionLogReplay"},r=>t(r))});e!=null&&e.success?o(`Replayed ${e.enqueued||0} actions.`):o("Replay failed."),w()}catch{o("Replay failed.")}finally{R(!1)}},oe=()=>{const e=document.createElement("input");e.type="file",e.accept="application/json",e.onchange=async()=>{var r;const t=(r=e.files)==null?void 0:r[0];if(t)try{$(!0),o("Importing\u2026");const{actionsImported:a,screenshotsImported:n}=await $e(t);o(`Imported ${a} actions and ${n} screenshots`),w()}catch(a){const n=a instanceof Error?a.message:"Unknown error";o(`Import failed: ${n}`)}finally{$(!1)}},e.click()},ce=async()=>{var e,t,r;try{T(!0),o("Exporting\u2026");const a=m,n=((t=(e=a==null?void 0:a.active_organization)==null?void 0:e.super_organization)==null?void 0:t.id)||"unknown",h=((r=a==null?void 0:a.active_organization)==null?void 0:r.id)||"unknown",{fileName:l,actionCount:u,screenshotCount:j}=await _e({orgScope:`${n}|${h}`});o(`Exported ${u} actions, ${j} screenshots in ${l}`)}catch(a){const n=a instanceof Error?a.message:"Unknown error";o(`Export failed: ${n}`)}finally{T(!1)}},le=async()=>{try{U(!0),o("Clearing\u2026");const e=await new Promise(t=>{chrome.runtime.sendMessage({messageType:"dwActionLogClear"},r=>t(r))});e!=null&&e.success?o(`Cleared ${e.deleted||0} logged actions.`):o("Clear failed."),w()}catch{o("Clear failed.")}finally{U(!1)}},me=async()=>{try{await new Promise(e=>{chrome.runtime.sendMessage({messageType:"dwManualRun"},()=>e())})}catch{}},de=async()=>{try{await new Promise(e=>{chrome.runtime.sendMessage({messageType:"dwCleanup"},()=>e())})}catch{}},[b,y]=i.useState(!1),[G,d]=i.useState(null),pe=async()=>{try{d("Checking\u2026");const e=await new Promise(t=>{chrome.runtime.sendMessage({messageType:"dwPollOnce"},r=>t(r))});e!=null&&e.success&&(e!=null&&e.stored)?d("New results detected."):e!=null&&e.success?d("No change."):d("Poll failed.")}catch{d("Poll failed.")}},ue=async e=>{var t,r;try{e?(d("Autopolling\u2026"),(t=await new Promise(a=>{chrome.runtime.sendMessage({messageType:"dwAutopollStart"},n=>a(n))}))!=null&&t.success&&y(!0)):(r=await new Promise(a=>{chrome.runtime.sendMessage({messageType:"dwAutopollStop"},n=>a(n))}))!=null&&r.success&&(y(!1),d(null))}catch{}};i.useEffect(()=>{const e=t=>{(t==null?void 0:t.messageType)==="dwAutopollStarted"&&(y(!0),d("Autopolling\u2026")),(t==null?void 0:t.messageType)==="dwAutopollStopped"&&(y(!1),d(null)),(t==null?void 0:t.messageType)==="dwAutopollFoundNewResults"&&(y(!1),d("New results detected."))};try{chrome.runtime.onMessage.addListener(e)}catch{}return()=>{try{chrome.runtime.onMessage.removeListener(e)}catch{}}},[]);const ge=async()=>{try{await new Promise(e=>{chrome.runtime.sendMessage({messageType:"dwClearLocal"},()=>e())})}catch{}};return s.jsxs(s.Fragment,{children:[se&&s.jsxs("div",{className:"mx-2 p-2 border-b border-slate-200 rounded-md",children:[F&&O&&s.jsxs("div",{className:"mb-2 p-2 rounded-md bg-slate-100 border border-slate-200",children:[s.jsx("div",{className:"mb-1 text-xs text-slate-500",children:"Server (remote)"}),s.jsxs("div",{className:"flex items-center gap-2",children:[s.jsx(p,{size:"small",variant:"danger",onClick:de,children:"Nuke"}),s.jsx(p,{size:"small",variant:"primary",onClick:me,children:"New job"}),s.jsx(p,{size:"small",variant:"secondary",disabled:b,onClick:pe,children:b?"Polling\u2026":"Poll"}),s.jsxs("label",{className:"flex items-center gap-2 text-xs text-slate-600",children:[s.jsx("input",{type:"checkbox",checked:b,onChange:e=>ue(e.target.checked)}),"Autopoll"]}),G&&s.jsx("span",{className:"text-xs text-slate-500",children:G})]})]}),x&&s.jsxs("div",{className:"mt-2 p-2 rounded-md bg-slate-50 border border-slate-200",children:[s.jsx("div",{className:"mb-1 text-xs text-slate-500",children:"Local (device)"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("label",{className:"flex items-center gap-2 text-xs text-slate-600",htmlFor:"dw-dev-dummy-screens",children:[s.jsx("input",{id:"dw-dev-dummy-screens",type:"checkbox",checked:I,onChange:e=>V(e.target.checked)}),"Backfill missing screenshots"]}),s.jsx(p,{size:"small",variant:"secondary",disabled:k,onClick:te,children:k?"Importing\u2026":"\u{1F4C2}"}),s.jsx(p,{size:"small",variant:"secondary",disabled:S,onClick:ae,children:S?"Exporting\u2026":"\u{1F4BE}"}),s.jsxs("label",{className:"flex items-center gap-2 text-xs text-slate-600",htmlFor:"dw-dev-slim-export",children:[s.jsx("input",{id:"dw-dev-slim-export",type:"checkbox",checked:E,onChange:e=>Q(e.target.checked)}),"Slim"]}),C&&s.jsx("span",{className:"text-xs text-slate-500",children:C})]}),s.jsx("div",{className:"mt-2 flex items-center gap-3",children:s.jsxs("label",{className:"flex items-center gap-2 text-xs text-slate-600",htmlFor:"dw-dev-import-under-current",children:[s.jsx("input",{id:"dw-dev-import-under-current",type:"checkbox",checked:P,onChange:e=>X(e.target.checked)}),"Import under current user"]})}),s.jsx("div",{className:"mt-2",children:s.jsx(p,{size:"small",variant:"danger",className:"w-full",onClick:ge,children:"Clear local DW databases"})})]}),x&&s.jsxs("div",{className:"mt-2 p-2 rounded-md bg-slate-50 border border-slate-200",children:[s.jsx("div",{className:"mb-1 text-xs text-slate-500",children:"Action logging"}),s.jsxs("div",{className:"flex items-center gap-3",children:[s.jsxs("label",{className:"flex items-center gap-2 text-xs text-slate-600",children:[s.jsx("input",{type:"checkbox",checked:Y,onChange:e=>ne(e.target.checked)}),"Action logging"]}),s.jsxs("span",{className:"text-xs text-slate-500",children:["Logged: ",Z]}),s.jsx(p,{size:"small",variant:"primary",disabled:L,onClick:ie,children:L?"Replaying\u2026":"Replay"}),s.jsx(p,{size:"small",variant:"secondary",disabled:M,onClick:oe,children:M?"Importing\u2026":"\u{1F4C2}"}),s.jsx(p,{size:"small",variant:"secondary",disabled:_,onClick:ce,children:_?"Exporting\u2026":"\u{1F4BE}"}),A&&s.jsx("span",{className:"text-xs text-slate-500",children:A})]}),s.jsx("div",{className:"mt-2",children:s.jsx(p,{size:"small",variant:"danger",className:"w-full",disabled:D,onClick:le,children:D?"Clearing\u2026":"Clear action logging database"})})]})]}),s.jsx(Ne,{isSidePanel:!0,scribeCountOnDomain:H,workspaceScribes:q,galleryScribes:W,user:m,userGrowthState:J,onClose:()=>{},missingPermissions:K})]})},Le=()=>s.jsxs(ye.StrictMode,{children:[s.jsx("style",{type:"text/css",children:Ce}),s.jsx(fe,{store:ve,children:s.jsx(Te,{})})]}),B=document.getElementById("sidepanel-home-root");if(!B)throw new Error("Can not find #sidepanel-home-root");we(B).render(s.jsx(Le,{}));
