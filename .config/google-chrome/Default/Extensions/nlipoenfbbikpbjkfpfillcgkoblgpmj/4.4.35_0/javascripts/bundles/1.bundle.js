"use strict";(self.webpackChunkawesomescreenshot_extension=self.webpackChunkawesomescreenshot_extension||[]).push([[1],{98787:(e,t,n)=>{n.d(t,{Y:()=>o});var r=n(93355),o=((0,r.b)("success","processing","error","default","warning"),(0,r.b)("pink","red","yellow","orange","cyan","green","blue","purple","geekblue","magenta","volcano","gold","lime"))},51609:(e,t,n)=>{var r=n(64867),o=n(91849),i=n(30321),s=n(47185);var a=function e(t){var n=new i(t),a=o(i.prototype.request,n);return r.extend(a,i.prototype,n),r.extend(a,n),a.create=function(n){return e(s(t,n))},a}(n(45546));a.Axios=i,a.CanceledError=n(60644),a.CancelToken=n(14972),a.isCancel=n(26502),a.VERSION=n(97288).version,a.toFormData=n(47675),a.AxiosError=n(10723),a.Cancel=a.CanceledError,a.all=function(e){return Promise.all(e)},a.spread=n(8713),a.isAxiosError=n(16268),e.exports=a,e.exports.default=a},46113:()=>{},72408:(e,t,n)=>{var r=n(27418),o="function"==typeof Symbol&&Symbol.for,i=o?Symbol.for("react.element"):60103,s=o?Symbol.for("react.portal"):60106,a=o?Symbol.for("react.fragment"):60107,c=o?Symbol.for("react.strict_mode"):60108,u=o?Symbol.for("react.profiler"):60114,l=o?Symbol.for("react.provider"):60109,f=o?Symbol.for("react.context"):60110,h=o?Symbol.for("react.forward_ref"):60112,d=o?Symbol.for("react.suspense"):60113,p=o?Symbol.for("react.memo"):60115,y=o?Symbol.for("react.lazy"):60116,v="function"==typeof Symbol&&Symbol.iterator;function m(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var b={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g={};function w(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||b}function k(){}function S(e,t,n){this.props=e,this.context=t,this.refs=g,this.updater=n||b}w.prototype.isReactComponent={},w.prototype.setState=function(e,t){if("object"!=typeof e&&"function"!=typeof e&&null!=e)throw Error(m(85));this.updater.enqueueSetState(this,e,t,"setState")},w.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},k.prototype=w.prototype;var j=S.prototype=new k;j.constructor=S,r(j,w.prototype),j.isPureReactComponent=!0;var O={current:null},x=Object.prototype.hasOwnProperty,P={key:!0,ref:!0,__self:!0,__source:!0};function R(e,t,n){var r,o={},s=null,a=null;if(null!=t)for(r in void 0!==t.ref&&(a=t.ref),void 0!==t.key&&(s=""+t.key),t)x.call(t,r)&&!P.hasOwnProperty(r)&&(o[r]=t[r]);var c=arguments.length-2;if(1===c)o.children=n;else if(1<c){for(var u=Array(c),l=0;l<c;l++)u[l]=arguments[l+2];o.children=u}if(e&&e.defaultProps)for(r in c=e.defaultProps)void 0===o[r]&&(o[r]=c[r]);return{$$typeof:i,type:e,key:s,ref:a,props:o,_owner:O.current}}function C(e){return"object"==typeof e&&null!==e&&e.$$typeof===i}var T=/\/+/g,D=[];function N(e,t,n,r){if(D.length){var o=D.pop();return o.result=e,o.keyPrefix=t,o.func=n,o.context=r,o.count=0,o}return{result:e,keyPrefix:t,func:n,context:r,count:0}}function _(e){e.result=null,e.keyPrefix=null,e.func=null,e.context=null,e.count=0,10>D.length&&D.push(e)}function E(e,t,n,r){var o=typeof e;"undefined"!==o&&"boolean"!==o||(e=null);var a=!1;if(null===e)a=!0;else switch(o){case"string":case"number":a=!0;break;case"object":switch(e.$$typeof){case i:case s:a=!0}}if(a)return n(r,e,""===t?"."+F(e,0):t),1;if(a=0,t=""===t?".":t+":",Array.isArray(e))for(var c=0;c<e.length;c++){var u=t+F(o=e[c],c);a+=E(o,u,n,r)}else if(null===e||"object"!=typeof e?u=null:u="function"==typeof(u=v&&e[v]||e["@@iterator"])?u:null,"function"==typeof u)for(e=u.call(e),c=0;!(o=e.next()).done;)a+=E(o=o.value,u=t+F(o,c++),n,r);else if("object"===o)throw n=""+e,Error(m(31,"[object Object]"===n?"object with keys {"+Object.keys(e).join(", ")+"}":n,""));return a}function I(e,t,n){return null==e?0:E(e,"",t,n)}function F(e,t){return"object"==typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+(""+e).replace(/[=:]/g,function(e){return t[e]})}(e.key):t.toString(36)}function A(e,t){e.func.call(e.context,t,e.count++)}function B(e,t,n){var r=e.result,o=e.keyPrefix;e=e.func.call(e.context,t,e.count++),Array.isArray(e)?U(e,r,n,function(e){return e}):null!=e&&(C(e)&&(e=function(e,t){return{$$typeof:i,type:e.type,key:t,ref:e.ref,props:e.props,_owner:e._owner}}(e,o+(!e.key||t&&t.key===e.key?"":(""+e.key).replace(T,"$&/")+"/")+n)),r.push(e))}function U(e,t,n,r,o){var i="";null!=n&&(i=(""+n).replace(T,"$&/")+"/"),I(e,B,t=N(t,i,r,o)),_(t)}var M={current:null};function q(){var e=M.current;if(null===e)throw Error(m(321));return e}var G={ReactCurrentDispatcher:M,ReactCurrentBatchConfig:{suspense:null},ReactCurrentOwner:O,IsSomeRendererActing:{current:!1},assign:r};t.Children={map:function(e,t,n){if(null==e)return e;var r=[];return U(e,r,null,t,n),r},forEach:function(e,t,n){if(null==e)return e;I(e,A,t=N(null,null,t,n)),_(t)},count:function(e){return I(e,function(){return null},null)},toArray:function(e){var t=[];return U(e,t,null,function(e){return e}),t},only:function(e){if(!C(e))throw Error(m(143));return e}},t.Component=w,t.Fragment=a,t.Profiler=u,t.PureComponent=S,t.StrictMode=c,t.Suspense=d,t.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=G,t.cloneElement=function(e,t,n){if(null==e)throw Error(m(267,e));var o=r({},e.props),s=e.key,a=e.ref,c=e._owner;if(null!=t){if(void 0!==t.ref&&(a=t.ref,c=O.current),void 0!==t.key&&(s=""+t.key),e.type&&e.type.defaultProps)var u=e.type.defaultProps;for(l in t)x.call(t,l)&&!P.hasOwnProperty(l)&&(o[l]=void 0===t[l]&&void 0!==u?u[l]:t[l])}var l=arguments.length-2;if(1===l)o.children=n;else if(1<l){u=Array(l);for(var f=0;f<l;f++)u[f]=arguments[f+2];o.children=u}return{$$typeof:i,type:e.type,key:s,ref:a,props:o,_owner:c}},t.createContext=function(e,t){return void 0===t&&(t=null),(e={$$typeof:f,_calculateChangedBits:t,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider={$$typeof:l,_context:e},e.Consumer=e},t.createElement=R,t.createFactory=function(e){var t=R.bind(null,e);return t.type=e,t},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:h,render:e}},t.isValidElement=C,t.lazy=function(e){return{$$typeof:y,_ctor:e,_status:-1,_result:null}},t.memo=function(e,t){return{$$typeof:p,type:e,compare:void 0===t?null:t}},t.useCallback=function(e,t){return q().useCallback(e,t)},t.useContext=function(e,t){return q().useContext(e,t)},t.useDebugValue=function(){},t.useEffect=function(e,t){return q().useEffect(e,t)},t.useImperativeHandle=function(e,t,n){return q().useImperativeHandle(e,t,n)},t.useLayoutEffect=function(e,t){return q().useLayoutEffect(e,t)},t.useMemo=function(e,t){return q().useMemo(e,t)},t.useReducer=function(e,t,n){return q().useReducer(e,t,n)},t.useRef=function(e){return q().useRef(e)},t.useState=function(e){return q().useState(e)},t.version="16.14.0"},67294:(e,t,n)=>{e.exports=n(72408)},59631:(e,t,n)=>{n.d(t,{Z:()=>i});var r=n(7085),o=(n(46113),n(85893));const i=function(e){var t=e.size;return(0,o.jsx)("div",{className:"container-loading ".concat(t),children:(0,o.jsx)(r.Z,{})})}},82483:(e,t,n)=>{n.d(t,{J:()=>o,r:()=>r});var r=function(e){var t=e.test,n=e.children,r=n.find(function(e){return e.props.default})||null;return n.find(function(e){return e.props.value===t})||r},o=function(e){return e.children}},83550:(e,t,n)=>{n.d(t,{Z:()=>s});var r={preview:{ws:"wss",domain:"preview.awesomescreenshot.com",cookie:"awesomescreenshot.com",schema:"https"},www:{ws:"wss",domain:"www.awesomescreenshot.com",cookie:"awesomescreenshot.com",schema:"https"},alpha:{ws:"wss",domain:"alpha.awesomescreenshot.com",cookie:"awesomescreenshot.com",schema:"https"},local:{ws:"wss",domain:"www.awesomescreenshot.cn",cookie:"awesomescreenshot.cn",schema:"https"}};for(var o in r){var i=r[o];i.baseUrl=i.schema+"://"+i.domain,i.wsUrl=i.ws+"://"+i.domain}const s=r.www},95915:(e,t,n)=>{n.d(t,{Z:()=>v});n(91886);var r=n(45777),o=(n(51837),n(54458)),i=(n(81211),n(2214)),s=n(35552),a=n(12964),c=n(86642),u=n(92427),l=n(83550),f=n(35036),h=n(85893);function d(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof a?r:a,u=Object.create(c.prototype);return p(u,"_invoke",function(n,r,o){var i,a,c,u=0,l=o||[],f=!1,h={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return i=t,a=0,c=e,h.n=n,s}};function d(n,r){for(a=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,i=l[t],d=h.p,p=i[2];n>3?(o=p===r)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=n<2&&d<i[1])?(a=0,h.v=r,h.n=i[1]):d<p&&(o=n<3||i[0]>r||r>p)&&(i[4]=n,i[5]=r,h.n=p,a=0))}if(o||n>1)return s;throw f=!0,r}return function(o,l,p){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,p),a=l,c=p;(t=a<2?e:c)||!f;){i||(a?a<3?(a>1&&(h.n=-1),d(a,c)):h.n=c:h.v=c);try{if(u=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(f=h.n<0)?c:n.call(r,h))!==s)break}catch(t){i=e,a=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,i),!0),u}var s={};function a(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(p(t={},r,function(){return this}),t),f=u.prototype=a.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,p(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,p(f,"constructor",u),p(u,"constructor",c),c.displayName="GeneratorFunction",p(u,o,"GeneratorFunction"),p(f),p(f,o,"Generator"),p(f,r,function(){return this}),p(f,"toString",function(){return"[object Generator]"}),(d=function(){return{w:i,m:h}})()}function p(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}p=function(e,t,n,r){function i(t,n){p(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},p(e,t,n,r)}function y(e,t,n,r,o,i,s){try{var a=e[i](s),c=a.value}catch(e){return void n(e)}a.done?t(c):Promise.resolve(c).then(r,o)}const v=function(e){var t=e.lists,n=e.poorNetWork,p=e.isRecorder;function v(e){if(e){var t=new Date;t.setTime(e);var n=t.getDate(),r=t.getMonth(),o=t.getFullYear();return["Sun","Mon","Tue","Wed","Thu","Fri","Sat"][t.getDay()]+" "+["Jan","Feb","Mar","Apr","May","June","July","Aug","Sep","Oct","Nov","Dec"][r]+" "+n+", "+o+",  "+t.toLocaleTimeString()}return""}function m(e){var t=e.target;t.attributes.datatype&&t.attributes.datatype.nodeValue&&(0,c.RB)(l.Z.baseUrl+"/video/"+t.attributes.datatype.nodeValue)}function b(e){return g.apply(this,arguments)}function g(){var e;return e=d().m(function e(t){var n,r,o,i,s,u;return d().w(function(e){for(;;)switch(e.n){case 0:if(t.stopPropagation(),!(n=t.target).attributes.datatype||!n.attributes.datatype.nodeValue){e.n=3;break}return r=n.attributes.datatype.nodeValue,r=parseInt(r),o=new a.Z,e.n=1,o.getDetail(r);case 1:return i=e.v,e.n=2,o.getVideo(r);case 2:s=e.v,u=i.title+".mp4",s=new Blob([s],{type:"video/mp4"}),chrome.permissions.request({permissions:["downloads"]},function(e){if(e){var t={url:URL.createObjectURL(s),filename:u,saveAs:!0};(0,c.VC)(t)}});case 3:return e.a(2)}},e)}),g=function(){var t=this,n=arguments;return new Promise(function(r,o){var i=e.apply(t,n);function s(e){y(i,r,o,s,a,"next",e)}function a(e){y(i,r,o,s,a,"throw",e)}s(void 0)})},g.apply(this,arguments)}function w(e){e.stopPropagation();var t=e.target;if(t.attributes.datatype&&t.attributes.datatype.nodeValue){var n=t.attributes.datatype.nodeValue;n=parseInt(n),p?(0,f.ws)("",n):chrome.runtime.sendMessage({action:"reUpload",target:"Recorder",data:n})}}function k(e){e.stopPropagation();var t=e.target;if(t.attributes.datatype&&t.attributes.datatype.nodeValue){var n=t.attributes.datatype.nodeValue;n=parseInt(n),i.Z.confirm({title:"Are you sure you want to delete the recording?",content:"If you haven't downloaded this recording, please do it first. Otherwise, you will lose it permanently.",okText:"Delete",cancelText:chrome.i18n.getMessage("discard_p_no"),onOk:function(){!function(e){e&&((new a.Z).remove(e),u.Z.dispatch("uploadingUpdate"),u.Z.dispatch("discardAction",e))}(n)},okType:"danger"})}}function S(e){e=Math.floor(e/1e3);var t=Math.floor(e/3600),n=Math.floor((e-3600*t)/60),r=e%60;return n<10&&t>0&&(n="0"+n),r<10&&(r="0"+r),(t>0?t+":":"")+n+":"+r}return(0,h.jsx)("div",{className:"uploading-list",children:t.map(function(e){return(0,h.jsxs)("div",{datatype:e.originId,className:"uploading-list-item",children:[e.processStatus&&"failed"===e.processStatus?(0,h.jsx)(s.Jw,{}):(0,h.jsx)(s.Bn,{}),(0,h.jsxs)("div",{className:"infos",datatype:e.originId,children:[(0,h.jsx)("div",{className:"title",children:e.title}),(0,h.jsx)("div",{className:"time",children:v(e.createAt)}),"completed"!==e.processStatus?(0,h.jsx)(o.Z,{type:"line",status:"active",showInfo:!1,percent:parseInt(100*e.progress),strokeColor:"#5794FF"}):(0,h.jsx)(h.Fragment,{}),(0,h.jsxs)("div",{className:"extra-field",children:[(0,h.jsx)("div",{className:"time",children:S(e.duration)}),(0,h.jsx)("div",{className:"time",children:(0,c.RD)(e.size)}),e.processStatus&&"failed"===e.processStatus?(0,h.jsx)("div",{className:"status failed",children:"Failed"}):(0,h.jsx)("div",{className:"status",children:"completed"==e.processStatus?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(s.qw,{}),"Upload completed"]}):"Uploading "+parseInt(100*e.progress)+"%"}),n&&"failed"!==e.processStatus&&"completed"!==e.processStatus?(0,h.jsx)("div",{className:"warning",children:" Poor network"}):""]}),(0,h.jsxs)("div",{className:"action-field "+(e.processStatus||n||!p?"":"recent"),children:[e.processStatus&&"completed"===e.processStatus?(0,h.jsxs)("div",{className:"action-btn uploaded",datatype:e.originId,onClick:m,children:["View ",(0,h.jsx)(s.jT,{})]}):(0,h.jsx)(h.Fragment,{}),"started"!=e.status&&"completed"!==e.processStatus&&(e.processStatus&&"failed"===e.processStatus||!p||n)?(0,h.jsxs)(h.Fragment,{children:[(0,h.jsx)(r.Z,{title:"Download Full Recording to Computer",placement:"top",overlayStyle:{maxWidth:"400px"},children:(0,h.jsx)("div",{className:"action-btn failed",datatype:e.key,onClick:b,children:(0,h.jsx)(s.$r,{})})},"export"),"failed"===e.processStatus?(0,h.jsx)(r.Z,{title:"Re-upload Full Recording to Cloud",children:(0,h.jsx)("div",{className:"action-btn failed",datatype:e.key,onClick:w,children:(0,h.jsx)(s.Rv,{})})},"upload"):(0,h.jsx)(h.Fragment,{}),(0,h.jsx)(r.Z,{title:"Delete",children:(0,h.jsx)("div",{className:"action-btn failed",datatype:e.key,onClick:k,children:(0,h.jsx)(s.R6,{})})},"delete")]}):(0,h.jsx)(h.Fragment,{})]})]})]},e.key)})})}},63188:(e,t,n)=>{n.d(t,{$:()=>a,x:()=>c});var r=n(86642),o=0,i=new Map,s=!1;function a(e,t){var n=o++;i.set(n+"",e);var r=isFinite(t)?t:0;return chrome.alarms.create(n+"",{when:Date.now()+r}),s||setTimeout(function(){!function(e){var t=i.get(e);t&&(i.delete(e),t())}(n+"")},r),n}function c(e){i.get(e);i.delete(e+"")}(0,r.fx)()&&chrome.alarms&&chrome.alarms.onAlarm.addListener(function(e){s=!0;var t=e.name,n=i.get(t);n&&(i.delete(t),n())})},92427:(e,t,n)=>{n.d(t,{Z:()=>r});const r={on:function(e,t){document.addEventListener(e,function(e){return t(e.detail)})},dispatch:function(e,t){document.dispatchEvent(new CustomEvent(e,{detail:t}))},remove:function(e,t){document.removeEventListener(e,t)}}},99231:(e,t,n)=>{function r(e,t,n,r){return new(n||(n=Promise))(function(o,i){function s(e){try{c(r.next(e))}catch(e){i(e)}}function a(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n(function(e){e(t)})).then(s,a)}c((r=r.apply(e,t||[])).next())})}n.d(t,{m:()=>r})},12964:(e,t,n)=>{n.d(t,{Z:()=>p});var r=n(99231);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=a(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return s=e.done,e},e:function(e){c=!0,i=e},f:function(){try{s||null==n.return||n.return()}finally{if(c)throw i}}}}function s(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||a(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function a(e,t){if(e){if("string"==typeof e)return c(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?c(e,t):void 0}}function c(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function u(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof a?r:a,u=Object.create(c.prototype);return l(u,"_invoke",function(n,r,o){var i,a,c,u=0,l=o||[],f=!1,h={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return i=t,a=0,c=e,h.n=n,s}};function d(n,r){for(a=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,i=l[t],d=h.p,p=i[2];n>3?(o=p===r)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=n<2&&d<i[1])?(a=0,h.v=r,h.n=i[1]):d<p&&(o=n<3||i[0]>r||r>p)&&(i[4]=n,i[5]=r,h.n=p,a=0))}if(o||n>1)return s;throw f=!0,r}return function(o,l,p){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,p),a=l,c=p;(t=a<2?e:c)||!f;){i||(a?a<3?(a>1&&(h.n=-1),d(a,c)):h.n=c:h.v=c);try{if(u=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(f=h.n<0)?c:n.call(r,h))!==s)break}catch(t){i=e,a=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,i),!0),u}var s={};function a(){}function c(){}function f(){}t=Object.getPrototypeOf;var h=[][r]?t(t([][r]())):(l(t={},r,function(){return this}),t),d=f.prototype=a.prototype=Object.create(h);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,l(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return c.prototype=f,l(d,"constructor",f),l(f,"constructor",c),c.displayName="GeneratorFunction",l(f,o,"GeneratorFunction"),l(d),l(d,o,"Generator"),l(d,r,function(){return this}),l(d,"toString",function(){return"[object Generator]"}),(u=function(){return{w:i,m:p}})()}function l(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}l=function(e,t,n,r){function i(t,n){l(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},l(e,t,n,r)}function f(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,h(r.key),r)}}function h(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}var d=2e5,p=function(){return e=function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.DBName="videos",this.DBVersion=1,this.detailStoreName="detail",this.fmp4StoreName="fmp4",this.webmStoreName="webm",this.handleUpgradeNeeded=this.handleUpgradeNeeded.bind(this)},(t=[{key:"openDb",value:function(){return(0,r.m)(this,void 0,void 0,u().m(function e(){var t,n=this;return u().w(function(e){for(;;)switch(e.n){case 0:if(!this.openPromise){e.n=1;break}return e.a(2,this.openPromise);case 1:return t=indexedDB.open(this.DBName,this.DBVersion),this.openPromise=new Promise(function(e,r){t.onupgradeneeded=n.handleUpgradeNeeded,t.onsuccess=function(){e(t.result)},t.onerror=function(e){r()}}),e.n=2,this.openPromise;case 2:return this.db=e.v,e.a(2,this.db)}},e,this)}))}},{key:"handleUpgradeNeeded",value:function(e){return(0,r.m)(this,void 0,void 0,u().m(function t(){var n;return u().w(function(t){for(;;)switch(t.n){case 0:n=e.target.result,e.oldVersion<this.DBVersion&&(n.createObjectStore(this.detailStoreName,{autoIncrement:!0}),n.createObjectStore(this.fmp4StoreName,{keyPath:"key"}),n.createObjectStore(this.webmStoreName,{keyPath:"key"}));case 1:return t.a(2)}},t,this)}))}},{key:"create",value:function(e){return(0,r.m)(this,void 0,void 0,u().m(function t(){var n,r,o,i,a,c,l,f,h;return u().w(function(t){for(;;)switch(t.n){case 0:if(n=(null==e?void 0:e.mimeType)||"video/webm",r=n.match(/video\/webm/)?this.webmStoreName:n.match(/video\/mp4/)?this.fmp4StoreName:this.webmStoreName,e=Object.assign(Object.assign({mimeType:n,storeName:r},e),{status:"created",createAt:Date.now()}),this.currentSliceStore=e.storeName,this.db){t.n=1;break}return t.n=1,this.openDb();case 1:return o=this.db.transaction([this.detailStoreName,this.currentSliceStore],"readwrite"),i=o.objectStore(this.currentSliceStore),a=i.getAllKeys(),t.n=2,new Promise(function(e,t){a.onsuccess=function(){var t=a.result;if(0==t.length)return e(0);e(Math.max.apply(Math,s(t)))},a.onerror=function(){return t()}});case 2:return c=t.v,this.sliceKeyStart=c?c+d-c%d:0,this.currentSliceKey=this.sliceKeyStart,this.currentSize=0,i.put({key:this.sliceKeyStart,data:new Blob([])}),this.detail=Object.assign(Object.assign({},e),{sliceStart:this.sliceKeyStart}),l=o.objectStore(this.detailStoreName),f=l.add(this.detail),t.n=3,new Promise(function(e,t){f.onsuccess=function(){return e(f.result)},f.onerror=function(){return t()}});case 3:return h=t.v,this.detail=Object.assign({key:h},this.detail),this.update(this.detail),this.isOpen=!0,t.a(2,this.detail)}},t,this)}))}},{key:"push",value:function(e,t){return(0,r.m)(this,void 0,void 0,u().m(function n(){var r,o,i,s,a;return u().w(function(n){for(;;)switch(n.n){case 0:if(e&&e.size){n.n=1;break}return n.a(2);case 1:if(this.isOpen){n.n=2;break}return n.a(2);case 2:if(!(this.currentSliceKey-this.sliceKeyStart>=d)){n.n=3;break}return n.a(2);case 3:return r=this.currentSliceKey++,o=this.db.transaction(this.currentSliceStore,"readwrite"),i=o.objectStore(this.currentSliceStore),s=i.put({key:r,uploaded:!1,data:e,offset:r-this.sliceKeyStart,sizeOffset:this.currentSize}),a=new Promise(function(e,t){s.onsuccess=function(){return e()},s.onerror=function(){return t()}}),this.currentSize+=e.size,this.detail=Object.assign(Object.assign(Object.assign({},this.detail),t),{status:"started",sliceEnd:this.currentSliceKey,size:this.currentSize}),this.update(this.detail),n.a(2,a)}},n,this)}))}},{key:"update",value:function(e,t){return(0,r.m)(this,void 0,void 0,u().m(function n(){var r,o,i;return u().w(function(n){for(;;)switch(n.n){case 0:if(isFinite(t)||(t=this.detail.key),isFinite(t)){n.n=1;break}return n.a(2);case 1:return this.detail=Object.assign(Object.assign(Object.assign({},this.detail),e),{updateAt:Date.now(),key:t}),r=this.db.transaction(this.detailStoreName,"readwrite"),o=r.objectStore(this.detailStoreName),i=o.put(this.detail,this.detail.key),n.n=2,new Promise(function(e,t){i.onsuccess=function(){return e()},i.onerror=function(){return t()}});case 2:return n.a(2,this.detail)}},n,this)}))}},{key:"close",value:function(e){return(0,r.m)(this,void 0,void 0,u().m(function t(){return u().w(function(t){for(;;)switch(t.n){case 0:this.detail=Object.assign(Object.assign(Object.assign({},this.detail),{status:"closed",sliceEnd:this.currentSliceKey,closeAt:Date.now()}),isFinite(e)?{duration:e}:{}),this.update(this.detail),this.isOpen=!1;case 1:return t.a(2)}},t,this)}))}},{key:"remove",value:function(e){return(0,r.m)(this,void 0,void 0,u().m(function t(){var n,r,o,i,s,a,c,l,f;return u().w(function(t){for(;;)switch(t.n){case 0:if(this.db){t.n=1;break}return t.n=1,this.openDb();case 1:return this.isOpen&&(this.isOpen=!1),!e&&this.detail&&this.detail.key&&(e=this.detail.key),n=this.db.transaction([this.detailStoreName,this.fmp4StoreName,this.webmStoreName],"readwrite"),r=n.objectStore(this.detailStoreName),o=r.get(e),t.n=2,new Promise(function(e,t){o.onsuccess=function(){return e(o.result)},o.onerror=function(){return t()}});case 2:return i=t.v,s=n.objectStore(i.storeName),a=isFinite(i.sliceEnd)?i.sliceEnd:i.sliceStart+d,c=IDBKeyRange.bound(i.sliceStart,a,!1,a>i.sliceStart),l=s.delete(c),t.n=3,new Promise(function(e,t){l.onsuccess=function(){return e()},l.onerror=function(){return t()}});case 3:return f=r.delete(i.key),t.n=4,new Promise(function(e,t){f.onsuccess=function(){return e()},f.onerror=function(){return t()}});case 4:return t.a(2)}},t,this)}))}},{key:"cleanup",value:function(){return(0,r.m)(this,void 0,void 0,u().m(function e(){var t,n,r,o,s,a,c,l;return u().w(function(e){for(;;)switch(e.p=e.n){case 0:if(this.db){e.n=1;break}return e.n=1,this.openDb();case 1:return t=this.db.transaction(this.detailStoreName,"readonly"),n=t.objectStore(this.detailStoreName),r=n.getAllKeys(),e.n=2,new Promise(function(e,t){r.onsuccess=function(){return e(r.result)},r.onerror=function(){return t()}});case 2:o=e.v,s=i(o),e.p=3,s.s();case 4:if((a=s.n()).done){e.n=6;break}return c=a.value,e.n=5,this.remove(c);case 5:e.n=4;break;case 6:e.n=8;break;case 7:e.p=7,l=e.v,s.e(l);case 8:return e.p=8,s.f(),e.f(8);case 9:return e.a(2)}},e,this,[[3,7,8,9]])}))}},{key:"getDetail",value:function(e){return(0,r.m)(this,void 0,void 0,u().m(function t(){var n,r,o,i;return u().w(function(t){for(;;)switch(t.n){case 0:if(this.db){t.n=1;break}return t.n=1,this.openDb();case 1:return n=this.db.transaction(this.detailStoreName,"readonly"),r=n.objectStore(this.detailStoreName),o=r.get(e),t.n=2,new Promise(function(e,t){o.onsuccess=function(){return e(o.result)},o.onerror=function(){return t()}});case 2:return i=t.v,this.detail=i,t.a(2,i)}},t,this)}))}},{key:"getAllDetail",value:function(){return(0,r.m)(this,void 0,void 0,u().m(function e(){var t,n,r,o;return u().w(function(e){for(;;)switch(e.n){case 0:if(this.db){e.n=1;break}return e.n=1,this.openDb();case 1:return t=this.db.transaction(this.detailStoreName,"readonly"),n=t.objectStore(this.detailStoreName),r=n.getAll(),e.n=2,new Promise(function(e,t){r.onsuccess=function(){return e(r.result)},r.onerror=function(){return t()}});case 2:return o=e.v,e.a(2,o)}},e,this)}))}},{key:"getVideo",value:function(e){return(0,r.m)(this,void 0,void 0,u().m(function t(){var n,r,o,i,s,a,c,l;return u().w(function(t){for(;;)switch(t.n){case 0:if(this.db){t.n=1;break}return t.n=1,this.openDb();case 1:return t.n=2,this.getDetail(e);case 2:if(n=t.v,r=this.db.transaction(n.storeName,"readonly"),o=r.objectStore(n.storeName),(i=isFinite(n.sliceEnd)?n.sliceEnd:n.sliceStart+d)!==n.sliceStart){t.n=3;break}return t.a(2,new Blob([],{type:n.mimeType}));case 3:return s=IDBKeyRange.bound(n.sliceStart,i,!1,!0),a=o.getAll(s),t.n=4,new Promise(function(e,t){a.onsuccess=function(){return e(a.result)},a.onerror=function(){return t()}});case 4:return c=t.v,l=c.map(function(e){return e.data}),t.a(2,new Blob(l,{type:n.mimeType}))}},t,this)}))}},{key:"getSlice",value:function(e,t){return(0,r.m)(this,void 0,void 0,u().m(function n(){var r,o,i,s,a,c;return u().w(function(n){for(;;)switch(n.n){case 0:if(this.db){n.n=1;break}return n.n=1,this.openDb();case 1:if(e===this.getSliceKey){n.n=3;break}return this.getSliceKey=e,n.n=2,this.getDetail(e);case 2:this.getSliceDetail=n.v;case 3:return r=this.getSliceDetail,o=r.sliceStart+t,i=this.db.transaction(r.storeName,"readonly"),s=i.objectStore(r.storeName),a=s.get(o),n.n=4,new Promise(function(e,t){a.onsuccess=function(){a.result?e(a.result):e(null)},a.onerror=function(){return t()}});case 4:return c=n.v,n.a(2,c)}},n,this)}))}},{key:"deleteSlice",value:function(e,t){return(0,r.m)(this,void 0,void 0,u().m(function n(){var r,o,i,s,a,c;return u().w(function(n){for(;;)switch(n.n){case 0:if(this.db){n.n=1;break}return n.n=1,this.openDb();case 1:if(e===this.getSliceKey){n.n=3;break}return this.getSliceKey=e,n.n=2,this.getDetail(e);case 2:this.getSliceDetail=n.v;case 3:return r=this.getSliceDetail,o=r.sliceStart+t,i=IDBKeyRange.bound(r.sliceStart,o,!1,o>r.sliceStart),s=this.db.transaction(r.storeName,"readwrite"),a=s.objectStore(r.storeName),c=a.delete(i),n.n=4,new Promise(function(e,t){c.onsuccess=function(){return e()},c.onerror=function(){return t()}});case 4:return n.a(2)}},n,this)}))}},{key:"updateSlice",value:function(e,t,n){return(0,r.m)(this,void 0,void 0,u().m(function r(){var o,i,s,a,c,l,f,h,d;return u().w(function(r){for(;;)switch(r.n){case 0:if(this.db){r.n=1;break}return r.n=1,this.openDb();case 1:if(n===this.getSliceKey&&this.getSliceDetail){r.n=5;break}if(this.getSliceKey=n,!n){r.n=3;break}return r.n=2,this.getDetail(n);case 2:d=r.v,r.n=4;break;case 3:d=Object.assign({},this.detail);case 4:this.getSliceDetail=d;case 5:return o=this.getSliceDetail,i=o.sliceStart+e,s=this.db.transaction(o.storeName,"readwrite"),a=s.objectStore(o.storeName),c=a.get(i),r.n=6,new Promise(function(e,t){c.onsuccess=function(){c.result?e(c.result):e(null)},c.onerror=function(){return t()}});case 6:return l=r.v,f=Object.assign(Object.assign({},l),t),h=a.put(f),r.n=7,new Promise(function(e,t){h.onsuccess=function(t){return e(t.target)},h.onerror=function(){return t()}});case 7:return r.a(2)}},r,this)}))}}])&&f(e.prototype,t),n&&f(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}()},77029:(e,t,n)=>{n.d(t,{Q:()=>Y});var r=n(99231);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function a(n,r,o,i){var a=r&&r.prototype instanceof u?r:u,l=Object.create(a.prototype);return s(l,"_invoke",function(n,r,o){var i,s,a,u=0,l=o||[],f=!1,h={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return i=t,s=0,a=e,h.n=n,c}};function d(n,r){for(s=n,a=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,i=l[t],d=h.p,p=i[2];n>3?(o=p===r)&&(a=i[(s=i[4])?5:(s=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=n<2&&d<i[1])?(s=0,h.v=r,h.n=i[1]):d<p&&(o=n<3||i[0]>r||r>p)&&(i[4]=n,i[5]=r,h.n=p,s=0))}if(o||n>1)return c;throw f=!0,r}return function(o,l,p){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,p),s=l,a=p;(t=s<2?e:a)||!f;){i||(s?s<3?(s>1&&(h.n=-1),d(s,a)):h.n=a:h.v=a);try{if(u=2,i){if(s||(o="next"),t=i[o]){if(!(t=t.call(i,a)))throw TypeError("iterator result is not an object");if(!t.done)return t;a=t.value,s<2&&(s=0)}else 1===s&&(t=i.return)&&t.call(i),s<2&&(a=TypeError("The iterator does not provide a '"+o+"' method"),s=1);i=e}else if((t=(f=h.n<0)?a:n.call(r,h))!==c)break}catch(t){i=e,s=1,a=t}finally{u=1}}return{value:t,done:f}}}(n,o,i),!0),l}var c={};function u(){}function l(){}function f(){}t=Object.getPrototypeOf;var h=[][r]?t(t([][r]())):(s(t={},r,function(){return this}),t),d=f.prototype=u.prototype=Object.create(h);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,s(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=f,s(d,"constructor",f),s(f,"constructor",l),l.displayName="GeneratorFunction",s(f,o,"GeneratorFunction"),s(d),s(d,o,"Generator"),s(d,r,function(){return this}),s(d,"toString",function(){return"[object Generator]"}),(i=function(){return{w:a,m:p}})()}function s(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}s=function(e,t,n,r){function i(t,n){s(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},s(e,t,n,r)}function a(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,c(r.key),r)}}function c(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}var u="queue-blob-placeholder";function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function f(e){return function(e){if(Array.isArray(e))return h(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return h(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function d(e){if(null!=e){var t=e["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],n=0;if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length))return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}}}throw new TypeError(l(e)+" is not iterable")}function p(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof a?r:a,u=Object.create(c.prototype);return y(u,"_invoke",function(n,r,o){var i,a,c,u=0,l=o||[],f=!1,h={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return i=t,a=0,c=e,h.n=n,s}};function d(n,r){for(a=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,i=l[t],d=h.p,p=i[2];n>3?(o=p===r)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=n<2&&d<i[1])?(a=0,h.v=r,h.n=i[1]):d<p&&(o=n<3||i[0]>r||r>p)&&(i[4]=n,i[5]=r,h.n=p,a=0))}if(o||n>1)return s;throw f=!0,r}return function(o,l,p){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,p),a=l,c=p;(t=a<2?e:c)||!f;){i||(a?a<3?(a>1&&(h.n=-1),d(a,c)):h.n=c:h.v=c);try{if(u=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(f=h.n<0)?c:n.call(r,h))!==s)break}catch(t){i=e,a=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,i),!0),u}var s={};function a(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(y(t={},r,function(){return this}),t),f=u.prototype=a.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,y(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,y(f,"constructor",u),y(u,"constructor",c),c.displayName="GeneratorFunction",y(u,o,"GeneratorFunction"),y(f),y(f,o,"Generator"),y(f,r,function(){return this}),y(f,"toString",function(){return"[object Generator]"}),(p=function(){return{w:i,m:h}})()}function y(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}y=function(e,t,n,r){function i(t,n){y(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},y(e,t,n,r)}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,m(r.key),r)}}function m(e){var t=function(e,t){if("object"!=l(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=l(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==l(t)?t:t+""}function b(e,t,n){return t=w(t),function(e,t){if(t&&("object"==l(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,g()?Reflect.construct(t,n||[],w(e).constructor):t.apply(e,n))}function g(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(g=function(){return!!e})()}function w(e){return w=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},w(e)}function k(e,t){return k=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},k(e,t)}function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function j(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof a?r:a,u=Object.create(c.prototype);return O(u,"_invoke",function(n,r,o){var i,a,c,u=0,l=o||[],f=!1,h={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return i=t,a=0,c=e,h.n=n,s}};function d(n,r){for(a=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,i=l[t],d=h.p,p=i[2];n>3?(o=p===r)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=n<2&&d<i[1])?(a=0,h.v=r,h.n=i[1]):d<p&&(o=n<3||i[0]>r||r>p)&&(i[4]=n,i[5]=r,h.n=p,a=0))}if(o||n>1)return s;throw f=!0,r}return function(o,l,p){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,p),a=l,c=p;(t=a<2?e:c)||!f;){i||(a?a<3?(a>1&&(h.n=-1),d(a,c)):h.n=c:h.v=c);try{if(u=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(f=h.n<0)?c:n.call(r,h))!==s)break}catch(t){i=e,a=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,i),!0),u}var s={};function a(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(O(t={},r,function(){return this}),t),f=u.prototype=a.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,O(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,O(f,"constructor",u),O(u,"constructor",c),c.displayName="GeneratorFunction",O(u,o,"GeneratorFunction"),O(f),O(f,o,"Generator"),O(f,r,function(){return this}),O(f,"toString",function(){return"[object Generator]"}),(j=function(){return{w:i,m:h}})()}function O(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}O=function(e,t,n,r){function i(t,n){O(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},O(e,t,n,r)}function x(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,P(r.key),r)}}function P(e){var t=function(e,t){if("object"!=S(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=S(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==S(t)?t:t+""}function R(e,t,n){return t=D(t),function(e,t){if(t&&("object"==S(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,C()?Reflect.construct(t,n||[],D(e).constructor):t.apply(e,n))}function C(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(C=function(){return!!e})()}function T(){return T="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=D(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},T.apply(null,arguments)}function D(e){return D=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},D(e)}function N(e,t){return N=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},N(e,t)}function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function E(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,I(r.key),r)}}function I(e){var t=function(e,t){if("object"!=_(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=_(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==_(t)?t:t+""}function F(e,t,n){return t=M(t),function(e,t){if(t&&("object"==_(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,A()?Reflect.construct(t,n||[],M(e).constructor):t.apply(e,n))}function A(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(A=function(){return!!e})()}function B(e,t,n,r){var o=U(M(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof o?function(e){return o.apply(n,e)}:o}function U(){return U="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=M(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},U.apply(null,arguments)}function M(e){return M=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},M(e)}function q(e,t){return q=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},q(e,t)}function G(e){return G="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},G(e)}function K(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var c=r&&r.prototype instanceof a?r:a,u=Object.create(c.prototype);return Q(u,"_invoke",function(n,r,o){var i,a,c,u=0,l=o||[],f=!1,h={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return i=t,a=0,c=e,h.n=n,s}};function d(n,r){for(a=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,i=l[t],d=h.p,p=i[2];n>3?(o=p===r)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=n<2&&d<i[1])?(a=0,h.v=r,h.n=i[1]):d<p&&(o=n<3||i[0]>r||r>p)&&(i[4]=n,i[5]=r,h.n=p,a=0))}if(o||n>1)return s;throw f=!0,r}return function(o,l,p){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,p),a=l,c=p;(t=a<2?e:c)||!f;){i||(a?a<3?(a>1&&(h.n=-1),d(a,c)):h.n=c:h.v=c);try{if(u=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(f=h.n<0)?c:n.call(r,h))!==s)break}catch(t){i=e,a=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,i),!0),u}var s={};function a(){}function c(){}function u(){}t=Object.getPrototypeOf;var l=[][r]?t(t([][r]())):(Q(t={},r,function(){return this}),t),f=u.prototype=a.prototype=Object.create(l);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,Q(e,o,"GeneratorFunction")),e.prototype=Object.create(f),e}return c.prototype=u,Q(f,"constructor",u),Q(u,"constructor",c),c.displayName="GeneratorFunction",Q(u,o,"GeneratorFunction"),Q(f),Q(f,o,"Generator"),Q(f,r,function(){return this}),Q(f,"toString",function(){return"[object Generator]"}),(K=function(){return{w:i,m:h}})()}function Q(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}Q=function(e,t,n,r){function i(t,n){Q(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},Q(e,t,n,r)}function L(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,z(r.key),r)}}function z(e){var t=function(e,t){if("object"!=G(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=G(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==G(t)?t:t+""}function V(e,t,n){return t=Z(t),function(e,t){if(t&&("object"==G(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(e,$()?Reflect.construct(t,n||[],Z(e).constructor):t.apply(e,n))}function $(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return($=function(){return!!e})()}function J(e,t,n,r){var o=W(Z(1&r?e.prototype:e),t,n);return 2&r&&"function"==typeof o?function(e){return o.apply(n,e)}:o}function W(){return W="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,n){var r=function(e,t){for(;!{}.hasOwnProperty.call(e,t)&&null!==(e=Z(e)););return e}(e,t);if(r){var o=Object.getOwnPropertyDescriptor(r,t);return o.get?o.get.call(arguments.length<3?e:n):o.value}},W.apply(null,arguments)}function Z(e){return Z=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},Z(e)}function H(e,t){return H=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},H(e,t)}var Y=function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=V(this,t,[e])).getMessage=function(e){return(0,r.m)(n,void 0,void 0,K().m(function t(){return K().w(function(t){for(;;)switch(t.n){case 0:if("complete"!=e.messageType){t.n=1;break}return t.a(2,JSON.stringify(Object.assign(Object.assign({},e.data),{videoName:this.videoName})));case 1:return t.a(2)}},t,this)}))},n.apiBase=e.apiBase,n.token=e.token,n.uid=e.uid,n.handleResponseResult=n.handleResponseResult.bind(n),n.uploadProtocal="websocket",n.socketCloseTimeline=[],n.httpTraceId=Math.round(1e6*Math.random()),n.payload={},n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&H(e,t)}(t,e),n=t,(o=[{key:"payloadData",value:function(){var e=this.payload,t={};e.locationType&&e.locationId&&(t.scope={type:this.payload.locationType,id:this.payload.locationId});var n={};if(e.tabUrl&&(n.sourceURL=e.tabUrl),e.appVersion&&(n.userAgent=e.appVersion),e.recordType&&(n.recordType=e.recordType),e.recorderVersion&&(n.extVersion=e.recorderVersion),e.screenSize&&(n.screenSize=e.screenSize),e.appAndPlatform&&(n.client=e.appAndPlatform),e.defaultCloudPlace){var r=e.defaultCloudPlace,o=r.split("-.-")[0];if("folder"===o)t.folderID=r.split("-.-")[1];else if("channel"===o){var i=r.split("-.-")[2],s=r.split("-.-")[1];i&&s&&(t.workspaceID=i,t.channelID=s)}}return t.extra=n,t}},{key:"getInitData",value:function(){var e=this.payloadData(),t=this.payload.videoCodec;return JSON.stringify(Object.assign(Object.assign({},e),{type:"init",title:this.title,token:this.token,userID:this.uid,videoCodec:t||"webm"}))}},{key:"getRecoverData",value:function(){var e=this.payloadData();return JSON.stringify(Object.assign(Object.assign({},e),{type:"recover",videoName:this.videoName,token:this.token,userID:this.uid}))}},{key:"getCompleteData",value:function(){return JSON.stringify({type:"complete",videoName:this.videoName,stopAt:Date.now()/1e3})}},{key:"getInitRequest",value:function(e){}},{key:"getCancelRequest",value:function(){var e="?t="+this.httpTraceId,t=this.apiBase+"/api/v1/record/discard"+e;return this.isStarted||(t=t.replace("discard","cancel")),new Request(t,{headers:{Authorization:this.token},method:"DELETE"})}},{key:"getRecoverRequest",value:function(){var e="?t="+this.httpTraceId,t=this.apiBase+"/record/file_upload_progress"+e;return new Request(t,{headers:{Authorization:this.token},method:"GET"})}},{key:"getUploadRequest",value:function(e){if(e instanceof Blob){var t="?t="+this.httpTraceId+"&i="+this.outQueueIndex,n=this.apiBase+"/record/file_upload"+t,r=new FormData;return r.append("video_id",this.id),r.append("file",e),new Request(n,{headers:{Authorization:this.token},method:"POST",body:r})}if("string"==typeof e)try{var o=JSON.parse(e);null==o||o.type}catch(e){}}},{key:"ready",value:function(e){return(0,r.m)(this,void 0,void 0,K().m(function t(){var n,r=this;return K().w(function(t){for(;;)if(0===t.n)return this.key=Date.now()+Math.random().toString(36),this.id="",this.temSid="",this.isPushDone=!1,this.isCancel=!1,this.isFirstSliceReported=!1,this.isStarted=!1,this.title=e.title,this.payload=e.payload||{},this.push(this.getInitData()),n=new Promise(function(e,t){r.initDone=e,setTimeout(function(){t()},6e5)}),this.socketConnect().finally(function(){return r.switchProtocal(r.uploadProtocal)}).then(function(){return n}).then(function(){r.onConnected&&r.onConnected(r.key,{vid:r.id,sid:r.temSid,backupDetails:{videoName:r.videoName}}),r.updateSid(r.temSid)}).catch(function(e){r.isNetWorkError=!0,r.haveRetryFailed(!0),r.handleNetWorkInfo()}),t.a(2,this.key)},t,this)}))}},{key:"replenish",value:function(e,t){return(0,r.m)(this,void 0,void 0,K().m(function n(){var r=this;return K().w(function(n){for(;;)if(0===n.n)return this.id=e,this.videoName=t,this.isFirstSliceReported=!0,this.isReplenish=!0,this.isReplenishRevise=!0,this.switchProtocal("websocket"),n.a(2,new Promise(function(e,t){r.replenishReviseResolve=e}))},n,this)}))}},{key:"netWorkRetryFailed",value:function(){J(t,"netWorkRetryFailed",this,3)([]),this.isNetWorkError=!0,this.haveRetryFailed(!0),this.handleNetWorkInfo()}},{key:"handleNetWorkInfo",value:function(){this.isPushDone&&this.isNetWorkError&&!this.isCanceling&&this.onError&&this.onError(this.key,{type:"networkError"})}},{key:"hackStopAction",value:function(){if(this.isPushDone&&!this.haveStop&&!this.isCanceling){var e,t={type:"queue-message-placeholder",messageType:"complete",data:{type:"complete",stopAt:Date.now()/1e3}};e=JSON.stringify(t),this.push(e),this.haveStop=!0}}},{key:"switchProtocal",value:function(e){return(0,r.m)(this,void 0,void 0,K().m(function t(){return K().w(function(t){for(;;)switch(t.n){case 0:"http"===e?(this.uploadProtocal="http",this.startHttpUpload(),this.frozenSocketUpload(),this.reviveHttpUpload()):(this.uploadProtocal="websocket",this.startSocketUpload(),this.frozenHttpUpload(),this.reviveSocketUpload());case 1:return t.a(2)}},t,this)}))}},{key:"start",value:function(){return J(t,"start",this,3)([]),this.getData()}},{key:"pause",value:function(){this.videoName&&this.push(JSON.stringify({type:"pause",videoName:this.videoName,reason:"user click"}))}},{key:"resume",value:function(){this.reportConnection()}},{key:"stop",value:function(e){return e.duration,e.size,(0,r.m)(this,void 0,void 0,K().m(function e(){var t=this;return K().w(function(e){for(;;)switch(e.n){case 0:this.setTimeout(function(){var e;t.videoName&&t.id&&(e=t.getCompleteData(),t.haveStop=!0,t.push(e)),t.isPushDone=!0,t.handleNetWorkInfo()},0),this.isReplenish,this.reportConnection();case 1:return e.a(2)}},e,this)}))}},{key:"cancel",value:function(){return(0,r.m)(this,void 0,void 0,K().m(function e(){var t,n=this;return K().w(function(e){for(;;)switch(e.n){case 0:return this.push(JSON.stringify({type:"cancel",videoName:this.videoName})),this.isPushDone=!0,this.isCanceling=!0,t=new Promise(function(e){n.socketCancelResolve=e,n.setTimeout(e,12e4)}),e.n=1,t;case 1:this.isCancel=!0,this.initQueue(),this.disconnect(),this.monitorStop();case 2:return e.a(2)}},e,this)}))}},{key:"push",value:function(e){var n=!1;e instanceof Blob||"complete"!==JSON.parse(e).messageType||this.haveStop||(n=!0),(!0!==this.isPushDone||n)&&!0!==this.isError&&(e instanceof Blob&&0===e.size||(J(t,"push",this,3)([e]),!this.isFirstSliceReported&&e instanceof Blob&&this.firstSliceReport(e)))}},{key:"handleMessageData",value:function(e){if(this.isNetWorkError=!1,"true"===e.close&&"cancel"!==e.type)return this.isError=!0,void(this.onError&&this.onError(this.key,{type:"unknown",message:e.message}));switch(this.handleResponseResult(e.type,parseInt(e.id)),e.type){case"init":case"recover":this.id=e.videoID||this.id,e.sid&&(this.temSid=e.sid),this.videoName=e.videoName||this.videoName,e.videoURI&&(this.videoUrl=e.videoURI),this.connectingDone&&this.connectingDone(!0);break;case"cancel":this.socketCancelResolve&&this.socketCancelResolve();break;case"complete":this.videoUrl=e.videoURI}"init"==e.type&&this.isPushDone&&!this.haveStop&&this.hackStopAction()}},{key:"handleResponseResult",value:function(e,t){switch(e){case"init":this.sliceIndexOffset+=1,this.handleQueueResponse(this.sliceIndex+this.sliceIndexOffset),"function"==typeof this.initDone&&(this.initDone(),this.monitorStart());break;case"slice":this.sliceIndex=t-1,this.handleQueueResponse(this.sliceIndex+this.sliceIndexOffset),this.onSliceUploaded&&this.onSliceUploaded(this.key,this.sliceIndex);break;case"pause":this.sliceIndexOffset+=1,this.handleQueueResponse(this.sliceIndex+this.sliceIndexOffset);break;case"recover":this.sliceIndex=isFinite(t)?t-1:this.sliceIndex,this.isReplenishRevise&&(this.replenishRevise(this.sliceIndex),this.replenishReviseResolve&&this.replenishReviseResolve(this.sliceIndex),this.isReplenishRevise=!1,this.replenishReviseResolve=null),this.revise(this.sliceIndex);break;case"complete":this.sliceIndexOffset+=1,this.handleQueueResponse(this.sliceIndex+this.sliceIndexOffset),this.disconnect()}}},{key:"getData",value:function(){return{vid:this.id,title:this.title,videoUrl:this.videoUrl}}},{key:"refreshProgress",value:function(){var e=J(t,"refreshProgress",this,3)([]);!0!==this.isPushDone||this.isCancel||e.finished!==e.total||"function"!=typeof this.onSuccess||(this.monitorStop(),this.onSuccess(this.key,this.getData()),this.disconnect());try{this.onProgress&&this.onProgress(this.key,e.finished/(this.totalBackupSlices&&this.totalBackupSlices>0?this.totalBackupSlices:e.total),e)}catch(e){}return e}},{key:"firstSliceReport",value:function(e){}},{key:"beaconReport",value:function(e,t){}},{key:"connectionReport",value:function(e,t){}},{key:"onSocketRecover",value:function(){J(t,"onSocketRecover",this,3)([])}},{key:"onSocketClose",value:function(e){J(t,"onSocketClose",this,3)([e]),this.socketCloseTimeline.push(Date.now()),isFinite(this.socketCloseCount)||(this.socketCloseCount=0),this.socketCloseTimeline.length>5&&(this.socketCloseTimeline=this.socketCloseTimeline.slice(-5)),this.socketCloseCount++,this.socketCloseTimeline.length>=5&&(Date.now(),this.socketCloseTimeline[0]),this.isCanceling&&(this.isCancel=!0)}},{key:"onSocketBlocking",value:function(){J(t,"onSocketBlocking",this,3)([])}},{key:"updateBackupSlices",value:function(e){e&&e>0&&(this.totalBackupSlices=e)}},{key:"httpReportStop",value:function(e,t){var n=this,r=this.apiBase+"/api/v1/video/click_stop";return new Promise(function(o,i){fetch(r,{headers:{},method:"POST",body:e?JSON.stringify({videoID:n.id,sliceTotal:n.totalSlice+"",reason:e,duration:t+""}):JSON.stringify({videoID:n.id,sliceTotal:n.totalSlice+"",duration:t+""})}).then(function(){o("ok")}).catch(function(){i("failed")})})}}])&&L(n.prototype,o),i&&L(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,i}(function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=F(this,t,[e])).initConnection(),n.initSocketMeasurement(),n.handleUnload=n.handleUnload.bind(n),n.handleConnectionChange=n.handleConnectionChange.bind(n),n.lastReportAt=Date.now(),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&q(e,t)}(t,e),n=t,r=[{key:"start",value:function(){B(t,"start",this,3)([])}},{key:"initConnection",value:function(){this.downlink={min:1/0,max:0,total:0,count:0},this.connectionRtt={min:1/0,max:0,total:0,count:0},this.connectionType={fastest:"slow-2g",slowest:"4g"}}},{key:"monitorStart",value:function(){window.addEventListener("unload",this.handleUnload),navigator.connection&&(this.handleConnectionChange(),navigator.connection.addEventListener("change",this.handleConnectionChange)),this.proxyFetch()}},{key:"monitorStop",value:function(){window.removeEventListener("unload",this.handleUnload),navigator.connection&&navigator.connection.removeEventListener("change",this.handleConnectionChange),this.revokeProxyFetch()}},{key:"reportConnection",value:function(){Date.now()-this.lastReportAt<3e4||(this.connectionReport(this.getConnection(),this.getServerConnection()),this.lastReportAt=Date.now())}},{key:"handleQueueResponse",value:function(e){B(t,"handleQueueResponse",this,3)([e]);var n=Date.now();n-this.lastReportAt>18e5&&this.reportConnection();var r=this.getQueueProgress(),o=r.finished,i=r.current;i-o>10&&n-this.lastReportAt>12e4&&this.reportConnection(),i-o>30&&n-this.lastReportAt>6e4&&this.reportConnection()}},{key:"proxyFetch",value:function(){var e=this;this.fetchProxy=Proxy.revocable(window.fetch,{apply:function(t,n,r){var o=Date.now(),i=t.apply(null,r);return i.then(function(t){var n=Date.now()-o;e.socketRtt.total+=n,e.socketRtt.count+=1,e.socketRtt.min>n&&(e.socketRtt.min=n),e.socketRtt.max<n&&(e.socketRtt.max=n)}),i}}),this.originalFetch=this.fetch,this.fetch=this.fetchProxy.proxy,this.fetch=this.fetch.bind(null)}},{key:"revokeProxyFetch",value:function(){this.originalFetch&&(this.fetch=this.originalFetch,this.fetch=this.fetch.bind(null)),this.fetchProxy&&(this.fetchProxy.revoke(),this.fetchProxy=null)}},{key:"compareNetwork",value:function(e,t){var n=["5g","4g","3g","2g","slow-2g"],r=n.findIndex(function(t){return t===e});return n.findIndex(function(e){return e===t})-r}},{key:"handleConnectionChange",value:function(){if(navigator.connection){var e=navigator.connection,t=e.downlink,n=e.rtt,r=e.effectiveType;this.downlink.total+=t,this.downlink.count+=1,this.downlink.min>t&&(this.downlink.min=t),this.downlink.max<t&&(this.downlink.max=t),this.connectionRtt.total+=n,this.connectionRtt.count+=1,this.connectionRtt.min>n&&(this.connectionRtt.min=n),this.connectionRtt.max<n&&(this.connectionRtt.max=n),this.compareNetwork(this.connectionType.fastest,r)<0&&(this.connectionType.fastest=r),this.compareNetwork(this.connectionType.slowest,r)>0&&(this.connectionType.slowest=r)}}},{key:"getConnection",value:function(){return{downlink:{max:Math.round(25*this.downlink.max),min:Math.round(25*this.downlink.min),avg:Math.round(this.downlink.total/this.downlink.count*25)},rtt:{max:25*this.connectionRtt.max,min:25*this.connectionRtt.min,avg:Math.round(this.connectionRtt.total/this.connectionRtt.count*25)},effective_type:{best:this.connectionType.fastest,worst:this.connectionType.slowest}}}},{key:"getServerConnection",value:function(){var e=this.socketBandwidth,t=this.socketRtt,n=(null==e?void 0:e.total)/(null==e?void 0:e.count),r=this.getQueueProgress(),o=r.finished,i=r.total;return{uplink:{max:Math.round(null==e?void 0:e.max),min:Math.round(null==e?void 0:e.min),avg:Math.round(n)},rtt:{max:t.max,min:t.min,avg:Math.round(t.total/t.count)},progress:Math.round(this.loaded/this.total*100),queue_progress:o+"/"+i,remaining_time_estimate:Math.round((this.total-this.loaded)/n)}}},{key:"handleUnload",value:function(){this.beaconReport(this.getConnection(),this.getServerConnection())}},{key:"onSocketRecover",value:function(){B(t,"onSocketRecover",this,3)([]),this.reportConnection()}},{key:"initSocketMeasurement",value:function(){this.socketMeasurement={startAt:0,startLoaded:0,startFinished:-1,ongoing:!1},this.socketBandwidth={min:1/0,max:0,total:0,count:0},this.socketRtt={min:1/0,max:0,total:0,count:0}}},{key:"onSocketMessage",value:function(e){B(t,"onSocketMessage",this,3)([e]);var n=this.getQueueProgress(),r=n.finished,o=n.current,i=this.loaded;this.total;var s=this.socketMeasurement,a=s.ongoing,c=s.startLoaded,u=s.startAt,l=s.startFinished;if((r===o||r-l>=20)&&a){var f=(i-c)/(Date.now()-u);this.socketBandwidth.total+=f,this.socketBandwidth.count+=1,this.socketBandwidth.min>f&&(this.socketBandwidth.min=f),this.socketBandwidth.max<f&&(this.socketBandwidth.max=f),this.socketMeasurement.ongoing=!1}}},{key:"onSocketUpload",value:function(e){B(t,"onSocketUpload",this,3)([e]);var n=this.socketMeasurement.ongoing,r=this.loaded,o=this.getQueueProgress().finished;!n&&e instanceof Blob&&(this.socketMeasurement={startAt:Date.now(),startLoaded:r,startFinished:o,ongoing:!0})}}],r&&E(n.prototype,r),o&&E(n,o),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,r,o}(function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=R(this,t,[e])).httpDormant=!0,n.fetch=e.fetch||window.fetch,n.fetch=n.fetch.bind(null),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&N(e,t)}(t,e),n=t,o=[{key:"start",value:function(){var e,n,r,o,i;(e=t,n="start",r=this,i=T(D(1&(o=3)?e.prototype:e),n,r),2&o&&"function"==typeof i?function(e){return i.apply(r,e)}:i)([])}},{key:"httpConnect",value:function(){return(0,r.m)(this,void 0,void 0,j().m(function e(){return j().w(function(e){for(;;)if(0===e.n)return e.a(2)},e)}))}},{key:"startHttpUpload",value:function(){var e=this,t=function(){return(0,r.m)(e,void 0,void 0,j().m(function e(){var n,r;return j().w(function(e){for(;;)switch(e.n){case 0:if(!(this.isCancel||this.isError||this.isDone)){e.n=1;break}return e.a(2);case 1:if(n=1e3,!0===this.httpDormant||!0===this.isPending){e.n=4;break}return e.n=2,this.get();case 2:if(null===(r=e.v)){e.n=4;break}return e.n=3,this.httpUpload(r);case 3:n=100;case 4:this.setTimeout(t,n);case 5:return e.a(2)}},e,this)}))};t()}},{key:"httpUpload",value:function(e){return(0,r.m)(this,void 0,void 0,j().m(function t(){var n;return j().w(function(t){for(;;)switch(t.n){case 0:return n=this.getUploadRequest(e),t.n=1,this.persistFetch(n);case 1:return t.a(2)}},t,this)}))}},{key:"httpPause",value:function(){this.handleResponseResult("pause",this.sliceIndex)}},{key:"httpRecover",value:function(){return(0,r.m)(this,void 0,void 0,j().m(function e(){var t,n,r,o;return j().w(function(e){for(;;)switch(e.p=e.n){case 0:return this.isPending=!0,t=this.getRecoverRequest(),e.p=1,e.n=2,this.persistFetch(t);case 2:return n=e.v,e.n=3,n.json();case 3:r=e.v,this.handleResponseResult("recover",r.data.slice_index),e.n=5;break;case 4:e.p=4,o=e.v,this.onError(this,o);case 5:this.isPending=!1;case 6:return e.a(2)}},e,this,[[1,4]])}))}},{key:"httpCancel",value:function(){var e=this.getCancelRequest();this.persistFetch(e)}},{key:"retryStrategy",value:function(e,t,n){return e?-1:Math.max(0,1e3*(n-1)*2)}},{key:"persistFetch",value:function(e){return(0,r.m)(this,void 0,void 0,j().m(function t(){var n,r,o,i,s,a=this;return j().w(function(t){for(;;)switch(t.p=t.n){case 0:n=!1,r=0,o=0;case 1:if(n){t.n=8;break}return r++,n=!0,t.p=2,t.n=3,this.fetch(e);case 3:if(i=t.v,(o=this.retryStrategy(i,null,r))>=0&&(n=!1),!n){t.n=4;break}return t.a(2,i);case 4:t.n=6;break;case 5:if(t.p=5,s=t.v,(o=this.retryStrategy(null,s,r))>=0&&(n=!1),!n){t.n=6;break}throw s;case 6:return t.n=7,new Promise(function(e){a.setTimeout(function(){return e()},o)});case 7:t.n=1;break;case 8:return t.a(2)}},t,this,[[2,5]])}))}},{key:"frozenHttpUpload",value:function(){this.httpDormant=!0}},{key:"reviveHttpUpload",value:function(){return(0,r.m)(this,void 0,void 0,j().m(function e(){return j().w(function(e){for(;;)switch(e.n){case 0:this.httpDormant=!1,this.httpRecover();case 1:return e.a(2)}},e,this)}))}}],o&&x(n.prototype,o),i&&x(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,i}(function(e){function t(e){var n;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),(n=b(this,t,[e])).url=e.wsUrl,n.sid=e.sid,n.isOutRetryTimes=!1,n.protocols=e.wsProtocols||[],n.disconnect=n.disconnect.bind(n),n.handleClose=n.handleClose.bind(n),n.handleMessage=n.handleMessage.bind(n),n.socketDormant=!1,n.socketConnectTraceId=Math.round(1e6*Math.random()),n}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&k(e,t)}(t,e),n=t,(o=[{key:"updateSid",value:function(e){this.sid=e}},{key:"socketConnect",value:function(e){return(0,r.m)(this,void 0,void 0,p().m(function t(){var n,r,o,i,s,a=this;return p().w(function(t){for(;;)switch(t.n){case 0:if(n=20,r=0,o=!1,!0!==this.isConnecting){t.n=1;break}return t.a(2);case 1:this.isConnecting=!0,this.socketConnectPromise=new Promise(function(e,t){a.connectingDone=e,i=t}),s=p().m(function t(){var s;return p().w(function(t){for(;;)switch(t.n){case 0:if(!(a.isError||a.isDone||a.socketDormant||a.isCancel)){t.n=1;break}return t.a(2,1);case 1:return r++,t.n=2,a.connect().then(function(t){t.onclose=a.handleClose,o=!0,e&&e(t)}).catch(function(e){});case 2:if(o){t.n=3;break}return s=Math.max(0,1e3*(r-2)*2),t.n=3,new Promise(function(e){a.setTimeout(function(){return e()},s)});case 3:if(!(r>=n)||o){t.n=4;break}throw i(),Error("persist connect failed.");case 4:return t.a(2)}},t)});case 2:if(o){t.n=5;break}return t.d(d(s()),3);case 3:if(!t.v){t.n=4;break}return t.a(3,5);case 4:t.n=2;break;case 5:this.isConnecting=!1;case 6:return t.a(2)}},t,this)}))}},{key:"connect",value:function(){return(0,r.m)(this,void 0,void 0,p().m(function e(){var t,n=this;return p().w(function(e){for(;;)if(0===e.n)return this.socket&&this.socket.close(),t=this.url+"&t="+this.socketConnectTraceId+(this.sid?"&sid="+this.sid:""),this.socket=new WebSocket(t,f(this.protocols)),this.socket.onmessage=this.handleMessage,e.a(2,new Promise(function(e,t){n.socket.onopen=function(){if(n.isPushDone&&n.isDone)return n.socket.close();n._isConnected=!0,e(n.socket)},n.socket.onerror=function(e){t(e)},n.socket.onclose=function(e){t(e),n.onSocketClose(e)}}))},e,this)}))}},{key:"recover",value:function(){return(0,r.m)(this,void 0,void 0,p().m(function e(){var t,n=this;return p().w(function(e){for(;;)switch(e.n){case 0:if(!(this._isConnected||this.isError||this.isDone||this.socketDormant)){e.n=1;break}return e.a(2);case 1:return t=this.getRecoverData(),this.socketConnect(function(){n.upload(t)}).catch(function(e){n.netWorkRetryFailed()}),this.onSocketRecover(),e.a(2,this.socketConnectPromise)}},e,this)}))}},{key:"handleClose",value:function(e){var t=this;this._isConnected=!1,this.socketConnectPromise=null,this.getQueueProgress(),!0!==this.isError&&!0!==this.socketDormant&&!0!==this.isDone&&!0!==this.isCancel&&this.setTimeout(function(){t.recover()},3e3),this.onSocketClose(e)}},{key:"startUpload2",value:function(){return(0,r.m)(this,void 0,void 0,p().m(function e(){var t,n;return p().w(function(e){for(;;)switch(e.n){case 0:if(!(this.isCancel||this.isError||this.isDone)){e.n=1;break}return e.a(2);case 1:if(this.isUploading){e.n=9;break}this.isUploading=!0,t=!0===this._isConnected&&!this.isConnecting&&!0!==this.socketDormant;case 2:if(!t){e.n=8;break}if(!(this.penddingCount<=this.maxQueueBlobSlice/3&&this.maxQueueBlobSlice>1)){e.n=6;break}return e.n=3,this.get();case 3:if(null===(n=e.v)){e.n=4;break}this.upload(n),e.n=5;break;case 4:return e.a(3,8);case 5:e.n=7;break;case 6:return e.a(3,8);case 7:e.n=2;break;case 8:this.isUploading=!1;case 9:return e.a(2)}},e,this)}))}},{key:"startSocketUpload",value:function(){var e=this,t=function(){return(0,r.m)(e,void 0,void 0,p().m(function e(){var n,r,o,i,s;return p().w(function(e){for(;;)switch(e.n){case 0:if(!(this.isCancel||this.isError||this.isDone||this.isOutRetryTimes)){e.n=1;break}return e.a(2);case 1:if(n=1e3,r=this.penddingCount<=this.maxQueueBlobSlice/3&&this.maxQueueBlobSlice>1,!0!==this._isConnected||this.isConnecting||!0===this.socketDormant||!r){e.n=3;break}return e.n=2,this.get();case 2:null!==(o=e.v)&&(this.upload(o),n=100);case 3:i=isFinite(this.lastSendTime)?this.lastSendTime:0,s=isFinite(this.lastReceivedTime)?this.lastReceivedTime:0,i-s>2e4&&-1===this.jamAt&&(this.jamAt=Date.now()),Date.now()-this.jamAt>12e4&&this.onSocketBlocking(),this.setTimeout(t,n);case 4:return e.a(2)}},e,this)}))};t()}},{key:"handleMessage",value:function(e){this.lastReceivedTime=Date.now(),this.jamAt>0&&(this.jamAt=-1);try{var t=JSON.parse(e.data);this.handleMessageData(t)}catch(e){}this.onSocketMessage(e)}},{key:"upload",value:function(e){this.lastSendTime=Date.now(),this.socket.send(e),this.onSocketUpload(e)}},{key:"isConnected",get:function(){return this._isConnected}},{key:"haveRetryFailed",value:function(e){this.isOutRetryTimes=!0}},{key:"disconnect",value:function(){!1!==this._isConnected&&this.socket&&this.socket.close()}},{key:"frozenSocketUpload",value:function(){this.socketDormant=!0,this.disconnect()}},{key:"reviveSocketUpload",value:function(){this.socketDormant=!1,this._isConnected||this.isConnecting||this.recover()}},{key:"onSocketRecover",value:function(){}},{key:"onSocketMessage",value:function(e){}},{key:"onSocketUpload",value:function(e){}},{key:"onSocketClose",value:function(e){}},{key:"onSocketBlocking",value:function(){}}])&&v(n.prototype,o),i&&v(n,i),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,o,i}(function(){return e=function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.initQueue(),this.setTimeout=t.setTimeout||window.setTimeout,this.clearTimeout=t.clearTimeout||window.clearTimeout,this.setTimeout=this.setTimeout.bind(null),this.clearTimeout=this.clearTimeout.bind(null),this.maxQueueBlobSlice=isFinite(null==t?void 0:t.maxQueueBlobSlice)?t.maxQueueBlobSlice:0},(t=[{key:"start",value:function(){this.isStarted=!0}},{key:"initQueue",value:function(){this.queue=[],this.confirmedIndex=-1,this.sendedIndex=-1,this.countedCount=0,this.sliceIndexOffset=0,this.sliceIndex=-1,this.loaded=0,this.total=0,this.totalSlice=0}},{key:"updateTotalSliceBackup",value:function(e){this.totalSlice=e}},{key:"push",value:function(e){!0!==this.isError&&(e instanceof Blob&&(this.total+=e.size,this.totalSlice+=1,this.maxQueueBlobSlice>1&&this.getSlice&&this.queue.reduce(function(e,t){return t instanceof Blob?e+1:e},0)>this.maxQueueBlobSlice&&(e=JSON.stringify({type:u,slice:this.totalSlice-1}))),this.queue.push(e),this.refreshProgress())}},{key:"outQueueIndex",get:function(){return this.countedCount+this.sendedIndex+1}},{key:"getRaw",value:function(){if(!0===this.isError)return null;if(this.sendedIndex===this.queue.length-1)return null;var e=this.queue[this.sendedIndex+1],t=this.countedCount+this.sendedIndex+1;return!e||isNaN(t)||this.sendedIndex>=this.queue.length?null:(this.sendedIndex=this.sendedIndex+1,e)}},{key:"get",value:function(){return(0,r.m)(this,void 0,void 0,i().m(function e(){var t,n,r,o;return i().w(function(e){for(;;)switch(e.p=e.n){case 0:if(t=this.getRaw()){e.n=1;break}return e.a(2,t);case 1:if(!(t instanceof Blob)){e.n=2;break}return e.a(2,t);case 2:if(e.p=2,(n=JSON.parse(t)).type!=u){e.n=4;break}return e.n=3,this.getSlice(n.slice);case 3:return r=e.v,e.a(2,r);case 4:if("queue-message-placeholder"!=n.type){e.n=6;break}return e.n=5,this.getMessage(n);case 5:return o=e.v,e.a(2,o);case 6:return e.a(2,t);case 7:return e.p=7,e.v,e.a(2,t)}},e,this,[[2,7]])}))}},{key:"handleQueueResponse",value:function(e){if(this.countedCount,this.confirmedIndex,e===this.countedCount+this.confirmedIndex+1){this.confirmedIndex=this.confirmedIndex+1;var t=this.queue[this.confirmedIndex];t instanceof Blob&&(this.loaded+=t.size)}else e>this.countedCount+this.confirmedIndex+1&&(this.confirmedIndex=e-this.countedCount-1);this.confirmedIndex>5&&(this.countedCount=this.countedCount+this.confirmedIndex+1,this.sendedIndex=this.sendedIndex-this.confirmedIndex-1,this.queue=this.queue.slice(this.confirmedIndex+1),this.confirmedIndex=-1),this.refreshProgress()}},{key:"revise",value:function(e){this.sendedIndex=e+this.sliceIndexOffset-this.countedCount;var t=this.confirmedIndex;this.confirmedIndex=this.sendedIndex;for(var n=this.confirmedIndex-t,r=1;r<=n;r++){var o=this.queue[t+r];o instanceof Blob&&(this.loaded+=o.size)}}},{key:"replenishRevise",value:function(e){return(0,r.m)(this,void 0,void 0,i().m(function t(){return i().w(function(t){for(;;)switch(t.n){case 0:this.isPushDone=!1,this.isCancel=!1,this.isStarted=!0,this.countedCount=e+1;case 1:return t.a(2)}},t,this)}))}},{key:"getUnconfirmedCount",value:function(){return this.queue.length-this.confirmedIndex-1}},{key:"penddingCount",get:function(){return this.sendedIndex-this.confirmedIndex}},{key:"getConfirmedCount",value:function(){return this.countedCount+this.confirmedIndex+1}},{key:"getProgress",value:function(){return this.getConfirmedCount()/(this.countedCount+this.queue.length)}},{key:"getQueueProgress",value:function(){return{finished:this.countedCount+this.confirmedIndex+1,current:this.countedCount+this.sendedIndex+1,total:this.countedCount+this.queue.length,binarySlice:this.sliceIndex+1}}},{key:"refreshProgress",value:function(){var e=this.getQueueProgress();return this.isPushDone&&e.finished>=e.total&&(this.isDone=!0),e}},{key:"netWorkRetryFailed",value:function(){}}])&&a(e.prototype,t),n&&a(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}()))))},6186:(e,t,n)=>{n.d(t,{u:()=>f});var r=n(99231);function o(e){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},o(e)}function i(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,i,s,a=[],c=!0,u=!1;try{if(i=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=i.call(n)).done)&&(a.push(r.value),a.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(s=n.return(),Object(s)!==s))return}finally{if(u)throw o}}return a}}(e,t)||function(e,t){if(e){if("string"==typeof e)return s(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function a(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",o=n.toStringTag||"@@toStringTag";function i(n,r,o,i){var a=r&&r.prototype instanceof u?r:u,l=Object.create(a.prototype);return c(l,"_invoke",function(n,r,o){var i,a,c,u=0,l=o||[],f=!1,h={p:0,n:0,v:e,a:d,f:d.bind(e,4),d:function(t,n){return i=t,a=0,c=e,h.n=n,s}};function d(n,r){for(a=n,c=r,t=0;!f&&u&&!o&&t<l.length;t++){var o,i=l[t],d=h.p,p=i[2];n>3?(o=p===r)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=e):i[0]<=d&&((o=n<2&&d<i[1])?(a=0,h.v=r,h.n=i[1]):d<p&&(o=n<3||i[0]>r||r>p)&&(i[4]=n,i[5]=r,h.n=p,a=0))}if(o||n>1)return s;throw f=!0,r}return function(o,l,p){if(u>1)throw TypeError("Generator is already running");for(f&&1===l&&d(l,p),a=l,c=p;(t=a<2?e:c)||!f;){i||(a?a<3?(a>1&&(h.n=-1),d(a,c)):h.n=c:h.v=c);try{if(u=2,i){if(a||(o="next"),t=i[o]){if(!(t=t.call(i,c)))throw TypeError("iterator result is not an object");if(!t.done)return t;c=t.value,a<2&&(a=0)}else 1===a&&(t=i.return)&&t.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=e}else if((t=(f=h.n<0)?c:n.call(r,h))!==s)break}catch(t){i=e,a=1,c=t}finally{u=1}}return{value:t,done:f}}}(n,o,i),!0),l}var s={};function u(){}function l(){}function f(){}t=Object.getPrototypeOf;var h=[][r]?t(t([][r]())):(c(t={},r,function(){return this}),t),d=f.prototype=u.prototype=Object.create(h);function p(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,f):(e.__proto__=f,c(e,o,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=f,c(d,"constructor",f),c(f,"constructor",l),l.displayName="GeneratorFunction",c(f,o,"GeneratorFunction"),c(d),c(d,o,"Generator"),c(d,r,function(){return this}),c(d,"toString",function(){return"[object Generator]"}),(a=function(){return{w:i,m:p}})()}function c(e,t,n,r){var o=Object.defineProperty;try{o({},"",{})}catch(e){o=0}c=function(e,t,n,r){function i(t,n){c(e,t,function(e){return this._invoke(t,n,e)})}t?o?o(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n:(i("next",0),i("throw",1),i("return",2))},c(e,t,n,r)}function u(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,l(r.key),r)}}function l(e){var t=function(e,t){if("object"!=o(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=o(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==o(t)?t:t+""}var f=function(){return e=function e(t){var n=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.registerKeyPool=new Set,this.queryRegisterKey=(null==t?void 0:t.storageQueryKey)||"query_single_line",this.queryWaitingTime=isFinite(null==t?void 0:t.queryWaitingTime)?t.queryWaitingTime:300,this.handleStorage=function(e){if(e.key===n.queryRegisterKey)try{var t=JSON.parse(e.newValue);n.responseQueryEvent(t)}catch(e){}},this.storageListener=!1,this.setTimeout=(null==t?void 0:t.setTimeout)||window.setTimeout,this.clearTimeout=(null==t?void 0:t.clearTimeout)||window.clearTimeout,this.setTimeout=this.setTimeout.bind(null),this.clearTimeout=this.clearTimeout.bind(null)},t=[{key:"prepareListener",value:function(){this.registerKeyPool.size>0&&!this.storageListener&&(window.addEventListener("storage",this.handleStorage),window.addEventListener("storage-self",this.handleStorage),this.storageListener=!0),0==this.registerKeyPool.size&&this.storageListener&&(window.removeEventListener("storage",this.handleStorage),window.removeEventListener("storage-self",this.handleStorage),this.storageListener=!1)}},{key:"register",value:function(e){var t=this;return this.registerKeyPool.add(e),this.prepareListener(),function(){t.unregister(e)}}},{key:"unregister",value:function(e){this.registerKeyPool.delete(e),this.prepareListener()}},{key:"queryOutageKeys",value:function(e){return(0,r.m)(this,void 0,void 0,a().m(function t(){var n,r=this;return a().w(function(t){for(;;)switch(t.n){case 0:return this.dispatchQuery(e),t.n=1,new Promise(function(e){r.setTimeout(e,r.queryWaitingTime)});case 1:return n=this.getResponse(),t.a(2,e.filter(function(e){return n[e]<=0}))}},t,this)}))}},{key:"dispatchQuery",value:function(e){var t=localStorage.getItem(this.queryRegisterKey),n={};try{var r=JSON.parse(t);n=Object.assign(n,r)}catch(s){}var o=Date.now();n=Object.fromEntries(Object.entries(n).filter(function(e){var t=i(e,2),n=(t[0],t[1]);return o-Math.abs(n)<6e4})),n=Object.assign(n,e.reduce(function(e,t){return Object.assign(Object.assign({},e),function(e,t,n){return(t=l(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},t,-Date.now()))},{})),localStorage.setItem(this.queryRegisterKey,JSON.stringify(n));var s=new StorageEvent("storage-self",{key:this.queryRegisterKey,newValue:JSON.stringify(n)});window.dispatchEvent(s)}},{key:"responseQueryEvent",value:function(e){var t=this,n=Object.assign({},e),r=!1;Object.keys(e).forEach(function(e){t.registerKeyPool.has(e)&&(n[e]=Date.now(),r=!0)}),r&&localStorage.setItem(this.queryRegisterKey,JSON.stringify(n))}},{key:"getResponse",value:function(){var e=localStorage.getItem(this.queryRegisterKey),t={};try{var n=JSON.parse(e);t=Object.assign(t,n)}catch(e){}return t}}],t&&u(e.prototype,t),n&&u(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,t,n}()}}]);