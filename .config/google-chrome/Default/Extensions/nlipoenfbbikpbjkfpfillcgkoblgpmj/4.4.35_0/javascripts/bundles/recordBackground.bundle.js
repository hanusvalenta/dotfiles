(()=>{var t,e,r,n={9669:(t,e,r)=>{t.exports=r(51609)},35552:(t,e,r)=>{"use strict";r.d(e,{$r:()=>Qe,Bn:()=>He,GR:()=>Ue,HC:()=>Be,Jw:()=>Ke,R6:()=>$e,Rv:()=>tr,UB:()=>ze,ZE:()=>Ve,a6:()=>Le,c8:()=>We,gD:()=>Ye,jT:()=>Je,m2:()=>qe,qw:()=>Xe});var n=r(67294),o=r(16165),i=r(94184),a=r.n(i),c=(r(82452),r(98374)),u=r(60327),s=r(92976),l=r(98688),f=r(30418),d=r(24986),p=r(73586),h=r(49355),v=r(62504),m=r(86324),y=r(92504),b=r(11685),g=r(1744),w=r(42978),S=r(83225),k=r(83462),T=r(33038),O=r(29970),I=r(9187),j=r(48960),P=r(26436),E=r(93185),x=r(1080),D=r(66716),C=r(36716),_=r(4883),M=r(85631),R=r(2134),A=r(68766),F=r(45250),Z=r(4689),N=r(11734),G=r(68901),U=r(97479),B=r(63501),L=r(4450),z=r(55744),q=r(10757),V=r(83538),W=r(9571),K=r(7241),H=r(42025),J=r(31727),Q=r(71428),$=r(57179),Y=r(69546),X=r(60126),tt=r(17687),et=r(22939),rt=r(63059),nt=r(58899),ot=r(58707),it=r(38183),at=r(76664),ct=r(24346),ut=r(44436),st=r(85309),lt=r(54392),ft=r(68321),dt=r(8197),pt=r(21482),ht=r(37491),vt=r(64322),mt=r(13243),yt=r(64664),bt=r(13736),gt=r(94222),wt=r(63073),St=r(82082),kt=r(26836),Tt=r(74748),Ot=r(59333),It=r(70110),jt=r(15801),Pt=r(70161),Et=r(49233),xt=r(14962),Dt=r(21844),Ct=r(27807),_t=r(64094),Mt=r(93388),Rt=r(92580),At=r(93103),Ft=r(38514),Zt=r(25912),Nt=r(75847),Gt=r(30227),Ut=r(74990),Bt=r(91696),Lt=r(19877),zt=r(31614),qt=r(64970),Vt=r(69426),Wt=r(83748),Kt=r(78037),Ht=r(12528),Jt=r(30913),Qt=r(54311),$t=r(53495),Yt=r(77809),Xt=r(46516),te=r(32729),ee=r(72005),re=r(48858),ne=r(26191),oe=r(94372),ie=r(60272),ae=r(67449),ce=r(56191),ue=r(45747),se=r(39873),le=r(19961),fe=r(96596),de=r(17352),pe=r(33146),he=r(98258),ve=r(59478),me=r(76838),ye=r(67671),be=r(56101),ge=r(61780),we=r(72245),Se=r(44549),ke=r(61654),Te=r(49795),Oe=r(19926),Ie=r(22015),je=r(22594),Pe=r(45818),Ee=r(25323),xe=r(73988),De=r(85893);function Ce(t){return Ce="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ce(t)}function _e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function Me(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?_e(Object(r),!0).forEach(function(e){Re(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):_e(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function Re(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=Ce(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Ce(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ce(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function Ae(t){var e=a()("svg-icon",t.className);return(0,De.jsx)(o.Z,Me(Me({},t),{},{className:e}))}var Fe={AddImageIcon:c.Z,AddIcon:u.Z,AnnotateIcon:s.Z,ArrowIcon:l.Z,CloseIcon:f.Z,CommentIcon:d.Z,CopyLinkIcon:p.Z,CopyIcon:h.Z,DownloadIcon:v.Z,EmbedIcon:m.Z,FeedbackIcon:y.Z,FolderIcon:b.Z,ImagesIcon:g.Z,ItemsIcon:w.Z,LoadingMoreIcon:S.Z,MoreIcon:k.Z,MoveFolderIcon:T.Z,NotificationIcon:O.Z,OpenFolderIcon:I.Z,PutBackIcon:j.Z,RenameIcon:P.Z,RightIcon:E.Z,TagIcon:x.Z,TrashFilledIcon:D.Z,TrashIcon:C.Z,VideosIcon:_.Z,AddTextIcon:M.Z,CutIcon:R.Z,ProIcon:A.Z,PullIcon:F.Z,ReduceIcon:Z.Z,MoreDotIcon:N.Z,PlayIcon:U.Z,PauseIcon:B.Z,FullScreenIcon:L.Z,NormalScreenIcon:z.Z,PIPIcon:q.Z,ReplayIcon:V.Z,VolumeCloseIcon:W.Z,VolumeHighIcon:K.Z,VolumeLowIcon:H.Z,SharedIcon:J.Z,StepForwardIcon:Q.Z,StepBackIcon:$.Z,CommentBubbleIcon:Y.Z,MentionMsgIcon:X.Z,VideoEditorIcon:G.Z,EmojiIcon:tt.Z,RecordDesktopIcon:et.Z,RecordCameraIcon:rt.Z,PricingTagIcon:nt.Z,LightThemeIcon:ot.Z,DarkThemeIcon:it.Z,AutoThemeIcon:at.Z,NewTabIcon:ct.Z,MicIcon:ut.Z,HDIcon:st.Z,CameraIcon:lt.Z,ChromeIcon:ft.Z,EdgeIcon:dt.Z,GoogleIcon:pt.Z,BrushIcon:ht.Z,SecurityIcon:mt.Z,SyncIcon:vt.Z,ChannelIcon:yt.Z,SettingIcon:bt.Z,MemberIcon:gt.Z,PersonIcon:wt.Z,QuestionMarkIcon:St.Z,CardIcon:kt.Z,SharedMeIcon:Tt.Z,MeIcon:Ot.Z,StarIcon:It.Z,EmptyIcon:jt.Z,PdfIcon:Pt.Z,PrinterIcon:Et.Z,CopyImageIcon:xt.Z,SmileIcon:Dt.Z,CrownIcon:Ct.Z,CrownBgIcon:_t.Z,SharedMeFilledIcon:Mt.Z,WarningIcon:Rt.Z,BilligIcon:At.Z,StarFolderIcon:Ft.Z,MeFilledIcon:Zt.Z,AtIcon:Nt.Z,StickerIcon:tt.Z,CameraNoIcon:Gt.Z,TrashRecordIcon:Ut.Z,StopRecordIcon:Bt.Z,ActionBigIcon:zt.Z,ActionMiniIcon:Lt.Z,CameraRecordIcon:qt.Z,CheckboxIcon:Vt.Z,DragIcon:Wt.Z,AddMemberIcon:Kt.Z,RecordPauseIcon:Ht.Z,RecordPlayIcon:Jt.Z,LockIcon:Qt.Z,EnterpriseIcon:$t.Z,DomainIcon:Yt.Z,SsoIcon:Xt.Z,DownloadExtIcon:te.Z,CopyExtIcon:ee.Z,PDFExtIcon:re.Z,PrintExtIcon:ne.Z,BackupExtIcon:oe.Z,OutIcon:ie.Z,ShareIcon:ae.Z,DescIcon:ce.Z,FolderFilledIcon:ue.Z,VideoFolderIcon:se.Z,VideoFilmIcon:le.Z,VideoEditIcon:fe.Z,IcStopIcon:Bt.Z,PointerIcon:de.Z,ExtWarningIcon:pe.Z,NoBackupIcon:he.Z,VideoFailedIcon:ve.Z,VideoStatusIcon:me.Z,VideoPlayIcon:ye.Z,VideoDownloadIcon:be.Z,VideoRetryIcon:ge.Z,VideoDeleteIcon:we.Z,MyItemIcon:Se.Z,DoneIcon:ke.Z,ScreenshotIIcon:Te.Z,TabIIcon:Oe.Z,InfiniteIcon:Ie.Z,BrainIcon:je.Z,SiderOcrIcon:Pe.Z,ReUploadIcon:Ee.Z,TipIcon:xe.Z},Ze={},Ne=function(t){Ze[t]=(0,n.memo)(function(e){return(0,De.jsx)(Ae,Me({component:Fe[t]},e))}),Ze[t].displayName=t};for(var Ge in Fe)Ne(Ge);Ze.AddImageIcon,Ze.AddIcon,Ze.AnnotateIcon,Ze.ArrowIcon,Ze.CloseIcon,Ze.CommentIcon,Ze.CopyLinkIcon,Ze.CopyIcon,Ze.DownloadIcon,Ze.EmbedIcon,Ze.FeedbackIcon,Ze.FolderIcon,Ze.ImagesIcon,Ze.ItemsIcon,Ze.LoadingMoreIcon,Ze.MoreIcon,Ze.MoveFolderIcon,Ze.NotificationIcon,Ze.OpenFolderIcon,Ze.PutBackIcon,Ze.RenameIcon,Ze.RightIcon,Ze.TagIcon,Ze.TrashFilledIcon,Ze.TrashIcon,Ze.VideosIcon,Ze.AddTextIcon,Ze.CutIcon,Ze.ProIcon,Ze.PullIcon,Ze.ReduceIcon,Ze.MoreDotIcon,Ze.PlayIcon,Ze.PauseIcon,Ze.FullScreenIcon,Ze.NormalScreenIcon,Ze.PIPIcon,Ze.ReplayIcon,Ze.VolumeCloseIcon,Ze.VolumeHighIcon,Ze.VolumeLowIcon,Ze.SharedIcon,Ze.StepForwardIcon,Ze.StepBackIcon,Ze.CommentBubbleIcon,Ze.MentionMsgIcon,Ze.VideoEditorIcon,Ze.EmojiIcon,Ze.RecordDesktopIcon,Ze.RecordCameraIcon,Ze.PricingTagIcon,Ze.LightThemeIcon,Ze.DarkThemeIcon,Ze.AutoThemeIcon,Ze.NewTabIcon,Ze.MicIcon,Ze.HDIcon,Ze.CameraIcon,Ze.ChromeIcon,Ze.EdgeIcon,Ze.GoogleIcon,Ze.BrushIcon,Ze.SecurityIcon,Ze.SyncIcon,Ze.ChannelIcon,Ze.SettingIcon,Ze.MemberIcon,Ze.PersonIcon,Ze.QuestionMarkIcon,Ze.CardIcon,Ze.SharedMeIcon,Ze.MeIcon,Ze.StarIcon,Ze.EmptyIcon,Ze.PdfIcon,Ze.PrinterIcon,Ze.CopyImageIcon,Ze.SmileIcon,Ze.CrownIcon,Ze.CrownBgIcon,Ze.SharedMeFilledIcon,Ze.WarningIcon,Ze.BilligIcon,Ze.StarFolderIcon,Ze.MeFilledIcon,Ze.AtIcon,Ze.StickerIcon,Ze.CameraNoIcon;var Ue=Ze.TrashRecordIcon,Be=(Ze.StopRecordIcon,Ze.ActionBigIcon,Ze.ActionMiniIcon,Ze.CameraRecordIcon,Ze.DragIcon,Ze.CheckboxIcon,Ze.AddMemberIcon,Ze.RecordPauseIcon),Le=Ze.RecordPlayIcon,ze=(Ze.LockIcon,Ze.EnterpriseIcon,Ze.DomainIcon,Ze.SsoIcon,Ze.DownloadExtIcon,Ze.CopyExtIcon,Ze.PDFExtIcon,Ze.PrintExtIcon,Ze.BackupExtIcon,Ze.OutIcon,Ze.ShareIcon,Ze.DescIcon,Ze.FolderFilledIcon,Ze.VideoFolderIcon,Ze.VideoFilmIcon,Ze.VideoEditIcon,Ze.IcStopIcon),qe=Ze.PointerIcon,Ve=Ze.ExtWarningIcon,We=Ze.NoBackupIcon,Ke=Ze.VideoFailedIcon,He=Ze.VideoStatusIcon,Je=Ze.VideoPlayIcon,Qe=Ze.VideoDownloadIcon,$e=(Ze.VideoRetryIcon,Ze.VideoDeleteIcon),Ye=Ze.MyItemIcon,Xe=Ze.DoneIcon,tr=(Ze.ScreenshotIIcon,Ze.TabIIcon,Ze.InfiniteIcon,Ze.BrainIcon,Ze.SiderOcrIcon,Ze.ReUploadIcon);Ze.TipIcon},30340:(t,e,r)=>{"use strict";var n=r(73935),o=r(67294),i=r(82483),a=r(92427),c=r(86642);function u(t){return t.filter(function(t,e,r){return""!==t.label&&r.findIndex(function(e){return e.deviceId===t.deviceId})===e})}function s(){return new Promise(function(t,e){!function(t,e){if(!navigator.enumerateDevices&&window.MediaStreamTrack&&window.MediaStreamTrack.getSources&&(navigator.enumerateDevices=window.MediaStreamTrack.getSources.bind(window.MediaStreamTrack)),!navigator.enumerateDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=navigator.mediaDevices.enumerateDevices.bind(navigator)),navigator.enumerateDevices){var r=[],n=[],o=[],i=[],a=[],c=[];navigator.enumerateDevices(function(e){e.forEach(function(t){var e,u={};for(var s in t)u[s]=t[s];r.forEach(function(t){t.deviceId===u.deviceId&&(e=!0)}),e||("audio"===u.kind&&(u.kind="audioinput"),"video"===u.kind&&(u.kind="videoinput"),u.deviceId||(u.deviceId=u.id),u.id||(u.id=u.deviceId),"audioinput"!==u.kind&&"audio"!==u.kind||u.label&&!u.label.startsWith("AS")&&i.push(u),"audiooutput"===u.kind&&a.push(u),"videoinput"!==u.kind&&"video"!==u.kind||c.push(u),-1!==u.kind.indexOf("audio")&&u.label&&!u.label.startsWith("AS")&&n.push(u),-1!==u.kind.indexOf("video")&&o.push(u),r.push(u))}),t&&t({allMediaDevices:r,allVideoDevices:o,allAudioDevices:n,videoInputDevices:c,audioInputDevices:i,audioOutputDevices:a})})}else e(null,"Neither navigator.mediaDevices.enumerateDevices NOR MediaStreamTrack.getSources are available.")}(function(e){var r=e,n=u(r.audioInputDevices),o=u(r.videoInputDevices);t({availableAudioDevices:n,availableVideoDevices:o})})})}function l(t,e){return chrome.runtime.sendMessage(t,e)}navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(navigator.enumerateDevices=function(t){navigator.mediaDevices.enumerateDevices().then(t)});var f=r(72769),d="webm",p="video/webm;codecs=vp8",h="fmp4",v="video/mp4;codecs=h264";function m(t){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},m(t)}function y(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}throw new TypeError(m(t)+" is not iterable")}function b(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return g(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(g(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,g(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,g(f,"constructor",s),g(s,"constructor",u),u.displayName="GeneratorFunction",g(s,o,"GeneratorFunction"),g(f),g(f,o,"Generator"),g(f,n,function(){return this}),g(f,"toString",function(){return"[object Generator]"}),(b=function(){return{w:i,m:d}})()}function g(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}g=function(t,e,r,n){function i(e,r){g(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},g(t,e,r,n)}function w(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}window.requestFileSystem=window.requestFileSystem||window.webkitRequestFileSystem;var S=null;function k(t){var e="";switch(t.code){case FileError.QUOTA_EXCEEDED_ERR:e="QUOTA_EXCEEDED_ERR";break;case FileError.NOT_FOUND_ERR:e="NOT_FOUND_ERR";break;case FileError.SECURITY_ERR:e="SECURITY_ERR";break;case FileError.INVALID_MODIFICATION_ERR:e="INVALID_MODIFICATION_ERR";break;case FileError.INVALID_STATE_ERR:e="INVALID_STATE_ERR";break;default:e="Unknown Error"}return e}var T,O,I={prepareBlobs:[],isWriting:!1,fs:null,appendPromise:new Promise(function(t){t()}),getFs:function(){return new Promise(function(t,e){window.requestFileSystem(window.PERSISTENT,52428800,function(e){t(e)},function(t){e(t)})})},save:function(t,e){var r=this;return this.getFs().then(function(n){return r.do_save(n,t,e)},k)},remove:function(t){this.getFs().then(function(e){e.root.getFile(t,{},function(t){t.remove(function(){})})})},writeBlob:(T=b().m(function t(){var e,r=this;return b().w(function(t){for(;;)switch(t.n){case 0:this.isWriting=!0,e=b().m(function t(){var e;return b().w(function(t){for(;;)switch(t.n){case 0:return e=r.prepareBlobs.shift(),t.n=1,new Promise(function(t,r){try{S.write(e),S.onwriteend=function(){t()}}catch(e){t()}});case 1:case 2:return t.a(2)}},t)});case 1:if(!(this.prepareBlobs.length>0&&S)){t.n=3;break}return t.d(y(e()),2);case 2:t.n=1;break;case 3:this.isWriting=!1;case 4:return t.a(2)}},t,this)}),O=function(){var t=this,e=arguments;return new Promise(function(r,n){var o=T.apply(t,e);function i(t){w(o,r,n,i,a,"next",t)}function a(t){w(o,r,n,i,a,"throw",t)}i(void 0)})},function(){return O.apply(this,arguments)}),append:function(t,e){var r=this,n=this;return new Promise(function(o){if(S)return n.prepareBlobs.push(t),n.isWriting||n.writeBlob(),void o();r.getFs().then(function(r){r.root.getFile(e,{create:!1},function(e){e.createWriter(function(e){e.onwriteend=function(t){},e.onerror=function(t){},n.isWriting=!1,S=e,n.prepareBlobs.push(t),n.isWriting||n.writeBlob(),o()},function(t){})},function(t){})})})},do_save:function(t,e,r){var n=this;return new Promise(function(o,i){t.root.getFile(r,{create:!0},function(t){t.createWriter(function(r){r.onwriteend=function(t){},r.onerror=function(t){i(t.toString())},n.isWriting=!1,n.prepareBlobs=[],n.prepareBlobs.push(e),S=r,n.isWriting||n.writeBlob(),o(t.toURL())},function(t){i(t)})},function(t){i(t)})})},getFile:function(t){var e=this;return new Promise(function(r,n){e.getFs().then(function(e){e.root.getFile(t,{},function(t){t.file(function(t){r(t)},n)},n)})})}};const j=I;var P=r(83550);function E(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return x(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(x(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,x(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,x(f,"constructor",s),x(s,"constructor",u),u.displayName="GeneratorFunction",x(s,o,"GeneratorFunction"),x(f),x(f,o,"Generator"),x(f,n,function(){return this}),x(f,"toString",function(){return"[object Generator]"}),(E=function(){return{w:i,m:d}})()}function x(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}x=function(t,e,r,n){function i(e,r){x(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},x(t,e,r,n)}function D(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function C(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){D(i,n,o,a,c,"next",t)}function c(t){D(i,n,o,a,c,"throw",t)}a(void 0)})}}function _(t,e){return chrome.tabs.move(t,{windowId:e,index:0})}function M(t){return chrome.tabs.update(t,{pinned:!0})}function R(t){return chrome.windows.update(t,{state:"minimized"})}function A(t,e,r){return F.apply(this,arguments)}function F(){return(F=C(E().m(function t(e,r,n){return E().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,_(e,r);case 1:return t.n=2,M(e);case 2:t.n=7;break;case 3:return t.p=3,t.v,t.p=4,t.n=5,R(r);case 5:t.n=7;break;case 6:t.p=6,t.v;case 7:return t.a(2)}},t,null,[[4,6],[0,3]])}))).apply(this,arguments)}function Z(t){}var N={db:null,log:function(){Array.prototype.slice.apply(arguments).unshift("[DB]: ")},init:function(){return new Promise(function(t,e){var r=indexedDB.open("AwesomeScreenshot",1);r.onupgradeneeded=function(t){var e=t.target.result;t.target.transaction.onerror=Z,e.objectStoreNames.contains("recordings")&&e.deleteObjectStore("recordings"),e.createObjectStore("recordings",{autoIncrement:!0}).createIndex("by_id","id",{unique:!0})},r.onsuccess=function(e){N.db=e.target.result,t(e.target.result)},r.onerror=function(t){e(t)}})},save:function(t){var e=this.db;return new Promise(function(r,n){var o=e.transaction(["recordings"],"readwrite").objectStore("recordings"),i=(new Date).getTime(),a=o.put({id:i,fileUrl:t.fileUrl,detail:{title:t.title,youtubeUrl:"",gDriveUrl:"",size:t.size,duration:t.duration,timeStamp:i,thumbnailUrl:"",recordType:t.recordType,codecs:t.codecs}});a.onsuccess=function(){r({id:i,fileUrl:t.fileUrl,detail:{title:t.title,youtubeUrl:"",gDriveUrl:"",size:t.size,duration:t.duration,timeStamp:i,thumbnailUrl:"",recordType:t.recordType,codecs:t.codecs}})},a.onerror=n})},get:function(t){var e=this.db;return new Promise(function(r,n){var o=e.transaction(["recordings"],"readwrite").objectStore("recordings").index("by_id").get(t);o.onsuccess=function(t){var e=t.target.result;r(e)},o.onerror=n})},getAll:function(){var t=this.db;return new Promise(function(e,r){var n=t.transaction(["recordings"],"readwrite").objectStore("recordings").getAll();n.onsuccess=function(t){var r=t.target.result;e(r)},n.onerror=r})},_getCursor:function(t){var e=this.db;return new Promise(function(r,n){var o=e.transaction(["recordings"],"readwrite").objectStore("recordings"),i=IDBKeyRange.only(t),a=o.index("by_id").openCursor(i);a.onsuccess=function(t){var e=t.target.result;e&&r(e)},a.onerror=n})},updateYoutubeUrl:function(t,e){var r=this;return new Promise(function(n,o){r._getCursor(t).then(function(t){t.value.detail.youtubeUrl=e;var r=t.update(t.value);r.onsuccess=n,r.onerror=o})})},update:function(t,e){var r=this.db;return new Promise(function(n,o){var i=r.transaction(["recordings"],"readwrite").objectStore("recordings"),a=IDBKeyRange.only(t),c=i.index("by_id").openCursor(a);c.onsuccess=function(t){var r=t.target.result;r&&(r.update(e).onsuccess=function(){n()})},c.onerror=o})},deleteAll:function(){var t=this.db;return new Promise(function(e,r){var n=t.transaction(["recordings"],"readwrite").objectStore("recordings").clear();n.onsuccess=function(t){var r=t.target.result;e(r)},n.onerror=r})},delete:function(t){var e=this.db;return new Promise(function(r,n){var o=e.transaction(["recordings"],"readwrite").objectStore("recordings"),i=IDBKeyRange.only(t),a=o.index("by_id").openCursor(i);a.onsuccess=function(t){var e=t.target.result;e&&(e.delete().onsuccess=function(){r()})},a.onerror=n})}};const G=N;var U=r(77029),B=r(99231);function L(t){return L="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},L(t)}function z(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return q(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(q(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,q(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,q(f,"constructor",s),q(s,"constructor",u),u.displayName="GeneratorFunction",q(s,o,"GeneratorFunction"),q(f),q(f,o,"Generator"),q(f,n,function(){return this}),q(f,"toString",function(){return"[object Generator]"}),(z=function(){return{w:i,m:d}})()}function q(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}q=function(t,e,r,n){function i(e,r){q(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},q(t,e,r,n)}function V(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,W(n.key),n)}}function W(t){var e=function(t,e){if("object"!=L(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=L(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==L(e)?e:e+""}var K=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.queue=[]},(e=[{key:"ready",value:function(){return(0,B.m)(this,void 0,void 0,z().m(function t(){return z().w(function(t){for(;;)if(0===t.n)return t.a(2,"")},t)}))}},{key:"start",value:function(){return{vid:"0",title:"Download"}}},{key:"pause",value:function(){}},{key:"resume",value:function(){}},{key:"send",value:function(){}},{key:"sendAll",value:function(){}},{key:"connect",value:function(){return(0,B.m)(this,void 0,void 0,z().m(function t(){return z().w(function(t){for(;;)if(0===t.n)return t.a(2,!0)},t)}))}},{key:"tryConnect",value:function(){return(0,B.m)(this,void 0,void 0,z().m(function t(){return z().w(function(t){for(;;)if(0===t.n)return t.a(2,!0)},t)}))}},{key:"disconnect",value:function(){}},{key:"isConnected",value:function(){return!0}},{key:"push",value:function(t){t instanceof Blob&&this.queue.push(t)}},{key:"stop",value:function(){return(0,B.m)(this,void 0,void 0,z().m(function t(){var e=this;return z().w(function(t){for(;;)switch(t.n){case 0:setTimeout(function(){var t=new Blob(e.queue,{type:"video/mp4"}),r=URL.createObjectURL(t),n=document.createElement("a");n.href=r,n.download="Record"+Date.now()+".mp4",n.click()},1e3);case 1:return t.a(2)}},t)}))}},{key:"cancel",value:function(){return(0,B.m)(this,void 0,void 0,z().m(function t(){return z().w(function(t){for(;;)switch(t.n){case 0:this.stop();case 1:return t.a(2)}},t,this)}))}},{key:"getData",value:function(){return{vid:"0",title:"Download"}}},{key:"getQueueProgress",value:function(){return{finished:this.queue.length,current:this.queue.length,total:this.queue.length}}},{key:"refreshProgress",value:function(){}}])&&V(t.prototype,e),r&&V(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}();function H(t){return H="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},H(t)}function J(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return Q(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(Q(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Q(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Q(f,"constructor",s),Q(s,"constructor",u),u.displayName="GeneratorFunction",Q(s,o,"GeneratorFunction"),Q(f),Q(f,o,"Generator"),Q(f,n,function(){return this}),Q(f,"toString",function(){return"[object Generator]"}),(J=function(){return{w:i,m:d}})()}function Q(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Q=function(t,e,r,n){function i(e,r){Q(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},Q(t,e,r,n)}function $(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Y(n.key),n)}}function Y(t){var e=function(t,e){if("object"!=H(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=H(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==H(e)?e:e+""}var X=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.DBName=(null==e?void 0:e.name)||"Storage_Index",this.DBVersion=(null==e?void 0:e.version)||1,this.objectStoreName=(null==e?void 0:e.indexStoreName)||"index",this.handleUpgrade=this.handleUpgrade.bind(this),this.initDB()},e=[{key:"initDB",value:function(){var t=this;if(this.db)return this.db;var e=indexedDB.open(this.DBName,this.DBVersion);return new Promise(function(r,n){e.onerror=function(t){n()},e.onupgradeneeded=t.handleUpgrade,e.onsuccess=function(){r(e.result)}}).then(function(e){t.db=e,e.onerror=console.error}).catch(console.error)}},{key:"getObjectStore",value:function(t){return(0,B.m)(this,void 0,void 0,J().m(function e(){var r,n;return J().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.initDB();case 1:return r=this.db.transaction([this.objectStoreName],t),n=r.objectStore(this.objectStoreName),e.a(2,n)}},e,this)}))}},{key:"handleUpgrade",value:function(t){t.target.result.createObjectStore(this.objectStoreName,{autoIncrement:!0})}},{key:"createIndex",value:function(t){return(0,B.m)(this,void 0,void 0,J().m(function e(){var r,n,o;return J().w(function(e){for(;;)switch(e.n){case 0:return r=Object.assign({},t),e.n=1,this.getObjectStore("readwrite");case 1:return n=e.v,o=n.add(r),e.a(2,new Promise(function(t,e){o.onsuccess=function(){var e=o.result;t(e)},o.onerror=function(t){e()}}))}},e,this)}))}},{key:"updateIndex",value:function(t,e){return(0,B.m)(this,void 0,void 0,J().m(function r(){var n,o;return J().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,this.getObjectStore("readwrite");case 1:n=r.v,o=n.get(t),new Promise(function(t,e){o.onsuccess=function(){t(o.result)},o.onerror=function(t){e()}}).then(function(r){var o=Object.assign(Object.assign({},r),e),i=n.put(o,t);return new Promise(function(t,e){i.onsuccess=t,i.onerror=function(t){e()}})});case 2:return r.a(2)}},r,this)}))}},{key:"removeIndex",value:function(t){return(0,B.m)(this,void 0,void 0,J().m(function e(){var r,n;return J().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.getObjectStore("readwrite");case 1:return r=e.v,n=r.delete(t),e.a(2,new Promise(function(t,e){n.onsuccess=t,n.onerror=function(t){e()}}))}},e,this)}))}},{key:"getIndex",value:function(t){return(0,B.m)(this,void 0,void 0,J().m(function e(){var r,n,o;return J().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.getObjectStore("readonly");case 1:if(r=e.v,!isFinite(t)){e.n=2;break}return n=r.get(t),e.a(2,new Promise(function(t,e){n.onsuccess=function(){t(n.result)},n.onerror=function(t){e()}}));case 2:return o=r.getAll(),e.a(2,new Promise(function(t,e){o.onsuccess=function(){t(o.result)},o.onerror=function(t){e()}}))}},e,this)}))}},{key:"digest",value:function(t){return(0,B.m)(this,void 0,void 0,J().m(function e(){var r,n,o,i,a;return J().w(function(e){for(;;)switch(e.n){case 0:if(!window){e.n=3;break}return r=document.createElement("video"),n=document.createElement("canvas"),o=n.getContext("2d"),r.muted=!0,r.src=URL.createObjectURL(t),e.n=1,r.play();case 1:if(!isNaN(r.duration)){e.n=2;break}return e.a(2,!1);case 2:return r.currentTime=Math.min(r.duration/2,1),n.width=Math.min(r.videoWidth,420),n.height=Math.min(r.videoHeight,420*r.videoHeight/r.videoWidth),o.drawImage(r,0,0,n.width,n.height),i=n.toDataURL(),a={thumbnail:i,resolution:r.videoWidth+"*"+r.videoHeight,size:t.size,duration:1e3*r.duration},URL.revokeObjectURL(r.src),r.src="",e.a(2,a);case 3:return e.a(2,!1)}},e)}))}}],e&&$(t.prototype,e),r&&$(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}();function tt(t){return tt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},tt(t)}function et(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}throw new TypeError(tt(t)+" is not iterable")}function rt(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return nt(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(nt(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,nt(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,nt(f,"constructor",s),nt(s,"constructor",u),u.displayName="GeneratorFunction",nt(s,o,"GeneratorFunction"),nt(f),nt(f,o,"Generator"),nt(f,n,function(){return this}),nt(f,"toString",function(){return"[object Generator]"}),(rt=function(){return{w:i,m:d}})()}function nt(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}nt=function(t,e,r,n){function i(e,r){nt(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},nt(t,e,r,n)}function ot(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,it(n.key),n)}}function it(t){var e=function(t,e){if("object"!=tt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=tt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==tt(e)?e:e+""}function at(t,e,r){return e=ut(e),function(t,e){if(e&&("object"==tt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,ct()?Reflect.construct(e,r||[],ut(t).constructor):e.apply(t,r))}function ct(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(ct=function(){return!!t})()}function ut(t){return ut=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},ut(t)}function st(t,e){return st=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},st(t,e)}var lt=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=at(this,e)).queue=[],r.isPushDone=!1,r.dirName=(null==t?void 0:t.videosDirName)||"videos",r.autoGenerateThumbnail=!1!==(null==t?void 0:t.autoGenerateThumbnail),r.DEBUG_sliceId=0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&st(t,e)}(e,t),r=e,(n=[{key:"initFS",value:function(){return(0,B.m)(this,void 0,void 0,rt().m(function t(){var e,r;return rt().w(function(t){for(;;)switch(t.n){case 0:if(!this.fs){t.n=1;break}return t.a(2);case 1:return e=window.requestFileSystem||window.webkitRequestFileSystem,t.n=2,new Promise(function(t,r){e(window.PERSISTENT,52428800,function(e){t(e)},function(t){r()})});case 2:r=t.v,this.fs=r;case 3:return t.a(2)}},t,this)}))}},{key:"ready",value:function(t){return(0,B.m)(this,void 0,void 0,rt().m(function e(){var r,n,o,i,a=this;return rt().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.initFS();case 1:return e.n=2,this.createIndex({createAt:Date.now(),title:t.title,status:"ready",statusTimestamp:Date.now()});case 2:return r=e.v,this.indexKey=r,e.n=3,new Promise(function(t,e){a.fs.root.getDirectory(a.dirName,{create:!0},function(e){t(e)},function(t){e(t)})});case 3:return n=e.v,e.n=4,new Promise(function(t,e){n.getFile(""+a.indexKey,{create:!0},function(e){t(e)},function(t){e(t)})});case 4:return o=e.v,this.fileEntry=o,e.n=5,new Promise(function(t,e){o.createWriter(function(e){t(e)},function(t){e()})});case 5:return i=e.v,this.fileWriter=i,this.queue=[],this.isPushDone=!1,e.a(2,r+"")}},e,this)}))}},{key:"push",value:function(t){return(0,B.m)(this,void 0,void 0,rt().m(function e(){return rt().w(function(e){for(;;)switch(e.n){case 0:if("string"!=typeof t){e.n=1;break}return e.a(2,void 0);case 1:this.queue.push(t),this.isWriting||this.write();case 2:return e.a(2)}},e,this)}))}},{key:"write",value:function(){return(0,B.m)(this,void 0,void 0,rt().m(function t(){var e,r=this;return rt().w(function(t){for(;;)switch(t.n){case 0:this.isWriting=!0,e=rt().m(function t(){var e;return rt().w(function(t){for(;;)switch(t.n){case 0:return e=r.queue.shift(),r.DEBUG_sliceId++,r.writerPromise=new Promise(function(t,n){r.fileWriter.write(e),r.fileWriter.onerror=function(t){n()},r.fileWriter.onwriteend=function(){t()}}),t.n=1,r.writerPromise;case 1:return t.a(2)}},t)});case 1:if(!(this.queue.length>0)){t.n=3;break}return t.d(et(e()),2);case 2:t.n=1;break;case 3:this.isWriting=!1,this.isPushDone&&this.handleSuccess();case 4:return t.a(2)}},t,this)}))}},{key:"start",value:function(t){return this.updateIndex(this.indexKey,{key:this.indexKey,mimeType:t||"",status:"started",statusTimestamp:Date.now(),isFS:!0,fullPath:"/"+this.dirName+"/"+this.indexKey}),{vid:""+this.indexKey,title:""}}},{key:"pause",value:function(){this.updateIndex(this.indexKey,{status:"paused",statusTimestamp:Date.now()})}},{key:"resume",value:function(){this.updateIndex(this.indexKey,{status:"resumed",statusTimestamp:Date.now()})}},{key:"stop",value:function(t){var e=t.duration,r=t.size;return(0,B.m)(this,void 0,void 0,rt().m(function t(){var n=this;return rt().w(function(t){for(;;)switch(t.n){case 0:return this.isPushDone=!0,t.n=1,this.updateIndex(this.indexKey,{duration:e||0,size:r||0});case 1:return t.a(2,new Promise(function(t){n.stopPromiseResolve=t}))}},t,this)}))}},{key:"cancel",value:function(){return(0,B.m)(this,void 0,void 0,rt().m(function t(){var e=this;return rt().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t,r){if(!e.fileEntry)return t();e.fileEntry.remove(function(){t()},function(t){r()})}).then(function(){return e.removeIndex(e.indexKey)}).then(function(){e.clear()}))},t)}))}},{key:"regenerateThumbnail",value:function(){}},{key:"handleSuccess",value:function(){var t=this;this.updateIndex(this.indexKey,{status:"stopped",statusTimestamp:Date.now()}).then(function(){if(t.autoGenerateThumbnail)return t.generateThumbnail()}).then(function(e){if(e)return t.updateIndex(t.indexKey,e)}).then(function(){t.clear()}).then(function(){t.stopPromiseResolve&&t.stopPromiseResolve()})}},{key:"generateThumbnail",value:function(){return(0,B.m)(this,void 0,void 0,rt().m(function t(){var e,r=this;return rt().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,new Promise(function(t,e){r.fileEntry.file(function(e){t(e)},function(t){e()})});case 1:return e=t.v,t.a(2,this.digest(e))}},t,this)}))}},{key:"clear",value:function(){this.fileWriter=null,this.fileEntry=null}}])&&ot(r.prototype,n),o&&ot(r,o),Object.defineProperty(r,"prototype",{writable:!1}),r;var r,n,o}(X);function ft(t){return ft="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},ft(t)}function dt(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return pt(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(pt(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,pt(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,pt(f,"constructor",s),pt(s,"constructor",u),u.displayName="GeneratorFunction",pt(s,o,"GeneratorFunction"),pt(f),pt(f,o,"Generator"),pt(f,n,function(){return this}),pt(f,"toString",function(){return"[object Generator]"}),(dt=function(){return{w:i,m:d}})()}function pt(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}pt=function(t,e,r,n){function i(e,r){pt(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},pt(t,e,r,n)}function ht(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,vt(n.key),n)}}function vt(t){var e=function(t,e){if("object"!=ft(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=ft(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==ft(e)?e:e+""}var mt,yt,bt=function(){return t=function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t)},(e=[{key:"ready",value:function(){return(0,B.m)(this,void 0,void 0,dt().m(function t(){return dt().w(function(t){for(;;)if(0===t.n)return this.id="pipe-"+Date.now(),t.a(2,this.id)},t,this)}))}},{key:"start",value:function(){return{vid:this.id,title:""}}},{key:"pause",value:function(){}},{key:"resume",value:function(){}},{key:"push",value:function(t){this.count+=1}},{key:"stop",value:function(){return(0,B.m)(this,void 0,void 0,dt().m(function t(){return dt().w(function(t){for(;;)switch(t.n){case 0:this.onSuccess&&this.onSuccess(this.id,{vid:this.id,title:""});case 1:return t.a(2)}},t,this)}))}},{key:"cancel",value:function(){return(0,B.m)(this,void 0,void 0,dt().m(function t(){return dt().w(function(t){for(;;)if(0===t.n)return t.a(2)},t)}))}},{key:"getQueueProgress",value:function(){return{finished:this.count,current:this.count,total:this.count}}}])&&ht(t.prototype,e),r&&ht(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r}();!function(t){t.desktop="desktop",t.tab="tab",t.camera="camera"}(mt||(mt={})),function(t){t[t.notReady=0]="notReady",t[t.ready=1]="ready",t[t.waitingAuthorized=2]="waitingAuthorized",t[t.recording=3]="recording",t[t.paused=4]="paused",t[t.connecting=5]="connecting",t[t.countdown=6]="countdown",t[t.uploading=7]="uploading"}(yt||(yt={}));var gt,wt,St,kt,Tt;function Ot(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return It(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?It(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function It(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function jt(t,e){var r=Ot(t,2),n=r[0],o=r[1],i=Ot(e,2),a=i[0],c=i[1];if(n<=a&&o<=c)return[n,o];var u=Math.min(a/n,c/o);return[Math.ceil(u*n),Math.ceil(u*o)]}function Pt(t){return function(t){if(Array.isArray(t))return Et(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return Et(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Et(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Et(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function xt(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return Dt(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(Dt(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Dt(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Dt(f,"constructor",s),Dt(s,"constructor",u),u.displayName="GeneratorFunction",Dt(s,o,"GeneratorFunction"),Dt(f),Dt(f,o,"Generator"),Dt(f,n,function(){return this}),Dt(f,"toString",function(){return"[object Generator]"}),(xt=function(){return{w:i,m:d}})()}function Dt(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Dt=function(t,e,r,n){function i(e,r){Dt(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},Dt(t,e,r,n)}function Ct(t,e,r){return e=Rt(e),function(t,e){if(e&&("object"==Zt(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,_t()?Reflect.construct(e,r||[],Rt(t).constructor):e.apply(t,r))}function _t(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(_t=function(){return!!t})()}function Mt(){return Mt="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Rt(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},Mt.apply(null,arguments)}function Rt(t){return Rt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Rt(t)}function At(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ft(t,e)}function Ft(t,e){return Ft=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ft(t,e)}function Zt(t){return Zt="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Zt(t)}function Nt(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Gt(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Bt(n.key),n)}}function Ut(t,e,r){return e&&Gt(t.prototype,e),r&&Gt(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Bt(t){var e=function(t,e){if("object"!=Zt(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Zt(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Zt(e)?e:e+""}!function(t){t[t.null=0]="null",t[t.ready=1]="ready",t[t.start=2]="start",t[t.pause=3]="pause",t[t.resume=4]="resume",t[t.stop=5]="stop",t[t.cancel=6]="cancel",t[t.abort_cancel=7]="abort_cancel",t[t.abort_stop=8]="abort_stop",t[t.abort=9]="abort",t[t.processing_success=10]="processing_success",t[t.processing_error=11]="processing_error"}(gt||(gt={})),function(t){t[t.unready=0]="unready",t[t.unauthorized=1]="unauthorized",t[t.forbidden=2]="forbidden",t[t.authorized=3]="authorized",t[t.failed=4]="failed"}(wt||(wt={})),function(t){t.smartKeyToggleTime="smart_key_toggle_time",t.focusingWindowIdList="focusing_window_id_list"}(St||(St={}));var Lt,zt=function(){return Ut(function t(e){Nt(this,t),this.inputStream=e.stream,this.crop=e.crop},[{key:"stop",value:function(){this.outputStream&&(this.outputStream.getTracks().forEach(function(t){return t.stop()}),this.outputStream=null),this.inputStream&&(this.inputStream.getTracks().forEach(function(t){return t.stop()}),this.inputStream=null)}}])}(),qt=function(t){function e(t){var r;return Nt(this,e),(r=Ct(this,e,[t])).setTimeout=t.setTimeout||window.setTimeout,r.clearTimeout=t.clearTimeout||window.clearTimeout,r.setTimeout=r.setTimeout.bind(null),r.clearTimeout=r.clearTimeout.bind(null),r.timeout=isFinite(t.timeout)?t.timeout:34,r}return At(e,t),Ut(e,[{key:"absCrop",value:function(t){return(0,B.m)(this,void 0,void 0,xt().m(function e(){var r,n,o;return xt().w(function(e){for(;;)switch(e.n){case 0:if(!this.imageCapture){e.n=2;break}return e.n=1,this.imageCapture.grabFrame();case 1:return r=e.v,n=r.width,o=r.height,e.a(2,Jt(t,{width:n,height:o}));case 2:return e.a(2,Jt(t))}},e,this)}))}},{key:"prepare",value:function(){return(0,B.m)(this,void 0,void 0,xt().m(function t(){var e,r,n,o,i=this;return xt().w(function(t){for(;;)switch(t.n){case 0:if(!this.inputStream){t.n=2;break}return e=this.inputStream.getVideoTracks()[0],this.imageCapture=new ImageCapture(e),e.addEventListener("ended",function(){return i.stop()}),this.canvas=document.createElement("canvas"),t.n=1,this.absCrop(this.crop);case 1:return r=t.v,this.canvas.width=r.w,this.canvas.height=r.h,Qt(r.w,r.h)&&(this.canvas.height=Math.round(9*r.w/16)),this.ctx=this.canvas.getContext("2d"),this.canvasStream=this.canvas.captureStream(),n=this.inputStream.getAudioTracks(),o=this.canvasStream.getVideoTracks(),this.outputStream=new MediaStream([].concat(Pt(o),Pt(n))),this.outputStream.getVideoTracks().forEach(function(t){return t.addEventListener("ended",function(){return i.stop()})}),t.a(2);case 2:return t.a(2)}},t,this)}))}},{key:"render",value:function(){return(0,B.m)(this,void 0,void 0,xt().m(function t(){var e,r,n,o,i,a,c,u,s=this;return xt().w(function(t){for(;;)switch(t.n){case 0:return e=this.ctx,r=this.imageCapture,t.n=1,this.absCrop(this.crop);case 1:n=t.v,o=n.x,i=n.y,a=n.w,c=n.h,u=function(){r.grabFrame().then(function(t){e.drawImage(t,o,i,a,c,0,Math.round((s.canvas.height-c)/2),a,c)}).catch(function(t){}),s.timeoutId=s.setTimeout(u,s.timeout)},this.clearTimeout(this.timeoutId),u();case 2:return t.a(2)}},t,this)}))}},{key:"stop",value:function(){var t,r,n,o,i;(t=e,r="stop",n=this,i=Mt(Rt(1&(o=3)?t.prototype:t),r,n),2&o&&"function"==typeof i?function(t){return i.apply(n,t)}:i)([]),clearTimeout(this.timeoutId),this.canvas=null,this.imageCapture=null,this.ctx=null}},{key:"cropStream",value:function(t){return(0,B.m)(this,void 0,void 0,xt().m(function e(){return xt().w(function(e){for(;;)switch(e.n){case 0:return t&&(this.crop=t),e.n=1,this.prepare();case 1:this.render();case 2:return e.a(2)}},e,this)}))}}])}(zt),Vt="undefined"!=typeof MediaStreamTrackProcessor&&"undefined"!=typeof MediaStreamTrackGenerator,Wt=!(null===(Tt=null===(kt=null===globalThis||void 0===globalThis?void 0:globalThis.location)||void 0===kt?void 0:kt.href)||void 0===Tt?void 0:Tt.match(/^https?:\/\//)),Kt=Vt&&Wt;Kt&&(Lt=new Worker("crop.worker.js"));var Ht=function(t){function e(t){return Nt(this,e),Ct(this,e,[t])}return At(e,t),Ut(e,[{key:"cropStream",value:function(t){return(0,B.m)(this,void 0,void 0,xt().m(function e(){var r,n,o,i,a,c,u,s,l,f,d,p=this;return xt().w(function(e){for(;;)switch(e.n){case 0:if(t&&(this.crop=t),!this.inputStream){e.n=2;break}return r=this.inputStream.getVideoTracks()[0],n=new MediaStreamTrackProcessor({track:r}),o=new MediaStreamTrackGenerator({kind:"video"}),i=Jt(this.crop),a=i.x,c=i.y,u=i.w,s=i.h,l=n.readable,f=o.writable,Lt.postMessage({action:"crop",readable:l,writable:f,visibleRect:{x:a,y:c,width:u,height:s}},[l,f]),e.n=1,new Promise(function(t){Lt.onmessage=function(e){"crop-worker"===e.data.action&&t(e.data)}});case 1:r.addEventListener("ended",function(){return p.stop()}),d=this.inputStream.getAudioTracks(),this.outputStream=new MediaStream([o].concat(Pt(d))),this.outputStream.getVideoTracks().forEach(function(t){return t.addEventListener("ended",function(){return p.stop()})});case 2:return e.a(2)}},e,this)}))}}])}(zt);function Jt(t,e){var r=t.x,n=t.y,o=t.w,i=t.h,a=t.ww,c=t.wh;return e&&(a=e.width,c=e.height),r<1&&n<1&&o<=1&&i<=1&&(r=Math.round(r*a),n=Math.round(n*c),o=Math.round(o*a),i=Math.round(i*c)),{x:r=1&r?r+1:r,y:n=1&n?n+1:n,w:o=1&o?o-3:o-2,h:i=1&i?i-3:i-2,ww:a,wh:c}}function Qt(t,e){return t>475&&e<120}var $t=function(){return Ut(function t(e){Nt(this,t);var r=Jt(e.crop);Qt(r.w,r.h)?this.cropInstance=new qt(e):this.cropInstance=new t.CropClass(e)},[{key:"output",get:function(){return this.cropInstance.outputStream}},{key:"cropStream",value:function(t){return(0,B.m)(this,void 0,void 0,xt().m(function e(){return xt().w(function(e){for(;;)if(0===e.n)return e.a(2,this.cropInstance.cropStream(t))},e,this)}))}},{key:"stop",value:function(){this.cropInstance.stop()}}])}();function Yt(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return Xt(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Xt(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xt(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function te(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return ee(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(ee(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,ee(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,ee(f,"constructor",s),ee(s,"constructor",u),u.displayName="GeneratorFunction",ee(s,o,"GeneratorFunction"),ee(f),ee(f,o,"Generator"),ee(f,n,function(){return this}),ee(f,"toString",function(){return"[object Generator]"}),(te=function(){return{w:i,m:d}})()}function ee(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}ee=function(t,e,r,n){function i(e,r){ee(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},ee(t,e,r,n)}function re(t){return re="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},re(t)}function ne(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,oe(n.key),n)}}function oe(t){var e=function(t,e){if("object"!=re(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=re(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==re(e)?e:e+""}$t.CropClass=Kt?Ht:qt;var ie,ae=function(){function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.switchMic=this.switchMic.bind(this),this.setTimeout=(null==e?void 0:e.setTimeout)||window.setTimeout,this.clearTimeout=(null==e?void 0:e.clearTimeout)||window.clearTimeout,this.setTimeout=this.setTimeout.bind(null),this.clearTimeout=this.clearTimeout.bind(null),this.isRecordingAudio=!1,this.getAudioFailed=!1}return e=t,r=[{key:"captureDesktop",value:function(e){var r,n;return(0,B.m)(this,void 0,void 0,te().m(function o(){var i,a,c,u,s,l,f,d,p,h,v=this;return te().w(function(o){for(;;)switch(o.n){case 0:if(this.desktopCaptureOptions=e,a=(i=e||{}).timeout,c=i.sources,u=i.constraints,s=i.audio,l=i.video,f=e.streamId){o.n=2;break}return o.n=1,new Promise(function(t,e){v.desktopStreamIdResolve=t,v.desktopMediaRequestId=chrome.desktopCapture.chooseDesktopMedia(c||["screen","window","tab","audio"],t),a>0&&v.setTimeout(function(){chrome.desktopCapture.cancelChooseDesktopMedia(v.desktopMediaRequestId),v.desktopMediaRequestId=-1,e()},a)});case 1:f=o.v;case 2:if(f){o.n=3;break}throw new DOMException("Invalid state","NotAllowedError");case 3:return d=!1!==s&&Object.assign(Object.assign({},"object"==re(null==u?void 0:u.audio)?u.audio:{}),{mandatory:Object.assign(Object.assign({},"object"==re(null==u?void 0:u.audio)?null===(r=u.audio)||void 0===r?void 0:r.mandatory:{}),{chromeMediaSource:"desktop",chromeMediaSourceId:f})}),p=!1!==l&&Object.assign(Object.assign({},"object"==re(null==u?void 0:u.video)?u.video:{}),{mandatory:Object.assign(Object.assign({},"object"==re(null==u?void 0:u.video)?null===(n=u.video)||void 0===n?void 0:n.mandatory:{}),{chromeMediaSource:"desktop",chromeMediaSourceId:f})}),h=Object.assign(Object.assign({},u),{audio:d,video:p}),t.stopStream(this._stream),o.n=4,navigator.mediaDevices.getUserMedia(h);case 4:return this._stream=o.v,this.desktopMediaRequestId=-1,o.a(2,this._stream)}},o,this)}))}},{key:"reopenDesktopMediaPicker",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;return(0,B.m)(this,void 0,void 0,te().m(function e(){var r,n,o,i=this;return te().w(function(e){for(;;)switch(e.n){case 0:return this.desktopMediaRequestId&&chrome.desktopCapture.cancelChooseDesktopMedia(this.desktopMediaRequestId),r=this.desktopCaptureOptions||{},n=r.sources,o=this,e.n=1,new Promise(function(e,r){i.desktopMediaRequestId=chrome.desktopCapture.chooseDesktopMedia(n||["screen","window","tab","audio"],function(t){e(t),"function"==typeof o.desktopStreamIdResolve&&o.desktopStreamIdResolve(t)}),t>0&&i.setTimeout(function(){chrome.desktopCapture.cancelChooseDesktopMedia(i.desktopMediaRequestId),i.desktopMediaRequestId=-1,r()})});case 1:return e.a(2)}},e,this)}))}},{key:"captureTabMedia",value:function(t){var e,r,n;return(0,B.m)(this,void 0,void 0,te().m(function o(){var i,a,c,u,s,l,f,d,p,h,v,m,y,b,g,w,S;return te().w(function(o){for(;;)switch(o.n){case 0:if(this.stopCapture(),a=(i=t||{}).tabId,c=i.captureOptions,u=i.noAudioPatch,s=i.dimension,l={width:1920,height:1080},!(a&&(null===chrome||void 0===chrome?void 0:chrome.tabs)&&s)){o.n=2;break}return f=null===window||void 0===window?void 0:window.devicePixelRatio,d=isFinite(f)?f:1,o.n=1,new Promise(function(t){chrome.tabs.get(a,function(e){return t(e)})});case 1:p=o.v,l={width:(null!==(e=null==p?void 0:p.width)&&void 0!==e?e:1920)*d,height:(null!==(r=null==p?void 0:p.height)&&void 0!==r?r:1080)*d};case 2:return v=(h=s||{maxWidth:1920,maxHeight:1080}).maxWidth,m=h.maxHeight,y=jt([l.width,l.height],[v,m]),b=Yt(y,2),g=b[0],w=b[1],S=Object.assign(Object.assign({audio:!0,video:!0},c),{videoConstraints:Object.assign(Object.assign({},null==c?void 0:c.videoConstraints),{mandatory:Object.assign(Object.assign(Object.assign({},null===(n=null==c?void 0:c.videoConstraints)||void 0===n?void 0:n.mandatory),{chromeMediaSource:"tab"}),s?{maxWidth:g,maxHeight:w}:{})})}),o.n=3,new Promise(function(t){chrome.tabCapture.capture(S,function(e){t(e)})});case 3:return this._stream=o.v,!0!==u&&this.patchTabCapture(),o.a(2,this._stream)}},o,this)}))}},{key:"captureTab",value:function(t){var e,r;return(0,B.m)(this,void 0,void 0,te().m(function n(){var o,i,a,c,u,s,l,f,d,p,h,v;return te().w(function(n){for(;;)switch(n.n){case 0:if(i=(o=t||{}).targetTabId,a=o.consumerTabId,c=o.captureOptions,u=o.noAudioPatch,s=t.streamId){n.n=2;break}return n.n=1,new Promise(function(t){chrome.tabCapture.getMediaStreamId({targetTabId:i,consumerTabId:a},function(e){t(e)})});case 1:s=n.v;case 2:return f=(l=c||{}).audio,d=l.video,p=Object.assign(Object.assign({},null==c?void 0:c.audioConstraints),{mandatory:Object.assign(Object.assign({},null===(e=null==c?void 0:c.audioConstraints)||void 0===e?void 0:e.mandatory),{chromeMediaSource:"tab",chromeMediaSourceId:s})}),h=Object.assign(Object.assign({},null==c?void 0:c.videoConstraints),{mandatory:Object.assign(Object.assign({},null===(r=null==c?void 0:c.videoConstraints)||void 0===r?void 0:r.mandatory),{chromeMediaSource:"tab",chromeMediaSourceId:s})}),v={audio:0!=f&&p,video:0!=d&&h},n.n=3,window.navigator.mediaDevices.getUserMedia(v);case 3:return this._stream=n.v,!0!==u&&this.patchTabCapture(),n.a(2,this._stream)}},n,this)}))}},{key:"patchTabCapture",value:function(){var t;if((null===(t=this._stream.getAudioTracks())||void 0===t?void 0:t.length)>0){var e=new AudioContext;e.createMediaStreamSource(this._stream).connect(e.destination),this._stream.getAudioTracks().forEach(function(t){t.addEventListener("ended",function(){"closed"!==e.state&&e.close()})})}}},{key:"getDisplayMedia",value:function(t){return(0,B.m)(this,void 0,void 0,te().m(function e(){return te().w(function(e){for(;;)switch(e.n){case 0:return this.stopCapture(),t=Object.assign(Object.assign({audio:!0},t),{video:Object.assign({displaySurface:"monitor"},null==t?void 0:t.video)}),e.n=1,window.navigator.mediaDevices.getDisplayMedia(t);case 1:return this._stream=e.v,e.a(2,this._stream)}},e,this)}))}},{key:"getUserMedia",value:function(t){return(0,B.m)(this,void 0,void 0,te().m(function e(){return te().w(function(e){for(;;)switch(e.n){case 0:return this.stopCapture(),t=Object.assign({audio:!0,video:!0},t),e.n=1,navigator.mediaDevices.getUserMedia(t);case 1:return this._stream=e.v,e.a(2,this._stream)}},e,this)}))}},{key:"stream",get:function(){return this._stream},set:function(t){this._stream=t}},{key:"prepareAudioContext",value:function(){var t=this;if(!this.audioContext&&this._stream){this.audioContext=new AudioContext,this.audioDestination=this.audioContext.createMediaStreamDestination(),(this._stream.getAudioTracks().length>0?this.audioContext.createMediaStreamSource(this._stream):this.audioContext.createMediaElementSource(document.createElement("audio"))).connect(this.audioDestination);var e=this.audioDestination.stream.getAudioTracks()[0];this._stream.addTrack(e),this._stream.getAudioTracks().forEach(function(r){r!==e&&(t._stream.removeTrack(r),t._stream.addTrack(r))}),navigator.mediaDevices.ondevicechange=function(e){navigator.mediaDevices.enumerateDevices().then(function(e){var r=!1;e.forEach(function(t){"audioinput"===t.kind&&(r=!0)}),r&&t.isRecordingAudio&&t.getAudioFailed&&t.switchMic()})}}}},{key:"turnOnMic",value:function(e){return(0,B.m)(this,void 0,void 0,te().m(function r(){var n;return te().w(function(r){for(;;)switch(r.p=r.n){case 0:return t.stopStream(this.micStream),r.p=1,r.n=2,window.navigator.mediaDevices.getUserMedia({audio:!e||{deviceId:e},video:!1});case 2:this.micStream=r.v,r.n=4;break;case 3:return r.p=3,r.v,this.getAudioFailed=!0,r.a(2,!1);case 4:return this.getAudioFailed=!1,this.isRecordingAudio=!0,this.turnOffMicTime=0,(n=this.micStream.getAudioTracks()[0])&&(n.onended=this.switchMic),this.prepareAudioContext(),this.micAudioSource=this.audioContext.createMediaStreamSource(this.micStream),this.micAudioSource.connect(this.audioDestination),r.a(2,!0)}},r,this,[[1,3]])}))}},{key:"turnOffMic",value:function(){return(0,B.m)(this,void 0,void 0,te().m(function e(){return te().w(function(e){for(;;)switch(e.n){case 0:this.turnOffMicTime=Date.now(),this.isRecordingAudio=!1,this.micAudioSource&&(t.stopStream(this.micStream),this.micAudioSource=null,this.micStream=null);case 1:return e.a(2)}},e,this)}))}},{key:"switchMic",value:function(){Date.now()-this.turnOffMicTime>200&&(this._stream.removeTrack(this.micStream.getAudioTracks()[0]),this.turnOnMic())}},{key:"cropVideoTrack",value:function(t){return(0,B.m)(this,void 0,void 0,te().m(function e(){return te().w(function(e){for(;;)switch(e.n){case 0:if(!this._stream||!this.cropStream){e.n=1;break}return e.a(2,this.cropStream.cropStream(t));case 1:if(!this._stream){e.n=3;break}return this.cropStream=new $t({stream:this._stream,crop:t,setTimeout:this.setTimeout,clearTimeout:this.clearTimeout}),e.n=2,this.cropStream.cropStream();case 2:this._stream=this.cropStream.output;case 3:return e.a(2)}},e,this)}))}},{key:"stopCapture",value:function(){this._stream&&t.stopStream(this._stream),this.desktopMediaRequestId>0&&chrome.desktopCapture.cancelChooseDesktopMedia(this.desktopMediaRequestId),this.micStream&&(this.turnOffMicTime=Date.now(),t.stopStream(this.micStream)),this.micAudioSource&&(this.micAudioSource=null),this.audioContext&&("closed"!==this.audioContext.state&&this.audioContext.close(),this.audioContext=null,this.audioDestination=null),this.cropStream&&(this.cropStream.stop(),this.cropStream=null)}}],n=[{key:"isCaptureDesktopSupported",value:function(){return!!(window.chrome&&window.chrome.desktopCapture&&window.chrome.desktopCapture.chooseDesktopMedia)}},{key:"stopStream",value:function(t){t&&t.getTracks&&t.getTracks().forEach(function(t){return t.stop()})}}],r&&ne(e.prototype,r),n&&ne(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e;var e,r,n}();function ce(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return ue(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(ue(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,ue(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,ue(f,"constructor",s),ue(s,"constructor",u),u.displayName="GeneratorFunction",ue(s,o,"GeneratorFunction"),ue(f),ue(f,o,"Generator"),ue(f,n,function(){return this}),ue(f,"toString",function(){return"[object Generator]"}),(ce=function(){return{w:i,m:d}})()}function ue(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}ue=function(t,e,r,n){function i(e,r){ue(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},ue(t,e,r,n)}!function(t){t[t.touch=0]="touch",t[t.syncRecordingStatus=1]="syncRecordingStatus",t[t.requestRecordingStatus=2]="requestRecordingStatus",t[t.readyRecording=3]="readyRecording",t[t.startRecording=4]="startRecording",t[t.pauseRecording=5]="pauseRecording",t[t.resumeRecording=6]="resumeRecording",t[t.stopRecording=7]="stopRecording",t[t.cancelRecording=8]="cancelRecording",t[t.showCamera=9]="showCamera",t[t.showCameraPictureInPicture=10]="showCameraPictureInPicture",t[t.tabShowCamera=11]="tabShowCamera",t[t.tabCloseCamera=12]="tabCloseCamera",t[t.syncCameraStatus=13]="syncCameraStatus",t[t.showModalRecorder=14]="showModalRecorder",t[t.closeModalRecorder=15]="closeModalRecorder",t[t.requestSetting=16]="requestSetting",t[t.syncSetting=17]="syncSetting",t[t.requestReadyRecording=18]="requestReadyRecording",t[t.syncAuthorizationStatus=19]="syncAuthorizationStatus",t[t.windowsFocusChanged=20]="windowsFocusChanged",t[t.requestWindowsFocusingList=21]="requestWindowsFocusingList",t[t.reopenDesktopMediaPicker=22]="reopenDesktopMediaPicker",t[t.removeTask=23]="removeTask",t[t.reportActivity=24]="reportActivity",t[t.turnMicTo=25]="turnMicTo",t[t.turnCameraTo=26]="turnCameraTo",t[t.recordEvent=27]="recordEvent",t[t.TEST_delay=28]="TEST_delay"}(ie||(ie={}));var se=function(t){return"function"==typeof t},le=function(t){return"boolean"==typeof t},fe=function(t){return t instanceof Blob},de=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:window.setTimeout;return new Promise(function(r){e(function(){r()},t)})};var pe=function(){var t=this,e=function(r,n){var o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return(0,B.m)(t,void 0,void 0,ce().m(function t(){var i,a,c,u,s,l,f,d,p,h,v,m=this;return ce().w(function(t){for(;;)switch(t.n){case 0:if(i=o.retry,a=void 0!==i&&i,c=o.timeout,u=void 0===c?0:c,n=n||{},s=e.beforeRequest(r,n),r=s.info,n=s.init,u>0&&(f=new AbortController,n.signal=f.signal,l=setTimeout(function(){f.abort()},u)),a){t.n=2;break}return t.n=1,fetch(r,n);case 1:p=t.v,l&&clearTimeout(l),d=e.beforeResponse(p),t.n=3;break;case 2:return h=void 0,v=void 0,le(a)||(h=a.wait,v=a.times),t.n=3,ve(function(t){return(0,B.m)(m,void 0,void 0,ce().m(function o(){var i,a;return ce().w(function(o){for(;;)switch(o.p=o.n){case 0:return o.p=0,l&&clearTimeout(l),o.n=1,fetch(r,n);case 1:i=o.v,d=e.beforeResponse(i),o.n=4;break;case 2:if(o.p=2,a=o.v,l&&clearTimeout(l),0!==t){o.n=3;break}throw a;case 3:return o.a(2,!1);case 4:return o.a(2,!0)}},o,null,[[0,2]])}))},h,v);case 3:return t.a(2,d)}},t)}))};e.beforeRequest=function(t,e){return{info:t,init:e}},e.beforeResponse=function(t){if(!t.ok)throw new Error("Network response was not OK");return t.json()},e.meta={token:""};var r=function(t){return function(r,n,o){return(n=n||{}).method=t.toUpperCase(),e(r,n,o)}};return e.get=r("get"),e.post=r("post"),e.put=r("put"),e.delete=r("delete"),e.update=r("update"),e}();function he(t,e,r){var n=t[e];Object.defineProperty(t,e,{get:function(){return n},set:function(t){var e=n;n=t,e!==t&&r(t,e)}})}function ve(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1e3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:-1;return(0,B.m)(this,void 0,void 0,ce().m(function n(){var o,i,a;return ce().w(function(n){for(;;)switch(n.n){case 0:o=0,i=0,a=0;case 1:return n.n=2,t(r-o);case 2:if(!n.v){n.n=3;break}return n.a(2);case 3:if(o++,a=se(e)?e(i,o):e,i=a,!(a<0||r>=0&&o>r)){n.n=4;break}return n.a(2);case 4:return n.n=5,de(a);case 5:n.n=1;break;case 6:return n.a(2)}},n)}))}pe.beforeRequest=function(t,e){return pe.meta.token&&(e.headers=Object.assign({Authorization:pe.meta.token},e.headers||{})),{info:t,init:e}};Math.pow(2,31);function me(t){return me="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},me(t)}function ye(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return be(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?be(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function be(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function ge(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,we(n.key),n)}}function we(t){var e=function(t,e){if("object"!=me(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=me(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==me(e)?e:e+""}var Se=/^video\/mp4;?\s*(codecs[=:][(h264)|(h.264)].*)?$/,ke=["video/webm;codecs=h264,opus","video/mp4;codecs:h.264,opus"],Te=function(){return function(t,e,r){return e&&ge(t.prototype,e),r&&ge(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e,r,n){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.setTimeout=(null==n?void 0:n.setTimeout)||window.setTimeout,this.clearTimeout=(null==n?void 0:n.clearTimeout)||window.clearTimeout,this.handleAbort=this.handleAbort.bind(this),this.handleDataAvailable=this.handleDataAvailable.bind(this),this.handleRemuxerDataAvailable=this.handleRemuxerDataAvailable.bind(this),this.handleError=this.handleError.bind(this),this.setTimeout=this.setTimeout.bind(null),this.clearTimeout=this.clearTimeout.bind(null),this.timeSlice=null==n?void 0:n.timeSlice,this.safariTimeslicePatch=!0===(null==n?void 0:n.safariTimeslicePatch),this.noFragmentedMp4=!0===(null==n?void 0:n.noFragmentedMp4),this.noWasmMuxer=!0===(null==n?void 0:n.noWasmMuxer);var o=ye(this.getMimeType(null==r?void 0:r.mimeType,null==n?void 0:n.fallbackMimeTypes),2),i=o[0],a=o[1];this.mimeType=i,this.realMimeType=a,this.stream=e;var c=Object.assign(Object.assign({},r),{mimeType:a});this.mediaRecorder=new MediaRecorder(e,c),this.hookup()},[{key:"hookup",value:function(){var t=this;this.isHookup=!0,this.countedDuration=0,this.size=0,this.isRecording=!1,this.lastSliceCrash=!1,this.gotLastSlice=null,this.gotLastRemuxerSlice=null,this.mediaRecorder.ondataavailable=this.handleDataAvailable,this.mediaRecorder.onstop=this.handleAbort,this.mediaRecorder.onerror=this.handleError,this.stream.getVideoTracks().forEach(function(e){return e.addEventListener("ended",t.handleAbort)})}},{key:"unHook",value:function(){var t=this;this.isHookup=!1,this.mediaRecorder.ondataavailable=null,this.mediaRecorder.onstop=null,this.mediaRecorder.onerror=null,this.stream&&this.stream.getVideoTracks().forEach(function(e){return e.removeEventListener("ended",t.handleAbort)})}},{key:"getMimeType",value:function(t,e){var r=[];"string"==typeof t&&r.push(t),e&&e.forEach(function(t){return r.push(t)}),0===r.length&&r.push(""),t=r[0];var n=window.Module;if(!this.noWasmMuxer&&(null==n?void 0:n.inited)){var o=r.findIndex(function(t){return MediaRecorder.isTypeSupported(t)}),i=r.findIndex(function(t){return Se.test(t)}),a=ke.find(function(t){return MediaRecorder.isTypeSupported(t)});if(-1!==i&&(-1===o||o>i)&&a)return this.wasmMuxer=!0,this.muxerInit(),[r[i],a];if(-1!==o){var c=r[o];return[c,c]}}return[t,t]}},{key:"muxerInit",value:function(){var t=this.noFragmentedMp4?0:1,e=window.Module;e._mp4_muxer_close(1),e._mp4_muxer_create(0,t,0,3),window.muxer_data_out=this.handleRemuxerDataAvailable}},{key:"start",value:function(t){if(this.isHookup||this.hookup(),this.gotLastSlicePromise=null,"inactive"===this.mediaRecorder.state){void 0===t&&(t=this.timeSlice),this.mediaRecorder.start(t>0?t:void 0);var e=Date.now();return this.startTime=e,this.resumeTime=this.startTime,this.isRecording=!0,this.startTime}}},{key:"pause",value:function(){if("recording"===this.mediaRecorder.state){this.mediaRecorder.pause();var t=Date.now();return this.countedDuration=this.countedDuration+t-this.resumeTime,this.countedDuration}}},{key:"resume",value:function(){if("paused"===this.mediaRecorder.state){this.mediaRecorder.resume();var t=Date.now();return this.resumeTime=t,t}}},{key:"stop",value:function(){var t=this.mediaRecorder.state,e=Date.now();"recording"==t&&(this.countedDuration+=e-this.resumeTime),"recording"!=t&&"paused"!=t||(this.mediaRecorder.stop(),this.isRecording=!1,this.awaitDataAvailable(),this.stopTime=e)}},{key:"cancel",value:function(){this.unHook();var t=this.mediaRecorder.state;if(["recording","paused"].includes(t)){this.isRecording=!1,this.mediaRecorder.stop();var e=Date.now();this.stopTime=e}var r=window.Module;this.wasmMuxer&&r&&r._mp4_muxer_close(1)}},{key:"handleAbort",value:function(t){var e=this.countedDuration;!0===this.isRecording&&(this.awaitDataAvailable(),this.isRecording=!1,this.stopTime=Date.now(),e=this.countedDuration+this.stopTime-this.resumeTime);try{this.onAbort&&this.onAbort(e,t)}catch(t){}}},{key:"awaitDataAvailable",value:function(){var t=this;if(!this.gotLastSlicePromise){var e=window.Module;if(this.gotLastSlicePromise=new Promise(function(e){t.setTimeout(function(){return e()},1e3),t.gotLastSlice=e}),this.wasmMuxer)return this.gotLastRemuxerSlicePromise=new Promise(function(e){t.setTimeout(function(){return e()},1e4),t.gotLastRemuxerSlice=e}),this.gotLastSlicePromise.then(function(){e._mp4_muxer_close(1)}),void this.gotLastRemuxerSlicePromise.then(function(){t.onAllDataAvailable&&t.onAllDataAvailable()});this.gotLastSlicePromise.then(function(){t.onAllDataAvailable&&t.onAllDataAvailable()})}}},{key:"handleDataAvailable",value:function(t){var e=this;this.size=this.size+t.data.size;try{this.onRawDataAvailable&&this.onRawDataAvailable(t)}catch(t){}if(this.gotLastSlice&&this.gotLastSlice(),this.safariTimeslicePatch){if(0===t.data.size)return void(this.lastSliceCrash=!0);if(!0===this.lastSliceCrash)return void(this.lastSliceCrash=!1)}if(this.wasmMuxer){var r=window.Module,n=new FileReader;return n.readAsArrayBuffer(t.data),void(n.onload=function(){var t=new Uint8Array(n.result),o=r._malloc(t.length);r.HEAPU8.set(t,o),r._mp4_muxer_put_media(o,t.length)<0&&r._free(o),e.gotLastRemuxerSlice&&e.setTimeout(function(){r._mp4_muxer_close(1)},0)})}try{this.ondataavailable&&this.ondataavailable(t)}catch(t){}}},{key:"handleRemuxerDataAvailable",value:function(t){t.type;var e=t.data,r=t.flag,n=(t.duration,new Blob([e]));try{var o=new BlobEvent("dataavailable",{data:n});this.ondataavailable&&this.ondataavailable(o)}catch(t){}1===r&&this.gotLastRemuxerSlice&&this.gotLastRemuxerSlice()}},{key:"handleError",value:function(t){}},{key:"duration",get:function(){var t=this.mediaRecorder.state;return"paused"==t?this.countedDuration:"recording"==t?this.countedDuration+Date.now()-this.resumeTime:"inactive"==t&&this.countedDuration?this.countedDuration:0}},{key:"state",get:function(){return this.mediaRecorder?this.mediaRecorder.state:"inactive"}}],[{key:"isTypeSupported",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=window.Module;if(!e&&(null==r?void 0:r.inited)){var n=Se.test(t),o=ke.find(function(t){return MediaRecorder.isTypeSupported(t)});if(n&&o)return!0}return MediaRecorder.isTypeSupported(t)}}])}();function Oe(t){return Oe="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Oe(t)}function Ie(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return je(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(je(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,je(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,je(f,"constructor",s),je(s,"constructor",u),u.displayName="GeneratorFunction",je(s,o,"GeneratorFunction"),je(f),je(f,o,"Generator"),je(f,n,function(){return this}),je(f,"toString",function(){return"[object Generator]"}),(Ie=function(){return{w:i,m:d}})()}function je(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}je=function(t,e,r,n){function i(e,r){je(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},je(t,e,r,n)}function Pe(t,e){return Pe=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pe(t,e)}function Ee(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ee=function(){return!!t})()}function xe(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,De(n.key),n)}}function De(t){var e=function(t,e){if("object"!=Oe(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Oe(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Oe(e)?e:e+""}var Ce=function(){return function(t,e,r){return e&&xe(t.prototype,e),r&&xe(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}(function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.stopping=!1,this.countdownTime=[0,0],this.setTimeout=e.setTimeout||window.setTimeout,this.clearTimeout=e.clearTimeout||window.clearTimeout,this.setTimeout=this.setTimeout.bind(null),this.clearTimeout=this.clearTimeout.bind(null)},[{key:"setOptions",value:function(t){this.options=t}},{key:"ready",value:function(t){return this.options=t,this.isAllDataAvailable=!1,this.cancelled=!1,this.taskInit(),this.prepare(this.initialize.bind(this))}},{key:"initialize",value:function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];this.recorder=function(t,e,r){if(Ee())return Reflect.construct.apply(null,arguments);var n=[null];n.push.apply(n,e);var o=new(t.bind.apply(t,n));return r&&Pe(o,r.prototype),o}(Te,e),this.recorder.ondataavailable=this.handleDataAvailable.bind(this),this.recorder.onRawDataAvailable=this.handleRawDataAvailable.bind(this),this.recorder.onAbort=this.handleAbort.bind(this),this.recorder.onAllDataAvailable=this.handleAllDataAvailable.bind(this)}},{key:"start",value:function(){try{this.recorder.start()}catch(t){return this.cancel()}return this.showStatus=yt.recording,this.recordingTimer(),this.recorderEvent=gt.start,this.refreshStatus(),this.recorderEvent=gt.null,this.recorder.startTime}},{key:"pause",value:function(){return this.showStatus=yt.paused,this.recorderEvent=gt.pause,this.refreshStatus(),this.recorderEvent=gt.null,this.recorder.countedDuration}},{key:"safePause",value:function(){return(0,B.m)(this,void 0,void 0,Ie().m(function t(){return Ie().w(function(t){for(;;)switch(t.n){case 0:if(0!==this.recorder.size){t.n=1;break}return t.n=1,de(400,this.setTimeout);case 1:return t.a(2,this.pause())}},t,this)}))}},{key:"resume",value:function(){return this.showStatus=yt.recording,this.recordingTimer(),this.recorderEvent=gt.resume,this.refreshStatus(),this.recorderEvent=gt.null,this.recorder.resumeTime}},{key:"cancel",value:function(){var t;this.cancelled||(this.cancelled=!0,this.showStatus=yt.ready,null===(t=this.recorder)||void 0===t||t.cancel(),this.recorderEvent=gt.cancel,this.refreshStatus(),this.recorderEvent=gt.null,this.clear())}},{key:"stop",value:function(){this.recorder.stop(),this.foregroundProcessing?this.showStatus=yt.uploading:this.showStatus=yt.ready,this.recorderEvent=gt.stop,this.refreshStatus(),this.recorderEvent=gt.null,this.clear()}},{key:"safeStop",value:function(){return(0,B.m)(this,void 0,void 0,Ie().m(function t(){return Ie().w(function(t){for(;;)switch(t.n){case 0:if(!this.stopping){t.n=1;break}return t.a(2);case 1:if(this.stopping=!0,0!==this.recorder.size){t.n=2;break}return t.n=2,de(400,this.setTimeout);case 2:this.stop(),this.stopping=!1;case 3:return t.a(2)}},t,this)}))}},{key:"handleDataAvailable",value:function(t){try{this.onDataAvailable&&this.onDataAvailable(t)}catch(t){}}},{key:"handleRawDataAvailable",value:function(t){try{this.onRawDataAvailable&&this.onRawDataAvailable(t)}catch(t){}}},{key:"handleAllDataAvailable",value:function(){try{this.onAllDataAvailable&&this.onAllDataAvailable()}catch(t){}}},{key:"handleAbort",value:function(t,e){switch(this.showStatus===yt.recording&&Date.now()-this.recorder.startTime<400&&(this.showStatus=yt.countdown),this.showStatus){case yt.ready:break;case yt.waitingAuthorized:case yt.connecting:case yt.countdown:this.cancel(),this.recorderEvent=gt.abort_cancel,this.refreshStatus(),this.recorderEvent=gt.null;break;case yt.recording:case yt.paused:this.stop(),this.recorderEvent=gt.abort_stop,this.refreshStatus(),this.recorderEvent=gt.null}}},{key:"clear",value:function(){this.recorderEvent=gt.null}}])}();function _e(t){return _e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},_e(t)}function Me(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Re(n.key),n)}}function Re(t){var e=function(t,e){if("object"!=_e(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=_e(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==_e(e)?e:e+""}function Ae(t,e,r){return e=Ne(e),function(t,e){if(e&&("object"==_e(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Fe()?Reflect.construct(e,r||[],Ne(t).constructor):e.apply(t,r))}function Fe(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Fe=function(){return!!t})()}function Ze(){return Ze="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Ne(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},Ze.apply(null,arguments)}function Ne(t){return Ne=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Ne(t)}function Ge(t,e){return Ge=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ge(t,e)}var Ue=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Ae(this,e,[t])).simpleTaskPool={},r.taskPool={},r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ge(t,e)}(e,t),function(t,e,r){return e&&Me(t.prototype,e),r&&Me(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"setTask",value:function(t){t.id&&t.generate&&(this.taskPool[t.id]=t),t.id&&t.action&&(this.simpleTaskPool[t.id]=t)}},{key:"taskInit",value:function(){this.simpleTaskPool={};for(var t=0,e=Object.keys(this.taskPool);t<e.length;t++){var r=e[t],n=this.taskPool[r];n.init&&n.init(n)}}},{key:"removeTask",value:function(t){delete this.simpleTaskPool[t],delete this.taskPool[t]}},{key:"getTask",value:function(t){return this.simpleTaskPool[t]||null}},{key:"checkTask",value:function(t){for(var e=Date.now(),r=0,n=Object.keys(this.taskPool);r<n.length;r++){var o=n[r],i=this.taskPool[o],a=i.generate(i,t);a&&a.id&&this.setTask(a)}for(var c=0,u=Object.keys(this.simpleTaskPool);c<u.length;c++){var s=u[c],l=this.simpleTaskPool[s];isFinite(l.timestamp)&&l.timestamp<=e&&this.executeSimpleTask(l),isFinite(l.duration)&&l.duration<=t&&this.executeSimpleTask(l)}}},{key:"executeSimpleTask",value:function(t){switch(t.action){case"stop":this.stop();break;case"pause":this.pause()}delete this.simpleTaskPool[t.id]}},{key:"showTimer",value:function(t){}},{key:"countdownTimer",value:function(t){var e=this,r=function(){var n=t[1]-(Date.now()-t[0]);if(n>0&&e.showStatus===yt.countdown)return e.showTimer(Math.round(n/1e3)+""),void(e.countdownTimeoutId=e.setTimeout(r,n%1e3));e.setTimeout(function(){e.start()},100)};r()}},{key:"recordingTimer",value:function(){var t,e,r=this,n=this.recorder.countedDuration,o=this.recorder.resumeTime,i=function(){var a,c,u,s;r.showStatus===yt.recording&&(t=n+Date.now()-o,r.showTimer((a=t,c=Math.floor(a/36e5),u=Math.floor(a%36e5/6e4),s=Math.floor(a%6e4/1e3),c>0?"".concat(c,":").concat(("00"+u).slice(-2),":").concat(("00"+s).slice(-2)):"".concat(u,":").concat(("00"+s).slice(-2)))),r.checkTask(t),e=t%1e3,e=Math.max(1e3-e,e),r.recordingTimeoutId=r.setTimeout(i,e))};i()}},{key:"clear",value:function(){!function(t,e,r,n){var o=Ze(Ne(1&n?t.prototype:t),e,r);return 2&n&&"function"==typeof o?function(t){return o.apply(r,t)}:o}(e,"clear",this,3)([]),this.showTimer(""),this.clearTimeout(this.countdownTimeoutId),this.clearTimeout(this.recordingTimeoutId),this.simpleTaskPool={}}}])}(Ce);function Be(t){return Be="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Be(t)}function Le(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,ze(n.key),n)}}function ze(t){var e=function(t,e){if("object"!=Be(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Be(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Be(e)?e:e+""}function qe(t,e,r){return e=We(e),function(t,e){if(e&&("object"==Be(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ve()?Reflect.construct(e,r||[],We(t).constructor):e.apply(t,r))}function Ve(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ve=function(){return!!t})()}function We(t){return We=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},We(t)}function Ke(t,e){return Ke=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ke(t,e)}var He=function(t){function e(){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),qe(this,e,arguments)}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ke(t,e)}(e,t),function(t,e,r){return e&&Le(t.prototype,e),r&&Le(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"catch",value:function(t,e){return t&&"Invalid state"===t.message?this.report("cancelShareScreen",t):t&&"Permission denied by system"===t.message||t&&"Could not start video source"===t.message?(this.report("startFailed",t),this.report("recordingPermissionDenied")):void(t&&"getStreamFailed"===e&&this.report("cameraUnavailable",t))}},{key:"report",value:function(t,e){"function"==typeof this.onCatch&&this.onCatch.call(null,t,e)}}])}(Ue);function Je(t){return Je="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Je(t)}function Qe(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return $e(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):($e(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,$e(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,$e(f,"constructor",s),$e(s,"constructor",u),u.displayName="GeneratorFunction",$e(s,o,"GeneratorFunction"),$e(f),$e(f,o,"Generator"),$e(f,n,function(){return this}),$e(f,"toString",function(){return"[object Generator]"}),(Qe=function(){return{w:i,m:d}})()}function $e(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}$e=function(t,e,r,n){function i(e,r){$e(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},$e(t,e,r,n)}function Ye(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Xe(n.key),n)}}function Xe(t){var e=function(t,e){if("object"!=Je(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Je(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Je(e)?e:e+""}function tr(t,e,r){return e=nr(e),function(t,e){if(e&&("object"==Je(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,er()?Reflect.construct(e,r||[],nr(t).constructor):e.apply(t,r))}function er(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(er=function(){return!!t})()}function rr(){return rr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=nr(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},rr.apply(null,arguments)}function nr(t){return nr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},nr(t)}function or(t,e){return or=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},or(t,e)}var ir=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),r=tr(this,e,[t]),t&&(r.blankCameraVideo=t.blankCameraVideo,r.pipAspectRatio=t.pipCameraAspectRatio),r.handleLeavePictureInPicture=r.handleLeavePictureInPicture.bind(r),r.isCameraOn=!1,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&or(t,e)}(e,t),function(t,e,r){return e&&Ye(t.prototype,e),r&&Ye(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"turnCameraTo",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(0,B.m)(this,void 0,void 0,Qe().m(function r(){return Qe().w(function(r){for(;;)switch(r.n){case 0:if("on"===t&&this.showCamera(e),"off"!==t){r.n=1;break}return r.n=1,this.closeCamera();case 1:this.refreshStatus();case 2:return r.a(2)}},r,this)}))}},{key:"showCamera",value:function(t){return(0,B.m)(this,void 0,void 0,Qe().m(function e(){var r,n;return Qe().w(function(e){for(;;)switch(e.n){case 0:r=t||this.options.camera.deviceId,this.cameraID=r,n=this.options.recordType,e.n=n===mt.tab?1:n===mt.desktop?3:n===mt.camera?5:6;break;case 1:return e.n=2,this.tabShowCamera(r);case 2:return e.a(3,6);case 3:return e.n=4,this.showCameraPictureInPicture(r);case 4:case 5:return e.a(3,6);case 6:this.isCameraOn=!0,this.refreshStatus();case 7:return e.a(2)}},e,this)}))}},{key:"closeCamera",value:function(){var t;switch(null===(t=this.options)||void 0===t?void 0:t.recordType){case mt.tab:return this.tabCloseCamera();case mt.desktop:return this.exitPictureInPicture();case mt.camera:}}},{key:"syncTabCameraStatus",value:function(t,e,r){var n=!e||e===this.tabId;t!==this.isCameraOn&&n&&(this.isCameraOn=t),r&&(this.cameraID=r)}},{key:"showCameraPictureInPicture",value:function(t){return(0,B.m)(this,void 0,void 0,Qe().m(function e(){var r;return Qe().w(function(e){for(;;)switch(e.p=e.n){case 0:if((r="on-"+t)!==this.pictureInPictureKey){e.n=1;break}return e.a(2);case 1:if(this.pictureInPictureKey=r,this.closePendingPictureInPicture=!1,void 0!==document.pictureInPictureElement){e.n=2;break}return e.a(2);case 2:return e.p=2,e.n=3,this.videoPictureInPicture();case 3:if(e.v){e.n=4;break}return e.n=4,this.newVideoPictureInPicture(t);case 4:return e.p=4,this.closePendingPictureInPicture&&this.exitPictureInPicture(),e.f(4);case 5:return e.a(2)}},e,this,[[2,,4,5]])}))}},{key:"videoPictureInPicture",value:function(t){return(0,B.m)(this,void 0,void 0,Qe().m(function e(){var r,n=this;return Qe().w(function(e){for(;;)switch(e.n){case 0:if(!(r=document.querySelector(t||"video.ours-picture-in-picture-video"))){e.n=2;break}return e.n=1,r.requestPictureInPicture().then(function(){r.classList.add("picture-in-picture"),r.play().catch(console.error)},function(){function t(){r.requestPictureInPicture(),r.classList.add("picture-in-picture"),r.play().catch(function(){})}r.addEventListener("loadeddata",t),n.removeLoadedDataListener=function(){r.removeEventListener("loadeddata",t)}});case 1:return r.addEventListener("leavepictureinpicture",this.handleLeavePictureInPicture),e.a(2,!0);case 2:return e.a(2,!1)}},e,this)}))}},{key:"newVideoPictureInPicture",value:function(t){var e,r;return(0,B.m)(this,void 0,void 0,Qe().m(function n(){var o,i,a,c=this;return Qe().w(function(n){for(;;)switch(n.n){case 0:if(t=t||(null===(r=null===(e=this.options)||void 0===e?void 0:e.camera)||void 0===r?void 0:r.deviceId),this.assistCapturer&&this.assistCapturer.stopCapture(),this.assistCapturer=new ae,o=Date.now(),this.cameraCapturerId=o,this.videoEl||(this.videoEl=document.createElement("video")),a=new Promise(function(t){i=t}),this.videoEl.onloadedmetadata=function(){c.videoEl.onloadedmetadata=null,c.videoEl.requestPictureInPicture().then(function(){c.videoEl.onleavepictureinpicture=c.handleLeavePictureInPicture,i&&i(!0)}).catch(function(){i&&i(!1)})},!this.blankCameraVideo){n.n=2;break}return this.videoEl.srcObject=null,this.videoEl.src=this.blankCameraVideo,this.videoEl.play(),n.n=1,a;case 1:if(n.v){n.n=2;break}return n.a(2);case 2:return n.n=3,this.assistCapturer.getUserMedia({audio:!1,video:!t||{deviceId:{exact:t}}}).then(function(t){o!==c.cameraCapturerId&&ae.stopStream(t),c.pipAspectRatio&&t.getVideoTracks().forEach(function(t){t.applyConstraints({aspectRatio:c.pipAspectRatio})}),c.cameraStream=t}).catch(function(t){c.catch(t,"getStreamFailed")});case 3:return this.videoEl.srcObject=this.cameraStream,this.videoEl.play(),n.a(2,a)}},n,this)}))}},{key:"exitPictureInPicture",value:function(){return(0,B.m)(this,void 0,void 0,Qe().m(function t(){return Qe().w(function(t){for(;;)switch(t.n){case 0:if(this.closePendingPictureInPicture=!0,this.pictureInPictureKey="off",ae.stopStream(this.cameraStream),!document.pictureInPictureElement){t.n=2;break}return t.n=1,document.exitPictureInPicture();case 1:t.n=3;break;case 2:this.isCameraOn&&(this.isCameraOn=!1);case 3:this.removeLoadedDataListener&&this.removeLoadedDataListener();case 4:return t.a(2)}},t,this)}))}},{key:"handleLeavePictureInPicture",value:function(t){this.pictureInPictureKey="off",ae.stopStream(this.cameraStream),t&&t.target.classList.remove("picture-in-picture"),this.isCameraOn=!1,![yt.notReady,yt.ready].includes(this.showStatus)&&this.refreshStatus()}},{key:"tabShowCamera",value:function(t){return(0,B.m)(this,void 0,void 0,Qe().m(function e(){var r;return Qe().w(function(e){for(;;)switch(e.n){case 0:r=t||this.options.camera.deviceId,this.safeSendMessageToTab({action:ie.tabShowCamera,cameraId:r},this.options.tabId),this.onToggleTabCamera&&this.onToggleTabCamera({tabId:this.options.tabId,visible:!0,deviceId:r});case 1:return e.a(2)}},e,this)}))}},{key:"tabCloseCamera",value:function(){this.safeSendMessageToTab({action:ie.tabCloseCamera},this.options.tabId);try{this.onToggleTabCamera&&this.onToggleTabCamera({tabId:this.options.tabId,visible:!1})}catch(t){}this.isCameraOn=!1,this.refreshStatus()}},{key:"clear",value:function(){!function(t,e,r,n){var o=rr(nr(1&n?t.prototype:t),e,r);return 2&n&&"function"==typeof o?function(t){return o.apply(r,t)}:o}(e,"clear",this,3)([]),this.closeCamera(),this.isCameraOn=!1,this.assistCapturer&&this.assistCapturer.stopCapture(),this.assistCapturer=null}}])}(He);function ar(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return cr(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(cr(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,cr(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,cr(f,"constructor",s),cr(s,"constructor",u),u.displayName="GeneratorFunction",cr(s,o,"GeneratorFunction"),cr(f),cr(f,o,"Generator"),cr(f,n,function(){return this}),cr(f,"toString",function(){return"[object Generator]"}),(ar=function(){return{w:i,m:d}})()}function cr(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}cr=function(t,e,r,n){function i(e,r){cr(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},cr(t,e,r,n)}function ur(t){switch(t){case"720p":return{maxWidth:1280,maxHeight:720,maxFrameRate:30};case"1080p":default:return{maxWidth:1920,maxHeight:1080,maxFrameRate:30};case"2k":return{maxWidth:2560,maxHeight:1440,maxFrameRate:30};case"4k":return{maxWidth:4096,maxHeight:2160,maxFrameRate:30}}}function sr(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3670016;return(0,B.m)(this,void 0,void 0,ar().m(function r(){var n,o,i,a,c,u;return ar().w(function(r){for(;;)switch(r.p=r.n){case 0:return n=t.getVideoTracks()[0].getSettings(),o=n.width,i=n.height,r.p=1,a=new ImageCapture(t.getVideoTracks()[0]),r.n=2,a.grabFrame();case 2:c=r.v,o=c.width,i=c.height,c.close(),r.n=4;break;case 3:r.p=3,r.v;case 4:return u=Math.round(Math.sqrt(o*i/1920/1080)*e),r.a(2,{videoBitsPerSecond:u})}},r,null,[[1,3]])}))}function lr(t){return lr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},lr(t)}function fr(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return dr(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(dr(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,dr(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,dr(f,"constructor",s),dr(s,"constructor",u),u.displayName="GeneratorFunction",dr(s,o,"GeneratorFunction"),dr(f),dr(f,o,"Generator"),dr(f,n,function(){return this}),dr(f,"toString",function(){return"[object Generator]"}),(fr=function(){return{w:i,m:d}})()}function dr(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}dr=function(t,e,r,n){function i(e,r){dr(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},dr(t,e,r,n)}function pr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,hr(n.key),n)}}function hr(t){var e=function(t,e){if("object"!=lr(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=lr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==lr(e)?e:e+""}function vr(t,e,r){return e=br(e),function(t,e){if(e&&("object"==lr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,mr()?Reflect.construct(e,r||[],br(t).constructor):e.apply(t,r))}function mr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(mr=function(){return!!t})()}function yr(){return yr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=br(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},yr.apply(null,arguments)}function br(t){return br=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},br(t)}function gr(t,e){return gr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},gr(t,e)}var wr=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=vr(this,e,[t])).foregroundProcessing=t.foregroundProcessing,r.mediaSources=t.mediaSources||["screen","window","tab","audio"],r.mimeTypes=t.mimeTypes,r.timeSlice=t.timeSlice||1e3,r.safariTimeslicePatch=!0===t.safariTimeslicePatch,r.bitrateBase=t.bitrateBase||3670016,r.showStatus=yt.ready,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&gr(t,e)}(e,t),function(t,e,r){return e&&pr(t.prototype,e),r&&pr(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"reopenDesktopMediaPicker",value:function(){this.showStatus===yt.waitingAuthorized&&[mt.desktop].includes(this.options.recordType)&&this.capturer&&this.capturer.reopenDesktopMediaPicker()}},{key:"turnMicTo",value:function(t){var e,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return(0,B.m)(this,void 0,void 0,fr().m(function n(){var o;return fr().w(function(n){for(;;)switch(n.n){case 0:o=r||(null===(e=this.options.microphone)||void 0===e?void 0:e.deviceId),"on"===t?(this.isMicOn=!0,this.capturer.turnOnMic(o)):"off"===t?(this.isMicOn=!1,this.capturer.turnOffMic()):(this.isMicOn?this.capturer.turnOffMic():this.capturer.turnOnMic(o),this.isMicOn=!this.isMicOn),this.micID=o,this.refreshStatus();case 1:return n.a(2)}},n,this)}))}},{key:"prepare",value:function(t){var e;return(0,B.m)(this,void 0,void 0,fr().m(function r(){var n,o,i=this;return fr().w(function(r){for(;;)switch(r.n){case 0:this.showStatus=yt.waitingAuthorized,this.refreshStatus(),this.tabId=this.options.tabId,n=this.onPrepare?this.onPrepare(this.options):Promise.resolve(),o=this.prepareStream(this.options),(null===(e=this.options.camera)||void 0===e?void 0:e.open)&&this.showCamera(),this.prepareAbort=!1,o.then(function(t){try{i.afterCaptureStream&&i.afterCaptureStream(t)}catch(t){}i.validateStream(t),i.recordStream=t,i.showStatus=yt.connecting,i.refreshStatus()}).then(function(){return n}).then(function(){var t=i.options.quality||{},e=Object.assign({},t.videoBitsPerSecond?{videoBitsPerSecond:t.videoBitsPerSecond}:{});return e.videoBitsPerSecond?Promise.resolve(e):sr(i.recordStream,i.bitrateBase)}).then(function(e){var r=i.options,n=r.processorType,o=r.stopTimerTask;i.capturer.prepareAudioContext();var a="storage"==n||"none"==n;t(i.recordStream,Object.assign({},e),{fallbackMimeTypes:i.mimeTypes,timeSlice:i.timeSlice,noWasmMuxer:null,safariTimeslicePatch:i.safariTimeslicePatch,noFragmentedMp4:a,setTimeout:i.setTimeout,clearTimeout:i.clearTimeout}),o&&i.setTask(o),i.showStatus=yt.countdown,i.countdownTime=[Date.now(),i.options.countdown],i.countdownTimer(i.countdownTime),i.refreshStatus()}).catch(function(t){i.recordStream||i.afterCaptureStream&&i.afterCaptureStream(null),i.prepareAbort=!0,i.showStatus=yt.ready,i.refreshStatus(),i.resetPrepared(),i.cancel(),i.catch(t)}),this.recorderEvent=gt.ready,this.refreshStatus(),this.recorderEvent=gt.null;case 1:return r.a(2)}},r,this)}))}},{key:"prepareStream",value:function(t){var e,r,n,o;return(0,B.m)(this,void 0,void 0,fr().m(function i(){var a,c,u,s,l,f,d=this;return fr().w(function(i){for(;;)switch(i.n){case 0:if(!t.stream){i.n=1;break}return i.a(2,t.stream);case 1:this.beforeCaptureStream&&this.beforeCaptureStream(t),a=null===(e=this.options.microphone)||void 0===e?void 0:e.deviceId,c=Object.assign(Object.assign({},ur(this.options.quality.equivalent)),this.options.quality),u=new ae({setTimeout:this.setTimeout,clearTimeout:this.clearTimeout}),this.capturer=u,this.isMicOn=!1,s=[],f=t.recordType,i.n=f===mt.desktop?2:f===mt.tab?3:f===mt.camera?4:5;break;case 2:return ae.isCaptureDesktopSupported()?s.push(this.capturer.captureDesktop({streamId:t.streamId,sources:this.mediaSources,timeout:6e4,constraints:{audio:!0,video:{mandatory:{maxWidth:c.maxWidth,maxHeight:c.maxHeight,maxFrameRate:c.maxFrameRate}}}})):s.push(this.capturer.getDisplayMedia({audio:!0,video:{width:{max:c.maxWidth},height:{max:c.maxHeight},frameRate:c.maxFrameRate}})),i.a(3,5);case 3:return s.push(this.capturer.captureTab({targetTabId:this.options.tabId,streamId:this.options.streamId,captureOptions:{audio:!1!==this.options.tabAudio,video:!0,videoConstraints:{mandatory:this.options.crop?{maxWidth:this.options.crop.ww,maxHeight:this.options.crop.wh}:{maxWidth:c.maxWidth,maxHeight:c.maxHeight}}}})),i.a(3,5);case 4:return s.push(this.capturer.getUserMedia({video:{deviceId:{exact:null===(r=this.options.camera)||void 0===r?void 0:r.deviceId}},audio:!1})),i.a(3,5);case 5:if(!this.options.crop){i.n=7;break}return i.n=6,Promise.all(s);case 6:return i.n=7,this.capturer.cropVideoTrack(this.options.crop);case 7:if(!(null===(o=null===(n=this.options)||void 0===n?void 0:n.microphone)||void 0===o?void 0:o.open)){i.n=9;break}return this.isMicOn=!0,this.micID=a,i.n=8,Promise.all(s);case 8:l=this.capturer.turnOnMic(a).then(function(t){t||(d.isMicOn=!1)}),s.push(l);case 9:return i.n=10,Promise.all(s);case 10:return this.prepareAbort&&u.stopCapture(),i.a(2,u.stream)}},i,this)}))}},{key:"validateStream",value:function(t){var e=!0;if(t||(e=!1),t.active||(e=!1),!e)throw Error("Capturer: invalid stream.")}},{key:"resetPrepared",value:function(){this.capturer&&this.capturer.stopCapture(),ae.stopStream(this.recordStream),this.closeCamera()}},{key:"getTabInfo",value:function(t){return(0,B.m)(this,void 0,void 0,fr().m(function t(){return fr().w(function(t){for(;;)if(0===t.n)return t.a(2,{title:document.title,url:window.location.href})},t)}))}},{key:"safeSendMessageToTab",value:function(t,e){return(0,B.m)(this,void 0,void 0,fr().m(function t(){return fr().w(function(t){for(;;)if(0===t.n)return t.a(2)},t)}))}},{key:"clear",value:function(){!function(t,e,r,n){var o=yr(br(1&n?t.prototype:t),e,r);return 2&n&&"function"==typeof o?function(t){return o.apply(r,t)}:o}(e,"clear",this,3)([]),this.tabId=null,this.tabInfo=null,this.capturer&&this.capturer.stopCapture(),ae.stopStream(this.recordStream),this.recordStream=null,this.capturer=null}}])}(ir);function Sr(t){return Sr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Sr(t)}function kr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Tr(n.key),n)}}function Tr(t){var e=function(t,e){if("object"!=Sr(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Sr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Sr(e)?e:e+""}function Or(t,e,r){return e=jr(e),function(t,e){if(e&&("object"==Sr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Ir()?Reflect.construct(e,r||[],jr(t).constructor):e.apply(t,r))}function Ir(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Ir=function(){return!!t})()}function jr(t){return jr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},jr(t)}function Pr(t,e){return Pr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Pr(t,e)}var Er=function(t){function e(t){return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),Or(this,e,[t])}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Pr(t,e)}(e,t),function(t,e,r){return e&&kr(t.prototype,e),r&&kr(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"refreshStatus",value:function(){}},{key:"getStatusData",value:function(){}}])}(wr),xr=r(12964);function Dr(t){return Dr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Dr(t)}function Cr(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return _r(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(_r(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,_r(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,_r(f,"constructor",s),_r(s,"constructor",u),u.displayName="GeneratorFunction",_r(s,o,"GeneratorFunction"),_r(f),_r(f,o,"Generator"),_r(f,n,function(){return this}),_r(f,"toString",function(){return"[object Generator]"}),(Cr=function(){return{w:i,m:d}})()}function _r(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}_r=function(t,e,r,n){function i(e,r){_r(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},_r(t,e,r,n)}function Mr(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function Rr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,Fr(n.key),n)}}function Ar(t,e,r){return e&&Rr(t.prototype,e),r&&Rr(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function Fr(t){var e=function(t,e){if("object"!=Dr(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Dr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Dr(e)?e:e+""}var Zr=function(){return Ar(function t(e){var r=this;Mr(this,t),this.processing=!1,this.dataSize=0,this.dataCount=0,this.confirmedDataCount=0,this.jobQueue=new Nr,this.status="uploading",this.reUploading=!1,this.reUploadFirstSlice=!0,this.hasError=!1,pe.meta.token=e.token,this.apiOrigin=e.apiPath,e.backupKey&&(this.backupKey=e.backupKey,this.backup=new xr.Z),he(this,"confirmedDataCount",function(){return r.refreshProgress()}),he(this,"dataCount",function(){return r.refreshProgress()})},[{key:"ready",value:function(t){return(0,B.m)(this,void 0,void 0,Cr().m(function e(){return Cr().w(function(e){for(;;)switch(e.n){case 0:return this.title=t.title,this.payload=this.parsePayload(t.payload||{}),e.n=1,this.init();case 1:return this.vid=e.v,this.onConnected&&this.onConnected(this.vid,{vid:this.vid}),e.a(2,this.vid)}},e,this)}))}},{key:"init",value:function(){return(0,B.m)(this,void 0,void 0,Cr().m(function t(){var e;return Cr().w(function(t){for(;;)switch(t.n){case 0:return this.processing=!0,t.n=1,pe.post(this.getUrl("v2/record/init"),{body:JSON.stringify({video_title:this.title,scope:this.payload.scope,extra:this.payload.extra})});case 1:return e=t.v,this.processing=!1,3===e.data.status&&this.callHook("onError",this.vid,{type:"quotaExceeded"}),t.a(2,e.data.vid)}},t,this)}))}},{key:"push",value:function(t){this.hasError||("uploading"===this.status||"paused"===this.status)&&fe(t)&&t.size&&(this.dataSize||this.reportFirstSlice(t),this.pushUploadJob(t,this.dataSize,this.dataCount),this.dataSize+=t.size,this.dataCount+=1)}},{key:"pushUploadJob",value:function(t,e,r){var n=this;this.backup&&this.jobQueue.length>250?this.jobQueue.push(function(){return(0,B.m)(n,void 0,void 0,Cr().m(function t(){var n,o;return Cr().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,this.backup.getSlice(this.backupKey,r);case 1:return n=t.v,o=n.data,t.n=2,this.upload(o,e,r);case 2:return t.a(2)}},t,this)}))}):this.jobQueue.push(function(){return(0,B.m)(n,void 0,void 0,Cr().m(function n(){return Cr().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,this.upload(t,e,r);case 1:return n.a(2)}},n,this)}))})}},{key:"uploadSlice",value:function(t,e,r){return(0,B.m)(this,void 0,void 0,Cr().m(function n(){var o=this;return Cr().w(function(n){for(;;)switch(n.n){case 0:if(!this.hasError){n.n=1;break}return n.a(2,!0);case 1:if("uploading"!==this.status||!fe(t)||!t.size){n.n=5;break}if(!this.reUploadFirstSlice){n.n=3;break}return this.reUploadFirstSlice=!1,n.n=2,this.upload(t,e,r);case 2:n.n=4;break;case 3:return n.n=4,this.jobQueue.push(function(){return(0,B.m)(o,void 0,void 0,Cr().m(function n(){return Cr().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,this.upload(t,e,r);case 1:return n.a(2)}},n,this)}))});case 4:if(!this.hasError){n.n=5;break}return n.a(2,!0);case 5:return n.a(2)}},n,this)}))}},{key:"upload",value:function(t,e,r){return(0,B.m)(this,void 0,void 0,Cr().m(function n(){var o;return Cr().w(function(n){for(;;)switch(n.n){case 0:return(o=new FormData).append("video_id",this.vid),o.append("file",t),o.append("offset",String(e)),n.n=1,pe.post(this.getUrl("v2/record/file_upload?vid=".concat(this.vid,"&idx=").concat(r,"&offset=").concat(e)),{body:o},{retry:!0});case 1:if(-400!==n.v.code){n.n=2;break}return this.hasError||(this.hasError=!0,this.status="stopped",this.callHook("onError",this.vid,{})),n.a(2);case 2:"canceled"!==this.status&&(se(this.onSliceUploaded)&&this.onSliceUploaded(this.vid,r),this.confirmedDataCount+=1);case 3:return n.a(2)}},n,this)}))}},{key:"startReUpload",value:function(t,e,r,n){this.vid=t,this.reUploading=!0,this.dataSize=n||0,this.dataCount=e,this.confirmedDataCount=r}},{key:"start",value:function(){return{vid:this.vid,title:this.title}}},{key:"pause",value:function(){this.status="paused"}},{key:"resume",value:function(){this.status="uploading"}},{key:"stop",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.keepalive,r=void 0!==e&&e,n=t.onStop,o=void 0===n?function(){return null}:n;return(0,B.m)(this,void 0,void 0,Cr().m(function t(){var e=this;return Cr().w(function(t){for(;;)switch(t.n){case 0:if("stopped"!==this.status){t.n=1;break}return t.a(2);case 1:this.status="stopped",this.hasError||(this.processing=!0,ve(function(){return(0,B.m)(e,void 0,void 0,Cr().m(function t(){return Cr().w(function(t){for(;;)switch(t.n){case 0:if(!this.done){t.n=2;break}return t.n=1,pe.put(this.getUrl("/record/complete/".concat(this.vid,"?type=").concat(this.reUploading?"backup":"default")),{keepalive:r},{retry:!0});case 1:return this.processing=!1,this.callHook("onSuccess",this.vid,{vid:this.vid,title:this.title}),se(o)&&o(),t.a(2,!0);case 2:return t.a(2,!1)}},t,this)}))},1e3));case 2:return t.a(2)}},t,this)}))}},{key:"cancel",value:function(){var t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];return(0,B.m)(this,void 0,void 0,Cr().m(function e(){var r=this;return Cr().w(function(e){for(;;)switch(e.n){case 0:if("canceled"!==this.status){e.n=1;break}return e.a(2);case 1:return this.status="canceled",this.processing=!0,e.a(2,ve(function(){return(0,B.m)(r,void 0,void 0,Cr().m(function e(){var r;return Cr().w(function(e){for(;;)switch(e.n){case 0:if(!this.vid){e.n=2;break}return r=this.getUrl("/record/".concat(this.dataSize?"discard":"cancel","/").concat(this.vid)),e.n=1,pe.delete(r,{keepalive:t},{retry:!0});case 1:return this.processing=!1,e.a(2,!0);case 2:return e.a(2,!1)}},e,this)}))},1e3))}},e,this)}))}},{key:"reportFirstSlice",value:function(t){pe.post(this.getUrl("/record/buffer/first"),{body:JSON.stringify({id:this.vid,size:t.size,extra:this.payload.extra})})}},{key:"parsePayload",value:function(t){var e=t,r={};e.locationType&&e.locationId&&(r.scope={type:e.locationType,id:e.locationId});var n=r.extra={};return e.tabUrl&&(n.source_url=e.tabUrl),e.appVersion&&(n.client_version=e.appVersion),e.recordType&&(n.record_type=e.recordType),e.recorderVersion&&(n.recorder_version=e.recorderVersion),e.screenSize&&(n.screen_size=e.screenSize),e.appAndPlatform&&(n.client=e.appAndPlatform),r}},{key:"getUrl",value:function(t){return function(){for(var t=arguments.length,e=new Array(t),r=0;r<t;r++)e[r]=arguments[r];return e.join("/").replace(/([^:])\/{2,}/g,"$1/")}(this.apiOrigin,t)}},{key:"progress",get:function(){return{finished:this.confirmedDataCount,current:this.confirmedDataCount,total:this.dataCount,more:{binarySlice:this.confirmedDataCount}}}},{key:"done",get:function(){return"stopped"===this.status&&this.confirmedDataCount===this.dataCount}},{key:"refreshProgress",value:function(){var t=this.progress;this.callHook("onProgress",this.vid,t.finished/t.total,{binarySlice:t.more.binarySlice,finished:t.finished,total:t.total,current:t.current})}},{key:"onProgress",value:function(t,e){}},{key:"onError",value:function(){}},{key:"onSuccess",value:function(){}},{key:"onSliceUploaded",value:function(t,e){return(0,B.m)(this,void 0,void 0,Cr().m(function t(){return Cr().w(function(t){for(;;)if(0===t.n)return t.a(2)},t)}))}},{key:"callHook",value:function(t){for(var e,r=arguments.length,n=new Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];se(this[t])&&(e=this[t]).call.apply(e,[this].concat(n))}}])}(),Nr=function(){return Ar(function t(){Mr(this,t),this.runningCount=0,this.jobs=[]},[{key:"busy",get:function(){return this.runningCount>=5}},{key:"length",get:function(){return this.jobs.length}},{key:"push",value:function(t){var e=this,r=new Promise(function(t){e.resolveHook=t});return this.jobs.push(t),this.startNextJob(),r}},{key:"startNextJob",value:function(){return(0,B.m)(this,void 0,void 0,Cr().m(function t(){var e;return Cr().w(function(t){for(;;)switch(t.p=t.n){case 0:if(!this.busy){t.n=1;break}return t.a(2);case 1:return this.resolveHook(this.runningCount),this.runningCount++,e=this.jobs.shift(),t.p=2,t.n=3,e();case 3:this.runningCount--,this.jobs.length>0&&this.startNextJob(),t.n=5;break;case 4:t.p=4,t.v,this.runningCount--,this.push(e);case 5:return t.a(2)}},t,this,[[2,4]])}))}}])}(),Gr=r(6186);function Ur(t){return Ur="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Ur(t)}function Br(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return Lr(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(Lr(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Lr(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Lr(f,"constructor",s),Lr(s,"constructor",u),u.displayName="GeneratorFunction",Lr(s,o,"GeneratorFunction"),Lr(f),Lr(f,o,"Generator"),Lr(f,n,function(){return this}),Lr(f,"toString",function(){return"[object Generator]"}),(Br=function(){return{w:i,m:d}})()}function Lr(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Lr=function(t,e,r,n){function i(e,r){Lr(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},Lr(t,e,r,n)}function zr(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,qr(n.key),n)}}function qr(t){var e=function(t,e){if("object"!=Ur(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Ur(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Ur(e)?e:e+""}function Vr(t,e,r){return e=Jr(e),function(t,e){if(e&&("object"==Ur(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,Wr()?Reflect.construct(e,r||[],Jr(t).constructor):e.apply(t,r))}function Wr(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(Wr=function(){return!!t})()}function Kr(t,e,r,n){var o=Hr(Jr(1&n?t.prototype:t),e,r);return 2&n&&"function"==typeof o?function(t){return o.apply(r,t)}:o}function Hr(){return Hr="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=Jr(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},Hr.apply(null,arguments)}function Jr(t){return Jr=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Jr(t)}function Qr(t,e){return Qr=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Qr(t,e)}var $r=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=Vr(this,e,[t])).backupStrategy=t.backupStrategy,r.autoGenerateThumbnail=!1!==t.autoGenerateThumbnail,r.isStorageAlert=!1,r.isEmptyData=!0,r.isEmptyFmp4Data=!0,r.onPrepare=r.prepareCompat.bind(r),r.singleLine=new Gr.u({setTimeout:r.setTimeout,clearTimeout:r.clearTimeout}),r.processorMap=new Map,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Qr(t,e)}(e,t),function(t,e,r){return e&&zr(t.prototype,e),r&&zr(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"prepareCompat",value:function(){var t;return(0,B.m)(this,void 0,void 0,Br().m(function e(){return Br().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,this.beforePrepareProcessor();case 1:if(!this.prepareAbort){e.n=2;break}throw Error("prepareAborted");case 2:return e.n=3,this.prepareBackup();case 3:return this.backupKey=e.v,e.n=4,this.prepareProcessor();case 4:return this.processKey=e.v,this.backup&&this.backup.update({processKey:this.processKey,originId:this.videoId,options:this.options}),null===(t=this.singleLine)||void 0===t||t.register(this.processKey),e.n=5,this.afterPrepareProcessor();case 5:return e.a(2)}},e,this)}))}},{key:"updateStorageAlert",value:function(t){this.isStorageAlert=t}},{key:"beforePrepareProcessor",value:function(){return(0,B.m)(this,void 0,void 0,Br().m(function t(){var e,r,n,o,i,a,c,u,s;return Br().w(function(t){for(;;)switch(t.n){case 0:e=this.options,r=e.tabId,n=e.processorType,o=e.title,i=e.recordType,this.videoId="",this.processorType=n||"upload",this.backupType="none",s=this.backupStrategy,t.n="upload"===s?1:"auto"===s?2:"original"===s||"output"===s?3:4;break;case 1:return this.backupType="upload"===this.processorType?"output":"none",t.a(3,4);case 2:return this.backupType="upload"===this.processorType?"output":"original",t.a(3,4);case 3:return this.backupType=this.backupStrategy,t.a(3,4);case 4:if(this.title=o||this.generateTitle(i),!isFinite(r)){t.n=6;break}return t.n=5,this.getTabInfo(r);case 5:this.tab=t.v;case 6:return t.n=7,this.getProcessorConfig(this.processorType);case 7:a=t.v,this.processorConfig=a,"token"in a&&(pe.meta.token=a.token,c=this.parseToken(a.token),u=c.id,this.userId=u);case 8:return t.a(2)}},t,this)}))}},{key:"prepareBackup",value:function(){return(0,B.m)(this,void 0,void 0,Br().m(function t(){var e,r,n;return Br().w(function(t){for(;;)switch(t.n){case 0:e=this.backupType,n=e,t.n="original"===n||"output"===n?1:2;break;case 1:return this.backup=new xr.Z,t.a(3,3);case 2:return this.backup=null,t.a(3,3);case 3:if(this.backup){t.n=4;break}return t.a(2);case 4:return t.n=5,this.backup.create({title:this.title,owner:this.userId,mimeType:"output"===e?"video/mp4":"video/webm"});case 5:return r=t.v,t.a(2,r.key)}},t,this)}))}},{key:"prepareProcessor",value:function(){return(0,B.m)(this,void 0,void 0,Br().m(function t(){var e,r,n,o;return Br().w(function(t){for(;;)switch(t.n){case 0:e=this.processorType,r=this.options.payload,o=e,t.n="download"===o?1:"storage"===o?2:"upload"===o?3:"none"===o?4:5;break;case 1:return this.processor=new K,t.a(3,6);case 2:return this.processor=new lt({autoGenerateThumbnail:this.autoGenerateThumbnail}),t.a(3,6);case 3:return this.processor=new Zr(this.processorConfig),t.a(3,6);case 4:return this.processor=new bt(this.processorConfig),t.a(3,6);case 5:throw Error("RecorderCompat processorType not supported!");case 6:return this.processor.onConnected=this.handleProcessorConnected.bind(this),this.processor.onProgress=this.handleProcessorProgress.bind(this),this.processor.onSuccess=this.handleProcessorSuccess.bind(this),this.processor.onError=this.handleProcessorError.bind(this),this.processor.onSliceUploaded=this.handleSliceUploaded.bind(this),t.n=7,this.processor.ready({title:this.title,payload:r});case 7:return n=t.v,t.a(2,n)}},t,this)}))}},{key:"afterPrepareProcessor",value:function(){return(0,B.m)(this,void 0,void 0,Br().m(function t(){var e;return Br().w(function(t){for(;;)switch(t.n){case 0:e=this.processKey,this.processorMap.set(e,{key:e,type:this.processorType,vid:this.videoId,processor:this.processor,backup:this.backup,title:this.title,size:0,duration:0,progress:0});case 1:return t.a(2)}},t,this)}))}},{key:"generateTitle",value:function(t){var e=new Date,r="".concat(e.toLocaleDateString().replace(/\//g,"-"),"_").concat(e.toLocaleTimeString("en-US",{hour12:!1}).slice(0,-3));switch(t){case"desktop":return this.tab?this.tab.title:"Desktop-"+r;case"camera":return"Camera-"+r;case"tab":return this.tab?"Tab-"+this.tab.title:"Tab-"+r;default:return"Record-"+r}}},{key:"parseToken",value:function(t){try{return{id:JSON.parse(atob(t.split(".")[1])).user_id+""}}catch(t){return{id:""}}}},{key:"handleDataAvailable",value:function(t){var r=this;if(!this.cancelled){if(t.data&&t.data.size>0&&this.isEmptyFmp4Data&&(this.isEmptyFmp4Data=!1),this.processor.push(t.data),this.backup&&"output"===this.backupType)if(!this.backup.push(t.data,{duration:this.recorder.duration}).then(function(){},function(){r.onException&&r.onException("saveFailed","save blob failed")})){var n="save indexDB before";t.data&&t.data.size||(n="empty blob"),this.onException&&this.onException("saveFailed",n)}Kr(e,"handleDataAvailable",this,3)([t])}}},{key:"handleRawDataAvailable",value:function(t){this.cancelled||(t.data&&t.data.size>0&&this.isEmptyData&&(this.isEmptyData=!1),t.data&&t.data.size||this.onException&&this.onException("emptyBlob","empty original blob"),this.backup&&"original"===this.backupType&&this.backup.push(t.data,{duration:this.recorder.duration}),Kr(e,"handleRawDataAvailable",this,3)([t]))}},{key:"handleProcessorConnected",value:function(t,e){if(t===this.processKey&&(this.videoId=e.vid),this.processorMap.has(t)){var r=this.processorMap.get(t);this.processorMap.set(t,Object.assign(Object.assign({},r),{vid:e.vid})),r&&r.backup&&(null==r||r.backup.update(Object.assign({originId:e.vid,sid:e.sid},(null==e?void 0:e.backupDetails)?e.backupDetails:{})))}}},{key:"handleProcessorProgress",value:function(t,e,r){if(this.processingProgress=[r.finished,r.current,r.total],this.processorMap.has(t)){var n=this.processorMap.get(t).backup;null==n||n.update({uploadedSlice:r.binarySlice,progress:e})}this.isAllDataAvailable||(this.processingProgress=[r.finished,r.current,r.total+3]),this.showStatus===yt.uploading&&this.refreshStatus()}},{key:"handleProcessorError",value:function(t,e){var r;if(t==this.processKey)switch("quotaExceeded"===e.type&&(this.report("quotaExceeded"),this.cancel()),this.showStatus){case yt.waitingAuthorized:case yt.connecting:case yt.countdown:this.prepareAbort=!0,this.cancel();break;case yt.recording:case yt.paused:this.stop()}e&&"networkError"===e.type&&t&&(null===(r=this.singleLine)||void 0===r||r.unregister(t))}},{key:"handleProcessorSuccess",value:function(t){var e;if(t==this.processKey&&(this.showStatus===yt.uploading&&(this.showStatus=yt.ready),this.recorderEvent=gt.processing_success,this.refreshStatus(),this.recorderEvent=gt.null,this.foregroundProcessing&&this.complete()),this.processorMap.has(t)){var r=this.processorMap.get(t).backup;null==r||r.remove(),this.processorMap.delete(t)}null===(e=this.singleLine)||void 0===e||e.unregister(t)}},{key:"handleSliceUploaded",value:function(t,e){return(0,B.m)(this,void 0,void 0,Br().m(function r(){var n,o;return Br().w(function(r){for(;;)switch(r.n){case 0:if(!this.processorMap.has(t)){r.n=2;break}if(n=this.processorMap.get(t),!(o=n.backup)){r.n=2;break}return r.n=1,o.updateSlice(e,{uploaded:!0});case 1:if(!this.isStorageAlert){r.n=2;break}return r.n=2,o.deleteSlice(this.backupKey,e);case 2:return r.a(2)}},r,this)}))}},{key:"handleAllDataAvailable",value:function(){var t,e;return(0,B.m)(this,void 0,void 0,Br().m(function r(){var n,o,i;return Br().w(function(r){for(;;)switch(r.n){case 0:return n=this.recorder,o=n.duration,i=n.size,r.n=1,null===(t=this.processor)||void 0===t?void 0:t.stop({duration:o,size:i});case 1:return r.n=2,null===(e=this.backup)||void 0===e?void 0:e.close(o);case 2:this.onStopDone&&this.onStopDone({key:this.processKey,title:this.title,duration:this.recorder.duration,size:this.recorder.size,processorType:this.processorType});case 3:return r.a(2)}},r,this)}))}},{key:"getUploader",value:function(){return this.processor}},{key:"start",value:function(){this.processor.start(this.recorder.mimeType),Kr(e,"start",this,3)([]);try{this.onStart&&this.onStart({options:this.options,key:this.processKey,title:this.title,processorType:this.processorType})}catch(t){}}},{key:"pause",value:function(){return this.recorder.pause(),this.processor.pause(),Kr(e,"pause",this,3)([])}},{key:"resume",value:function(){return this.recorder.resume(),this.processor.resume(),Kr(e,"resume",this,3)([])}},{key:"cancel",value:function(){var t,r,n,o=Promise.all([null===(t=this.processor)||void 0===t?void 0:t.cancel(),null===(r=this.backup)||void 0===r?void 0:r.remove()]);this.backup=null,this.processKey&&this.processorMap.set(this.processKey,Object.assign(Object.assign({},this.processorMap.get(this.processKey)),{backup:null})),null===(n=this.singleLine)||void 0===n||n.unregister(this.processKey),Kr(e,"cancel",this,3)([]);try{this.onCancel&&this.onCancel({key:this.processKey,title:this.title,processorType:this.processorType,donePromise:o})}catch(t){}}},{key:"stop",value:function(){Kr(e,"stop",this,3)([]);try{this.onStop&&this.onStop({key:this.processKey,title:this.title,duration:this.recorder.duration,size:this.recorder.size,processorType:this.processorType})}catch(t){}this.foregroundProcessing||this.complete()}},{key:"abnormalExit",value:function(){this.recorder&&this.recorder.size?(this.backup&&this.backup.close(),this.processor.stop({keepalive:!0})):(this.processor.cancel(!0),this.backup&&this.backup.remove())}},{key:"complete",value:function(){}},{key:"clear",value:function(){Kr(e,"clear",this,3)([]);try{this.onClear&&this.onClear()}catch(t){}}},{key:"getStatusData",value:function(){var t;return this.recorder?{recordType:this.options.recordType,showStatus:this.showStatus,resumeTime:this.recorder.resumeTime,countedDuration:this.recorder.countedDuration,size:this.recorder.size,countdownTime:this.countdownTime,recorderEvent:this.recorderEvent,isCameraOn:this.isCameraOn,videoTitle:this.title,processingProgress:this.processingProgress,isMicOn:this.isMicOn,videoId:this.videoId,micID:this.micID,cameraID:this.cameraID,processorRunning:this.processor.processing,tabId:this.tabId}:{recordType:null===(t=this.options)||void 0===t?void 0:t.recordType,showStatus:this.showStatus,resumeTime:0,countedDuration:0,size:0,countdownTime:this.countdownTime,recorderEvent:this.recorderEvent,isCameraOn:this.isCameraOn,videoTitle:this.title,processingProgress:this.processingProgress,isMicOn:this.isMicOn,videoId:this.videoId,micID:this.micID,cameraID:this.cameraID,processorRunning:!1,tabId:this.tabId}}},{key:"refreshStatus",value:function(){var t=this.getStatusData();this.onStatusChange&&this.onStatusChange(t)}}])}(Er),Yr=r(63188);function Xr(t){return Xr="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},Xr(t)}function tn(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return en(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(en(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,en(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,en(f,"constructor",s),en(s,"constructor",u),u.displayName="GeneratorFunction",en(s,o,"GeneratorFunction"),en(f),en(f,o,"Generator"),en(f,n,function(){return this}),en(f,"toString",function(){return"[object Generator]"}),(tn=function(){return{w:i,m:d}})()}function en(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}en=function(t,e,r,n){function i(e,r){en(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},en(t,e,r,n)}function rn(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function nn(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){rn(i,n,o,a,c,"next",t)}function c(t){rn(i,n,o,a,c,"throw",t)}a(void 0)})}}function on(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,an(n.key),n)}}function an(t){var e=function(t,e){if("object"!=Xr(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=Xr(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==Xr(e)?e:e+""}function cn(t,e,r){return e=fn(e),function(t,e){if(e&&("object"==Xr(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}(t,un()?Reflect.construct(e,r||[],fn(t).constructor):e.apply(t,r))}function un(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(t){}return(un=function(){return!!t})()}function sn(t,e,r,n){var o=ln(fn(1&n?t.prototype:t),e,r);return 2&n&&"function"==typeof o?function(t){return o.apply(r,t)}:o}function ln(){return ln="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,r){var n=function(t,e){for(;!{}.hasOwnProperty.call(t,e)&&null!==(t=fn(t)););return t}(t,e);if(n){var o=Object.getOwnPropertyDescriptor(n,e);return o.get?o.get.call(arguments.length<3?t:r):o.value}},ln.apply(null,arguments)}function fn(t){return fn=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},fn(t)}function dn(t,e){return dn=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},dn(t,e)}var pn=function(t){function e(t){var r;return function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,e),(r=cn(this,e,[t])).haveEndRecord=!1,r.sendStopInfo=!1,r.haveAlertEmptyData=!1,r.reportFmp4Time=0,r.reportEmptyData=0,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&dn(t,e)}(e,t),function(t,e,r){return e&&on(t.prototype,e),r&&on(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}(e,[{key:"getUid",value:(d=nn(tn().m(function t(){return tn().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t){chrome.runtime.sendMessage({action:"getUID"},function(e){t(e)})}))},t)})),function(){return d.apply(this,arguments)})},{key:"getProcessorConfig",value:(f=nn(tn().m(function t(){var e,r,n;return tn().w(function(t){for(;;)switch(t.n){case 0:return e=this.options.payload,t.n=1,this.getUid();case 1:return r=t.v,n={wsUrl:P.Z.wsUrl+"/websocket2/video/open?time="+Date.now(),apiBase:P.Z.baseUrl,token:r.sid,uid:r.uid,tabTitle:e.tabTitle,maxQueueBlobSlice:200,setTimeout:(0,c.fx)()?Yr.$:null,clearTimeout:(0,c.fx)()?Yr.x:null},t.a(2,n)}},t,this)})),function(){return f.apply(this,arguments)})},{key:"safeSendMessageToTab",value:(s=nn(tn().m(function t(e,r){var n;return tn().w(function(t){for(;;)switch(t.n){case 0:if(n=this.options.crop,11!==e.action){t.n=2;break}return t.n=1,l({action:"sendMessageToTab",tabid:r,data:{action:"setup-camera",crop:n||"",deviceId:e.cameraId}});case 1:"err"==t.v&&(this.isCameraOn=!1,this.refreshStatus()),t.n=3;break;case 2:12===e.action&&l({action:"sendMessageToTab",tabid:r,data:{action:"stop-camera"}});case 3:return t.a(2)}},t,this)})),function(t,e){return s.apply(this,arguments)})},{key:"complete",value:function(){}},{key:"handleAllDataAvailable",value:(u=nn(tn().m(function t(){var r,n,o;return tn().w(function(t){for(;;)switch(t.n){case 0:sn(e,"handleAllDataAvailable",this,3)([]),this.haveEndRecord=!0,"none"===(r=this.processorType)?zo():"upload"===r&&(Vo(this.videoId),(n=ei())||(n="stream end"),this.isEmptyData&&(n+=" emptyRecordData"),this.videoId?this.processor instanceof U.Q&&(o=Math.floor(this.recorder.countedDuration/1e3),this.sendClickStop(this.processKey,this.processor,n,o,!1)):this.updateClickStopStatus(n,this.processKey,!1)),a.Z.dispatch("checkBackUp"),a.Z.dispatch("statusChecker");case 1:return t.a(2)}},t,this)})),function(){return u.apply(this,arguments)})},{key:"sendClickStop",value:function(t,e,r,n,o){var i=this,a=this;e.httpReportStop(r,n).then(function(e){a.sendStopInfo=!0,i.updateClickStopStatus(r,t,!0)}).catch(function(a){o?i.updateClickStopStatus(r,t,!1):setTimeout(function(){i.sendClickStop(t,e,r,n,!0)},3e3)})}},{key:"sendVideoLog",value:function(t,e){var r;this.videoId&&("noRecordData"==t||"noRecordDataFmp4"==t?r="216":"saveBackupFailed"==t&&(r="215"),r&&fetch(P.Z.baseUrl+"/api/v1/video/log",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({videoID:this.videoId,logType:r,info:JSON.stringify(e)})}).then(function(t){return t.json()}).then(function(t){}));"noRecordData"==t?chrome.runtime.sendMessage({action:"googleEvent",name:"empty_record_data",extra:JSON.stringify(e)}):"noRecordDataFmp4"==t?chrome.runtime.sendMessage({action:"googleEvent",name:"empty_record_fmp4_data",extra:JSON.stringify(e)}):"saveBackupFailed"==t&&chrome.runtime.sendMessage({action:"googleEvent",name:"save_backup_failed",extra:JSON.stringify(e)})}},{key:"updateClickStopStatus",value:function(t,e,r){if(e&&this.processorMap.has(e)){var n=this.processorMap.get(e).backup;n&&(r?null==n||n.update({clickStop:"ok",stopFrom:t}):null==n||n.update({clickStop:"failed",stopFrom:t}))}}},{key:"prepareProcessor",value:(i=nn(tn().m(function t(){var e,r,n,o;return tn().w(function(t){for(;;)switch(t.n){case 0:e=this.processorType,r=this.options.payload,o=e,t.n="download"===o?1:"storage"===o?2:"upload"===o?3:"none"===o?4:5;break;case 1:return this.processor=new K,t.a(3,6);case 2:return this.processor=new lt({autoGenerateThumbnail:this.autoGenerateThumbnail}),t.a(3,6);case 3:return this.processor=new U.Q(this.processorConfig),t.a(3,6);case 4:return this.processor=new bt(this.processorConfig),t.a(3,6);case 5:throw Error("RecorderCompat processorType not supported!");case 6:return this.processor.onConnected=this.handleProcessorConnected.bind(this),this.processor.onError=this.handleProcessorError.bind(this),this.processor.onProgress=this.handleProcessorProgress.bind(this),this.processor.onSuccess=this.handleProcessorSuccess.bind(this),this.processor.onSliceUploaded=this.handleSliceUploaded.bind(this),this.haveEndRecord=!1,this.sendStopInfo=!1,t.n=7,this.processor.ready({title:this.title,payload:r});case 7:return n=t.v,t.a(2,n)}},t,this)})),function(){return i.apply(this,arguments)})},{key:"checkEmptyRecordData",value:(o=nn(tn().m(function t(e){var r,n,o,i,a,c,u,s,f,d,p,h;return tn().w(function(t){for(;;)switch(t.n){case 0:if(!(e>=1e4)||this.haveAlertEmptyData){t.n=6;break}if(!(this.isEmptyFmp4Data&&"output"==this.backupType&&this.reportFmp4Time<5)){t.n=2;break}return t.n=1,navigator.storage.estimate();case 1:r=t.v,n=r.usage,o=r.quota,(i={msg:"10s no RecordFmp4Data"}).usage=n,i.quota=o,this.sendVideoLog("noRecordDataFmp4",i),this.reportFmp4Time=this.reportFmp4Time+1,t.n=4;break;case 2:if(!(e>=9e4&&this.isEmptyFmp4Data&&"output"==this.backupType)){t.n=4;break}return this.haveAlertEmptyData=!0,l({action:"windowsCreate",data:{type:"popup",url:"/empty-data-alert.html",left:200,top:200,width:634,height:200,focused:!0}}),t.n=3,navigator.storage.estimate();case 3:a=t.v,c=a.usage,u=a.quota,(s={msg:"90s no RecordFmp4Data"}).usage=c,s.quota=u,this.sendVideoLog("noRecordDataFmp4",s),this.cancel();case 4:if(!this.isEmptyData){t.n=6;break}return this.haveAlertEmptyData=!0,l({action:"windowsCreate",data:{type:"popup",url:"/empty-data-alert.html",left:200,top:200,width:634,height:200,focused:!0}}),this.cancel(),t.n=5,navigator.storage.estimate();case 5:f=t.v,d=f.usage,p=f.quota,(h={msg:"10s no RecordData"}).usage=d,h.quota=p,this.sendVideoLog("noRecordData",h);case 6:return t.a(2)}},t,this)})),function(t){return o.apply(this,arguments)})},{key:"onStart",value:function(t){this.haveAlertEmptyData=!1,this.reportFmp4Time=0,this.reportEmptyData=0}},{key:"onException",value:(n=nn(tn().m(function t(e,r){var n,o,i,a,c,u,s,l;return tn().w(function(t){for(;;)switch(t.n){case 0:if("saveFailed"!=e){t.n=2;break}return t.n=1,navigator.storage.estimate();case 1:n=t.v,o=n.usage,i=n.quota,(a={msg:r}).usage=o,a.quota=i,this.sendVideoLog("saveBackupFailed",a),t.n=4;break;case 2:if(!("emptyBlob"==e&&this.reportEmptyData<22)){t.n=4;break}return t.n=3,navigator.storage.estimate();case 3:c=t.v,u=c.usage,s=c.quota,(l={msg:r}).usage=u,l.quota=s,this.reportEmptyData++,this.sendVideoLog("noRecordData",l);case 4:return t.a(2)}},t,this)})),function(t,e){return n.apply(this,arguments)})},{key:"handleProcessorConnected",value:function(t,r){sn(e,"handleProcessorConnected",this,3)([t,r])}},{key:"cancelAction",value:(r=nn(tn().m(function t(){var e;return tn().w(function(t){for(;;)switch(t.n){case 0:if("upload"!=this.processorType||!this.processor){t.n=2;break}return t.n=1,this.processor.cancel();case 1:return t.n=2,null===(e=this.backup)||void 0===e?void 0:e.remove();case 2:return t.a(2)}},t,this)})),function(){return r.apply(this,arguments)})},{key:"handleProcessorProgress",value:function(t,r,n){if(sn(e,"handleProcessorProgress",this,3)([t,r,n]),a.Z.dispatch("uploadingUpdate"),chrome.runtime.sendMessage({action:"uploadingUpdate",target:"backupList"}),this.haveEndRecord&&!this.sendStopInfo&&navigator.onLine&&r>.5&&t&&this.processorMap.has(t)){var o=this.processorMap.get(t),i=o.processor,c=o.backup;if(i&&c){var u=c.detail;if(this.sendStopInfo=!0,u&&"failed"===u.clickStop){var s=Math.floor(u.duration/1e3);this.sendClickStop(t,i,u.stopFrom,s)}}}}},{key:"handleProcessorError",value:function(t,r){if(sn(e,"handleProcessorError",this,3)([t,r]),this.processorMap.has(t)&&"unknown"===r.type){var n=this.processorMap.get(t).backup;if(null==n||n.update({processStatus:"failed"}),a.Z.dispatch("uploadingUpdate"),chrome.runtime.sendMessage({action:"uploadingUpdate",target:"backupList"}),r&&r.message&&(r.message.startsWith("Please upgrade")||r.message.startsWith("Invalid channel")||r.message.startsWith("Invalid folder")||r.message.startsWith("Invalid workspace")||r.message.startsWith("Professional Plan Required")||r.message.startsWith("Permission deny")))chrome.runtime.sendMessage({action:"initAlert",alertType:r.message.startsWith("Please upgrade")||r.message.startsWith("Professional Plan Required")?"upgrade":"deny",data:this.options.payload.defaultCloudPlace}),this.getStatusData().showStatus<3?(this.cancel(),location.reload()):this.stop()}a.Z.dispatch("statusChecker")}},{key:"handleProcessorSuccess",value:function(t,e){var r;if(t==this.processKey&&(this.showStatus===yt.uploading&&(this.showStatus=yt.ready),this.recorderEvent=gt.processing_success,this.refreshStatus(),this.recorderEvent=gt.null,this.foregroundProcessing&&this.complete()),this.processorMap.has(t)){var n=this.processorMap.get(t).backup;e?null==n||n.update({processStatus:"completed",progress:1,originId:e.vid}):null==n||n.update({processStatus:"completed",progress:1}),a.Z.dispatch("uploadingUpdate"),chrome.runtime.sendMessage({action:"uploadingUpdate",target:"backupList"}),this.setTimeout(function(){null==n||n.remove(),a.Z.dispatch("statusChecker")},400),this.processorMap.delete(t)}else a.Z.dispatch("statusChecker");null===(r=this.singleLine)||void 0===r||r.unregister(t)}},{key:"sendStatusData",value:function(){this.getStatusData()}}]);var r,n,o,i,u,s,f,d}($r);var hn=r(35036),vn=(r(61337),r(55026)),mn=r(9669),yn=r.n(mn),bn=P.Z.baseUrl,gn=bn+"/api/v1",wn=["/premium/stripe/create_plan","/premium/stripe/change_plan","/folder/create","/folder/add_items","/folder/change_name","/trash/throw_into","/image/change_title","/video/update_title","/trash/restore","/trash/delete","/image/upload","/workspace/channel/move_items","/workspace/channel/load_items","/workspace/channel/load_members","/video/websocket/token","/refer/check_accept"],Sn=yn().create({baseURL:gn});function kn(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return Tn(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(Tn(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,Tn(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,Tn(f,"constructor",s),Tn(s,"constructor",u),u.displayName="GeneratorFunction",Tn(s,o,"GeneratorFunction"),Tn(f),Tn(f,o,"Generator"),Tn(f,n,function(){return this}),Tn(f,"toString",function(){return"[object Generator]"}),(kn=function(){return{w:i,m:d}})()}function Tn(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}Tn=function(t,e,r,n){function i(e,r){Tn(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},Tn(t,e,r,n)}function On(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function In(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){On(i,n,o,a,c,"next",t)}function c(t){On(i,n,o,a,c,"throw",t)}a(void 0)})}}Sn.interceptors.request.use(function(t){return t},function(){return vn.ZP.error("Network error, Request timeout!"),Promise.reject()}),Sn.interceptors.response.use(function(t){if(t&&t.data&&1===t.data.code)return Promise.resolve(t.data.data);if(t.data.code,2001===t.data.code)return Promise.reject(t.data);if(1201===t.data.code)return Promise.reject(t.data);if(t.data.msg){if(-1!==wn.indexOf(t.config.url))return Promise.reject(t.data.msg);if(vn.ZP.error(t.data.msg),"/pricing"!==window.location.pathname)return Promise.reject(t.data.msg)}},function(t){if(t.response){var e=t.response.status;vn.ZP.error("Network error! Error Code "+e)}});var jn=null,Pn=!1,En="",xn=null,Dn=!1,Cn=null,_n=0,Mn=null,Rn=[],An=[],Fn=null,Zn=null,Nn=null,Gn=!1,Un=null,Bn=!1,Ln=!1,zn=!0,qn="init",Vn="",Wn=0,Kn=0,Hn=!1,Jn="",Qn=null,$n=0,Yn=null,Xn=!1,to=[],eo=!1,ro="0:00",no=null,oo=1,io="",ao="auto-stop-timer",co=0,uo="",so=!1,lo=!!localStorage.isBrave,fo=document.createElement("video");fo.muted=!0;P.Z.baseUrl;function po(){return po=In(kn().m(function t(e){var r;return kn().w(function(t){for(;;)switch(t.n){case 0:if("desktop"!==e||!(0,c.fx)()){t.n=2;break}return t.n=1,(0,f.cF)("showGuide");case 1:r=t.v,a.Z.dispatch("verifyGuide",!r);case 2:return t.a(2)}},t)})),po.apply(this,arguments)}function ho(){G.init(),navigator.brave&&navigator.brave.isBrave().then(function(t){lo=t,localStorage.isBrave=!0}),chrome.runtime.onMessage.addListener(function(t,e,r){var n,o;if("offscreen"==t.target)switch(t.action){case"checkpin":r("hi");break;case"tests":r("hhh");break;case"record/start":jn=t.recordOptions,function(t){po.apply(this,arguments)}(En=jn.recordType);var i=jn.recordingTabId;"camera"!==En&&l({action:"insertAction",tabid:i},function(){l({action:"sendMessageToTab",tabid:i,data:{action:"insertRecordDiv"}}),"custom"==En&&l({action:"sendMessageToTab",tabid:i,data:{action:"prepareCustom"}})}),"custom"===En||(jn.isShowToolbar&&ti(),jo(jn),"camera"!==En&&jn.isRecordCam&&Qo(jn.camDeviceId,jn.recordType,!0));break;case"record/stop":Ho("recording"!==qn||t.isDiscard),t.from&&(uo=t.from),r();break;case"record/pause":Go();break;case"record/resume":Uo();break;case"record/discard":Ho(!0);break;case"record/changeMic":var a=t.deviceId;a&&(jn.micDeviceId=a,o=a,Un&&(Un.turnMicTo("on",o),Xo()),bo("mic-deviceId",a));break;case"record/changeCamera":var c=t.deviceId;c&&(jn.camDeviceId=c,function(t){var e=jn,r=(e.camDeviceId,e.recordType);Qo(t,r),Xo()}(c),bo("cam-deviceId",c));break;case"close-camera":Yo();break;case"hideAnnBar":Jo();break;case"embedCameraFailed":l({action:"openNewTab",data:"/getAccess.html"}),Un&&Un.turnCameraTo("off");break;case"init-camera":!function(){var t=jn,e=t.recordType,r=t.camDeviceId;"camera"!==e&&(Ln||Nn?Yo():Qo(r,e))}();break;case"record/getInfo":var u=t.keys;r(function(t){if("string"==typeof t)return Eo(t);if(Array.isArray(t))return t.map(function(t){return Eo(t)})}(u));break;case"record/toggleMic":!function(){Bn?Un.turnMicTo("off"):Un.turnMicTo("on",jn.micDeviceId||"default");l({action:"updateRecordUI"}),Ao("updateRecordUI",{audStatus:Wn,camStatus:Kn})}();break;case"record/toggleToolbar":!function(){var t=jn,e=t.recordType,r=t.isShowToolbar;"camera"!==e&&(r?Jo():ti(Vn,jn.cropObj))}();break;case"autoStop/toggle":!function(t){Dn=t,t||(timerHour=0,timerMin=0,timerSec=0,no=0);Oo()}(t.isOn);break;case"autoStop/updateTimer":var s=t.data;!function(t,e,r){Cn.timerHour=t,Cn.timerMin=e,Cn.timerSec=r,Dn=!0,Oo(),Lo()}(s.hour,s.min,s.sec);break;case"autoStop/resetTimer":no=$n;break;case"recordTime":wo(t.data);break;case"record/startCustom1":var f=t.data;t.ratio;null!==(n=jn)&&void 0!==n&&n.isShowToolbar&&ti(!1,f),jn.streamId=t.streamId,jn.isRecordCam&&(Nn?l({action:"sendMessageToTab",tabid:Jn,data:{action:"setup-camera",crop:"custom"===En?crop:"",deviceId:jn.camDeviceId}}):Qo(jn.camDeviceId,"custom",!0)),jo(jn,f);break;case"tabUpdated":if(jn){var d=jn.isShowToolbar,p=t.tabid;d&&ti(Vn,jn.cropObj),function(t){var e=jn,r=e.micDeviceId,n=e.camDeviceId,o={audios:Rn.map(function(t){return{deviceId:t.deviceId,label:t.label}}),cams:An.map(function(t){return{deviceId:t.deviceId,label:t.label}}),defaultMic:r||"default",defaultCam:n||"default"};l({action:"sendMessageToTab",tabid:t,data:{action:"devices",data:o}})}(p)}break;case"reloadRecorder":!function(){yo.apply(this,arguments)}();break;case"checkUploadingRecord":return function(){return mo.apply(this,arguments)}().then(function(t){r(t)}),!0;case"containVideo":var h=t.videoId;return h&&function(t){return vo.apply(this,arguments)}(h).then(function(t){r(t)}),!0}})}function vo(){return(vo=In(kn().m(function t(e){var r,n;return kn().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,(0,hn.gm)();case 1:if(r=t.v,n=!1,!(r.length>0)){t.n=2;break}return r.forEach(function(t){t.originId==e&&(n=!0)}),t.a(2,n);case 2:return t.a(2,!1);case 3:return t.a(2)}},t)}))).apply(this,arguments)}function mo(){return(mo=In(kn().m(function t(){var e,r,n;return kn().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,(0,hn.gm)();case 1:if(e=t.v,r=Date.now(),n={unfinished:!1,tookLongtime:!1,afterOneMinute:!1,isBeginRecorded:Pn},!(e.length>0)){t.n=2;break}return n.unfinished=!0,e.forEach(function(t){r-t.closeAt>18e5&&(n.tookLongtime=!0),r-t.closeAt>6e4&&(n.afterOneMinute=!0)}),t.a(2,n);case 2:return t.a(2,n);case 3:return t.a(2)}},t)}))).apply(this,arguments)}function yo(){return(yo=In(kn().m(function t(){return kn().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,Un.cancelAction();case 1:location.reload();case 2:return t.a(2)}},t)}))).apply(this,arguments)}function bo(t,e){return go.apply(this,arguments)}function go(){return(go=In(kn().m(function t(e,r){var n;return kn().w(function(t){for(;;)switch(t.n){case 0:e&&r&&((n={})[e]=r,l({action:"updateStorage",type:"options",data:n}));case 1:return t.a(2)}},t)}))).apply(this,arguments)}function wo(t){l({action:"setBadge",type:"text",data:ro=t}),(0,c.fx)()&&a.Z.dispatch("timeUpdated",ro),Ao("updateRecordTime",ro)}function So(t,e){var r=!1;t!==Ln&&(Ln=t,r=!0,Kn=t?2:An.length>0?1:3),e!==Bn&&(Bn=e,r=!0,Wn=e?2:Rn.length>0?1:3),r&&(l({action:"updateRecordUI"}),Ao("updateRecordUI",{audStatus:Wn,camStatus:Kn}))}function ko(t,e){zn=!t.videoFormat||"mp4"!=t.videoFormat,Un||((Un=globalThis.window?new pn({backupStrategy:"upload",mimeTypes:[Ko()],timeSlice:500,noFragmentedMp4:!0,pipCameraAspectRatio:1.78,setTimeout:(0,c.fx)()?Yr.$:null,clearTimeout:(0,c.fx)()?Yr.x:null,foregroundProcessing:!1,mediaSources:["screen","window","audio"]}):null).onCatch=function(t,e){"cancelShareScreen"===t||("startFailed"===t?(!function(t){var e,r;t&&("NotAllowedError"===t.name?/Permission denied by system/.test(t)?(e="mac",/Mac OS/.test(window.navigator.userAgent)||(e="win"),/\[Mic\]/.test(t)?r="mic":"camera"===jn.recordType&&(r="camera")):/Could not start audio source/.test(t)&&(e="win",r="mic"):"NotReadableError"===t.name&&(e="mac",r="browser_issue",/Mac OS/.test(window.navigator.userAgent)||(e="win",r="mic")));if(e){var n="/permission-denied.html?os="+e;r&&(n+="&type="+r),l({action:"openNewTab",data:n})}}(e),_o()):"cameraUnavailable"===t&&(l({action:"openNewTab",data:"/getAccess.html"}),Ln=!1))},Un.showTimer=function(t){t.length>2&&(wo(t),Lo())}),Un.ready({recordType:"custom"===t.recordType?"tab":t.recordType,microphone:{deviceId:t.micDeviceId,open:t.isRecordMic},camera:{deviceId:t.camDeviceId,open:t.isRecordCam},crop:e||"",quality:{equivalent:"4k"==t.resolution?"4k":t.resolution+"p"},tabId:t.recordingTabId,streamId:t.streamId,processorType:"local"===t.saveLocation?"none":"upload",countdown:1e3*parseInt(jn.countdown),tabAudio:t.isRecordTabSound,title:t.recordingTabTitle,payload:{videoCodec:zn?d:h,tabUrl:t.recordingTabUrl,tabTitle:t.recordingTabTitle,appAndPlatform:xo(),recordType:t.recordType,recorderVersion:t.recorderVersion,appVersion:navigator.userAgent,screenSize:t.screenWidth+"*"+t.screenHeight,defaultCloudPlace:t.defaultCloudPlace}}),Un.onStatusChange=function(){var t=In(kn().m(function t(e){var r,n,o,i,u,s,f,d,p,h,v,m,y,b,g,w;return kn().w(function(t){for(;;)switch(t.n){case 0:r=e.showStatus,a.Z.dispatch("uploadingUpdate"),l({action:"uploadingUpdate",target:"backupList"}),1===r?e.recorderEvent==gt.stop?(setTimeout(function(){Co()},100),a.Z.dispatch("statusChecker")):e.recorderEvent!=gt.cancel&&e.recorderEvent!==gt.abort_cancel||(Yn&&Yn.saveName&&j.remove(Yn.saveName),Yn&&Yn.info&&G.delete(Yn.info.id),Jn&&l({action:"sendMessageToTab",tabid:Jn,data:{action:"stop-countdown"}}),a.Z.dispatch("discardAction",Un.backupKey),a.Z.dispatch("statusChecker"),Co(),o=(n=jn).recordType,i=n.recordBgTabId,u=n.mainWinId,s=n.recordBgWinId,"desktop"===o&&(0,c.fx)()&&A(i,u,s),l({action:"uploadingUpdate",target:"backupList"})):3===r?(wo(ro),So(e.isCameraOn,e.isMicOn),Mo("recording")):4===r?So(e.isCameraOn,e.isMicOn):5===r?(d=(f=jn).recordType,p=f.recordBgTabId,h=f.mainWinId,v=f.recordBgWinId,"desktop"===d&&(0,c.fx)()&&A(p,h,v)):6===r&&(y=(m=jn).recordType,b=m.recordBgTabId,g=m.mainWinId,w=m.recordBgWinId,"desktop"===y&&(0,c.fx)()&&A(b,g,w),Po(),l({action:"prepare-recording"}),Oo(),To(),_o(),a.Z.dispatch("statusChecker"));case 1:return t.a(2)}},t)}));return function(e){return t.apply(this,arguments)}}(),Un.onDataAvailable=function(e){"local"===t.saveLocation&&function(t){No.apply(this,arguments)}(e.data)}}function To(){var t=Un.getTask("norm-task");t||(t={id:"norm-task",init:function(){},generate:function(t,e){return function(t){var e=jn,r=e.isSaveLocal,n=e.saveLocation;lo||navigator.storage.estimate().then(function(t){var e=t.quota-t.usage;if(!isNaN(e)&&e<1073741824){Un.updateStorageAlert(!0),Ho();var r=window.screen.width,n=window.screen.height,o=(r-400)/2,i=(n-380)/2;setTimeout(function(){l({action:"windowsCreate",data:{type:"popup",url:"/storage-alert.html",left:o||200,top:i||200,width:500,height:470,focused:!0}})},2e3)}else!isNaN(e)&&e<2147483648&&!so&&(Un.updateStorageAlert(!0),so=!0)});var o=Un.getTask(ao);"cloud"!==n||r||o||l({action:"getPremiumLevel"},function(e){var r=e?144e5:108e5;t>=oo*r&&t<=oo*r+100&&(l({action:"windowsCreate",data:{type:"popup",url:"/notification.html",left:0,top:0,width:300,height:400,focused:!0}}),oo++)});Un.checkEmptyRecordData(t),t>=301e3&&l({action:"getStorage",type:"userinfo"},function(t){t.userinfo?"local"===n||r?t.userinfo.premiumLevel<2&&(1===t.userinfo.premiumLevel&&0===t.userinfo.newPremium||Ho()):t.userinfo.videoTotalLimitation>=t.userinfo.videoLimitation&&t.userinfo.premiumLevel<2&&(uo="5mins_stop",Ho()):Ho()});t>=216e5&&(uo="6hours",Ho())}(e),$n=e,!1}},Un.setTask(t))}function Oo(){var t=Un.getTask(ao);if(Dn&&Cn.timerHour+Cn.timerMin+Cn.timerSec>0){var e=$n,r=1e3*(Cn.timerSec+60*Cn.timerMin+3600*Cn.timerHour)+(e||0);co=r+100,t?t.duration=co:Un.setTask({id:ao,action:"stop",duration:co})}else t&&Un.removeTask(ao)}function Io(){return jn?jn.saveLocation:"local"}function jo(t,e){Yn=null,Xn=!1,eo=!1,to=[],ro="0:00",uo="",jn=t,ko(t,e),jn.isSaveLocal="local"===t.saveLocation,Jn=jn.recordingTabId,e&&(xn=e,jn.cropObj=e),Pn=!0,l({action:"keepAwake"}),l({action:"updateContextMenu",isBeginRecorded:Pn}),Dn=t.isAutoStop,Cn={timerHour:t.autoStopHour,timerMin:t.autoStopMin,timerSec:t.autoStopSec},_n=parseInt(jn.countdown),s().then(function(t){var e,r,n;Rn=t.availableAudioDevices,An=t.availableVideoDevices,r=(e=jn).micDeviceId,n=e.camDeviceId,l({action:"broadCastMessage",data:{action:"devices",data:{audios:Rn.map(function(t){return{deviceId:t.deviceId,label:t.label}}),cams:An.map(function(t){return{deviceId:t.deviceId,label:t.label}}),defaultMic:r||"default",defaultCam:n||"default"}}})}),Mo("preparing"),(0,c.I1)("start_recording_"+t.recordType,t.recordType)}function Po(){var t=jn.countdown;l({action:"setBadge",type:"color",data:"#E53935"}),l({action:"updateWindowStatus"}),t>0?Jn&&"camera"!==En?l({action:"insertAction",tabid:Jn},function(){l({action:"sendMessageToTab",tabid:Jn,data:{action:"startCountDown",countdown:parseInt(t)}}),Ro()}):Ro():Do()}function Eo(t){switch(t){case"time":return ro;case"isInCountdown":return Gn;case"isPaused":return Hn;case"socketClient":return null;case"autoTimerInfo":return Cn;case"isAutoTimerStop":return Dn;case"recordTimeLength":return $n;case"startAutoStop":return no;case"countdown":return _n;case"cameraStream":return Ln||!!Nn;case"audioStream":return Bn;case"isShowToolbar":return jn.isShowToolbar;case"isBeginRecorded":return Pn;case"recordingStatus":return qn;case"autoStopTime":return io;case"devicesInfo":return{audioDevices:Rn.length,videoDevices:An.length}}}function xo(){return/Edg/.test(navigator.userAgent)?"Edge extension":"Chrome extension"}function Do(){Ao("done_start"),l({action:"start-recording"}),Vn=!0,Mo("recording"),(new Date).getTime()}function Co(){var t=jn.isShowToolbar;Jn&&(l({action:"sendMessageToTab",tabid:Jn,data:{action:"removeRecordDiv"}}),l({action:"sendMessageToTab",tabid:Jn,data:{action:"endSelect"}})),l({action:"stop-recording",data:!0}),l({action:"setRecordDefault"}),Fn&&(Fn.getTracks().forEach(function(t){t.stop()}),Fn.onended&&Fn.onended()),ro="0:00",l({action:"updateContextMenu",isBeginRecorded:!1}),t&&Jo(),Ln=!1,Bn=!1,so=!1,localStorage.alertStorage="0",l({action:"releaseKeepAwake"}),Zn&&Zn.stop(),Mn&&(clearInterval(Mn),Mn=null),Pn=!1,Un=null,Fn=null,Zn=null,Nn=null,Vn=!1,Mo("init"),Hn=!1,oo=1,_n=0,Gn=!1,Qn&&(clearInterval(Qn),Qn=null),Jn="",Wn=1,Kn=1,l({action:"setBadge",type:"text",data:""}),no=0,$n=0,Dn=!1,io=""}function _o(){l({action:"updateStorage",type:"options",data:{"auto-timer-stop":!1,"auto-hour":0,"auto-min":0,"auto-sec":0}})}function Mo(t){qn=t,l({action:"saveStorage",type:"recordingStatus",data:t}),a.Z.dispatch("statusChange",t),l({action:"updateRecordStatus",target:"backupList",data:t}).catch(function(){})}function Ro(){Gn=!0,Mo("countdown"),l({action:"setBadge",type:"text",data:_n+""}),a.Z.dispatch("countdownChange",_n),Mn=setInterval(function(){if(1===_n)return clearInterval(Mn),l({action:"setBadge",type:"text",data:"0:00"}),_n=0,void Do();_n>=1?(l({action:"setBadge",type:"text",data:--_n+""}),a.Z.dispatch("countdownChange",_n)):clearInterval(Mn)},985)}function Ao(t,e){var r=jn.recordType;"desktop"===r?l({action:"broadCastMessage",data:{action:t,data:e}}):"tab"!==r&&"custom"!==r||Jn&&l({action:"sendMessageToTab",tabid:Jn,data:{action:t,data:e}})}function Fo(t,e){var r=jn.recordType;return new Promise(function(n){Xn&&n(),Yn={size:0};var o=function(t){if("desktop"===t||"tab"===t||"custom"===t)return jn.recordingTabTitle;if("camera"===t){var e=new Date;return"Camera-"+(e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate()+"-"+e.getHours()+"-"+e.getMinutes()+"-"+e.getSeconds())}}(r),i=function(t){if("desktop"===t)var e="Desktop";else if("tab"===t||"custom"===t)e="Tab";else if("camera"===t)e="Camera";return e+"-"+(new Date).getTime()}(r);j.save(t,i).then(function(r){return G.save({fileUrl:r,title:o,size:(0,c.RD)(t.size),duration:e,recordType:jn.recordType,codecs:zn?d:h})}).then(function(e){Yn.saveName=i,Yn.info=e,Yn.size=t.size,Xn=!0,eo=!1,n()})})}function Zo(){for(eo=!0;to.length>0&&Yn;){var t=to.shift();j.append(t,Yn.saveName);var e=Yn.info;e.detail&&(Yn.size+=t.size,e.detail.size=(0,c.RD)(Yn.size),"0:00"!=ro&&(e.detail.duration=ro),G.update(e.id,Yn.info))}eo=!1}function No(){return(No=In(kn().m(function t(e){return kn().w(function(t){for(;;)switch(t.n){case 0:jn.recordType,e&&(Yn?(to.push(e),Xn&&!eo&&Zo()):Fo(e,ro).then(function(){eo||Zo()}));case 1:return t.a(2)}},t)}))).apply(this,arguments)}function Go(t,e){var r=jn,n=r.recordType;r.isShowToolbar,r.saveLocation,r.isSaveLocal;Hn||(Un.pause(),Hn=!0,Bo(!0),"camera"===n&&l({action:"pause-recording"}),a.Z.dispatch("togglePaused",!0))}function Uo(){Un.resume(),Hn=!1,Bo(!1),a.Z.dispatch("togglePaused",!1)}function Bo(t){var e=jn,r=e.recordType,n=e.isShowToolbar;t?n&&("tab"===r||"custom"===r?Jn&&l({action:"sendMessageToTab",tabid:Jn,data:{action:"pause"}}):"desktop"===r?l({action:"broadCastMessage",data:{action:"pause"}}):"camera"===r&&l({action:"pause-recording"})):n&&("tab"===r||"custom"===r?l({action:"sendMessageToTab",tabid:Jn,data:{action:"resume"}}):"desktop"===r?l({action:"broadCastMessage",data:{action:"resume"}}):"camera"===r&&l({action:"resume-recording"}))}function Lo(){var t=Cn,e=t.timerHour,r=t.timerMin,n=t.timerSec;if(Dn&&e+r+n>0){Un.getStatusData();var o=0;co-200>=$n&&(o=co-$n-200),o=Math.floor(o/1e3);var i=Math.floor(o/3600),a=Math.floor((o-3600*i)/60),c=o%60;c<10&&(c="0"+c),io=(i>0?i+":":"")+(i>0&&0==a?"00":a)+":"+c}}function zo(){setTimeout(function(){Yn&&Yn.info&&Yn.info.id&&l({action:"openNewTab",data:"/video-react.html?id="+Yn.info.id})},250),Co(),chrome.storage&&(0,f.Ot)("showGuide",!0)}function qo(t){l({action:"getOptionSetting",data:"autoShareUrl_record"},function(e){e&&Sn({method:"GET",url:"/video/get_share_link",params:{id:t}})})}function Vo(t){return Wo.apply(this,arguments)}function Wo(){return(Wo=In(kn().m(function t(e){var r;return kn().w(function(t){for(;;)switch(t.n){case 0:if(!e){t.n=1;break}l({action:"openNewTab",data:P.Z.baseUrl+"/video/"+e}),qo(e),t.n=4;break;case 1:if(!chrome.storage){t.n=3;break}return t.n=2,(0,f.cF)("recordTab");case 2:(r=t.v)&&chrome.tabs.update(r,{pinned:!0,highlighted:!0}),t.n=4;break;case 3:l({action:"openNewTab",data:"/backup-list.html"});case 4:chrome.storage&&(0,f.Ot)("showGuide",!0),Co();case 5:return t.a(2)}},t)}))).apply(this,arguments)}function Ko(){return zn?p:v}function Ho(t,e){t?Un.cancel():Un.safeStop(),e&&(uo=e)}function Jo(){jn.isShowToolbar;Ao("remove-toolbar",{}),jn.isShowToolbar=!1,l({action:"updateRecordUI"})}function Qo(t,e,r){return $o.apply(this,arguments)}function $o(){return $o=In(kn().m(function t(e,r,n){var o,i,a,c,u;return kn().w(function(t){for(;;)switch(t.n){case 0:"tab"===r||"custom"===r?(i=(o=jn).recordingTabId,a=o.camDeviceId,n?(l({action:"sendMessageToTab",tabid:i,data:{action:"setup-camera",crop:"custom"===r?xn:"",deviceId:a}}),Nn=!0):null===(c=Un)||void 0===c||c.turnCameraTo("on",e||"default")):null===(u=Un)||void 0===u||u.turnCameraTo("on",e||"default"),n&&Ao("updateRecordUI",{audStatus:Wn,camStatus:Kn});case 1:return t.a(2)}},t)})),$o.apply(this,arguments)}function Yo(){var t=jn,e=t.recordType,r=t.recordingTabId;l("tab"===e||"custom"===e?{action:"sendMessageToTab",tabid:r,data:{action:"stop-camera"}}:{action:"stop-camera"}),Un&&Un.turnCameraTo("off")}function Xo(){var t=jn,e=t.micDeviceId,r=t.camDeviceId;Ao("defaultDevice",{defaultMic:e||"default",defaultCam:r||"default"})}function ti(t,e){var r=jn,n=r.recordType,o=r.recordingTabId;r.isShowToolbar;"tab"===n||"custom"===n?l({action:"insertContent",tabid:o,data:{action:"setup-toolbar",isRecorded:t,crop:"custom"===n?e:"",audStatus:Wn,camStatus:Kn,recordTime:ro,isPaused:Hn}}):"desktop"===n&&l({action:"insertAllContent",data:{action:"setup-toolbar",isRecorded:t,audStatus:Wn,camStatus:Kn,recordTime:ro,isPaused:Hn}}),jn.isShowToolbar=!0,l({action:"updateRecordUI"})}function ei(){return uo}G.init(),chrome.runtime.connect({name:"record"}).onMessage.addListener(function(t){t.action});var ri=r(85893);function ni(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return oi(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?oi(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oi(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}const ii=function(){var t=ni((0,o.useState)(0),2),e=t[0],r=t[1],n=!1;function i(t){n&&r(t)}return(0,o.useEffect)(function(){a.Z.on("countdownChange",i),n=!0},[]),(0,ri.jsxs)("div",{className:"countdown-panel",children:[(0,ri.jsx)("div",{className:"cd-tip",children:"Recording will start in"}),(0,ri.jsx)("div",{className:"cd-text",children:e})]})};r(81211);var ai=r(2214),ci=r(35552);const ui=function(t){var e=t.time,r=t.isPaused,n=t.handlePause,o=t.handleResume,i=t.handleDiscard,a=t.handleStop;return(0,ri.jsxs)("div",{className:"record-panel ".concat(r?"paused":""),children:[(0,ri.jsx)("div",{className:"recording-status",children:(0,ri.jsxs)(ri.Fragment,{children:[(0,ri.jsx)("div",{className:"recording-icon ".concat(r?"paused":"")}),r?"Paused":"Recording"]})}),(0,ri.jsx)("div",{className:"time",children:e}),(0,ri.jsxs)("div",{className:"btn-area",children:[(0,ri.jsx)("div",{className:"record-action-btn tiny",onClick:function(){ai.Z.confirm({title:chrome.i18n.getMessage("warning"),content:chrome.i18n.getMessage("discard_p"),okText:chrome.i18n.getMessage("discard_p_yes"),cancelText:chrome.i18n.getMessage("discard_p_no"),onOk:i,okType:"danger"})},children:(0,ri.jsx)(ci.GR,{})}),(0,ri.jsxs)("div",{className:"actions",children:[r?(0,ri.jsx)("div",{className:"record-action-btn tiny",onClick:o,children:(0,ri.jsx)(ci.a6,{})}):(0,ri.jsx)("div",{className:"record-action-btn tiny",onClick:n,children:(0,ri.jsx)(ci.HC,{})}),(0,ri.jsxs)("div",{className:"record-action-btn stop",onClick:a,children:[(0,ri.jsx)(ci.UB,{}),"Stop"]})]})]})]})};function si(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||function(t,e){if(t){if("string"==typeof t)return li(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?li(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function li(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}const fi=function(t){t.status;var e=si((0,o.useState)("00:00"),2),r=e[0],n=e[1],i=si((0,o.useState)(!1),2),c=i[0],u=i[1],s=!1;function l(t){s&&u(t)}function f(t){s&&n(t)}return(0,o.useEffect)(function(){return a.Z.on("timeUpdated",f),a.Z.on("togglePaused",l),s=!0,function(){a.Z.remove("timeUpdated",f),a.Z.remove("togglePaused",l)}},[]),(0,ri.jsx)(ui,{time:r,isPaused:c,handlePause:function(){Go()},handleResume:function(){Uo()},handleDiscard:function(){Ho(!0)},handleStop:function(){Ho(!1,"pinTab")}})};var di=r(59631),pi=r(95915);const hi=function(t){var e=t.showGuide,r=t.isWindows;return(0,ri.jsxs)("div",{className:"guide-container ".concat(e?"show":""),children:[(0,ri.jsxs)("div",{className:"bubble left-top",children:[(0,ri.jsx)("div",{className:"guide-title",children:"Step 1"}),(0,ri.jsx)("div",{className:"guide-msg",children:"Click to select the screen under entir screen"})]}),r?(0,ri.jsxs)("div",{className:"bubble left-bottom",children:[(0,ri.jsx)("div",{className:"guide-title",children:"Step 2"}),(0,ri.jsx)("div",{className:"guide-msg",children:"Check the system sound"})]}):(0,ri.jsx)(ri.Fragment,{}),(0,ri.jsxs)("div",{className:"bubble right-bottom ".concat(r?"windows":""),children:[(0,ri.jsx)("div",{className:"guide-title",children:r?"Step 3":"Step 2"}),(0,ri.jsx)("div",{className:"guide-msg",children:"Click the Share button to start recording."}),(0,ri.jsx)(ci.m2,{})]})]})};function vi(t){return Oi(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||ki(t)||Si()}function mi(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return yi(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(yi(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,yi(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,yi(f,"constructor",s),yi(s,"constructor",u),u.displayName="GeneratorFunction",yi(s,o,"GeneratorFunction"),yi(f),yi(f,o,"Generator"),yi(f,n,function(){return this}),yi(f,"toString",function(){return"[object Generator]"}),(mi=function(){return{w:i,m:d}})()}function yi(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}yi=function(t,e,r,n){function i(e,r){yi(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},yi(t,e,r,n)}function bi(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function gi(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){bi(i,n,o,a,c,"next",t)}function c(t){bi(i,n,o,a,c,"throw",t)}a(void 0)})}}function wi(t,e){return Oi(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,c=[],u=!0,s=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;u=!1}else for(;!(u=(n=i.call(r)).done)&&(c.push(n.value),c.length!==e);u=!0);}catch(t){s=!0,o=t}finally{try{if(!u&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(s)throw o}}return c}}(t,e)||ki(t,e)||Si()}function Si(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function ki(t,e){if(t){if("string"==typeof t)return Ti(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?Ti(t,e):void 0}}function Ti(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function Oi(t){if(Array.isArray(t))return t}if(window){var Ii=document.createElement("script");Ii.src="./mp4_muxer.js",document.head.appendChild(Ii),window.Module={},window.Module.inited=!1,window.Module.onRuntimeInitialized=function(){window.Module.inited=!0}}const ji=function(){var t=wi((0,o.useState)("init"),2),e=t[0],r=t[1],n=wi((0,o.useState)([]),2),u=n[0],s=n[1],l=wi((0,o.useState)(0),2),f=l[0],d=l[1],p=wi((0,o.useState)(!1),2),h=p[0],v=p[1],m=wi((0,o.useState)(!0),2),y=m[0],b=m[1],g=wi((0,o.useState)(!1),2),w=g[0],S=g[1],k=wi((0,o.useState)(5),2),T=k[0],O=k[1],I=wi((0,o.useState)(!1),2),j=I[0],P=I[1],E=null,x=(0,o.createRef)();x.current=u;var D=5,C=(0,o.createRef)();C.current=e;var _=0;(0,o.useEffect)(function(){return ho(),a.Z.on("statusChange",G),a.Z.on("uploadingUpdate",W),a.Z.on("statusChecker",U),a.Z.on("verifyGuide",N),a.Z.on("discardAction",Z),a.Z.on("checkBackUp",A),document.title="Recorder",b(navigator.onLine),setTimeout(function(){F(!0)},400),(0,c.fx)()&&(window.onbeforeunload=M,W()),(0,c.fx)()&&document.addEventListener("visibilitychange",gi(mi().m(function t(){var e;return mi().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,chrome.tabs.getCurrent();case 1:if(t.v,"visible"!==document.visibilityState){t.n=3;break}return t.n=2,chrome.tabs.getCurrent();case 2:(e=t.v)&&e.pinned&&(F(!0),W()),L();case 3:return t.a(2)}},t)}))),window.addEventListener("offline",function(t){b(!1),R(!1)}),window.addEventListener("online",function(t){b(!0),R(!0)}),window.navigator.connection.onchange=R,L(),chrome.runtime.onMessage.addListener(function(t,e,r){if("Recorder"==t.target)switch(t.action){case"reUpload":var n=t.data;n&&(0,hn.ws)("",n);break;case"removeBackup":t.data}}),function(){window.onbeforeunload=null}},[]);var M=function(t){("init"!==e||x.current.length>0)&&(t.returnValue="changes you made may not be saved.")};function R(t){var e=window.navigator.connection.downlink;navigator.onLine?(S(e<.15),e>.001&&F(t)):S(!0)}function A(){F(!0)}function F(t){var e=(new Date).getTime();e-_>7e4&&navigator.onLine&&t&&!t.type&&(_=e,(0,hn.Os)())}function Z(t){if(x.current.length>0&&t>=0){var e=x.current.find(function(e){return e.key===t});if(e){var r=x.current.indexOf(e);x.current.splice(r,1);var n=vi(x.current).slice(0);s(n),x.current=n}}}function N(t){v(t)}function G(t){r(t),C.current=t,U(),W(),"preparing"!==t&&v(!1),"init"!==t?P(!1):L()}function U(){return B.apply(this,arguments)}function B(){return(B=gi(mi().m(function t(){return mi().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,(0,hn.RC)();case 1:if(0==t.v.length?chrome.runtime.sendMessage({action:"offScreenStatus",data:!1}):chrome.runtime.sendMessage({action:"offScreenStatus",data:!0}),!(0,c.fx)()){t.n=3;break}return t.n=2,(0,hn.ip)();case 2:0==t.v.length&&"init"===e&&L();case 3:return t.a(2)}},t)}))).apply(this,arguments)}function L(){return z.apply(this,arguments)}function z(){return(z=gi(mi().m(function t(){var e;return mi().w(function(t){for(;;)switch(t.n){case 0:if(!(0,c.fx)()){t.n=3;break}return t.n=1,chrome.tabs.getCurrent();case 1:return e=t.v,t.n=2,(0,hn.ip)();case 2:0==t.v&&"init"===C.current?(P(!0),e.highlighted?null===E?(O(D=5),E=setInterval(function(){q()},1e3)):(O(D=5),clearInterval(E),E=setInterval(function(){q()},1e3)):(E&&clearInterval(E),E=null,D<3&&(D=3),O(D),E=setInterval(gi(mi().m(function t(){return mi().w(function(t){for(;;)switch(t.n){case 0:q();case 1:return t.a(2)}},t)})),1e3))):E&&(P(!1),O(D=5),clearInterval(E),E=null);case 3:return t.a(2)}},t)}))).apply(this,arguments)}function q(){return V.apply(this,arguments)}function V(){return(V=gi(mi().m(function t(){var e,r;return mi().w(function(t){for(;;)switch(t.n){case 0:if(D--,O(D),!(D<=0)){t.n=3;break}if(clearInterval(E),!(0,c.fx)()){t.n=3;break}return t.n=1,chrome.tabs.getCurrent();case 1:return e=t.v,t.n=2,(0,hn.ip)();case 2:r=t.v,e&&e.pinned&&(0,c.fx)()&&"init"===C.current&&0==r.length&&(x.current=[],E=null,window.close());case 3:return t.a(2)}},t)}))).apply(this,arguments)}function W(){return K.apply(this,arguments)}function K(){return(K=gi(mi().m(function t(){var e;return mi().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,(0,hn.ip)();case 1:(e=t.v).length>0&&Date.now()-f>100&&(e.sort(function(t,e){return e.createAt-t.createAt}),d(Date.now()),s(e),x.current=e);case 2:return t.a(2)}},t)}))).apply(this,arguments)}var H="init"===e&&u.length>0?"uploading":e,J=navigator.userAgent.indexOf("Windows")+navigator.userAgent.indexOf("CrOS")>0,Q="cloud"===Io;return(0,ri.jsx)("div",{className:"record-bg",children:e?(0,ri.jsxs)(ri.Fragment,{children:[(0,ri.jsx)("div",{className:"logo"}),("recording"===e||"uploading"===H||j)&&(0,ri.jsx)("div",{className:"tip "+(j?"close":""),children:(0,ri.jsxs)("div",{className:"alert-content "+(j?"close":""),children:[(0,ri.jsx)(ci.ZE,{}),j?"Your videos have been uploaded successfully. This tab will automatically close in ".concat(T," seconds."):"uploading"===H?"Please keep this page open while uploading to avoid upload failure.":"Please DO NOT close this page while recording. It will cause the recording to fail."]})}),(0,ri.jsxs)("div",{className:"center-box",children:[(0,ri.jsxs)(i.r,{test:H,children:[(0,ri.jsx)(i.J,{value:"init",children:(0,ri.jsxs)("div",{className:"empty-box",children:[(0,ri.jsx)(ci.c8,{}),(0,ri.jsx)("div",{className:"tips",children:"All Videos Uploaded "}),(0,ri.jsxs)("div",{children:["You can check your videos in"," ",(0,ri.jsx)("a",{href:"https://www.awesomescreenshot.com/my_items",target:"_blank",children:"My Items"}),"."]})]})}),(0,ri.jsx)(i.J,{value:"countdown",children:(0,ri.jsx)(ii,{})}),(0,ri.jsx)(i.J,{value:"preparing",children:Q?(0,ri.jsxs)("div",{class:"video-prepare-view",children:[(0,ri.jsxs)("div",{class:"loading",children:[(0,ri.jsx)("div",{class:"double-bounce1"}),(0,ri.jsx)("div",{class:"double-bounce2"})]}),(0,ri.jsx)("div",{class:"prepare-tip",children:"Connecting to the server"})]}):(0,ri.jsx)(ri.Fragment,{})}),(0,ri.jsx)(i.J,{value:"recording",children:(0,ri.jsx)(fi,{status:e})}),(0,ri.jsx)(i.J,{value:"uploading",children:(0,ri.jsxs)(ri.Fragment,{children:[y?(0,ri.jsx)(ri.Fragment,{}):(0,ri.jsxs)("div",{className:"network-warning",children:[(0,ri.jsx)(ci.ZE,{}),"Network Disconnect"]}),(0,ri.jsx)(pi.Z,{lists:u,poorNetWork:w,isRecorder:!0})]})})]}),"uploading"===H?(0,ri.jsxs)("div",{className:"footer",children:[(0,ri.jsx)(ci.gD,{})," You can check your uploaded videos in"," ",(0,ri.jsx)("a",{href:"https://www.awesomescreenshot.com/all_videos",target:"_blank",children:'"My videos"'}),"."]}):(0,ri.jsx)(ri.Fragment,{})]}),(0,ri.jsx)(hi,{showGuide:h,isWindows:J})]}):(0,ri.jsx)(ri.Fragment,{children:(0,ri.jsx)("div",{className:"loading",children:(0,ri.jsx)(di.Z,{size:"large"})})})})};n.render((0,ri.jsx)(ji,{}),document.getElementById("app"))},35036:(t,e,r)=>{"use strict";r.d(e,{Os:()=>S,RC:()=>j,gm:()=>D,ip:()=>E,ws:()=>T});var n=r(12964),o=r(6186),i=r(77029),a=r(83550),c=r(92427),u=r(63188),s=r(86642);function l(t){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},l(t)}function f(t){if(null!=t){var e=t["function"==typeof Symbol&&Symbol.iterator||"@@iterator"],r=0;if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length))return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}}}throw new TypeError(l(t)+" is not iterable")}function d(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),r.push.apply(r,n)}return r}function p(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?d(Object(r),!0).forEach(function(e){h(t,e,r[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):d(Object(r)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))})}return t}function h(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=l(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=l(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==l(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function v(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",o=r.toStringTag||"@@toStringTag";function i(r,n,o,i){var u=n&&n.prototype instanceof c?n:c,s=Object.create(u.prototype);return m(s,"_invoke",function(r,n,o){var i,c,u,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,c=0,u=t,d.n=r,a}};function p(r,n){for(c=r,u=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(u=i[(c=i[4])?5:(c=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(c=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,c=0))}if(o||r>1)return a;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),c=l,u=h;(e=c<2?t:u)||!f;){i||(c?c<3?(c>1&&(d.n=-1),p(c,u)):d.n=u:d.v=u);try{if(s=2,i){if(c||(o="next"),e=i[o]){if(!(e=e.call(i,u)))throw TypeError("iterator result is not an object");if(!e.done)return e;u=e.value,c<2&&(c=0)}else 1===c&&(e=i.return)&&e.call(i),c<2&&(u=TypeError("The iterator does not provide a '"+o+"' method"),c=1);i=t}else if((e=(f=d.n<0)?u:r.call(n,d))!==a)break}catch(e){i=t,c=1,u=e}finally{s=1}}return{value:e,done:f}}}(r,o,i),!0),s}var a={};function c(){}function u(){}function s(){}e=Object.getPrototypeOf;var l=[][n]?e(e([][n]())):(m(e={},n,function(){return this}),e),f=s.prototype=c.prototype=Object.create(l);function d(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,s):(t.__proto__=s,m(t,o,"GeneratorFunction")),t.prototype=Object.create(f),t}return u.prototype=s,m(f,"constructor",s),m(s,"constructor",u),u.displayName="GeneratorFunction",m(s,o,"GeneratorFunction"),m(f),m(f,o,"Generator"),m(f,n,function(){return this}),m(f,"toString",function(){return"[object Generator]"}),(v=function(){return{w:i,m:d}})()}function m(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}m=function(t,e,r,n){function i(e,r){m(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(i("next",0),i("throw",1),i("return",2))},m(t,e,r,n)}function y(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function b(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function a(t){y(i,n,o,a,c,"next",t)}function c(t){y(i,n,o,a,c,"throw",t)}a(void 0)})}}function g(){return w.apply(this,arguments)}function w(){return(w=b(v().m(function t(){return v().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t){chrome.runtime.sendMessage({action:"getUID"},function(e){t(e)})}))},t)}))).apply(this,arguments)}function S(){return k.apply(this,arguments)}function k(){return(k=b(v().m(function t(){var e,r,i,a,c,u,s,l,d,m,y;return v().w(function(t){for(;;)switch(t.n){case 0:e=new n.Z,r=new o.u,i=Date.now()+"",r.register(i),c=!1,s=function(t){},l=function(){u()},d=function(t){},m=function(){u()},y=v().m(function t(){var n,o,f,y,b,g;return v().w(function(t){for(;;)switch(t.n){case 0:return n=Date.now(),t.n=1,e.getAllDetail();case 1:return(o=t.v).filter(function(t){return"created"===t.status&&n-t.updateAt>2e5}).forEach(function(t){return e.update(p(p({},t),{},{processStatus:"failed"}),t.key)}),o.filter(function(t){return"created"===t.status&&"failed"===t.processStatus&&n-t.updateAt>2e5}).forEach(function(t){return e.remove(t.key)}),f=o.filter(function(t){return!["created"].includes(t.status)&&"fmp4"===t.storeName}),y=f.map(function(t){return t.processKey}),t.n=2,r.queryOutageKeys(y);case 2:if(b=t.v,g=f.filter(function(t){return b.includes(t.processKey)}),a=g.find(function(t){return"failed"!==t.processStatus}),g&&g.length>0&&g.reduce(function(t,e){return p(p({},t),{},h({},e.key,p(p({},e),{},{external:!0})))},{}),a){t.n=3;break}return c=!0,t.a(2,1);case 3:return s(),T(i,a.key,l,d,m),t.n=4,new Promise(function(t){u=t});case 4:return t.a(2)}},t)});case 1:if(c){t.n=4;break}return t.d(f(y()),2);case 2:if(!t.v){t.n=3;break}return t.a(3,4);case 3:t.n=1;break;case 4:r.unregister(i);case 5:return t.a(2)}},t)}))).apply(this,arguments)}function T(t,e,r,n,o){return O.apply(this,arguments)}function O(){return O=b(v().m(function t(e,r,l,f,d){var h,m,y,w,S,k,T,O,j,P,E,x,D,C,_,M,R,A;return v().w(function(t){for(;;)switch(t.n){case 0:return A=function(){if(w&&S&&!k&&(k=!0,x.stop({duration:m.duration,size:m.size}),"ok"!==m.clickStop)){var t=Math.floor(m.duration/1e3);x.httpReportStop(m.stopFrom,t).then(function(){h&&h.update({clickStop:""},r)})}},h=new n.Z,t.n=1,h.getDetail(r);case 1:if((!(m=t.v)||"completed"!=m.processStatus)&&m){t.n=2;break}return d&&d(),t.a(2);case 2:return t.n=3,g();case 3:if(!(y=t.v)||y.sid){t.n=4;break}return t.a(2);case 4:if(w=!1,S=!1,k=!1,T=!1,O=0,E=!0,!(e&&e.length>1)){t.n=6;break}return t.n=5,h.update({processKey:e},r);case 5:t.n=7;break;case 6:return E=!1,j=new o.u,P=Date.now()+"",j.register(P),e=P,t.n=7,h.update({processKey:P},r);case 7:if((x=new i.Q({wsUrl:a.Z.wsUrl+"/websocket2/video/open?time="+Date.now(),apiBase:a.Z.baseUrl,token:y.sid,uid:y.uid,sid:m.sid,maxQueueBlobSlice:200,setTimeout:(0,s.fx)()?u.$:null,clearTimeout:(0,s.fx)()?u.x:null})).onError=function(){var t=b(v().m(function t(e,n){return v().w(function(t){for(;;)switch(t.n){case 0:if(!h){t.n=2;break}if(!n||"unknown"!==n.type){t.n=1;break}return t.n=1,h.update({processStatus:"failed"},r);case 1:c.Z.dispatch("uploadingUpdate"),chrome.runtime.sendMessage({action:"uploadingUpdate",target:"backupList"}),l&&l();case 2:j&&P&&j.unregister(P);case 3:return t.a(2)}},t)}));return function(e,r){return t.apply(this,arguments)}}(),x.onProgress=function(){var t=b(v().m(function t(e,n){return v().w(function(t){for(;;)switch(t.n){case 0:if(!h||T){t.n=2;break}if(n>1&&(n=1),!(Date.now()-O>100)){t.n=2;break}return O=Date.now(),t.n=1,h.update({progress:n},r);case 1:c.Z.dispatch("uploadingUpdate"),chrome.runtime.sendMessage({action:"uploadingUpdate",target:"backupList"});case 2:f&&f(n);case 3:return t.a(2)}},t)}));return function(e,r){return t.apply(this,arguments)}}(),x.onSuccess=function(){var t=b(v().m(function t(e,n){return v().w(function(t){for(;;)switch(t.n){case 0:if(T=!0,!n||!n.vid){t.n=2;break}return t.n=1,h.update({progress:1,processStatus:"completed",originId:n.vid},r);case 1:t.n=3;break;case 2:return t.n=3,h.update({progress:1,processStatus:"completed"},r);case 3:c.Z.dispatch("uploadingUpdate"),chrome.runtime.sendMessage({action:"uploadingUpdate",target:"backupList"}),setTimeout(function(){h.remove(r),h=null,c.Z.dispatch("statusChecker","backup"),d&&d()},600),j&&P&&j.unregister(P);case 4:return t.a(2)}},t)}));return function(e,r){return t.apply(this,arguments)}}(),x.onConnected=function(){var t=b(v().m(function t(e,r){return v().w(function(t){for(;;)switch(t.n){case 0:h&&(h.update(p({originId:r.vid},null!=r&&r.backupDetails?r.backupDetails:{})),S=!0,A());case 1:return t.a(2)}},t)}));return function(e,r){return t.apply(this,arguments)}}(),x.getSlice=function(){var t=b(v().m(function t(e){var r;return v().w(function(t){for(;;)switch(t.n){case 0:if(h){t.n=1;break}return t.a(2,null);case 1:return t.n=2,h.getSlice(m.key,e);case 2:return r=t.v,t.a(2,r.data)}},t)}));return function(e){return t.apply(this,arguments)}}(),h.update({processStatus:"uploading"},r),chrome.runtime.sendMessage({action:"uploadingUpdate",target:"backupList"}),(!e||e.length<1)&&(c.Z.dispatch("uploadingUpdate"),chrome.runtime.sendMessage({action:"uploadingUpdate",target:"backupList"})),!m.originId||!E){t.n=9;break}return t.n=8,x.replenish(m.originId,m.videoName);case 8:D=t.v,x.updateTotalSliceBackup(D),S=!0,I(m.originId,"217",{videoSliceId:D+1}),A(),t.n=11;break;case 9:return C={},D=-1,E=!1,m.options&&(C=m.options.payload),t.n=10,x.ready({title:m.title,payload:C});case 10:t.v;case 11:_=isFinite(m.sliceEnd-m.sliceStart)?m.sliceEnd-m.sliceStart:2e5,x.updateBackupSlices(_),M=D+1;case 12:if(!(M<_)){t.n=15;break}return t.n=13,h.getSlice(m.key,M);case 13:(R=t.v)&&R.data?x.push(R.data):x.id&&I(x.id,"215",{msg:"getBackupDataNull"});case 14:M++,t.n=12;break;case 15:w=!0,A();case 16:return t.a(2)}},t)})),O.apply(this,arguments)}function I(t,e,r){t&&t.length>0&&fetch(a.Z.baseUrl+"/api/v1/video/log",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify({videoID:t,logType:e,info:JSON.stringify(r)})}).then(function(t){return t.json()}).then(function(t){})}function j(){return P.apply(this,arguments)}function P(){return(P=b(v().m(function t(){var e,r,i;return v().w(function(t){for(;;)switch(t.n){case 0:return e=new n.Z,new o.u,t.n=1,e.getAllDetail();case 1:if(!((r=t.v)&&r.length>0)){t.n=2;break}return i=r.filter(function(t){return!["failed"].includes(t.status)&&"fmp4"===t.storeName}),t.a(2,i);case 2:return t.a(2,[]);case 3:return t.a(2)}},t)}))).apply(this,arguments)}function E(){return x.apply(this,arguments)}function x(){return(x=b(v().m(function t(){var e,r,i;return v().w(function(t){for(;;)switch(t.n){case 0:return e=new n.Z,new o.u,t.n=1,e.getAllDetail();case 1:if(!((r=t.v)&&r.length>0)){t.n=2;break}return i=r.filter(function(t){return!["created"].includes(t.status)&&"fmp4"===t.storeName}),t.a(2,i);case 2:return t.a(2,[]);case 3:return t.a(2)}},t)}))).apply(this,arguments)}function D(){return C.apply(this,arguments)}function C(){return(C=b(v().m(function t(){var e,r,i;return v().w(function(t){for(;;)switch(t.n){case 0:return e=new n.Z,new o.u,t.n=1,e.getAllDetail();case 1:if(!((r=t.v)&&r.length>0)){t.n=2;break}return i=r.filter(function(t){return["closed"].includes(t.status)&&"fmp4"===t.storeName}),t.a(2,i);case 2:return t.a(2,[]);case 3:return t.a(2)}},t)}))).apply(this,arguments)}},72769:(t,e,r)=>{"use strict";function n(){var t,e,r="function"==typeof Symbol?Symbol:{},i=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function c(r,n,i,a){var c=n&&n.prototype instanceof s?n:s,l=Object.create(c.prototype);return o(l,"_invoke",function(r,n,o){var i,a,c,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,a=0,c=t,d.n=r,u}};function p(r,n){for(a=r,c=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(a=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,a=0))}if(o||r>1)return u;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),a=l,c=h;(e=a<2?t:c)||!f;){i||(a?a<3?(a>1&&(d.n=-1),p(a,c)):d.n=c:d.v=c);try{if(s=2,i){if(a||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=i.return)&&e.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((e=(f=d.n<0)?c:r.call(n,d))!==u)break}catch(e){i=t,a=1,c=e}finally{s=1}}return{value:e,done:f}}}(r,i,a),!0),l}var u={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var d=[][i]?e(e([][i]())):(o(e={},i,function(){return this}),e),p=f.prototype=s.prototype=Object.create(d);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,o(t,a,"GeneratorFunction")),t.prototype=Object.create(p),t}return l.prototype=f,o(p,"constructor",f),o(f,"constructor",l),l.displayName="GeneratorFunction",o(f,a,"GeneratorFunction"),o(p),o(p,a,"Generator"),o(p,i,function(){return this}),o(p,"toString",function(){return"[object Generator]"}),(n=function(){return{w:c,m:h}})()}function o(t,e,r,n){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}o=function(t,e,r,n){function a(e,r){o(t,e,function(t){return this._invoke(e,r,t)})}e?i?i(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(a("next",0),a("throw",1),a("return",2))},o(t,e,r,n)}function i(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function a(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var a=t.apply(e,r);function c(t){i(a,n,o,c,u,"next",t)}function u(t){i(a,n,o,c,u,"throw",t)}c(void 0)})}}function c(t,e,r){return(e=function(t){var e=function(t,e){if("object"!=u(t)||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=u(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==u(e)?e:e+""}(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function s(t,e){return new Promise(function(r,n){var o=null;if("object"===u(t))o=t;else{if("string"!=typeof t)throw"TypeError: First argument should be a string or an object.";o=c({},t,e)}chrome.storage.local.set(o,function(){return chrome.runtime.lastError?n(chrome.runtime.lastError):r()})})}function l(t){return new Promise(function(e,r){"string"==typeof t?chrome.storage.local.get([t],function(r){e(r[t])}):Array.isArray(t)?chrome.storage.local.get(null,function(r){e(t.map(function(t){return r[t]}))}):t||chrome.storage.local.get(null,function(t){e(t)})})}function f(t){return d.apply(this,arguments)}function d(){return(d=a(n().m(function t(e){return n().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t){chrome.storage.local.get("options",function(r){t(e?r.options[e]:r.options)})}))},t)}))).apply(this,arguments)}r.d(e,{Ot:()=>s,S1:()=>f,cF:()=>l})},86642:(t,e,r)=>{"use strict";r.d(e,{I1:()=>f,RB:()=>h,RD:()=>p,VC:()=>u,fx:()=>d});r(27484),r(9669),r(40705),r(28374);var n=r(72769);function o(){var t,e,r="function"==typeof Symbol?Symbol:{},n=r.iterator||"@@iterator",a=r.toStringTag||"@@toStringTag";function c(r,n,o,a){var c=n&&n.prototype instanceof s?n:s,l=Object.create(c.prototype);return i(l,"_invoke",function(r,n,o){var i,a,c,s=0,l=o||[],f=!1,d={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(e,r){return i=e,a=0,c=t,d.n=r,u}};function p(r,n){for(a=r,c=n,e=0;!f&&s&&!o&&e<l.length;e++){var o,i=l[e],p=d.p,h=i[2];r>3?(o=h===n)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=t):i[0]<=p&&((o=r<2&&p<i[1])?(a=0,d.v=n,d.n=i[1]):p<h&&(o=r<3||i[0]>n||n>h)&&(i[4]=r,i[5]=n,d.n=h,a=0))}if(o||r>1)return u;throw f=!0,n}return function(o,l,h){if(s>1)throw TypeError("Generator is already running");for(f&&1===l&&p(l,h),a=l,c=h;(e=a<2?t:c)||!f;){i||(a?a<3?(a>1&&(d.n=-1),p(a,c)):d.n=c:d.v=c);try{if(s=2,i){if(a||(o="next"),e=i[o]){if(!(e=e.call(i,c)))throw TypeError("iterator result is not an object");if(!e.done)return e;c=e.value,a<2&&(a=0)}else 1===a&&(e=i.return)&&e.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=t}else if((e=(f=d.n<0)?c:r.call(n,d))!==u)break}catch(e){i=t,a=1,c=e}finally{s=1}}return{value:e,done:f}}}(r,o,a),!0),l}var u={};function s(){}function l(){}function f(){}e=Object.getPrototypeOf;var d=[][n]?e(e([][n]())):(i(e={},n,function(){return this}),e),p=f.prototype=s.prototype=Object.create(d);function h(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,f):(t.__proto__=f,i(t,a,"GeneratorFunction")),t.prototype=Object.create(p),t}return l.prototype=f,i(p,"constructor",f),i(f,"constructor",l),l.displayName="GeneratorFunction",i(f,a,"GeneratorFunction"),i(p),i(p,a,"Generator"),i(p,n,function(){return this}),i(p,"toString",function(){return"[object Generator]"}),(o=function(){return{w:c,m:h}})()}function i(t,e,r,n){var o=Object.defineProperty;try{o({},"",{})}catch(t){o=0}i=function(t,e,r,n){function a(e,r){i(t,e,function(t){return this._invoke(e,r,t)})}e?o?o(t,e,{value:r,enumerable:!n,configurable:!n,writable:!n}):t[e]=r:(a("next",0),a("throw",1),a("return",2))},i(t,e,r,n)}function a(t,e,r,n,o,i,a){try{var c=t[i](a),u=c.value}catch(t){return void r(t)}c.done?e(u):Promise.resolve(u).then(n,o)}function c(t){return function(){var e=this,r=arguments;return new Promise(function(n,o){var i=t.apply(e,r);function c(t){a(i,n,o,c,u,"next",t)}function u(t){a(i,n,o,c,u,"throw",t)}c(void 0)})}}function u(t){return s.apply(this,arguments)}function s(){return(s=c(o().m(function t(e){return o().w(function(t){for(;;)if(0===t.n)return t.a(2,new Promise(function(t){var r=e.filename;(0,n.S1)("download_directory").then(function(n){n&&(e.filename=n+"/"+e.filename),chrome.downloads.download(e,function(n){(void 0===n||chrome.runtime.lastError)&&l(e.url,r),t()})})}))},t)}))).apply(this,arguments)}function l(t,e){var r=document.createElement("a"),n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),r.setAttribute("href",t),r.setAttribute("download",e),r.rel="noopener",r.dispatchEvent(n)}function f(t,e){try{chrome.runtime.sendMessage({action:"googleEvent",name:t,extra:e})}catch(t){}}function d(){var t=navigator.userAgent,e=t.indexOf("Chrome/"),r=t.substring(e+7,t.length),n=r.indexOf("."),o=r.substring(0,n);return parseInt(o)<116}function p(t){if(0===t)return"0 Bytes";var e=parseInt(Math.floor(Math.log(t)/Math.log(1e3)),10);return(t/Math.pow(1e3,e)).toPrecision(3)+" "+["Bytes","KB","MB","GB","TB"][e]}function h(t){var e,r;e={},r=function(e){var r={url:t};e&&e.incognito||!e?chrome.windows.getAll(function(t){t.forEach(function(t){t.incognito||"normal"!==t.type||(r.windowId=t.id)}),v(r)}):(r.index=(e?e.index:currentTabIndex||0)+1,r.windowId=e?e.windowId:currentWindowId,v(r))},chrome.tabs.query(Object.assign({active:!0},e),function(t){r(t[0])})}function v(t){t&&t.url&&(t.hasOwnProperty("index")&&!t.index&&delete t.index,chrome.tabs.create(t,function(t){chrome.windows.update(t.windowId,{focused:!0})}))}Math.pow(2,31)}},o={};function i(t){var e=o[t];if(void 0!==e)return e.exports;var r=o[t]={exports:{}};return n[t].call(r.exports,r,r.exports,i),r.exports}i.m=n,t=[],i.O=(e,r,n,o)=>{if(!r){var a=1/0;for(l=0;l<t.length;l++){for(var[r,n,o]=t[l],c=!0,u=0;u<r.length;u++)(!1&o||a>=o)&&Object.keys(i.O).every(t=>i.O[t](r[u]))?r.splice(u--,1):(c=!1,o<a&&(a=o));if(c){t.splice(l--,1);var s=n();void 0!==s&&(e=s)}}return e}o=o||0;for(var l=t.length;l>0&&t[l-1][2]>o;l--)t[l]=t[l-1];t[l]=[r,n,o]},i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},r=Object.getPrototypeOf?t=>Object.getPrototypeOf(t):t=>t.__proto__,i.t=function(t,n){if(1&n&&(t=this(t)),8&n)return t;if("object"==typeof t&&t){if(4&n&&t.__esModule)return t;if(16&n&&"function"==typeof t.then)return t}var o=Object.create(null);i.r(o);var a={};e=e||[null,r({}),r([]),r(r)];for(var c=2&n&&t;"object"==typeof c&&!~e.indexOf(c);c=r(c))Object.getOwnPropertyNames(c).forEach(e=>a[e]=()=>t[e]);return a.default=()=>t,i.d(o,a),o},i.d=(t,e)=>{for(var r in e)i.o(e,r)&&!i.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},(()=>{var t={830:0};i.O.j=e=>0===t[e];var e=(e,r)=>{var n,o,[a,c,u]=r,s=0;if(a.some(e=>0!==t[e])){for(n in c)i.o(c,n)&&(i.m[n]=c[n]);if(u)var l=u(i)}for(e&&e(r);s<a.length;s++)o=a[s],i.o(t,o)&&t[o]&&t[o][0](),t[o]=0;return i.O(l)},r=self.webpackChunkawesomescreenshot_extension=self.webpackChunkawesomescreenshot_extension||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})(),i.O(void 0,[775,629,982,925,610,932,654,825,700,1],()=>i(32082));var a=i.O(void 0,[775,629,982,925,610,932,654,825,700,1],()=>i(30340));a=i.O(a)})();